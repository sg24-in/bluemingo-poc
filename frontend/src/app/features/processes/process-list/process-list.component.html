<div class="process-list-page">
  <div class="page-header">
    <h1 class="page-title">Processes</h1>
    <button class="btn btn-primary" (click)="createProcess()">+ New Process</button>
  </div>

  <div class="card">
    <div class="filters">
      <div class="filter-group" [class.filter-active]="filterStatus && filterStatus !== 'all'">
        <label for="status-filter">Status:</label>
        <select id="status-filter" [(ngModel)]="filterStatus" (change)="onFilterStatusChange(filterStatus)"
                [class.filter-active]="filterStatus && filterStatus !== 'all'">
          <option value="all">All Statuses</option>
          <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
        </select>
      </div>

      <div class="filter-group search-group">
        <label for="search">Search:</label>
        <input
          type="text"
          id="search"
          [(ngModel)]="searchTerm"
          (input)="onSearchChange(searchTerm)"
          placeholder="Search by process name or ID..."
        />
      </div>
    </div>
  </div>

  <div class="summary-cards" *ngIf="!loading">
    <div class="summary-card">
      <span class="count">{{ statusCounts['DRAFT'] + statusCounts['ACTIVE'] + statusCounts['INACTIVE'] }}</span>
      <span class="label">Total</span>
    </div>
    <div class="summary-card draft">
      <span class="count">{{ statusCounts['DRAFT'] }}</span>
      <span class="label">Draft</span>
    </div>
    <div class="summary-card active">
      <span class="count">{{ statusCounts['ACTIVE'] }}</span>
      <span class="label">Active</span>
    </div>
    <div class="summary-card inactive">
      <span class="count">{{ statusCounts['INACTIVE'] }}</span>
      <span class="label">Inactive</span>
    </div>
  </div>

  <div class="table-container" *ngIf="!loading; else loadingTpl">
    <table class="data-table" *ngIf="processes.length > 0; else emptyTpl">
      <thead>
        <tr>
          <th>ID</th>
          <th>Process Name</th>
          <th>Status</th>
          <th>Created</th>
          <th>Updated</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let process of processes" (click)="viewProcess(process)" class="clickable-row">
          <td>{{ process.processId }}</td>
          <td>{{ process.processName }}</td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(process.status)">
              {{ process.status }}
            </span>
          </td>
          <td>{{ process.createdOn | date:'short' }}</td>
          <td>{{ process.updatedOn | date:'short' }}</td>
          <td class="actions-cell" (click)="$event.stopPropagation()">
            <button
              *ngIf="process.status === 'DRAFT' || process.status === 'INACTIVE'"
              class="btn-icon btn-success"
              title="Activate"
              (click)="activateProcess(process)"
              [disabled]="processing">
              <span class="icon">&#10003;</span>
            </button>
            <button
              *ngIf="process.status === 'ACTIVE'"
              class="btn-icon btn-warning"
              title="Deactivate"
              (click)="deactivateProcess(process)"
              [disabled]="processing">
              <span class="icon">&#10007;</span>
            </button>
            <button class="btn-icon" title="Edit" (click)="editProcess(process)">
              <span class="icon">&#9998;</span>
            </button>
            <button class="btn-icon btn-danger" title="Delete" (click)="confirmDelete(process)">
              <span class="icon">&#128465;</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <ng-template #emptyTpl>
      <div class="empty-state">
        <p>No processes found.</p>
      </div>
    </ng-template>

    <!-- Pagination -->
    <app-pagination
      *ngIf="processes.length > 0"
      [page]="page"
      [size]="size"
      [totalElements]="totalElements"
      [totalPages]="totalPages"
      [hasNext]="hasNext"
      [hasPrevious]="hasPrevious"
      (pageChange)="onPageChange($event)"
      (sizeChange)="onSizeChange($event)"
    ></app-pagination>
  </div>

  <ng-template #loadingTpl>
    <div class="loading">Loading processes...</div>
  </ng-template>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="cancelDelete()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Delete Process</h2>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete process <strong>{{ processToDelete?.processName }}</strong>?</p>
        <p class="warning-text">This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cancelDelete()" [disabled]="deleting">Cancel</button>
        <button class="btn btn-danger" (click)="deleteProcess()" [disabled]="deleting">
          {{ deleting ? 'Deleting...' : 'Delete' }}
        </button>
      </div>
    </div>
  </div>
</div>
