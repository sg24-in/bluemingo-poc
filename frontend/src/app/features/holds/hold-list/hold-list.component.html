<div class="hold-list-container">
  <div class="page-header">
    <h2>Hold Management</h2>
    <button class="btn btn-primary" (click)="openApplyHoldModal()">
      Apply Hold
    </button>
  </div>

  <div *ngIf="error" class="alert alert-error">{{ error }}</div>
  <div *ngIf="success" class="alert alert-success">{{ success }}</div>

  <div *ngIf="loading" class="loading">
    <app-loading-spinner message="Loading holds..."></app-loading-spinner>
  </div>

  <div class="holds-table" *ngIf="!loading">
    <table *ngIf="activeHolds.length > 0">
      <thead>
        <tr>
          <th>Entity Type</th>
          <th>Entity</th>
          <th>Reason</th>
          <th>Applied By</th>
          <th>Applied On</th>
          <th>Duration</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let hold of activeHolds">
          <td>
            <span class="entity-type-badge" [ngClass]="hold.entityType.toLowerCase()">
              {{ hold.entityType }}
            </span>
          </td>
          <td>{{ hold.entityName }}</td>
          <td>{{ hold.reason }}</td>
          <td>{{ hold.appliedBy }}</td>
          <td>{{ hold.appliedOn | date:'short' }}</td>
          <td>{{ formatDuration(hold.durationMinutes) }}</td>
          <td>
            <button class="btn btn-sm btn-success" (click)="openReleaseHoldModal(hold)">
              Release
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="activeHolds.length === 0" class="no-data">
      <p>No active holds found.</p>
    </div>
  </div>
</div>

<!-- Apply Hold Modal -->
<div class="modal-overlay" *ngIf="showApplyHoldModal" (click)="closeApplyHoldModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Apply Hold</h3>
      <button class="close-btn" (click)="closeApplyHoldModal()">&times;</button>
    </div>
    <form [formGroup]="applyHoldForm" (ngSubmit)="applyHold()">
      <div class="modal-body">
        <div class="form-group">
          <label for="entityType">Entity Type *</label>
          <select id="entityType" formControlName="entityType">
            <option value="">Select entity type</option>
            <option *ngFor="let type of entityTypes" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
        </div>

        <div class="form-group" *ngIf="applyHoldForm.get('entityType')?.value">
          <label for="entityId">Entity *</label>
          <select id="entityId" formControlName="entityId">
            <option value="">Select entity</option>
            <option *ngFor="let entity of getEntityOptions()" [value]="entity.id">
              {{ entity.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="reason">Reason *</label>
          <select id="reason" formControlName="reason">
            <option value="">Select reason</option>
            <option *ngFor="let reason of holdReasons" [value]="reason.reasonCode">
              {{ reason.reasonDescription }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="comments">Comments</label>
          <textarea id="comments" formControlName="comments" rows="3"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeApplyHoldModal()">Cancel</button>
        <button type="submit" class="btn btn-warning" [disabled]="applyHoldForm.invalid || loading">
          Apply Hold
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Release Hold Modal -->
<div class="modal-overlay" *ngIf="showReleaseHoldModal" (click)="closeReleaseHoldModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Release Hold</h3>
      <button class="close-btn" (click)="closeReleaseHoldModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="hold-details" *ngIf="selectedHold">
        <p><strong>Entity:</strong> {{ selectedHold.entityType }} - {{ selectedHold.entityName }}</p>
        <p><strong>Reason:</strong> {{ selectedHold.reason }}</p>
        <p><strong>Applied By:</strong> {{ selectedHold.appliedBy }}</p>
        <p><strong>Duration:</strong> {{ formatDuration(selectedHold.durationMinutes) }}</p>
      </div>

      <div class="form-group">
        <label for="releaseComments">Release Comments</label>
        <textarea id="releaseComments" [(ngModel)]="releaseComments" rows="3"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="closeReleaseHoldModal()">Cancel</button>
      <button type="button" class="btn btn-success" (click)="releaseHold()" [disabled]="loading">
        Release Hold
      </button>
    </div>
  </div>
</div>
