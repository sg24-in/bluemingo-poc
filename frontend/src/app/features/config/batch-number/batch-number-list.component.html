<div class="config-list-page">
  <div class="page-header">
    <h1>Batch Number Config</h1>
    <button class="btn btn-primary" (click)="create()">+ New Batch Number Config</button>
  </div>

  <div class="card">
    <div class="filters">
      <div class="filter-group" [class.filter-active]="filterStatus && filterStatus !== 'all'">
        <label>Status:</label>
        <select [(ngModel)]="filterStatus" (change)="onFilterStatusChange(filterStatus)"
                [class.filter-active]="filterStatus && filterStatus !== 'all'">
          <option value="all">All</option>
          <option value="ACTIVE">Active</option>
          <option value="INACTIVE">Inactive</option>
        </select>
      </div>
      <div class="filter-group search-group">
        <label>Search:</label>
        <input type="text" [(ngModel)]="searchTerm" (input)="onSearchChange(searchTerm)" placeholder="Search by name or prefix..." />
      </div>
    </div>
  </div>

  <div class="table-container" *ngIf="!loading; else loadingTpl">
    <table class="data-table" *ngIf="items.length > 0; else emptyTpl">
      <thead>
        <tr>
          <th>Name</th>
          <th>Operation Type</th>
          <th>Product</th>
          <th>Prefix</th>
          <th>Date Format</th>
          <th>Sequence</th>
          <th>Reset</th>
          <th>Priority</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of items">
          <td>{{ item.configName }}</td>
          <td>{{ item.operationType || '-' }}</td>
          <td>{{ item.productSku || '-' }}</td>
          <td>{{ item.prefix }}</td>
          <td>{{ item.dateFormat || '-' }}</td>
          <td>{{ item.sequenceLength }}</td>
          <td>{{ item.sequenceReset }}</td>
          <td>{{ item.priority }}</td>
          <td><span class="status-badge" [ngClass]="item.status.toLowerCase()">{{ item.status }}</span></td>
          <td class="actions">
            <button class="btn btn-sm btn-secondary" (click)="edit(item)">Edit</button>
            <button class="btn btn-sm btn-danger" (click)="openDeleteModal(item)" [disabled]="item.status === 'INACTIVE'">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
    <ng-template #emptyTpl>
      <div class="empty-state"><p>No batch number configs found.</p><button class="btn btn-primary" (click)="create()">Create First Batch Number Config</button></div>
    </ng-template>
    <div class="pagination-controls" *ngIf="items.length > 0">
      <div class="page-info">Showing {{ page * size + 1 }} - {{ page * size + items.length }} of {{ totalElements }}</div>
      <div class="page-buttons">
        <button class="btn btn-sm" (click)="onPageChange(page - 1)" [disabled]="!hasPrevious">Previous</button>
        <span class="page-number">Page {{ page + 1 }} of {{ totalPages }}</span>
        <button class="btn btn-sm" (click)="onPageChange(page + 1)" [disabled]="!hasNext">Next</button>
      </div>
      <div class="page-size">
        <label>Show:</label>
        <select [(ngModel)]="size" (ngModelChange)="onSizeChange($event)">
          <option [ngValue]="10">10</option><option [ngValue]="20">20</option><option [ngValue]="50">50</option>
        </select>
      </div>
    </div>
  </div>
  <ng-template #loadingTpl><div class="loading">Loading batch number configs...</div></ng-template>

  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h2>Delete Batch Number Config</h2>
      <p>Are you sure you want to delete <strong>{{ itemToDelete?.configName }}</strong>?</p>
      <p class="warning">This will mark it as inactive.</p>
      <div class="error" *ngIf="deleteError">{{ deleteError }}</div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDeleteModal()" [disabled]="deleteLoading">Cancel</button>
        <button class="btn btn-danger" (click)="confirmDelete()" [disabled]="deleteLoading">{{ deleteLoading ? 'Deleting...' : 'Delete' }}</button>
      </div>
    </div>
  </div>
</div>
