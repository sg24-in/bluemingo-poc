<div class="batch-size-form-page">
  <div class="page-header">
    <h1>{{ title }}</h1>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">Loading configuration...</div>

  <!-- Error -->
  <div *ngIf="error" class="error-message">{{ error }}</div>

  <!-- Form -->
  <form *ngIf="!loading" [formGroup]="form" (ngSubmit)="onSubmit()" class="form-container">
    <div class="form-section">
      <h3>Scope (Leave blank for generic default)</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="operationType">Operation Type:</label>
          <select id="operationType" formControlName="operationType">
            <option value="">Any</option>
            <option *ngFor="let op of operationTypes" [value]="op">{{ op }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="materialId">Material ID:</label>
          <input type="text" id="materialId" formControlName="materialId" placeholder="e.g., RM-001">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="productSku">Product SKU:</label>
          <input type="text" id="productSku" formControlName="productSku" placeholder="e.g., STL-ROD-10">
        </div>

        <div class="form-group">
          <label for="equipmentType">Equipment Type:</label>
          <input type="text" id="equipmentType" formControlName="equipmentType" placeholder="e.g., FURNACE">
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3>Batch Size Limits</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="minBatchSize">Min Batch Size:</label>
          <input type="number" id="minBatchSize" formControlName="minBatchSize" step="0.0001" min="0">
          <span class="help-text">Minimum quantity per batch (prevents tiny batches)</span>
          <div *ngIf="hasError('minBatchSize')" class="field-error">Invalid value</div>
        </div>

        <div class="form-group">
          <label for="maxBatchSize">Max Batch Size: *</label>
          <input type="number" id="maxBatchSize" formControlName="maxBatchSize" step="0.0001" min="0.0001">
          <span class="help-text">Maximum quantity per batch (triggers multi-batch when exceeded)</span>
          <div *ngIf="hasError('maxBatchSize')" class="field-error">Max batch size is required</div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="preferredBatchSize">Preferred Batch Size:</label>
          <input type="number" id="preferredBatchSize" formControlName="preferredBatchSize" step="0.0001" min="0">
          <span class="help-text">Optimal batch size for splitting (defaults to max if not set)</span>
        </div>

        <div class="form-group">
          <label for="unit">Unit: *</label>
          <select id="unit" formControlName="unit">
            <option *ngFor="let u of units" [value]="u">{{ u }}</option>
          </select>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3>Options</h3>

      <div class="form-row">
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" formControlName="allowPartialBatch">
            Allow Partial Batch
          </label>
          <span class="help-text">If enabled, allows remainder quantities below preferred size</span>
        </div>

        <div class="form-group">
          <label for="priority">Priority:</label>
          <input type="number" id="priority" formControlName="priority" min="0">
          <span class="help-text">Higher priority configs take precedence (0 = lowest)</span>
        </div>
      </div>

      <div class="form-row" *ngIf="isEditMode">
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" formControlName="isActive">
            Active
          </label>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="cancel()">Cancel</button>
      <button type="submit" class="btn btn-primary" [disabled]="saving">
        {{ saving ? 'Saving...' : (isEditMode ? 'Update' : 'Create') }}
      </button>
    </div>
  </form>
</div>
