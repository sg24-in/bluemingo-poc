<div class="config-list-page">
  <div class="page-header">
    <h1 class="page-title">Process Parameters Config</h1>
    <button class="btn btn-primary" (click)="create()">+ New Process Parameter</button>
  </div>

  <div class="card">
    <div class="filters">
      <div class="filter-group" [class.filter-active]="filterStatus && filterStatus !== 'all'">
        <label>Status:</label>
        <select [(ngModel)]="filterStatus" (change)="onFilterStatusChange(filterStatus)"
                [class.filter-active]="filterStatus && filterStatus !== 'all'">
          <option value="all">All</option>
          <option value="ACTIVE">Active</option>
          <option value="INACTIVE">Inactive</option>
        </select>
      </div>
      <div class="filter-group search-group">
        <label>Search:</label>
        <input type="text" [(ngModel)]="searchTerm" (input)="onSearchChange(searchTerm)" placeholder="Search by operation type or parameter..." />
      </div>
    </div>
  </div>

  <div class="table-container" *ngIf="!loading; else loadingTpl">
    <table class="data-table" *ngIf="items.length > 0; else emptyTpl">
      <thead>
        <tr>
          <th>Operation Type</th>
          <th>Product SKU</th>
          <th>Parameter Name</th>
          <th>Type</th>
          <th>Unit</th>
          <th>Min</th>
          <th>Max</th>
          <th>Required</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of items">
          <td>{{ item.operationType }}</td>
          <td>{{ item.productSku || '-' }}</td>
          <td>{{ item.parameterName }}</td>
          <td>{{ item.parameterType }}</td>
          <td>{{ item.unit || '-' }}</td>
          <td>{{ item.minValue != null ? item.minValue : '-' }}</td>
          <td>{{ item.maxValue != null ? item.maxValue : '-' }}</td>
          <td>{{ item.isRequired ? 'Yes' : 'No' }}</td>
          <td><span class="status-badge" [ngClass]="item.status.toLowerCase()">{{ item.status }}</span></td>
          <td class="actions">
            <button class="btn btn-sm btn-secondary" (click)="edit(item)">Edit</button>
            <button class="btn btn-sm btn-danger" (click)="openDeleteModal(item)" [disabled]="item.status === 'INACTIVE'">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
    <ng-template #emptyTpl>
      <div class="empty-state"><p>No process parameters found.</p><button class="btn btn-primary" (click)="create()">Create First Process Parameter</button></div>
    </ng-template>
    <app-pagination
      *ngIf="items.length > 0"
      [page]="page" [size]="size"
      [totalElements]="totalElements" [totalPages]="totalPages"
      [hasNext]="hasNext" [hasPrevious]="hasPrevious"
      (pageChange)="onPageChange($event)"
      (sizeChange)="onSizeChange($event)"
    ></app-pagination>
  </div>
  <ng-template #loadingTpl><div class="loading">Loading process parameters...</div></ng-template>

  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h2>Delete Process Parameter</h2>
      <p>Are you sure you want to delete <strong>{{ itemToDelete?.parameterName }}</strong>?</p>
      <p class="warning">This will mark it as inactive.</p>
      <div class="error" *ngIf="deleteError">{{ deleteError }}</div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDeleteModal()" [disabled]="deleteLoading">Cancel</button>
        <button class="btn btn-danger" (click)="confirmDelete()" [disabled]="deleteLoading">{{ deleteLoading ? 'Deleting...' : 'Delete' }}</button>
      </div>
    </div>
  </div>
</div>
