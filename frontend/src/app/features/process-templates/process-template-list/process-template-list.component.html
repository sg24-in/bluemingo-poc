<div class="processes-container">
  <div class="page-header">
    <h1>Processes</h1>
    <button class="btn btn-primary" (click)="createProcess()">
      + New Process
    </button>
  </div>

  <div class="summary-cards" *ngIf="!loading">
    <div class="summary-card draft">
      <span class="count">{{ draftCount }}</span>
      <span class="label">Draft</span>
    </div>
    <div class="summary-card active">
      <span class="count">{{ activeCount }}</span>
      <span class="label">Active</span>
    </div>
    <div class="summary-card inactive">
      <span class="count">{{ inactiveCount }}</span>
      <span class="label">Inactive</span>
    </div>
  </div>

  <div class="filters-section">
    <div class="filters">
      <div class="filter-group">
        <label>Search:</label>
        <input type="text"
               [(ngModel)]="searchTerm"
               (keyup.enter)="onSearch()"
               placeholder="Process name or code...">
        <button class="btn btn-secondary btn-sm" (click)="onSearch()">Search</button>
      </div>
      <div class="filter-group">
        <label>Status:</label>
        <select [(ngModel)]="statusFilter" (change)="onStatusChange()">
          <option value="">All Statuses</option>
          <option value="DRAFT">Draft</option>
          <option value="ACTIVE">Active</option>
          <option value="INACTIVE">Inactive</option>
          <option value="SUPERSEDED">Superseded</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Product:</label>
        <input type="text"
               [(ngModel)]="productFilter"
               (keyup.enter)="onSearch()"
               placeholder="Product SKU...">
      </div>
      <button class="btn btn-link" (click)="clearFilters()" *ngIf="searchTerm || statusFilter || productFilter">
        Clear Filters
      </button>
    </div>
  </div>

  <div class="loading" *ngIf="loading">
    <span class="spinner"></span> Loading processes...
  </div>

  <div class="error-message" *ngIf="error">
    {{ error }}
  </div>

  <div class="processes-table" *ngIf="!loading && processes.length > 0">
    <table>
      <thead>
        <tr>
          <th>Process Name</th>
          <th>Code</th>
          <th>Product</th>
          <th>Version</th>
          <th>Steps</th>
          <th>Status</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let process of processes">
          <td>
            <a class="process-link" (click)="viewProcess(process)">
              {{ process.processName }}
            </a>
          </td>
          <td class="code">{{ process.processCode }}</td>
          <td>{{ process.productSku || '-' }}</td>
          <td>{{ process.version }}</td>
          <td class="center">{{ process.stepCount }}</td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(process.status)">
              {{ process.status }}
            </span>
            <span class="effective-badge" *ngIf="process.isEffective">Effective</span>
          </td>
          <td class="date">{{ formatDate(process.createdOn) }}</td>
          <td class="actions">
            <button class="btn btn-sm btn-secondary" (click)="viewProcess(process)" title="View">
              View
            </button>
            <button class="btn btn-sm btn-secondary"
                    (click)="editProcess(process)"
                    title="Edit"
                    *ngIf="process.status === 'DRAFT'">
              Edit
            </button>
            <button class="btn btn-sm btn-success"
                    (click)="activateProcess(process)"
                    title="Activate"
                    *ngIf="process.status === 'DRAFT'">
              Activate
            </button>
            <button class="btn btn-sm btn-warning"
                    (click)="deactivateProcess(process)"
                    title="Deactivate"
                    *ngIf="process.status === 'ACTIVE'">
              Deactivate
            </button>
            <button class="btn btn-sm btn-secondary"
                    (click)="createNewVersion(process)"
                    title="New Version"
                    *ngIf="process.status === 'ACTIVE' || process.status === 'INACTIVE'">
              New Version
            </button>
            <button class="btn btn-sm btn-danger"
                    (click)="deleteProcess(process)"
                    title="Delete"
                    *ngIf="process.status === 'DRAFT'">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="empty-state" *ngIf="!loading && processes.length === 0">
    <p>No processes found.</p>
    <button class="btn btn-primary" (click)="createProcess()">Create First Process</button>
  </div>

  <div class="pagination" *ngIf="totalPages > 1">
    <button class="btn btn-sm"
            [disabled]="currentPage === 0"
            (click)="onPageChange(0)">
      First
    </button>
    <button class="btn btn-sm"
            [disabled]="currentPage === 0"
            (click)="onPageChange(currentPage - 1)">
      Previous
    </button>
    <span class="page-info">
      Page {{ currentPage + 1 }} of {{ totalPages }} ({{ totalElements }} total)
    </span>
    <button class="btn btn-sm"
            [disabled]="currentPage >= totalPages - 1"
            (click)="onPageChange(currentPage + 1)">
      Next
    </button>
    <button class="btn btn-sm"
            [disabled]="currentPage >= totalPages - 1"
            (click)="onPageChange(totalPages - 1)">
      Last
    </button>
    <select [(ngModel)]="pageSize" (change)="onPageSizeChange(pageSize)" class="page-size-select">
      <option [value]="10">10 per page</option>
      <option [value]="20">20 per page</option>
      <option [value]="50">50 per page</option>
    </select>
  </div>
</div>
