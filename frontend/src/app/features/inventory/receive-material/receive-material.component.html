<div class="receive-material-page">
  <div class="page-header">
    <h1 class="page-title">Receive Raw Material</h1>
    <p class="subtitle">Create batch and inventory record for incoming raw materials</p>
  </div>

  <!-- Success Result Card -->
  <div class="result-card success" *ngIf="receiptResult">
    <div class="result-icon">
      <i class="fas fa-check-circle"></i>
    </div>
    <div class="result-content">
      <h2>Material Received Successfully</h2>
      <p>{{ successMessage }}</p>

      <div class="result-details">
        <div class="detail-row">
          <span class="label">Batch Number:</span>
          <span class="value">{{ receiptResult.batchNumber }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Batch Status:</span>
          <span class="value status-badge pending">{{ receiptResult.batchStatus }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Inventory State:</span>
          <span class="value status-badge available">{{ receiptResult.inventoryState }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Quantity:</span>
          <span class="value">{{ receiptResult.quantity }} {{ receiptResult.unit }}</span>
        </div>
      </div>

      <div class="result-actions">
        <button type="button" class="btn btn-secondary" (click)="viewBatch()">
          <i class="fas fa-cube"></i> View Batch
        </button>
        <button type="button" class="btn btn-secondary" (click)="viewInventory()">
          <i class="fas fa-boxes-stacked"></i> View Inventory
        </button>
        <button type="button" class="btn btn-primary" (click)="receiveAnother()">
          <i class="fas fa-plus"></i> Receive Another
        </button>
      </div>
    </div>
  </div>

  <!-- Form -->
  <div class="form-container" *ngIf="!receiptResult">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="error-banner" *ngIf="error">
        <i class="fas fa-exclamation-circle"></i> {{ error }}
      </div>

      <!-- Material Selection -->
      <div class="form-section">
        <h2><i class="fas fa-box"></i> Material Information</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="materialId">Material *</label>
            <select
              id="materialId"
              formControlName="materialId"
              [class.error]="hasError('materialId')"
              (change)="onMaterialChange($event)"
            >
              <option value="">Select raw material...</option>
              <option *ngFor="let mat of materials" [value]="mat.materialCode">
                {{ mat.materialCode }} - {{ mat.materialName }}
              </option>
            </select>
            <span class="error-text" *ngIf="hasError('materialId')">
              {{ getError('materialId') }}
            </span>
            <span class="hint-text" *ngIf="loadingMaterials">Loading materials...</span>
            <span class="hint-text" *ngIf="!loadingMaterials && materials.length === 0">
              No raw materials configured. Add materials in Master Data first.
            </span>
          </div>

          <div class="form-group">
            <label for="materialName">Material Name</label>
            <input
              type="text"
              id="materialName"
              formControlName="materialName"
              placeholder="Auto-filled from selection"
              readonly
            />
          </div>
        </div>
      </div>

      <!-- Supplier Information -->
      <div class="form-section">
        <h2><i class="fas fa-truck"></i> Supplier Information</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="supplierId">Supplier ID</label>
            <input
              type="text"
              id="supplierId"
              formControlName="supplierId"
              placeholder="e.g., SUP-001"
            />
          </div>

          <div class="form-group">
            <label for="supplierBatchNumber">Supplier Batch Number</label>
            <input
              type="text"
              id="supplierBatchNumber"
              formControlName="supplierBatchNumber"
              placeholder="For traceability"
            />
            <span class="hint-text">External batch number from supplier's documentation</span>
          </div>
        </div>
      </div>

      <!-- Quantity Section -->
      <div class="form-section">
        <h2><i class="fas fa-weight"></i> Quantity</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="quantity">Quantity *</label>
            <input
              type="number"
              id="quantity"
              formControlName="quantity"
              [class.error]="hasError('quantity')"
              placeholder="e.g., 1000"
              step="0.01"
              min="0"
            />
            <span class="error-text" *ngIf="hasError('quantity')">
              {{ getError('quantity') }}
            </span>
          </div>

          <div class="form-group">
            <label for="unit">Unit of Measure *</label>
            <input
              type="text"
              id="unit"
              formControlName="unit"
              [class.error]="hasError('unit')"
              placeholder="e.g., KG, TONS, PCS"
            />
            <span class="error-text" *ngIf="hasError('unit')">
              {{ getError('unit') }}
            </span>
            <span class="hint-text">System units: KG, TONS, PCS, M, L</span>
          </div>
        </div>
      </div>

      <!-- Receipt Details -->
      <div class="form-section">
        <h2><i class="fas fa-clipboard-list"></i> Receipt Details</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="receivedDate">Received Date</label>
            <input
              type="date"
              id="receivedDate"
              formControlName="receivedDate"
            />
          </div>

          <div class="form-group">
            <label for="location">Storage Location</label>
            <input
              type="text"
              id="location"
              formControlName="location"
              placeholder="e.g., Warehouse A, Bay 3"
            />
          </div>
        </div>

        <div class="form-group full-width">
          <label for="notes">Notes</label>
          <textarea
            id="notes"
            formControlName="notes"
            placeholder="Delivery reference, inspection notes, etc."
            rows="3"
          ></textarea>
        </div>
      </div>

      <!-- Info Card -->
      <div class="info-card">
        <i class="fas fa-info-circle"></i>
        <div class="info-content">
          <strong>What happens on submit:</strong>
          <ul>
            <li>A new <strong>Batch</strong> is created with status <strong>QUALITY_PENDING</strong></li>
            <li>An <strong>Inventory</strong> record is created with state <strong>AVAILABLE</strong></li>
            <li>An <strong>Inventory Movement</strong> (RECEIVE) is logged for traceability</li>
            <li>The batch requires quality approval before it can be consumed in production</li>
          </ul>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="saving">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="saving || form.invalid">
          <i class="fas fa-download" *ngIf="!saving"></i>
          {{ saving ? 'Receiving...' : 'Receive Material' }}
        </button>
      </div>
    </form>
  </div>
</div>
