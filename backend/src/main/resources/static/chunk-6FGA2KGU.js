import{b as Pe}from"./chunk-SHFHBLSP.js";import{b as k,c as G,d as Y,e as Ie,g as Me}from"./chunk-PDG3W73O.js";import{$ as w,A as ne,B as i,Ba as me,C as t,Ca as ge,D as m,Da as ue,E as O,Ea as fe,F as f,Fa as _e,G as p,Ga as xe,H as ie,Ha as he,I as re,Ia as $,J as oe,Ja as B,L as s,La as Ce,M as h,Ma as ve,N as C,Na as Oe,O as S,Oa as be,V as T,X as L,Z as ae,_ as se,aa as N,da as q,fa as de,i as z,k as E,l as V,n as _,na as j,o as x,pa as D,s as a,sa as U,t as v,v as g,wa as le,x as d,xa as b,y as te,ya as ce,z as P,za as pe}from"./chunk-YGVGUOKE.js";function Ve(n,c){n&1&&(i(0,"div",17),m(1,"app-loading-spinner",18),t())}function qe(n,c){if(n&1){let e=O();i(0,"tr")(1,"td"),s(2),t(),i(3,"td"),s(4),t(),i(5,"td"),s(6),t(),i(7,"td"),s(8),t(),i(9,"td"),m(10,"app-status-badge",25),t(),i(11,"td"),s(12),T(13,"date"),t(),i(14,"td",26)(15,"button",27),f("click",function(){let o=_(e).$implicit,l=p(3);return x(l.viewOrder(o.orderId))}),s(16," View "),t(),i(17,"button",28),f("click",function(){let o=_(e).$implicit,l=p(3);return x(l.editOrder(o.orderId))}),s(18," Edit "),t()()()}if(n&2){let e=c.$implicit,r=p(3);a(2),h(e.orderNumber||"ORD-"+e.orderId),a(2),h(e.customerName||"N/A"),a(2),h(r.getProductInfo(e)),a(2),h(r.getTotalQuantity(e)),a(2),d("status",e.status),a(2),h(L(13,6,e.orderDate,"mediumDate"))}}function je(n,c){if(n&1&&(i(0,"table",23)(1,"thead")(2,"tr")(3,"th"),s(4,"Order Number"),t(),i(5,"th"),s(6,"Customer"),t(),i(7,"th"),s(8,"Product"),t(),i(9,"th"),s(10,"Quantity"),t(),i(11,"th"),s(12,"Status"),t(),i(13,"th"),s(14,"Order Date"),t(),i(15,"th"),s(16,"Actions"),t()()(),i(17,"tbody"),g(18,qe,19,9,"tr",24),t()()),n&2){let e=p(2);a(18),d("ngForOf",e.orders)}}function $e(n,c){n&1&&(i(0,"p",29),s(1," No orders found matching the selected filter. "),t())}function Be(n,c){if(n&1){let e=O();i(0,"app-pagination",30),f("pageChange",function(o){_(e);let l=p(2);return x(l.onPageChange(o))})("sizeChange",function(o){_(e);let l=p(2);return x(l.onSizeChange(o))}),t()}if(n&2){let e=p(2);d("page",e.page)("size",e.size)("totalElements",e.totalElements)("totalPages",e.totalPages)("hasNext",e.hasNext)("hasPrevious",e.hasPrevious)}}function Ge(n,c){if(n&1&&(i(0,"div",19),g(1,je,19,1,"table",20)(2,$e,2,0,"p",21)(3,Be,1,6,"app-pagination",22),t()),n&2){let e=p();a(),d("ngIf",e.orders.length>0),a(),d("ngIf",e.orders.length===0),a(),d("ngIf",e.orders.length>0)}}var we=(()=>{class n{constructor(e,r){this.apiService=e,this.router=r,this.orders=[],this.loading=!0,this.page=0,this.size=20,this.totalElements=0,this.totalPages=0,this.hasNext=!1,this.hasPrevious=!1,this.filterStatus="",this.searchTerm=""}ngOnInit(){this.loadOrders()}loadOrders(){this.loading=!0;let e={page:this.page,size:this.size,sortBy:"orderDate",sortDirection:"DESC",status:this.filterStatus||void 0,search:this.searchTerm||void 0};this.apiService.getOrdersPaged(e).subscribe({next:r=>{this.orders=r.content,this.page=r.page,this.size=r.size,this.totalElements=r.totalElements,this.totalPages=r.totalPages,this.hasNext=r.hasNext,this.hasPrevious=r.hasPrevious,this.loading=!1},error:r=>{console.error("Error loading orders:",r),this.loading=!1}})}onPageChange(e){this.page=e,this.loadOrders()}onSizeChange(e){this.size=e,this.page=0,this.loadOrders()}onFilterChange(e){this.filterStatus=e==="all"?"":e,this.page=0,this.loadOrders()}onSearch(e){this.searchTerm=e,this.page=0,this.loadOrders()}viewOrder(e){this.router.navigate(["/orders",e])}createOrder(){this.router.navigate(["/orders/new"])}editOrder(e){this.router.navigate(["/orders",e,"edit"])}getProductInfo(e){return e.lineItems&&e.lineItems.length>0?e.lineItems[0].productName:"N/A"}getTotalQuantity(e){return e.lineItems&&e.lineItems.length>0?e.lineItems.reduce((r,o)=>r+(o.quantity||0),0):0}static{this.\u0275fac=function(r){return new(r||n)(v(k),v(D))}}static{this.\u0275cmp=E({type:n,selectors:[["app-order-list"]],decls:26,vars:8,consts:[[1,"container"],[1,"page-header"],[1,"page-title"],[1,"btn","btn-primary",3,"click"],[1,"card"],[1,"filters"],[1,"search-group"],["type","text","placeholder","Search orders...",1,"search-input",3,"input","value"],[1,"filter-group"],[3,"change","value"],["value","all"],["value","CREATED"],["value","IN_PROGRESS"],["value","COMPLETED"],["value","CANCELLED"],["class","text-center",4,"ngIf"],["class","table-container",4,"ngIf"],[1,"text-center"],["message","Loading orders..."],[1,"table-container"],["class","table",4,"ngIf"],["class","no-data",4,"ngIf"],[3,"page","size","totalElements","totalPages","hasNext","hasPrevious","pageChange","sizeChange",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],[3,"status"],[1,"actions"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"btn","btn-secondary","btn-sm",3,"click"],[1,"no-data"],[3,"pageChange","sizeChange","page","size","totalElements","totalPages","hasNext","hasPrevious"]],template:function(r,o){r&1&&(i(0,"div",0)(1,"div",1)(2,"h1",2),s(3,"Production Orders"),t(),i(4,"button",3),f("click",function(){return o.createOrder()}),s(5,"+ New Order"),t()(),i(6,"div",4)(7,"div",5)(8,"div",6)(9,"input",7),f("input",function(u){return o.onSearch(u.target.value)}),t()(),i(10,"div",8)(11,"label"),s(12,"Status:"),t(),i(13,"select",9),f("change",function(u){return o.onFilterChange(u.target.value)}),i(14,"option",10),s(15,"All"),t(),i(16,"option",11),s(17,"Created"),t(),i(18,"option",12),s(19,"In Progress"),t(),i(20,"option",13),s(21,"Completed"),t(),i(22,"option",14),s(23,"Cancelled"),t()()()()(),g(24,Ve,2,0,"div",15)(25,Ge,4,3,"div",16),t()),r&2&&(a(9),d("value",o.searchTerm),a(),P("filter-active",o.filterStatus&&o.filterStatus!=="all"),a(3),P("filter-active",o.filterStatus&&o.filterStatus!=="all"),d("value",o.filterStatus||"all"),a(11),d("ngIf",o.loading),a(),d("ngIf",!o.loading))},dependencies:[w,N,$,B,G,Y,Ie,q],styles:[".table-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;overflow:hidden}.page-title-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:16px}.page-title-section[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{white-space:nowrap}.header-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.search-input[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;width:250px}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2}.actions[_ngcontent-%COMP%]{display:flex;gap:8px}"]})}}return n})();var Ye=["processFlowChart"];function He(n,c){if(n&1&&(i(0,"span",13),m(1,"i",14),s(2),t()),n&2){let e=p();a(2),C(" ",e.order.customerName," ")}}function Qe(n,c){if(n&1){let e=O();i(0,"button",18),f("click",function(){_(e);let o=p(2);return x(o.editOrder())}),m(1,"i",19),s(2," Edit Order "),t()}}function Ke(n,c){if(n&1&&(i(0,"div",15),m(1,"app-status-badge",16),g(2,Qe,3,0,"button",17),t()),n&2){let e=p();a(),d("status",e.order.status),a(),d("ngIf",e.order.status!=="COMPLETED"&&e.order.status!=="CANCELLED")}}function Ue(n,c){n&1&&(i(0,"div",20),m(1,"app-loading-spinner",21),t())}function We(n,c){if(n&1){let e=O();i(0,"div",50)(1,"div",51),f("click",function(){_(e);let o=p(2);return x(o.toggleFlowChart())}),i(2,"span"),m(3,"i",52),s(4," Process Flow Visualization"),t(),i(5,"button",53),m(6,"i",54),t()(),i(7,"div",55),m(8,"div",56,0),t()()}if(n&2){let e=p(2);a(6),P("fa-chevron-down",!e.flowChartCollapsed)("fa-chevron-right",e.flowChartCollapsed),a(),P("collapsed",e.flowChartCollapsed)}}function Xe(n,c){if(n&1&&(i(0,"span",66),m(1,"i",67),s(2),T(3,"date"),t()),n&2){let e=p().$implicit;a(2),C(" ",L(3,1,e.deliveryDate,"mediumDate")," ")}}function Ze(n,c){n&1&&m(0,"div",85)}function Je(n,c){if(n&1&&(i(0,"span"),m(1,"i",86),s(2),t()),n&2){let e=p().$implicit;a(2),C(" ",e.operationType,"")}}function et(n,c){if(n&1&&(i(0,"span"),m(1,"i",87),s(2),t()),n&2){let e=p().$implicit;a(2),C(" Step ",e.sequenceNumber,"")}}function tt(n,c){if(n&1){let e=O();i(0,"div",88)(1,"button",89),f("click",function(){_(e);let o=p().$implicit,l=p(4);return x(l.startProduction(o.operationId))}),m(2,"i",90),s(3),t()()}if(n&2){let e=p().$implicit;a(3),C(" ",e.status==="IN_PROGRESS"?"Continue Production":"Start Production"," ")}}function nt(n,c){if(n&1&&(i(0,"div",73)(1,"div",74)(2,"div",75),m(3,"i",76),t(),g(4,Ze,1,0,"div",77),t(),i(5,"div",78)(6,"div",79)(7,"span",80),s(8),t(),i(9,"span",81),s(10),t(),m(11,"app-status-badge",16),t(),i(12,"div",82),g(13,Je,3,1,"span",83)(14,et,3,1,"span",83),t(),g(15,tt,4,1,"div",84),t()()),n&2){let e=c.$implicit,r=c.index,o=p().$implicit,l=p(3);ne(l.getOperationStatusClass(e.status)),a(3),d("ngClass",l.getOperationIcon(e.status)),a(),d("ngIf",r<o.operations.length-1),a(4),h(e.operationName),a(2),C("(",e.operationCode,")"),a(),d("status",e.status),a(2),d("ngIf",e.operationType),a(),d("ngIf",e.sequenceNumber),a(),d("ngIf",l.canStartOperation(e))}}function it(n,c){if(n&1&&(i(0,"div",68)(1,"div",69),m(2,"i",70),i(3,"h4"),s(4),t()(),i(5,"div",71),g(6,nt,16,10,"div",72),t()()),n&2){let e=c.$implicit;a(4),h(e.processName),a(2),d("ngForOf",e.operations)}}function rt(n,c){n&1&&(i(0,"div",91),m(1,"i",92),i(2,"p"),s(3,"No operations defined for this line item."),t()())}function ot(n,c){if(n&1&&(i(0,"div",50)(1,"div",57)(2,"div",58)(3,"span",59),s(4),t(),i(5,"span",60),s(6),t()(),i(7,"div",61)(8,"span",62),s(9),t(),g(10,Xe,4,4,"span",63),t()(),i(11,"div",55),g(12,it,7,2,"div",64)(13,rt,4,0,"div",65),t()()),n&2){let e=c.$implicit,r=p(2);a(4),h(e.productName),a(2),C("SKU: ",e.productSku,""),a(3),S("",e.quantity," ",e.unit,""),a(),d("ngIf",e.deliveryDate),a(2),d("ngForOf",r.getProcessesForLineItem(e)),a(),d("ngIf",r.getProcessesForLineItem(e).length===0)}}function at(n,c){if(n&1&&(i(0,"div",22)(1,"div",23)(2,"h2",24),m(3,"i",25),s(4," Order Summary"),t(),i(5,"div",26)(6,"div",27)(7,"div",28)(8,"span",29),s(9,"Order Date"),t()(),i(10,"div",30),s(11),T(12,"date"),t()(),i(13,"div",27)(14,"div",28)(15,"span",29),s(16,"Line Items"),t()(),i(17,"div",30),s(18),t()(),i(19,"div",27)(20,"div",28)(21,"span",29),s(22,"Total Operations"),t()(),i(23,"div",30),s(24),t(),i(25,"div",31)(26,"span",32),s(27),t()()(),i(28,"div",27)(29,"div",28)(30,"span",29),s(31,"Progress"),t(),i(32,"span",33),s(33),t()(),i(34,"div",30),s(35),t(),i(36,"div",31)(37,"span",32),s(38,"operations completed"),t()()()()(),i(39,"div",34)(40,"div",35),m(41,"div",36),t(),i(42,"div",37)(43,"span",38),m(44,"i",39),s(45),t(),i(46,"span",40),m(47,"i",41),s(48),t(),i(49,"span",42),m(50,"i",43),s(51),t(),i(52,"span",44),m(53,"i",45),s(54),t()()(),g(55,We,10,6,"div",46),i(56,"div",47)(57,"h2",24),m(58,"i",48),s(59," Line Items"),t(),g(60,ot,14,7,"div",49),t()()),n&2){let e=p();a(11),h(L(12,15,e.order.orderDate,"mediumDate")),a(7),h((e.order.lineItems==null?null:e.order.lineItems.length)||0),a(6),h(e.getTotalOperations()),a(3),C("",e.getReadyOperations()," ready to start"),a(6),C("",e.getCompletionPercentage(),"%"),a(2),S("",e.getCompletedOperations(),"/",e.getTotalOperations(),""),a(6),te("width",e.getCompletionPercentage(),"%"),a(4),C(" ",e.getCompletedOperations()," Completed"),a(3),C(" ",e.getInProgressOperations()," In Progress"),a(3),C(" ",e.getReadyOperations()," Ready"),a(3),C(" ",e.getPendingOperations()," Pending"),a(),d("ngIf",(e.order.lineItems==null?null:e.order.lineItems.length)>0),a(5),d("ngForOf",e.order.lineItems)}}function st(n,c){if(n&1){let e=O();i(0,"div",93)(1,"div",91),m(2,"i",94),i(3,"h3"),s(4,"Order Not Found"),t(),i(5,"p"),s(6,"The requested order could not be found."),t(),i(7,"button",18),f("click",function(){_(e);let o=p();return x(o.goBack())}),s(8,"Return to Orders"),t()()()}}var Ne=(()=>{class n{constructor(e,r,o,l){this.route=e,this.router=r,this.apiService=o,this.chartService=l,this.order=null,this.loading=!0,this.lineItemProcesses=new Map,this.flowChartCollapsed=!1,this.collapsedLineItems=new Set}ngOnInit(){this.orderId=Number(this.route.snapshot.paramMap.get("orderId")),this.loadOrder()}loadOrder(){this.loading=!0,this.apiService.getOrderById(this.orderId).subscribe({next:e=>{this.order=e,this.groupOperationsByProcess(),this.loading=!1,setTimeout(()=>this.buildProcessFlowChart(),0)},error:e=>{console.error("Error loading order:",e),this.loading=!1}})}groupOperationsByProcess(){if(this.lineItemProcesses.clear(),!!this.order?.lineItems)for(let e of this.order.lineItems){let r=e.operations||[],o=new Map;for(let u of r){let I=u.processId?`${u.processId}`:"default",F=u.processName||"Production";o.has(I)||o.set(I,{processId:u.processId||null,processName:F,operations:[]}),o.get(I).operations.push(u)}for(let u of o.values())u.operations.sort((I,F)=>(I.sequenceNumber||0)-(F.sequenceNumber||0));let l=Array.from(o.values());this.lineItemProcesses.set(e.orderLineId,l)}}getProcessesForLineItem(e){return this.lineItemProcesses.get(e.orderLineId)||[]}getAllOperations(){return this.order?.lineItems?this.order.lineItems.flatMap(e=>e.operations||[]):[]}getTotalOperations(){return this.getAllOperations().length}getCompletedOperations(){return this.getAllOperations().filter(e=>e.status==="CONFIRMED"||e.status==="COMPLETED").length}getInProgressOperations(){return this.getAllOperations().filter(e=>e.status==="IN_PROGRESS"||e.status==="PARTIALLY_CONFIRMED").length}getReadyOperations(){return this.getAllOperations().filter(e=>e.status==="READY").length}getPendingOperations(){return this.getAllOperations().filter(e=>e.status==="NOT_STARTED"||e.status==="ON_HOLD"||e.status==="BLOCKED").length}getCompletionPercentage(){let e=this.getTotalOperations();return e===0?0:Math.round(this.getCompletedOperations()/e*100)}getLineItemProgress(e){let r=e.operations||[];if(r.length===0)return 0;let o=r.filter(l=>l.status==="CONFIRMED"||l.status==="COMPLETED").length;return Math.round(o/r.length*100)}toggleFlowChart(){this.flowChartCollapsed=!this.flowChartCollapsed}toggleLineItem(e){this.collapsedLineItems.has(e)?this.collapsedLineItems.delete(e):this.collapsedLineItems.add(e)}isLineItemCollapsed(e){return this.collapsedLineItems.has(e)}getOperationIcon(e){switch(e){case"CONFIRMED":case"COMPLETED":return"fa-check";case"IN_PROGRESS":case"PARTIALLY_CONFIRMED":return"fa-spinner fa-spin";case"READY":return"fa-play";case"ON_HOLD":return"fa-pause";case"BLOCKED":return"fa-ban";case"NOT_STARTED":default:return"fa-circle"}}goBack(){this.router.navigate(["/orders"])}editOrder(){this.router.navigate(["/orders",this.orderId,"edit"])}startProduction(e){this.router.navigate(["/production/confirm",e])}canStartOperation(e){return e.status==="READY"||e.status==="IN_PROGRESS"}getOperationStatusClass(e){switch(e){case"CONFIRMED":case"COMPLETED":return"step-completed";case"IN_PROGRESS":case"PARTIALLY_CONFIRMED":return"step-active";case"READY":return"step-ready";case"ON_HOLD":return"step-on-hold";case"BLOCKED":return"step-blocked";case"NOT_STARTED":default:return"step-pending"}}ngOnDestroy(){this.chartService.disposeAll()}getStatusColor(e){return{NOT_STARTED:"#9e9e9e",PENDING:"#9e9e9e",READY:"#4caf50",IN_PROGRESS:"#1976d2",COMPLETED:"#388e3c",CONFIRMED:"#388e3c",ON_HOLD:"#f44336",BLOCKED:"#d32f2f"}[e]||"#9e9e9e"}buildProcessFlowChart(){if(!this.processFlowChartRef||!this.order?.lineItems?.length)return;let e=[],r=[],o=130,l=100,u=0;this.order.lineItems.forEach((M,Et)=>{this.getProcessesForLineItem(M).forEach(Q=>{let X=`process-${Q.processId||"default"}-${M.orderLineId}`,Z=Q.operations||[],wt=Z.length||1,J=50+u*l;e.push({id:X,name:Q.processName,x:60,y:J,symbolSize:[140,36],symbol:"roundRect",itemStyle:{color:{type:"linear",x:0,y:0,x2:1,y2:0,colorStops:[{offset:0,color:"#667eea"},{offset:1,color:"#764ba2"}]},borderRadius:8,shadowColor:"rgba(102, 126, 234, 0.4)",shadowBlur:10,shadowOffsetY:4},label:{show:!0,fontSize:12,fontWeight:"bold",color:"#fff",formatter:y=>y.name}});let K=null;Z.forEach((y,ee)=>{let R=`op-${y.operationId}`,{bgColor:ke,borderColor:Te,shadowColor:Le}=this.getStatusStyles(y.status);if(e.push({id:R,name:y.operationName,value:y.status,x:200+ee*o,y:J,symbolSize:[105,48],symbol:"roundRect",itemStyle:{color:ke,borderColor:Te,borderWidth:2,borderRadius:8,shadowColor:Le,shadowBlur:8,shadowOffsetY:3},label:{show:!0,fontSize:10,color:"#333",overflow:"truncate",ellipsis:"..",width:95,formatter:A=>`{name|${A.name}}
{status|${A.value}}`,rich:{name:{fontSize:10,fontWeight:"bold",color:"#1e293b",lineHeight:14,width:95,overflow:"truncate",ellipsis:".."},status:{fontSize:9,color:"#64748b",lineHeight:12}}}}),ee===0&&r.push({source:X,target:R,lineStyle:{color:"#94a3b8",width:2,type:[5,3]}}),K){let A=this.getEdgeColor(y.status);r.push({source:K,target:R,lineStyle:{color:A,width:3,curveness:0},symbol:["none","arrow"],symbolSize:10})}K=R}),u++})});let I=Math.max(300,u*l+80);this.processFlowChartRef.nativeElement.style.height=I+"px",this.processFlowChartRef.nativeElement.style.minHeight=I+"px";let F=this.chartService.initChart(this.processFlowChartRef.nativeElement,"process-flow");this.chartService.setOption("process-flow",{tooltip:{trigger:"item",backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#e2e8f0",borderWidth:1,textStyle:{fontSize:12,color:"#1e293b"},formatter:M=>M.dataType==="node"&&M.value?`<strong>${M.name}</strong><br/>Status: ${M.value}`:M.name},series:[{type:"graph",layout:"none",roam:!0,zoom:.85,center:["50%","50%"],data:e,links:r,lineStyle:{curveness:0},emphasis:{focus:"adjacency",itemStyle:{shadowBlur:15,shadowColor:"rgba(0, 0, 0, 0.3)"},lineStyle:{width:4}}}]})}getStatusStyles(e){let r={CONFIRMED:{bgColor:"#dcfce7",borderColor:"#22c55e",shadowColor:"rgba(34, 197, 94, 0.3)"},COMPLETED:{bgColor:"#dcfce7",borderColor:"#22c55e",shadowColor:"rgba(34, 197, 94, 0.3)"},IN_PROGRESS:{bgColor:"#dbeafe",borderColor:"#3b82f6",shadowColor:"rgba(59, 130, 246, 0.3)"},PARTIALLY_CONFIRMED:{bgColor:"#dbeafe",borderColor:"#3b82f6",shadowColor:"rgba(59, 130, 246, 0.3)"},READY:{bgColor:"#fef3c7",borderColor:"#f59e0b",shadowColor:"rgba(245, 158, 11, 0.3)"},ON_HOLD:{bgColor:"#ffedd5",borderColor:"#f97316",shadowColor:"rgba(249, 115, 22, 0.3)"},BLOCKED:{bgColor:"#fee2e2",borderColor:"#ef4444",shadowColor:"rgba(239, 68, 68, 0.3)"},NOT_STARTED:{bgColor:"#f1f5f9",borderColor:"#94a3b8",shadowColor:"rgba(148, 163, 184, 0.2)"}};return r[e]||r.NOT_STARTED}getEdgeColor(e){return{CONFIRMED:"#22c55e",COMPLETED:"#22c55e",IN_PROGRESS:"#3b82f6",READY:"#f59e0b",NOT_STARTED:"#cbd5e1"}[e]||"#cbd5e1"}static{this.\u0275fac=function(r){return new(r||n)(v(j),v(D),v(k),v(Pe))}}static{this.\u0275cmp=E({type:n,selectors:[["app-order-detail"]],viewQuery:function(r,o){if(r&1&&ie(Ye,5),r&2){let l;re(l=oe())&&(o.processFlowChartRef=l.first)}},decls:13,vars:6,consts:[["processFlowChart",""],[1,"order-detail-page"],[1,"page-header"],[1,"page-header-left"],[1,"back-btn",3,"click"],[1,"fas","fa-arrow-left"],[1,"page-title-section"],[1,"page-title"],["class","page-subtitle",4,"ngIf"],["class","page-header-actions",4,"ngIf"],["class","text-center",4,"ngIf"],["class","order-content",4,"ngIf"],["class","card not-found-card",4,"ngIf"],[1,"page-subtitle"],[1,"fas","fa-building"],[1,"page-header-actions"],[3,"status"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-edit"],[1,"text-center"],["message","Loading order details..."],[1,"order-content"],[1,"metrics-section"],[1,"section-title"],[1,"fas","fa-chart-simple"],[1,"metrics-grid"],[1,"metric-card"],[1,"metric-header"],[1,"metric-label"],[1,"metric-value"],[1,"metric-footer"],[1,"metric-sublabel"],[1,"metric-badge"],[1,"progress-section"],[1,"progress-bar-container"],[1,"progress-bar"],[1,"progress-legend"],[1,"legend-item","completed"],[1,"fas","fa-check-circle"],[1,"legend-item","in-progress"],[1,"fas","fa-spinner"],[1,"legend-item","ready"],[1,"fas","fa-play-circle"],[1,"legend-item","pending"],[1,"fas","fa-clock"],["class","card",4,"ngIf"],[1,"line-items-section"],[1,"fas","fa-boxes-stacked"],["class","card",4,"ngFor","ngForOf"],[1,"card"],[1,"card-header","clickable",3,"click"],[1,"fas","fa-project-diagram"],[1,"collapse-btn"],[1,"fas"],[1,"card-body"],[1,"process-flow-container"],[1,"card-header"],[1,"line-item-info"],[1,"product-name"],[1,"product-sku"],[1,"line-item-qty"],[1,"quantity"],["class","delivery-date",4,"ngIf"],["class","process-section",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"delivery-date"],[1,"fas","fa-truck"],[1,"process-section"],[1,"process-header"],[1,"fas","fa-cog"],[1,"operations-list"],["class","operation-item",3,"class",4,"ngFor","ngForOf"],[1,"operation-item"],[1,"operation-step"],[1,"step-number"],[1,"fas",3,"ngClass"],["class","step-line",4,"ngIf"],[1,"operation-content"],[1,"operation-info"],[1,"operation-name"],[1,"operation-code"],[1,"operation-details"],[4,"ngIf"],["class","operation-actions",4,"ngIf"],[1,"step-line"],[1,"fas","fa-tag"],[1,"fas","fa-list-ol"],[1,"operation-actions"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"fas","fa-play"],[1,"empty-state"],[1,"fas","fa-inbox"],[1,"card","not-found-card"],[1,"fas","fa-search"]],template:function(r,o){r&1&&(i(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),f("click",function(){return o.goBack()}),m(4,"i",5),t(),i(5,"div",6)(6,"h1",7),s(7),t(),g(8,He,3,1,"span",8),t()(),g(9,Ke,3,2,"div",9),t(),g(10,Ue,2,0,"div",10)(11,at,61,18,"div",11)(12,st,9,0,"div",12),t()),r&2&&(a(7),h((o.order==null?null:o.order.orderNumber)||"Order Details"),a(),d("ngIf",o.order==null?null:o.order.customerName),a(),d("ngIf",o.order),a(),d("ngIf",o.loading),a(),d("ngIf",!o.loading&&o.order),a(),d("ngIf",!o.loading&&!o.order))},dependencies:[se,w,N,G,Y,q],styles:[".order-detail-page[_ngcontent-%COMP%]{padding:24px}.order-content[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.page-header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.back-btn[_ngcontent-%COMP%]{width:40px;height:40px;display:flex;align-items:center;justify-content:center;background:#fff;border:1px solid #e0e0e0;border-radius:8px;color:#666;cursor:pointer;transition:all .2s}.back-btn[_ngcontent-%COMP%]:hover{background:#f5f5f5;color:#333}.page-title-section[_ngcontent-%COMP%]{display:flex;flex-direction:column}.page-title[_ngcontent-%COMP%]{font-size:28px;font-weight:600;color:#1a1a1a;margin:0}.page-subtitle[_ngcontent-%COMP%]{font-size:14px;color:#666;display:flex;align-items:center;gap:6px;margin-top:4px}.page-subtitle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#999}.page-header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.section-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#333;margin:0 0 16px;display:flex;align-items:center;gap:8px}.section-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#1976d2}.metrics-section[_ngcontent-%COMP%]{margin-bottom:24px}.metrics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}.metric-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px #0000000f;transition:all .2s}.metric-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 16px #0000001a}.metric-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.metric-label[_ngcontent-%COMP%]{font-size:13px;color:#666;font-weight:500}.metric-badge[_ngcontent-%COMP%]{font-size:11px;padding:3px 8px;border-radius:10px;background:#e3f2fd;color:#1976d2;font-weight:500}.metric-value[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#1a1a1a;line-height:1.1}.metric-footer[_ngcontent-%COMP%]{margin-top:8px}.metric-sublabel[_ngcontent-%COMP%]{font-size:12px;color:#888}.progress-section[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px #0000000f;margin-bottom:24px}.progress-bar-container[_ngcontent-%COMP%]{height:12px;background:#e2e8f0;border-radius:6px;overflow:hidden;margin-bottom:16px}.progress-bar[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#22c55e,#16a34a);border-radius:6px;transition:width .5s ease}.progress-legend[_ngcontent-%COMP%]{display:flex;gap:24px;flex-wrap:wrap}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:13px;color:#64748b}.legend-item.completed[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#22c55e}.legend-item.in-progress[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#3b82f6}.legend-item.ready[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#f59e0b}.legend-item.pending[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#94a3b8}.card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000000f;margin-bottom:16px;overflow:hidden}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;font-weight:600;color:#333;border-bottom:1px solid #f0f0f0}.card-header.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:background .2s}.card-header.clickable[_ngcontent-%COMP%]:hover{background:#f8f9fa}.card-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:8px;color:#1976d2}.collapse-btn[_ngcontent-%COMP%]{background:none;border:none;color:#666;cursor:pointer;padding:4px 8px;border-radius:4px;transition:all .2s}.collapse-btn[_ngcontent-%COMP%]:hover{background:#e0e0e0;color:#333}.card-body[_ngcontent-%COMP%]{padding:20px}.card-body.collapsed[_ngcontent-%COMP%]{display:none}.process-flow-container[_ngcontent-%COMP%]{width:100%;height:450px;min-height:450px;border-radius:8px;background:#fafafa}.line-items-section[_ngcontent-%COMP%]{margin-top:24px}.line-item-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.product-name[_ngcontent-%COMP%]{font-weight:600;font-size:16px;color:#333}.product-sku[_ngcontent-%COMP%]{font-size:13px;color:#888}.line-item-qty[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:4px}.quantity[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#1976d2}.delivery-date[_ngcontent-%COMP%]{font-size:13px;color:#666;display:flex;align-items:center;gap:6px}.delivery-date[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#999}.process-section[_ngcontent-%COMP%]{margin-bottom:24px}.process-section[_ngcontent-%COMP%]:last-child{margin-bottom:0}.process-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:16px;padding-bottom:8px;border-bottom:2px solid #e3f2fd}.process-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#1976d2;font-size:16px}.process-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:15px;font-weight:600;margin:0;color:#1976d2}.operations-list[_ngcontent-%COMP%]{margin-left:8px}.operation-item[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:4px}.operation-step[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.step-number[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;background:#e0e0e0;color:#666;flex-shrink:0}.step-line[_ngcontent-%COMP%]{width:2px;flex:1;min-height:40px;background:#e0e0e0}.step-completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.step-completed[_ngcontent-%COMP%]   .step-line[_ngcontent-%COMP%]{background:#22c55e}.step-active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.step-active[_ngcontent-%COMP%]   .step-line[_ngcontent-%COMP%]{background:#3b82f6}.step-ready[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#f59e0b;color:#fff}.step-ready[_ngcontent-%COMP%]   .step-line[_ngcontent-%COMP%]{background:#f59e0b}.step-on-hold[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#f97316;color:#fff}.step-on-hold[_ngcontent-%COMP%]   .step-line[_ngcontent-%COMP%]{background:#f97316}.step-blocked[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.step-blocked[_ngcontent-%COMP%]   .step-line[_ngcontent-%COMP%]{background:#ef4444}.step-pending[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#94a3b8;color:#fff}.operation-content[_ngcontent-%COMP%]{flex:1;padding:12px 16px;background:#f8f9fa;border-radius:8px;margin-bottom:8px;border-left:3px solid #e0e0e0}.step-completed[_ngcontent-%COMP%]   .operation-content[_ngcontent-%COMP%]{background:#f0fdf4;border-left-color:#22c55e}.step-active[_ngcontent-%COMP%]   .operation-content[_ngcontent-%COMP%]{background:#eff6ff;border-left-color:#3b82f6}.step-ready[_ngcontent-%COMP%]   .operation-content[_ngcontent-%COMP%]{background:#fffbeb;border-left-color:#f59e0b}.step-on-hold[_ngcontent-%COMP%]   .operation-content[_ngcontent-%COMP%]{background:#fff7ed;border-left-color:#f97316}.step-blocked[_ngcontent-%COMP%]   .operation-content[_ngcontent-%COMP%]{background:#fef2f2;border-left-color:#ef4444}.operation-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap}.operation-name[_ngcontent-%COMP%]{font-weight:600;font-size:14px;color:#333}.operation-code[_ngcontent-%COMP%]{color:#888;font-size:13px}.operation-details[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:13px;color:#666}.operation-details[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.operation-details[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#999;font-size:12px}.operation-actions[_ngcontent-%COMP%]{margin-top:12px}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:10px 18px;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;border:none}.btn-primary[_ngcontent-%COMP%]{background:#1976d2;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background:#1565c0}.btn-success[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.btn-success[_ngcontent-%COMP%]:hover{background:#16a34a}.btn-sm[_ngcontent-%COMP%]{padding:8px 14px;font-size:13px}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;color:#888;text-align:center}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:48px;margin-bottom:16px;color:#ddd}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#333;margin:0 0 8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 20px;font-size:14px}.not-found-card[_ngcontent-%COMP%]{max-width:500px;margin:40px auto}@media (max-width: 1024px){.metrics-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.page-header[_ngcontent-%COMP%]{flex-direction:column;gap:16px;align-items:flex-start}.page-header-actions[_ngcontent-%COMP%]{width:100%;justify-content:flex-start}}@media (max-width: 768px){.order-detail-page[_ngcontent-%COMP%]{padding:16px}.metrics-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.card-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.line-item-qty[_ngcontent-%COMP%]{align-items:flex-start}.progress-legend[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.operation-info[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:6px}.operation-details[_ngcontent-%COMP%]{flex-direction:column;gap:6px}}"]})}}return n})();function dt(n,c){n&1&&(i(0,"div",5),s(1,"Loading order..."),t())}function lt(n,c){if(n&1&&(i(0,"div",33),s(1),t()),n&2){let e=p(2);a(),h(e.error)}}function ct(n,c){if(n&1&&m(0,"input",34),n&2){let e,r=p(2);d("value",((e=r.form.get("customerId"))==null?null:e.value)+" - "+((e=r.form.get("customerName"))==null?null:e.value))}}function pt(n,c){if(n&1&&(i(0,"option",38),s(1),t()),n&2){let e=c.$implicit;d("value",e.customerCode),a(),S(" ",e.customerCode," - ",e.customerName," ")}}function mt(n,c){if(n&1){let e=O();i(0,"select",35),f("change",function(o){_(e);let l=p(2);return x(l.onCustomerChange(o))}),i(1,"option",36),s(2,"Select a customer..."),t(),g(3,pt,2,3,"option",37),t()}if(n&2){let e=p(2);P("error",e.hasError("customerId")),a(3),d("ngForOf",e.customers)}}function gt(n,c){n&1&&(i(0,"span",22),s(1,"Loading customers..."),t())}function ut(n,c){n&1&&(i(0,"span",39),s(1,"Customer is required"),t())}function ft(n,c){n&1&&(i(0,"span",39),s(1,"Order date is required"),t())}function _t(n,c){n&1&&(i(0,"div",10)(1,"div",11)(2,"label",40),s(3,"Status"),t(),i(4,"select",41)(5,"option",42),s(6,"Created"),t(),i(7,"option",43),s(8,"In Progress"),t(),i(9,"option",44),s(10,"Completed"),t(),i(11,"option",45),s(12,"On Hold"),t(),i(13,"option",46),s(14,"Cancelled"),t()()()())}function xt(n,c){if(n&1){let e=O();i(0,"button",47),f("click",function(){_(e);let o=p(2);return x(o.addLineItem())}),s(1," + Add Line Item "),t()}}function ht(n,c){n&1&&(i(0,"div",48),s(1," Line items can only be modified for orders with CREATED status. "),t())}function Ct(n,c){if(n&1){let e=O();i(0,"button",62),f("click",function(){_(e);let o=p().index,l=p(2);return x(l.removeLineItem(o))}),m(1,"i",63),t()}}function vt(n,c){if(n&1&&m(0,"input",34),n&2){let e,r=p().index,o=p(2);d("value",((e=o.lineItems.at(r).get("productSku"))==null?null:e.value)+" - "+((e=o.lineItems.at(r).get("productName"))==null?null:e.value))}}function Ot(n,c){if(n&1&&(i(0,"option",38),s(1),t()),n&2){let e=c.$implicit;d("value",e.sku),a(),S(" ",e.sku," - ",e.productName," ")}}function bt(n,c){if(n&1){let e=O();i(0,"select",64),f("change",function(o){_(e);let l=p().index,u=p(2);return x(u.onProductChange(l,o))}),i(1,"option",36),s(2,"Select a product..."),t(),g(3,Ot,2,3,"option",37),t()}if(n&2){let e=p().index,r=p(2);P("error",r.hasLineItemError(e,"productSku")),a(3),d("ngForOf",r.products)}}function Pt(n,c){if(n&1&&(i(0,"div",49)(1,"div",50)(2,"span",51),s(3),t(),g(4,Ct,2,0,"button",52),t(),i(5,"div",53)(6,"div",54)(7,"label"),s(8,"Product *"),t(),g(9,vt,1,1,"input",13)(10,bt,4,3,"select",55),m(11,"input",56),t(),i(12,"div",57)(13,"label"),s(14,"Quantity *"),t(),m(15,"input",58),t(),i(16,"div",59)(17,"label"),s(18,"Unit"),t(),m(19,"input",60),t(),i(20,"div",11)(21,"label"),s(22,"Delivery Date"),t(),m(23,"input",61),t()()()),n&2){let e,r,o=c.index,l=p(2);d("formGroupName",o),a(3),C("Line ",o+1,""),a(),d("ngIf",l.lineItems.length>1&&l.canEditLineItems()),a(5),d("ngIf",l.isEditMode&&((e=l.lineItems.at(o).get("orderLineId"))==null?null:e.value)),a(),d("ngIf",!l.isEditMode||!((r=l.lineItems.at(o).get("orderLineId"))!=null&&r.value)),a(5),P("error",l.hasLineItemError(o,"quantity")),a(4),P("error",l.hasLineItemError(o,"unit"))}}function It(n,c){n&1&&(i(0,"div",65),s(1,' No line items. Click "Add Line Item" to add products to this order. '),t())}function Mt(n,c){if(n&1){let e=O();i(0,"div",6)(1,"form",7),f("ngSubmit",function(){_(e);let o=p();return x(o.onSubmit())}),g(2,lt,2,1,"div",8),i(3,"div",9)(4,"h2"),s(5,"Order Information"),t(),i(6,"div",10)(7,"div",11)(8,"label",12),s(9,"Customer *"),t(),g(10,ct,1,1,"input",13)(11,mt,4,3,"select",14),m(12,"input",15),g(13,gt,2,0,"span",16)(14,ut,2,0,"span",17),t()(),i(15,"div",10)(16,"div",11)(17,"label",18),s(18,"Order Date *"),t(),m(19,"input",19),g(20,ft,2,0,"span",17),t(),i(21,"div",11)(22,"label",20),s(23,"Order Number"),t(),m(24,"input",21),i(25,"span",22),s(26,"Leave empty to auto-generate"),t()()(),g(27,_t,15,0,"div",23),t(),i(28,"div",9)(29,"div",24)(30,"h2"),s(31,"Line Items"),t(),g(32,xt,2,0,"button",25),t(),g(33,ht,2,0,"div",26),i(34,"div",27),g(35,Pt,24,9,"div",28),t(),g(36,It,2,0,"div",29),t(),i(37,"div",30)(38,"button",31),f("click",function(){_(e);let o=p();return x(o.cancel())}),s(39," Cancel "),t(),i(40,"button",32),s(41),t()()()()}if(n&2){let e=p();a(),d("formGroup",e.form),a(),d("ngIf",e.error),a(8),d("ngIf",e.isEditMode),a(),d("ngIf",!e.isEditMode),a(2),d("ngIf",!e.isEditMode&&e.loadingCustomers),a(),d("ngIf",e.hasError("customerId")),a(5),P("error",e.hasError("orderDate")),a(),d("ngIf",e.hasError("orderDate")),a(4),d("readonly",e.isEditMode),a(3),d("ngIf",e.isEditMode),a(5),d("ngIf",e.canEditLineItems()),a(),d("ngIf",e.isEditMode&&!e.canEditLineItems()),a(2),d("ngForOf",e.lineItems.controls),a(),d("ngIf",e.lineItems.length===0),a(2),d("disabled",e.saving),a(2),d("disabled",e.saving||e.form.invalid),a(),C(" ",e.saving?"Saving...":e.isEditMode?"Update Order":"Create Order"," ")}}var W=(()=>{class n{constructor(e,r,o,l,u){this.fb=e,this.apiService=r,this.route=o,this.router=l,this.cdr=u,this.isEditMode=!1,this.orderId=null,this.loading=!1,this.saving=!1,this.error="",this.customers=[],this.products=[],this.loadingCustomers=!0,this.loadingProducts=!0}ngOnInit(){let e=this.route.snapshot.paramMap.get("orderId");e&&(this.isEditMode=!0,this.orderId=+e),this.initForm(),this.loadCustomers(),this.loadProducts(),this.isEditMode&&this.orderId?this.loadOrder():this.addLineItem()}initForm(){this.form=this.fb.group({customerId:["",b.required],customerName:["",[b.required,b.maxLength(200)]],orderDate:[this.getTodayDate(),b.required],orderNumber:[""],status:["CREATED"],lineItems:this.fb.array([])})}get lineItems(){return this.form.get("lineItems")}createLineItemGroup(e){return this.fb.group({orderLineId:[e?.orderLineId||null],productSku:[e?.productSku||"",[b.required,b.maxLength(50)]],productName:[e?.productName||"",[b.required,b.maxLength(200)]],quantity:[e?.quantity||1,[b.required,b.min(.01)]],unit:[e?.unit||"",[b.required,b.maxLength(20)]],deliveryDate:[e?.deliveryDate||""]})}addLineItem(){this.lineItems.push(this.createLineItemGroup())}removeLineItem(e){this.lineItems.length>1&&this.lineItems.removeAt(e)}loadCustomers(){this.apiService.getActiveCustomers().subscribe({next:e=>{this.customers=e,this.loadingCustomers=!1,this.cdr.detectChanges()},error:e=>{console.error("Error loading customers:",e),this.loadingCustomers=!1,this.cdr.detectChanges()}})}loadProducts(){this.apiService.getActiveProducts().subscribe({next:e=>{this.products=e,this.loadingProducts=!1,this.cdr.detectChanges()},error:e=>{console.error("Error loading products:",e),this.loadingProducts=!1,this.cdr.detectChanges()}})}onCustomerChange(e){let r=e.target.value,o=this.customers.find(l=>l.customerCode===r);o&&this.form.patchValue({customerName:o.customerName})}onProductChange(e,r){let o=r.target.value,l=this.products.find(u=>u.sku===o);l&&this.lineItems.at(e).patchValue({productName:l.productName,unit:l.baseUnit})}loadOrder(){this.orderId&&(this.loading=!0,this.apiService.getOrderById(this.orderId).subscribe({next:e=>{this.form.patchValue({customerId:e.customerId||"",customerName:e.customerName||"",orderDate:e.orderDate||"",orderNumber:e.orderNumber||"",status:e.status}),this.lineItems.clear(),e.lineItems&&e.lineItems.length>0?e.lineItems.forEach(r=>{this.lineItems.push(this.createLineItemGroup(r))}):this.addLineItem(),this.loading=!1},error:e=>{this.error=e.error?.message||"Failed to load order.",this.loading=!1}}))}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.saving=!0,this.error="";let e=this.form.getRawValue();if(this.isEditMode&&this.orderId){let r={customerId:e.customerId,customerName:e.customerName,orderDate:e.orderDate||void 0,status:e.status};this.apiService.updateOrder(this.orderId,r).subscribe({next:()=>{this.saving=!1,this.router.navigate(["/orders"])},error:o=>{this.saving=!1,this.error=o.error?.message||"Failed to update order."}})}else{let r={customerId:e.customerId,customerName:e.customerName,orderDate:e.orderDate,orderNumber:e.orderNumber||void 0,lineItems:e.lineItems.map(o=>({productSku:o.productSku,productName:o.productName,quantity:o.quantity,unit:o.unit,deliveryDate:o.deliveryDate||void 0}))};this.apiService.createOrder(r).subscribe({next:()=>{this.saving=!1,this.router.navigate(["/orders"])},error:o=>{this.saving=!1,this.error=o.error?.message||"Failed to create order."}})}}cancel(){this.router.navigate(["/orders"])}getTodayDate(){return new Date().toISOString().split("T")[0]}hasError(e){let r=this.form.get(e);return!!(r&&r.invalid&&r.touched)}hasLineItemError(e,r){let o=this.lineItems.at(e)?.get(r);return!!(o&&o.invalid&&o.touched)}getError(e){let r=this.form.get(e);return!r||!r.errors?"":r.errors.required?`${e} is required`:r.errors.maxlength?`${e} is too long`:"Invalid value"}canEditLineItems(){return!this.isEditMode||this.form.get("status")?.value==="CREATED"}trackByIndex(e){return e}static{this.\u0275fac=function(r){return new(r||n)(v(ve),v(k),v(j),v(D),v(ae))}}static{this.\u0275cmp=E({type:n,selectors:[["app-order-form"]],decls:6,vars:3,consts:[[1,"order-form-page"],[1,"page-header"],[1,"page-title"],["class","loading",4,"ngIf"],["class","form-container",4,"ngIf"],[1,"loading"],[1,"form-container"],[3,"ngSubmit","formGroup"],["class","error-banner",4,"ngIf"],[1,"form-section"],[1,"form-row"],[1,"form-group"],["for","customerId"],["type","text","readonly","",3,"value",4,"ngIf"],["id","customerId","formControlName","customerId",3,"error","change",4,"ngIf"],["type","hidden","formControlName","customerName"],["class","hint",4,"ngIf"],["class","error-text",4,"ngIf"],["for","orderDate"],["type","date","id","orderDate","formControlName","orderDate"],["for","orderNumber"],["type","text","id","orderNumber","formControlName","orderNumber","placeholder","Auto-generated if empty",3,"readonly"],[1,"hint"],["class","form-row",4,"ngIf"],[1,"section-header"],["type","button","class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["class","line-items-warning",4,"ngIf"],["formArrayName","lineItems"],["class","line-item",3,"formGroupName",4,"ngFor","ngForOf"],["class","empty-line-items",4,"ngIf"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"error-banner"],["type","text","readonly","",3,"value"],["id","customerId","formControlName","customerId",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"error-text"],["for","status"],["id","status","formControlName","status"],["value","CREATED"],["value","IN_PROGRESS"],["value","COMPLETED"],["value","ON_HOLD"],["value","CANCELLED"],["type","button",1,"btn","btn-sm","btn-primary",3,"click"],[1,"line-items-warning"],[1,"line-item",3,"formGroupName"],[1,"line-item-header"],[1,"line-number"],["type","button","class","btn-icon btn-danger","title","Remove line item",3,"click",4,"ngIf"],[1,"line-item-fields"],[1,"form-group","product-group"],["formControlName","productSku",3,"error","change",4,"ngIf"],["type","hidden","formControlName","productName"],[1,"form-group","quantity-group"],["type","number","formControlName","quantity","min","0.01","step","0.01"],[1,"form-group","unit-group"],["type","text","formControlName","unit","readonly",""],["type","date","formControlName","deliveryDate"],["type","button","title","Remove line item",1,"btn-icon","btn-danger",3,"click"],[1,"fas","fa-xmark"],["formControlName","productSku",3,"change"],[1,"empty-line-items"]],template:function(r,o){if(r&1&&(i(0,"div",0)(1,"div",1)(2,"h1",2),s(3),t()(),g(4,dt,2,0,"div",3)(5,Mt,42,18,"div",4),t()),r&2){let l;a(3),h(o.isEditMode?"Edit Order: "+(((l=o.form.get("orderNumber"))==null?null:l.value)||"ORD-"+o.orderId):"New Order"),a(),d("ngIf",o.loading),a(),d("ngIf",!o.loading)}},dependencies:[w,N,me,$,B,le,ge,he,ce,pe,Ce,ue,xe,fe,_e],styles:[".order-form-page[_ngcontent-%COMP%]{padding:20px;max-width:1000px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;color:#333}.loading[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}.form-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;padding:24px}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:12px 16px;border-radius:4px;margin-bottom:20px}.form-section[_ngcontent-%COMP%]{margin-bottom:32px}.form-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#333;margin:0 0 16px;padding-bottom:8px;border-bottom:1px solid #eee}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid #eee}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;padding:0;border:none}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:16px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.form-group.full-width[_ngcontent-%COMP%]{grid-column:1 / -1}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:#555;font-size:14px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{padding:10px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;transition:border-color .2s}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea.error[_ngcontent-%COMP%]{border-color:#d32f2f}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:disabled, .form-group[_ngcontent-%COMP%]   input[readonly][_ngcontent-%COMP%]{background:#f5f5f5;cursor:not-allowed}.hint[_ngcontent-%COMP%]{font-size:12px;color:#666}.error-text[_ngcontent-%COMP%]{font-size:12px;color:#d32f2f}.line-item[_ngcontent-%COMP%]{background:#f8f9fa;border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid #e9ecef}.line-item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.line-number[_ngcontent-%COMP%]{font-weight:600;color:#333}.line-item-fields[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 120px 100px 150px;gap:12px;align-items:end}.quantity-group[_ngcontent-%COMP%]{min-width:100px}.unit-group[_ngcontent-%COMP%]{min-width:80px}.line-items-warning[_ngcontent-%COMP%]{background:#fff3cd;color:#856404;padding:12px 16px;border-radius:4px;margin-bottom:16px;font-size:14px}.empty-line-items[_ngcontent-%COMP%]{text-align:center;padding:32px;color:#666;background:#f8f9fa;border-radius:8px;border:2px dashed #dee2e6}.btn-icon[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:background .2s}.btn-icon.btn-danger[_ngcontent-%COMP%]{color:#d32f2f}.btn-icon.btn-danger[_ngcontent-%COMP%]:hover{background:#f8d7da}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;padding-top:20px;border-top:1px solid #eee}.btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:500;transition:background .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#1976d2;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#1565c0}.btn-secondary[_ngcontent-%COMP%]{background:#757575;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#616161}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}@media (max-width: 900px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.line-item-fields[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}@media (max-width: 600px){.line-item-fields[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return n})();var yt=[{path:"",component:we},{path:"new",component:W},{path:":orderId",component:Ne},{path:":orderId/edit",component:W}],De=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=V({type:n})}static{this.\u0275inj=z({imports:[U.forChild(yt),U]})}}return n})();var Zt=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=V({type:n})}static{this.\u0275inj=z({imports:[de,Oe,be,De,Me]})}}return n})();export{Zt as OrdersModule};
