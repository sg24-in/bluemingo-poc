import{d as Z,e as J,f as K,g as X}from"./chunk-IX5OVKKX.js";import{d as Q}from"./chunk-ARXHOQX7.js";import"./chunk-6JOZGQIR.js";import{$ as V,Aa as j,D as v,Da as q,E as u,Ea as G,F as d,Fa as U,Ga as W,K as l,Ka as Y,L as g,M as f,N as I,Q as M,R as O,S as w,V as P,X as L,_ as N,aa as k,da as R,ea as A,g as C,i as T,j as E,l as m,m as _,o as r,p as S,qa as H,r as h,t as s,ta as F,ua as b,va as D,wa as z,x as i,xa as $,y as t,ya as B,z as x}from"./chunk-ADVEXGTJ.js";function oe(o,c){if(o&1&&(i(0,"div",9),l(1),t()),o&2){let e=d();r(),g(e.error)}}function le(o,c){if(o&1&&(i(0,"div",10),l(1),t()),o&2){let e=d();r(),g(e.success)}}function ae(o,c){o&1&&(i(0,"div",11),x(1,"app-loading-spinner",12),t())}function re(o,c){if(o&1){let e=v();i(0,"button",37),u("click",function(){m(e);let a=d().$implicit,p=d(3);return _(p.openReleaseHoldModal(a))}),l(1," Release "),t()}}function se(o,c){o&1&&(i(0,"span",38),l(1,"-"),t())}function de(o,c){if(o&1&&(i(0,"tr")(1,"td")(2,"span",33),l(3),t()(),i(4,"td"),l(5),t(),i(6,"td"),l(7),t(),i(8,"td"),x(9,"app-status-badge",34),t(),i(10,"td"),l(11),t(),i(12,"td"),l(13),P(14,"date"),t(),i(15,"td"),l(16),t(),i(17,"td"),h(18,re,2,0,"button",35)(19,se,2,0,"span",36),t()()),o&2){let e=c.$implicit,n=d(3);r(2),s("ngClass",e.entityType.toLowerCase()),r(),f(" ",e.entityType," "),r(2),g(e.entityName),r(2),g(e.reason),r(2),s("status",e.status),r(2),g(e.appliedBy),r(2),g(L(14,10,e.appliedOn,"short")),r(3),g(n.formatDuration(e.durationMinutes)),r(2),s("ngIf",e.status==="ACTIVE"),r(),s("ngIf",e.status!=="ACTIVE")}}function pe(o,c){if(o&1&&(i(0,"table",31)(1,"thead")(2,"tr")(3,"th"),l(4,"Entity Type"),t(),i(5,"th"),l(6,"Entity"),t(),i(7,"th"),l(8,"Reason"),t(),i(9,"th"),l(10,"Status"),t(),i(11,"th"),l(12,"Applied By"),t(),i(13,"th"),l(14,"Applied On"),t(),i(15,"th"),l(16,"Duration"),t(),i(17,"th"),l(18,"Actions"),t()()(),i(19,"tbody"),h(20,de,20,13,"tr",32),t()()),o&2){let e=d(2);r(20),s("ngForOf",e.holds)}}function ce(o,c){o&1&&(i(0,"p",39),l(1," No holds found matching the selected filters. "),t())}function me(o,c){if(o&1){let e=v();i(0,"app-pagination",40),u("pageChange",function(a){m(e);let p=d(2);return _(p.onPageChange(a))})("sizeChange",function(a){m(e);let p=d(2);return _(p.onSizeChange(a))}),t()}if(o&2){let e=d(2);s("page",e.page)("size",e.size)("totalElements",e.totalElements)("totalPages",e.totalPages)("hasNext",e.hasNext)("hasPrevious",e.hasPrevious)}}function _e(o,c){if(o&1){let e=v();i(0,"div")(1,"div",13)(2,"div",14)(3,"div",15)(4,"label"),l(5,"Status:"),t(),i(6,"select",16),u("change",function(a){m(e);let p=d();return _(p.onFilterStatusChange(a.target.value))}),i(7,"option",17),l(8,"All Statuses"),t(),i(9,"option",18),l(10,"Active"),t(),i(11,"option",19),l(12,"Released"),t()()(),i(13,"div",15)(14,"label"),l(15,"Entity Type:"),t(),i(16,"select",16),u("change",function(a){m(e);let p=d();return _(p.onFilterEntityTypeChange(a.target.value))}),i(17,"option",17),l(18,"All Types"),t(),i(19,"option",20),l(20,"Operation"),t(),i(21,"option",21),l(22,"Process"),t(),i(23,"option",22),l(24,"Order Line"),t(),i(25,"option",23),l(26,"Inventory"),t(),i(27,"option",24),l(28,"Batch"),t(),i(29,"option",25),l(30,"Equipment"),t()()(),i(31,"div",26)(32,"label"),l(33,"Search:"),t(),i(34,"input",27),u("input",function(a){m(e);let p=d();return _(p.onSearchChange(a.target.value))}),t()()()(),i(35,"div",13),h(36,pe,21,1,"table",28)(37,ce,2,0,"p",29)(38,me,1,6,"app-pagination",30),t()()}if(o&2){let e=d();r(6),s("value",e.filterStatus||"all"),r(10),s("value",e.filterEntityType||"all"),r(18),s("value",e.searchTerm),r(2),s("ngIf",e.holds.length>0),r(),s("ngIf",e.holds.length===0),r(),s("ngIf",e.holds.length>0)}}function ue(o,c){if(o&1&&(i(0,"option",61),l(1),t()),o&2){let e=c.$implicit;s("value",e.value),r(),f(" ",e.label," ")}}function he(o,c){if(o&1&&(i(0,"option",61),l(1),t()),o&2){let e=c.$implicit;s("value",e.id),r(),f(" ",e.name," ")}}function ge(o,c){if(o&1&&(i(0,"div",48)(1,"label",62),l(2,"Entity *"),t(),i(3,"select",63)(4,"option",51),l(5,"Select entity"),t(),h(6,he,2,2,"option",52),t()()),o&2){let e=d(2);r(6),s("ngForOf",e.getEntityOptions())}}function fe(o,c){if(o&1&&(i(0,"option",61),l(1),t()),o&2){let e=c.$implicit;s("value",e.reasonCode),r(),f(" ",e.reasonDescription," ")}}function xe(o,c){if(o&1){let e=v();i(0,"div",41),u("click",function(){m(e);let a=d();return _(a.closeApplyHoldModal())}),i(1,"div",42),u("click",function(a){return m(e),_(a.stopPropagation())}),i(2,"div",43)(3,"h3"),l(4,"Apply Hold"),t(),i(5,"button",44),u("click",function(){m(e);let a=d();return _(a.closeApplyHoldModal())}),x(6,"i",45),t()(),i(7,"form",46),u("ngSubmit",function(){m(e);let a=d();return _(a.applyHold())}),i(8,"div",47)(9,"div",48)(10,"label",49),l(11,"Entity Type *"),t(),i(12,"select",50)(13,"option",51),l(14,"Select entity type"),t(),h(15,ue,2,2,"option",52),t()(),h(16,ge,7,1,"div",53),i(17,"div",48)(18,"label",54),l(19,"Reason *"),t(),i(20,"select",55)(21,"option",51),l(22,"Select reason"),t(),h(23,fe,2,2,"option",52),t()(),i(24,"div",48)(25,"label",56),l(26,"Comments"),t(),x(27,"textarea",57),t()(),i(28,"div",58)(29,"button",59),u("click",function(){m(e);let a=d();return _(a.closeApplyHoldModal())}),l(30,"Cancel"),t(),i(31,"button",60),l(32," Apply Hold "),t()()()()()}if(o&2){let e,n=d();r(7),s("formGroup",n.applyHoldForm),r(8),s("ngForOf",n.entityTypes),r(),s("ngIf",(e=n.applyHoldForm.get("entityType"))==null?null:e.value),r(7),s("ngForOf",n.holdReasons),r(8),s("disabled",n.applyHoldForm.invalid||n.loading)}}function ve(o,c){if(o&1&&(i(0,"div",68)(1,"p")(2,"strong"),l(3,"Entity:"),t(),l(4),t(),i(5,"p")(6,"strong"),l(7,"Reason:"),t(),l(8),t(),i(9,"p")(10,"strong"),l(11,"Applied By:"),t(),l(12),t(),i(13,"p")(14,"strong"),l(15,"Duration:"),t(),l(16),t()()),o&2){let e=d(2);r(4),I(" ",e.selectedHold.entityType," - ",e.selectedHold.entityName,""),r(4),f(" ",e.selectedHold.reason,""),r(4),f(" ",e.selectedHold.appliedBy,""),r(4),f(" ",e.formatDuration(e.selectedHold.durationMinutes),"")}}function ye(o,c){if(o&1){let e=v();i(0,"div",41),u("click",function(){m(e);let a=d();return _(a.closeReleaseHoldModal())}),i(1,"div",42),u("click",function(a){return m(e),_(a.stopPropagation())}),i(2,"div",43)(3,"h3"),l(4,"Release Hold"),t(),i(5,"button",44),u("click",function(){m(e);let a=d();return _(a.closeReleaseHoldModal())}),x(6,"i",45),t()(),i(7,"div",47),h(8,ve,17,5,"div",64),i(9,"div",48)(10,"label",65),l(11,"Release Comments"),t(),i(12,"textarea",66),w("ngModelChange",function(a){m(e);let p=d();return O(p.releaseComments,a)||(p.releaseComments=a),_(a)}),t()()(),i(13,"div",58)(14,"button",59),u("click",function(){m(e);let a=d();return _(a.closeReleaseHoldModal())}),l(15,"Cancel"),t(),i(16,"button",67),u("click",function(){m(e);let a=d();return _(a.releaseHold())}),l(17," Release Hold "),t()()()()}if(o&2){let e=d();r(8),s("ngIf",e.selectedHold),r(4),M("ngModel",e.releaseComments),r(4),s("disabled",e.loading)}}var te=(()=>{class o{constructor(e,n){this.apiService=e,this.fb=n,this.holds=[],this.holdReasons=[],this.loading=!1,this.error="",this.success="",this.page=0,this.size=20,this.totalElements=0,this.totalPages=0,this.hasNext=!1,this.hasPrevious=!1,this.filterStatus="",this.filterEntityType="",this.searchTerm="",this.showApplyHoldModal=!1,this.showReleaseHoldModal=!1,this.selectedHold=null,this.releaseComments="",this.entityTypes=[{value:"OPERATION",label:"Operation"},{value:"PROCESS",label:"Process"},{value:"ORDER_LINE",label:"Order Line"},{value:"INVENTORY",label:"Inventory"},{value:"BATCH",label:"Batch"}],this.operations=[],this.processes=[],this.inventory=[],this.batches=[],this.applyHoldForm=this.fb.group({entityType:["",b.required],entityId:["",b.required],reason:["",b.required],comments:[""]})}ngOnInit(){this.loadHolds(),this.loadHoldReasons(),this.loadEntities()}loadHolds(){this.loading=!0;let e={page:this.page,size:this.size,sortBy:"appliedOn",sortDirection:"DESC",status:this.filterStatus||void 0,type:this.filterEntityType||void 0,search:this.searchTerm||void 0};this.apiService.getHoldsPaged(e).subscribe({next:n=>{this.holds=n.content,this.page=n.page,this.size=n.size,this.totalElements=n.totalElements,this.totalPages=n.totalPages,this.hasNext=n.hasNext,this.hasPrevious=n.hasPrevious,this.loading=!1},error:n=>{console.error("Error loading holds:",n),this.error="Failed to load holds",this.loading=!1}})}onPageChange(e){this.page=e,this.loadHolds()}onSizeChange(e){this.size=e,this.page=0,this.loadHolds()}onFilterStatusChange(e){this.filterStatus=e==="all"?"":e,this.page=0,this.loadHolds()}onFilterEntityTypeChange(e){this.filterEntityType=e==="all"?"":e,this.page=0,this.loadHolds()}onSearchChange(e){this.searchTerm=e,this.page=0,this.loadHolds()}loadHoldReasons(){this.apiService.getHoldReasons().subscribe({next:e=>{this.holdReasons=e},error:e=>console.error("Error loading hold reasons:",e)})}loadEntities(){this.apiService.getAvailableOrders().subscribe({next:e=>{this.operations=[],e.forEach(n=>{n.lineItems?.forEach(a=>{a.processes?.forEach(p=>{p.operations?.forEach(y=>{y.status!=="ON_HOLD"&&y.status!=="CONFIRMED"&&this.operations.push({id:y.operationId,name:`${y.operationName} (Order: ${n.orderId})`})}),p.status!=="ON_HOLD"&&p.status!=="COMPLETED"&&this.processes.push({id:p.processId,name:`${p.stageName} (Order: ${n.orderId})`})})})})},error:e=>console.error("Error loading operations:",e)}),this.apiService.getAllInventory().subscribe({next:e=>{this.inventory=e.filter(n=>n.state!=="ON_HOLD"&&n.state!=="CONSUMED").map(n=>({id:n.inventoryId,name:`${n.materialId} - ${n.materialName} (${n.quantity} ${n.unit})`}))},error:e=>console.error("Error loading inventory:",e)}),this.apiService.getAllBatches().subscribe({next:e=>{this.batches=e.filter(n=>n.status!=="ON_HOLD"&&n.status!=="CONSUMED").map(n=>({id:n.batchId,name:`${n.batchNumber} - ${n.materialName}`}))},error:e=>console.error("Error loading batches:",e)})}getEntityOptions(){switch(this.applyHoldForm.get("entityType")?.value){case"OPERATION":return this.operations;case"PROCESS":return this.processes;case"INVENTORY":return this.inventory;case"BATCH":return this.batches;default:return[]}}openApplyHoldModal(){this.applyHoldForm.reset(),this.showApplyHoldModal=!0,this.error="",this.success=""}closeApplyHoldModal(){this.showApplyHoldModal=!1}openReleaseHoldModal(e){this.selectedHold=e,this.releaseComments="",this.showReleaseHoldModal=!0,this.error="",this.success=""}closeReleaseHoldModal(){this.showReleaseHoldModal=!1,this.selectedHold=null}applyHold(){if(this.applyHoldForm.invalid)return;let e=this.applyHoldForm.value;this.loading=!0,this.error="",this.apiService.applyHold(e).subscribe({next:()=>{this.success="Hold applied successfully",this.closeApplyHoldModal(),this.loadHolds(),this.loadEntities(),this.loading=!1},error:n=>{console.error("Error applying hold:",n),this.error=n.error?.message||"Failed to apply hold",this.loading=!1}})}releaseHold(){this.selectedHold&&(this.loading=!0,this.error="",this.apiService.releaseHold(this.selectedHold.holdId,this.releaseComments).subscribe({next:()=>{this.success="Hold released successfully",this.closeReleaseHoldModal(),this.loadHolds(),this.loadEntities(),this.loading=!1},error:e=>{console.error("Error releasing hold:",e),this.error=e.error?.message||"Failed to release hold",this.loading=!1}}))}formatDuration(e){if(!e)return"-";let n=Math.floor(e/60),a=e%60;return n>0?`${n}h ${a}m`:`${a}m`}static{this.\u0275fac=function(n){return new(n||o)(S(Q),S(Y))}}static{this.\u0275cmp=T({type:o,selectors:[["app-hold-list"]],decls:12,vars:6,consts:[[1,"container"],[1,"page-header"],[1,"page-title"],[1,"btn","btn-primary",3,"click"],["class","alert alert-error",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["class","text-center",4,"ngIf"],[4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-error"],[1,"alert","alert-success"],[1,"text-center"],["message","Loading holds..."],[1,"card"],[1,"filters"],[1,"filter-group"],[3,"change","value"],["value","all"],["value","ACTIVE"],["value","RELEASED"],["value","OPERATION"],["value","PROCESS"],["value","ORDER_LINE"],["value","INVENTORY"],["value","BATCH"],["value","EQUIPMENT"],[1,"filter-group","search-group"],["type","text","placeholder","Search by reason or comments...",3,"input","value"],["class","table",4,"ngIf"],["class","no-data",4,"ngIf"],[3,"page","size","totalElements","totalPages","hasNext","hasPrevious","pageChange","sizeChange",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],[1,"entity-type-badge",3,"ngClass"],[3,"status"],["class","btn btn-sm btn-success",3,"click",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"text-muted"],[1,"no-data"],[3,"pageChange","sizeChange","page","size","totalElements","totalPages","hasNext","hasPrevious"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"fas","fa-xmark"],[3,"ngSubmit","formGroup"],[1,"modal-body"],[1,"form-group"],["for","entityType"],["id","entityType","formControlName","entityType"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","form-group",4,"ngIf"],["for","reason"],["id","reason","formControlName","reason"],["for","comments"],["id","comments","formControlName","comments","rows","3"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-warning",3,"disabled"],[3,"value"],["for","entityId"],["id","entityId","formControlName","entityId"],["class","hold-details",4,"ngIf"],["for","releaseComments"],["id","releaseComments","rows","3",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-success",3,"click","disabled"],[1,"hold-details"]],template:function(n,a){n&1&&(i(0,"div",0)(1,"div",1)(2,"h1",2),l(3,"Hold Management"),t(),i(4,"button",3),u("click",function(){return a.openApplyHoldModal()}),l(5," Apply Hold "),t()(),h(6,oe,2,1,"div",4)(7,le,2,1,"div",5)(8,ae,2,0,"div",6)(9,_e,39,6,"div",7),t(),h(10,xe,33,5,"div",8)(11,ye,18,3,"div",8)),n&2&&(r(6),s("ngIf",a.error),r(),s("ngIf",a.success),r(),s("ngIf",a.loading),r(),s("ngIf",!a.loading),r(),s("ngIf",a.showApplyHoldModal),r(),s("ngIf",a.showReleaseHoldModal))},dependencies:[N,V,k,B,U,W,F,G,D,z,$,j,q,Z,J,K,R],styles:[".hold-list-container[_ngcontent-%COMP%]{padding:20px}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333}.holds-table[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;overflow:hidden}.holds-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.holds-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .holds-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 16px;text-align:left;border-bottom:1px solid #e0e0e0}.holds-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f5f5f5;font-weight:600;color:#333}.holds-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#fafafa}.entity-type-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500;text-transform:uppercase}.entity-type-badge.operation[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.entity-type-badge.process[_ngcontent-%COMP%]{background-color:#f3e5f5;color:#7b1fa2}.entity-type-badge.order_line[_ngcontent-%COMP%]{background-color:#fff3e0;color:#f57c00}.entity-type-badge.inventory[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#388e3c}.entity-type-badge.batch[_ngcontent-%COMP%]{background-color:#fce4ec;color:#c2185b}.entity-type-badge.equipment[_ngcontent-%COMP%]{background-color:#e0f2f1;color:#00796b}.hold-details[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:16px;border-radius:4px;margin-bottom:16px}.hold-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px}"]})}}return o})();var Ce=[{path:"",component:te}],ie=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=E({type:o})}static{this.\u0275inj=C({imports:[H.forChild(Ce),H]})}}return o})();var De=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=E({type:o})}static{this.\u0275inj=C({imports:[A,ie,X]})}}return o})();export{De as HoldsModule};
