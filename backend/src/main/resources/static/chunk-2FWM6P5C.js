import{b as o,e as n,f as a,h as i,ja as c,qa as u,ua as l}from"./chunk-HJUEQZSK.js";var f=(()=>{class r{constructor(t,e){this.http=t,this.router=e,this.TOKEN_KEY="mes_token",this.USER_KEY="mes_user",this.currentUserSubject=new o(this.getStoredUser()),this.currentUser$=this.currentUserSubject.asObservable()}login(t){return this.http.post(`${l.apiUrl}/auth/login`,t).pipe(n(e=>{this.setToken(e.accessToken);let s={email:e.user.email,fullName:e.user.name};this.setUser(s),this.currentUserSubject.next(s)}))}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_KEY),this.currentUserSubject.next(null),this.router.navigate(["/login"])}getToken(){return localStorage.getItem(this.TOKEN_KEY)}isAuthenticated(){let t=this.getToken();if(!t)return!1;try{let s=JSON.parse(atob(t.split(".")[1])).exp*1e3;return Date.now()<s}catch{return!1}}getCurrentUser(){return this.currentUserSubject.value}setToken(t){localStorage.setItem(this.TOKEN_KEY,t)}setUser(t){localStorage.setItem(this.USER_KEY,JSON.stringify(t))}getStoredUser(){let t=localStorage.getItem(this.USER_KEY);if(t)try{return JSON.parse(t)}catch{return null}return null}static{this.\u0275fac=function(e){return new(e||r)(i(c),i(u))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{f as a};
