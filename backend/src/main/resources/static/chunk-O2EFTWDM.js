import{h as N,i as Ce,j as be,l as ye,m as Pe,n as Se}from"./chunk-LMWWBC6Z.js";import{$ as q,$a as he,A as ee,Aa as A,B as d,C as W,D as y,Da as Y,F as n,G as t,Ga as le,H as f,Ha as H,Ia as O,Ja as L,Ka as se,L as C,La as de,M as v,Ma as ce,N as p,Na as pe,Pa as me,Qa as ue,Ra as ge,S as $,Sa as fe,T as o,Ta as Q,U as u,Ua as T,V as g,Va as R,W as b,X as M,Xa as _e,Z as z,Za as xe,_ as V,_a as ve,d as J,da as D,ea as te,f as U,fa as ne,ga as G,h as K,ia as E,j as X,ja as w,k as Z,ka as k,m as F,na as ie,o as I,oa as oe,p as B,qa as re,r as _,s as x,w as r,x as S,ya as ae,z as m}from"./chunk-SXRLIX2W.js";function Ne(i,c){if(i&1){let e=C();n(0,"button",13),v("click",function(){_(e);let l=p();return x(l.openHoldModal())}),f(1,"i",14),o(2," Apply Hold "),t()}}function ze(i,c){i&1&&(n(0,"span",15),f(1,"i",14),o(2," Operation On Hold "),t())}function Ve(i,c){i&1&&(n(0,"div",16),f(1,"app-loading-spinner",17),t())}function qe(i,c){if(i&1&&(n(0,"div",34)(1,"div",35),f(2,"i",36),n(3,"span"),o(4,"This is a partial confirmation. Additional confirmations are needed to complete this operation."),t()(),n(5,"div",37)(6,"div",38)(7,"span"),o(8),t(),n(9,"span",39),o(10),t()(),n(11,"div",40),f(12,"div",41),t(),n(13,"div",42)(14,"strong"),o(15,"Remaining:"),t(),o(16),t()()()),i&2){let e=p(2);r(8),b("Progress: ",e.confirmationResult.producedQty," / ",e.getTargetQty(),""),r(2),g("",e.getConfirmationProgress(),"%"),r(2),W("width",e.getConfirmationProgress(),"%"),r(4),g(" ",e.getRemainingQty()," units ")}}function Fe(i,c){if(i&1&&(n(0,"div",24)(1,"span",25),o(2,"Output Batches:"),t(),n(3,"span",26),o(4),t()()),i&2){let e=p(2);r(4),g("",e.getOutputBatches().length," batch(es)")}}function Be(i,c){if(i&1){let e=C();n(0,"div",48)(1,"div",49)(2,"span",50),o(3),t(),n(4,"span",51),o(5),t()(),n(6,"div",52)(7,"div",53)(8,"span",54),o(9,"Material:"),t(),n(10,"span",55),o(11),t()(),n(12,"div",53)(13,"span",54),o(14,"Quantity:"),t(),n(15,"span",55),o(16),t()()(),n(17,"button",56),v("click",function(){let l=_(e).$implicit,s=p(3);return x(s.goToBatch(l.batchId))}),f(18,"i",57),o(19," View Batch "),t()()}if(i&2){let e=c.$implicit,a=c.index;r(3),g("#",a+1,""),r(2),u(e.batchNumber),r(6),u(e.materialName||e.materialId),r(5),b("",e.quantity," ",e.unit,"")}}function De(i,c){if(i&1&&(n(0,"div",43)(1,"h4",44),f(2,"i",45),o(3),t(),n(4,"div",46),m(5,Be,20,5,"div",47),t()()),i&2){let e=p(2);r(3),g(" Output Batches (",e.getOutputBatches().length,") "),r(2),d("ngForOf",e.getOutputBatches())}}function Ae(i,c){if(i&1&&(n(0,"div",24)(1,"span",25),o(2,"New Batch Created:"),t(),n(3,"span",26),o(4),t()()),i&2){let e=p(2);r(4),u(e.confirmationResult.newBatchNumber)}}function He(i,c){i&1&&(n(0,"span",59),o(1," (includes partial batch) "),t())}function Le(i,c){if(i&1&&(n(0,"div",24)(1,"span",25),o(2,"Batch Split:"),t(),n(3,"span",26),o(4),m(5,He,2,0,"span",58),t()()),i&2){let e=p(2);r(4),g(" ",e.confirmationResult.batchCount," batches "),r(),d("ngIf",e.confirmationResult.hasPartialBatch)}}function Qe(i,c){if(i&1){let e=C();n(0,"button",60),v("click",function(){_(e);let l=p(2);return x(l.continueConfirmation())}),f(1,"i",61),o(2," Continue Confirmation "),t()}}function je(i,c){if(i&1){let e=C();n(0,"button",2),v("click",function(){_(e);let l=p(2);return x(l.goToBatch(l.getOutputBatches()[0].batchId))}),o(1," View Batch "),t()}}function We(i,c){if(i&1){let e=C();n(0,"button",2),v("click",function(){_(e);let l=p(2);return x(l.goToBatch(l.confirmationResult.newBatchId))}),o(1," View New Batch "),t()}}function $e(i,c){if(i&1){let e=C();n(0,"div",18)(1,"div",19)(2,"div",20),f(3,"i",21),t(),n(4,"h2"),o(5),t(),m(6,qe,17,6,"div",22),n(7,"div",23)(8,"div",24)(9,"span",25),o(10,"Confirmation ID:"),t(),n(11,"span",26),o(12),t()(),n(13,"div",24)(14,"span",25),o(15,"Quantity Produced:"),t(),n(16,"span",26),o(17),t()(),m(18,Fe,5,1,"div",27)(19,De,6,2,"div",28)(20,Ae,5,1,"div",27),n(21,"div",24)(22,"span",25),o(23,"Materials Consumed:"),t(),n(24,"span",26),o(25),t()(),n(26,"div",24)(27,"span",25),o(28,"Operation Status:"),t(),f(29,"app-status-badge",29),t(),m(30,Le,6,2,"div",27),t(),n(31,"div",30)(32,"button",31),v("click",function(){_(e);let l=p();return x(l.goBack())}),o(33,"Back to Order"),t(),m(34,Qe,3,0,"button",32)(35,je,2,0,"button",33)(36,We,2,0,"button",33),t()()()}if(i&2){let e=p();r(),y("partial-card",e.isPartialConfirmation()),r(),y("partial-icon",e.isPartialConfirmation()),r(),d("ngClass",e.isPartialConfirmation()?"fa-clock":"fa-circle-check"),r(2),u(e.isPartialConfirmation()?"Partial Confirmation Saved":"Production Confirmed Successfully!"),r(),d("ngIf",e.isPartialConfirmation()),r(6),u(e.confirmationResult.confirmationId),r(5),u(e.confirmationResult.producedQty||e.confirmationResult.quantityProduced),r(),d("ngIf",e.getOutputBatches().length>0),r(),d("ngIf",e.getOutputBatches().length>0),r(),d("ngIf",e.getOutputBatches().length===0&&e.confirmationResult.newBatchNumber),r(5),g("",(e.confirmationResult.materialsConsumed==null?null:e.confirmationResult.materialsConsumed.length)||0," item(s)"),r(4),d("status",e.confirmationResult.status||e.confirmationResult.operationStatus),r(),d("ngIf",e.confirmationResult.batchCount&&e.confirmationResult.batchCount>1),r(4),d("ngIf",e.isPartialConfirmation()),r(),d("ngIf",e.getOutputBatches().length===1),r(),d("ngIf",e.confirmationResult.newBatchId&&e.getOutputBatches().length===0)}}function Ge(i,c){if(i&1&&(n(0,"span",133),o(1),t()),i&2){let e=p(3);r(),g(" ",e.previewBatchNumber," ")}}function Ye(i,c){i&1&&(n(0,"span",134),o(1," Loading... "),t())}function Je(i,c){if(i&1&&(n(0,"div",129)(1,"div",66)(2,"span",67),o(3,"Output Batch Number (Preview)"),t(),m(4,Ge,2,1,"span",130)(5,Ye,2,0,"span",131),t(),n(6,"p",132),o(7,"This batch number will be assigned upon confirmation"),t()()),i&2){let e=p(2);r(4),d("ngIf",!e.loadingBatchPreview),r(),d("ngIf",e.loadingBatchPreview)}}function Ue(i,c){i&1&&(n(0,"div",135),o(1," Start time cannot be in the future "),t())}function Ke(i,c){i&1&&(n(0,"div",135),o(1," End time must be after start time "),t())}function Xe(i,c){if(i&1&&(n(0,"div",136)(1,"span",137),o(2,"Duration:"),t(),n(3,"span",138),o(4),t(),n(5,"span",139),o(6),t()()),i&2){let e=p(2);r(4),u(e.durationFormatted),r(2),g("(",e.durationMinutes," minutes)")}}function Ze(i,c){if(i&1&&(n(0,"div",140),f(1,"i",141),n(2,"span"),o(3),t()()),i&2){let e=p(2);r(3),u(e.batchSizeWarning)}}function et(i,c){if(i&1&&(n(0,"div",142),f(1,"i",36),n(2,"span"),o(3),t()()),i&2){let e=p(2);r(3),M(" Batch size range: ",(e.batchSizeConfig==null?null:e.batchSizeConfig.minBatchSize)||0," - ",e.batchSizeConfig==null?null:e.batchSizeConfig.maxBatchSize," ",(e.batchSizeConfig==null?null:e.batchSizeConfig.unit)||"T"," ")}}function tt(i,c){i&1&&(n(0,"span",151),o(1," partial "),t())}function nt(i,c){if(i&1&&(n(0,"span",149),o(1),m(2,tt,2,0,"span",150),t()),i&2){let e=c.$implicit,a=c.index,l=p(3);y("partial-chip",l.batchSplitPreview.hasPartialBatch&&a===l.batchSplitPreview.batchSizes.length-1),r(),M(" #",a+1,": ",e,"",(l.batchSizeConfig==null?null:l.batchSizeConfig.unit)||"T"," "),r(),d("ngIf",l.batchSplitPreview.hasPartialBatch&&a===l.batchSplitPreview.batchSizes.length-1)}}function it(i,c){if(i&1&&(n(0,"div",143)(1,"div",144),f(2,"i",145),n(3,"span"),o(4,"This will create "),n(5,"strong"),o(6),t()()(),n(7,"div",146),m(8,nt,3,6,"span",147),t(),n(9,"div",148),f(10,"i",36),o(11," Sequential batch numbers will be assigned (e.g. -01, -02, ...) "),t()()),i&2){let e=p(2);r(6),g("",e.batchSplitPreview.batchCount," batches"),r(2),d("ngForOf",e.batchSplitPreview.batchSizes)}}function ot(i,c){i&1&&(n(0,"div",152),f(1,"span",153),o(2," Calculating batch split... "),t())}function rt(i,c){if(i&1&&(n(0,"div",154)(1,"div",155)(2,"div",156)(3,"span",157),o(4,"Total Production:"),t(),n(5,"span",158),o(6),t()(),n(7,"div",156)(8,"span",157),o(9,"Yield:"),t(),n(10,"span",159),o(11),t()()(),n(12,"div",160),f(13,"div",161),t(),n(14,"div",162)(15,"span",163),f(16,"span",164),o(17," Good (>=95%)"),t(),n(18,"span",163),f(19,"span",165),o(20," Warning (80-95%)"),t(),n(21,"span",163),f(22,"span",166),o(23," Critical (<80%)"),t()()()),i&2){let e=p(2);r(6),u(e.totalProduction),r(4),d("ngClass",e.yieldClass),r(),g(" ",e.yieldPercentage,"% "),r(2),W("width",e.yieldPercentage,"%"),d("ngClass",e.yieldClass)}}function at(i,c){if(i&1&&(n(0,"tr")(1,"td"),o(2),t(),n(3,"td"),o(4),t(),n(5,"td"),o(6),t(),n(7,"td"),o(8),t(),n(9,"td")(10,"span",175),o(11),t()()()),i&2){let e=c.$implicit;y("insufficient",!e.sufficientStock),r(2),b("",e.materialName," (",e.materialId,")"),r(2),b("",e.requiredQuantity," ",e.unit,""),r(2),b("",e.availableQuantity," ",e.unit,""),r(2),u(e.yieldLossRatio),r(2),y("ok",e.sufficientStock)("low",!e.sufficientStock),r(),g(" ",e.sufficientStock?"Sufficient":"Insufficient"," ")}}function lt(i,c){i&1&&(n(0,"div",176)(1,"strong"),o(2,"Warning:"),t(),o(3," Insufficient stock for some materials. Please review before proceeding. "),t())}function st(i,c){if(i&1){let e=C();n(0,"div",167)(1,"div",168)(2,"h4"),o(3,"BOM Suggested Consumption"),t(),n(4,"button",94),v("click",function(){_(e);let l=p(2);return x(l.applySuggestedConsumption())}),o(5," Apply Suggestions "),t()(),n(6,"div",169)(7,"span",170),o(8,"Target Quantity:"),t(),n(9,"span",171),o(10),t(),n(11,"span",170),o(12,"Total Required:"),t(),n(13,"span",171),o(14),t()(),n(15,"table",172)(16,"thead")(17,"tr")(18,"th"),o(19,"Material"),t(),n(20,"th"),o(21,"Required Qty"),t(),n(22,"th"),o(23,"Available"),t(),n(24,"th"),o(25,"Yield Ratio"),t(),n(26,"th"),o(27,"Stock Status"),t()()(),n(28,"tbody"),m(29,at,12,14,"tr",173),t()(),m(30,lt,4,0,"div",174),t()}if(i&2){let e=p(2);r(10),g("",e.suggestedConsumption.targetQuantity," T"),r(4),g("",e.suggestedConsumption.totalRequiredQuantity," T"),r(15),d("ngForOf",e.suggestedConsumption.suggestedMaterials),r(),d("ngIf",!e.hasSufficientStock())}}function dt(i,c){i&1&&(n(0,"span",187),f(1,"i",188),o(2," Reserved "),t())}function ct(i,c){i&1&&(n(0,"span",189),f(1,"span",153),o(2," Reserving... "),t())}function pt(i,c){if(i&1&&(n(0,"span",190),f(1,"i",141),o(2," Not Reserved "),t()),i&2){let e=p().$implicit,a=p(3);d("title",a.getReservationWarning(e.inventoryId))}}function mt(i,c){i&1&&(n(0,"span",191),o(1," -- "),t())}function ut(i,c){if(i&1){let e=C();n(0,"tr")(1,"td"),o(2),t(),n(3,"td"),o(4),t(),n(5,"td"),o(6),t(),n(7,"td"),m(8,dt,3,0,"span",181)(9,ct,3,0,"span",182)(10,pt,3,1,"span",183)(11,mt,2,0,"span",184),t(),n(12,"td")(13,"input",185),v("change",function(l){let s=_(e).index,h=p(3);return x(h.updateMaterialQuantity(s,l.target.valueAsNumber))}),t()(),n(14,"td")(15,"button",186),v("click",function(){let l=_(e).index,s=p(3);return x(s.removeMaterial(l))}),o(16," Remove "),t()()()}if(i&2){let e=c.$implicit,a=p(3);y("reservation-warning-row",a.getReservationWarning(e.inventoryId)),r(2),u(e.batchNumber),r(2),u(e.materialId),r(2),u(e.availableQuantity),r(2),d("ngIf",a.isReserved(e.inventoryId)),r(),d("ngIf",a.isReserving(e.inventoryId)),r(),d("ngIf",a.getReservationWarning(e.inventoryId)),r(),d("ngIf",!a.isReserved(e.inventoryId)&&!a.isReserving(e.inventoryId)&&!a.getReservationWarning(e.inventoryId)),r(2),d("value",e.quantityToConsume)("min",0)("max",e.availableQuantity)}}function gt(i,c){i&1&&(n(0,"div",192),f(1,"i",141),n(2,"span"),o(3," Some materials could not be reserved and may be allocated by another session. Proceed with caution to avoid double-allocation. "),t()())}function ft(i,c){if(i&1&&(n(0,"div",177)(1,"h4"),o(2),t(),n(3,"table",178)(4,"thead")(5,"tr")(6,"th"),o(7,"Batch #"),t(),n(8,"th"),o(9,"Material ID"),t(),n(10,"th"),o(11,"Available"),t(),n(12,"th"),o(13,"Reservation"),t(),n(14,"th"),o(15,"Qty to Consume"),t(),n(16,"th"),o(17,"Action"),t()()(),n(18,"tbody"),m(19,ut,17,12,"tr",179),t()(),m(20,gt,4,0,"div",180),t()),i&2){let e=p(2);r(2),g("Selected Materials (",e.selectedMaterials.length,")"),r(17),d("ngForOf",e.selectedMaterials),r(),d("ngIf",e.hasReservationWarnings())}}function _t(i,c){if(i&1){let e=C();n(0,"tr")(1,"td"),o(2),t(),n(3,"td"),o(4),t(),n(5,"td"),o(6),t(),n(7,"td"),f(8,"app-status-badge",29),t(),n(9,"td")(10,"button",194),v("click",function(){let l=_(e).$implicit,s=p(3);return x(s.addMaterial(l))}),o(11),t()()()}if(i&2){let e=c.$implicit,a=p(3);r(2),u(e.batchNumber),r(2),u(e.materialId),r(2),b("",e.quantity," ",e.unit,""),r(2),d("status",e.state),r(2),d("ngClass",a.isMaterialSelected(e)?"btn-added":"btn-primary")("disabled",a.isMaterialSelected(e)),r(),g(" ",a.isMaterialSelected(e)?"Added":"Add"," ")}}function xt(i,c){if(i&1&&(n(0,"table",178)(1,"thead")(2,"tr")(3,"th"),o(4,"Batch #"),t(),n(5,"th"),o(6,"Material ID"),t(),n(7,"th"),o(8,"Available Qty"),t(),n(9,"th"),o(10,"State"),t(),n(11,"th"),o(12,"Action"),t()()(),n(13,"tbody"),m(14,_t,12,8,"tr",193),t()()),i&2){let e=p(2);r(14),d("ngForOf",e.availableInventory)}}function vt(i,c){i&1&&(n(0,"p",195),o(1,"No available inventory"),t())}function ht(i,c){if(i&1&&(n(0,"tr",199)(1,"td"),o(2),t(),n(3,"td"),o(4),t(),n(5,"td"),o(6),t(),n(7,"td")(8,"span",200),o(9),D(10,"uppercase"),t()()()),i&2){let e=c.$implicit,a=p(3);d("ngClass","bom-"+a.getRequirementStatus(e)),r(2),b("",e.materialName," (",e.materialId,")"),r(2),b("",e.quantityRequired," ",e.unit,""),r(2),b("",a.getTotalSelectedByMaterial(e.materialId)," ",e.unit,""),r(2),d("ngClass",a.getRequirementStatus(e)),r(),g(" ",te(10,9,a.getRequirementStatus(e))," ")}}function Ct(i,c){if(i&1&&(n(0,"div",196)(1,"h4"),o(2,"BOM Requirements"),t(),n(3,"table",197)(4,"thead")(5,"tr")(6,"th"),o(7,"Material"),t(),n(8,"th"),o(9,"Required Qty"),t(),n(10,"th"),o(11,"Selected Qty"),t(),n(12,"th"),o(13,"Status"),t()()(),n(14,"tbody"),m(15,ht,11,11,"tr",198),t()()()),i&2){let e=p(2);r(15),d("ngForOf",e.bomRequirements)}}function bt(i,c){if(i&1&&(n(0,"li"),o(1),t()),i&2){let e=c.$implicit;r(),u(e)}}function yt(i,c){if(i&1&&(n(0,"div",176)(1,"strong"),o(2,"Warnings:"),t(),n(3,"ul"),m(4,bt,2,1,"li",193),t()()),i&2){let e=p(3);r(4),d("ngForOf",e.bomValidationResult.warnings)}}function Pt(i,c){if(i&1&&(n(0,"li"),o(1),t()),i&2){let e=c.$implicit;r(),u(e)}}function St(i,c){if(i&1&&(n(0,"div",202)(1,"strong"),o(2,"Errors:"),t(),n(3,"ul"),m(4,Pt,2,1,"li",193),t()()),i&2){let e=p(3);r(4),d("ngForOf",e.bomValidationResult.errors)}}function Ot(i,c){if(i&1&&(n(0,"div",201),m(1,yt,5,1,"div",174)(2,St,5,1,"div",117),t()),i&2){let e=p(2);r(),d("ngIf",(e.bomValidationResult.warnings==null?null:e.bomValidationResult.warnings.length)>0),r(),d("ngIf",(e.bomValidationResult.errors==null?null:e.bomValidationResult.errors.length)>0)}}function Mt(i,c){if(i&1){let e=C();n(0,"div",203)(1,"label",120)(2,"input",204),v("change",function(){let l=_(e).index,s=p(2);return x(s.toggleEquipment(l))}),t(),n(3,"span",122),o(4),t()()()}if(i&2){let e=c.$implicit;r(2),d("checked",e.selected),r(2),b("",e.equipmentName," (",e.equipmentCode,")")}}function It(i,c){i&1&&(n(0,"p",205),o(1,"No equipment available"),t())}function Et(i,c){if(i&1){let e=C();n(0,"div",203)(1,"label",120)(2,"input",204),v("change",function(){let l=_(e).index,s=p(2);return x(s.toggleOperator(l))}),t(),n(3,"span",122),o(4),t()()()}if(i&2){let e=c.$implicit;r(2),d("checked",e.selected),r(2),b("",e.operatorName," (",e.operatorCode,")")}}function wt(i,c){i&1&&(n(0,"p",205),o(1,"No operators available"),t())}function kt(i,c){i&1&&(n(0,"span",206),o(1,"*"),t())}function Tt(i,c){if(i&1&&(n(0,"option",207),o(1),t()),i&2){let e=c.$implicit;d("value",e.reason_code),r(),g(" ",e.reason_description," ")}}function Rt(i,c){i&1&&(n(0,"div",135),o(1," Delay reason is required when delay duration is entered "),t())}function Nt(i,c){i&1&&(n(0,"span",206),o(1,"*"),t())}function zt(i,c){if(i&1&&(n(0,"span",213),o(1),t()),i&2){let e=p().$implicit;r(),g("(",e.unit,")")}}function Vt(i,c){if(i&1&&(n(0,"span",213),o(1),t()),i&2){let e=p().$implicit;r(),b(" [",e.min_value||"..."," - ",e.max_value||"...","] ")}}function qt(i,c){if(i&1&&(n(0,"div",135),o(1),t()),i&2){let e=p().$implicit;r(),g(" ",e.parameter_name," is required ")}}function Ft(i,c){if(i&1&&(n(0,"div",135),o(1),t()),i&2){let e=p().$implicit;r(),M(" ",e.parameter_name," must be at least ",e.min_value," ",e.unit||""," ")}}function Bt(i,c){if(i&1&&(n(0,"div",135),o(1),t()),i&2){let e=p().$implicit;r(),M(" ",e.parameter_name," must not exceed ",e.max_value," ",e.unit||""," ")}}function Dt(i,c){if(i&1&&(n(0,"div",75)(1,"div",210)(2,"label"),o(3),m(4,Nt,2,0,"span",111)(5,zt,2,1,"span",211)(6,Vt,2,2,"span",211),t(),f(7,"input",212),m(8,qt,2,1,"div",78)(9,Ft,2,3,"div",78)(10,Bt,2,3,"div",78),t()()),i&2){let e,a,l,s=c.$implicit,h=c.index,P=p(3);r(),d("formGroupName",h),r(2),g("",s.parameter_name," "),r(),d("ngIf",s.is_required),r(),d("ngIf",s.unit),r(),d("ngIf",s.min_value!==null||s.max_value!==null),r(),d("placeholder",s.default_value||""),ee("min",s.min_value)("max",s.max_value),r(),d("ngIf",((e=P.processParamsFormArray.at(h).get("parameterValue"))==null||e.errors==null?null:e.errors.required)&&((e=P.processParamsFormArray.at(h).get("parameterValue"))==null?null:e.touched)),r(),d("ngIf",(a=P.processParamsFormArray.at(h).get("parameterValue"))==null||a.errors==null?null:a.errors.min),r(),d("ngIf",(l=P.processParamsFormArray.at(h).get("parameterValue"))==null||l.errors==null?null:l.errors.max)}}function At(i,c){if(i&1){let e=C();n(0,"div",72)(1,"div",63),v("click",function(){_(e);let l=p(2);return x(l.toggleSection("processParameters"))}),n(2,"span"),o(3,"Process Parameters"),t(),f(4,"i",21),t(),n(5,"div",64)(6,"div",208),m(7,Dt,11,11,"div",209),t()()()}if(i&2){let e=p(2);r(4),d("ngClass",e.isCollapsed("processParameters")?"fa-chevron-down":"fa-chevron-up"),r(),y("collapsed",e.isCollapsed("processParameters")),r(2),d("ngForOf",e.processParameters)}}function Ht(i,c){if(i&1&&(n(0,"div",202),o(1),t()),i&2){let e=p(2);r(),g(" ",e.error," ")}}function Lt(i,c){i&1&&(n(0,"div",214),f(1,"i",36),n(2,"span"),o(3," This confirmation will be saved as partial. You can continue confirming additional quantities for this operation later. "),t()())}function Qt(i,c){if(i&1&&(n(0,"span"),o(1),t()),i&2){let e,a=p(2);r(),g(" ",(e=a.confirmForm.get("saveAsPartial"))!=null&&e.value?"Save Partial Confirmation":"Confirm Production"," ")}}function jt(i,c){i&1&&f(0,"span",215)}function Wt(i,c){if(i&1){let e=C();n(0,"div")(1,"div",62)(2,"div",63),v("click",function(){_(e);let l=p();return x(l.toggleSection("operationDetails"))}),n(3,"span"),o(4,"Operation Details"),t(),f(5,"i",21),t(),n(6,"div",64)(7,"div",65)(8,"div",66)(9,"span",67),o(10,"Operation"),t(),n(11,"span",68),o(12),t()(),n(13,"div",66)(14,"span",67),o(15,"Type"),t(),n(16,"span",68),o(17),t()(),n(18,"div",66)(19,"span",67),o(20,"Status"),t(),f(21,"app-status-badge",29),t(),n(22,"div",66)(23,"span",67),o(24,"Product"),t(),n(25,"span",68),o(26),t()(),n(27,"div",66)(28,"span",67),o(29,"Order Quantity"),t(),n(30,"span",68),o(31),t()(),n(32,"div",66)(33,"span",67),o(34,"Stage"),t(),n(35,"span",68),o(36),t()()(),m(37,Je,8,2,"div",69),t()(),n(38,"form",70),v("ngSubmit",function(){_(e);let l=p();return x(l.onSubmit())}),n(39,"div",71)(40,"div",72)(41,"div",63),v("click",function(){_(e);let l=p();return x(l.toggleSection("productionTime"))}),n(42,"span"),o(43,"Production Time"),t(),f(44,"i",21),t(),n(45,"div",64)(46,"div",73)(47,"div",74)(48,"div",75)(49,"label",76),o(50,"Start Time *"),t(),f(51,"input",77),m(52,Ue,2,0,"div",78),t()(),n(53,"div",74)(54,"div",75)(55,"label",79),o(56,"End Time *"),t(),f(57,"input",80),t()()(),m(58,Ke,2,0,"div",78)(59,Xe,7,2,"div",81),t()(),n(60,"div",72)(61,"div",63),v("click",function(){_(e);let l=p();return x(l.toggleSection("productionQuantities"))}),n(62,"span"),o(63,"Production Quantities"),t(),f(64,"i",21),t(),n(65,"div",64)(66,"div",73)(67,"div",74)(68,"div",75)(69,"label",82),o(70,"Quantity Produced *"),t(),f(71,"input",83),t()(),n(72,"div",74)(73,"div",75)(74,"label",84),o(75,"Quantity Scrapped"),t(),f(76,"input",85),t()()(),m(77,Ze,4,1,"div",86)(78,et,4,3,"div",87)(79,it,12,2,"div",88)(80,ot,3,0,"div",89)(81,rt,24,6,"div",90),t()()(),n(82,"div",62)(83,"div",91),v("click",function(){_(e);let l=p();return x(l.toggleSection("materialConsumption"))}),n(84,"span",92),o(85,"Material Consumption"),t(),n(86,"div",93)(87,"button",94),v("click",function(l){return _(e),p().openMaterialModal(),x(l.stopPropagation())}),f(88,"i",95),o(89," Select Materials "),t(),f(90,"i",96),t()(),n(91,"div",64),m(92,st,31,4,"div",97)(93,ft,21,3,"div",98),n(94,"div",99)(95,"h4"),o(96,"Available Inventory"),t(),m(97,xt,15,1,"table",100)(98,vt,2,0,"p",101),t(),m(99,Ct,16,1,"div",102)(100,Ot,3,2,"div",103),t()(),n(101,"div",71)(102,"div",72)(103,"div",63),v("click",function(){_(e);let l=p();return x(l.toggleSection("equipmentOperator"))}),n(104,"span"),o(105,"Equipment & Operator"),t(),f(106,"i",21),t(),n(107,"div",64)(108,"div",73)(109,"div",74)(110,"div",75)(111,"label"),o(112,"Equipment * "),n(113,"span",104),o(114),t()(),n(115,"div",105),m(116,Mt,5,3,"div",106)(117,It,2,0,"p",107),t()()(),n(118,"div",74)(119,"div",75)(120,"label"),o(121,"Operator * "),n(122,"span",104),o(123),t()(),n(124,"div",105),m(125,Et,5,3,"div",106)(126,wt,2,0,"p",107),t()()()()()(),n(127,"div",72)(128,"div",63),v("click",function(){_(e);let l=p();return x(l.toggleSection("delayTracking"))}),n(129,"span"),o(130,"Delay Tracking"),t(),f(131,"i",21),t(),n(132,"div",64)(133,"div",73)(134,"div",74)(135,"div",75)(136,"label",108),o(137,"Delay Duration (minutes)"),t(),f(138,"input",109),t()(),n(139,"div",74)(140,"div",75)(141,"label",110),o(142," Delay Reason "),m(143,kt,2,0,"span",111),t(),n(144,"select",112)(145,"option",113),o(146,"-- Select Reason --"),t(),m(147,Tt,2,2,"option",114),t(),m(148,Rt,2,0,"div",78),t()()()()()(),n(149,"div",71),m(150,At,8,4,"div",115),n(151,"div",72)(152,"div",63),v("click",function(){_(e);let l=p();return x(l.toggleSection("notes"))}),n(153,"span"),o(154,"Notes"),t(),f(155,"i",21),t(),n(156,"div",64)(157,"div",75),f(158,"textarea",116),t()()()(),m(159,Ht,2,1,"div",117),n(160,"div",118)(161,"div",119)(162,"label",120),f(163,"input",121),n(164,"span",122)(165,"strong"),o(166,"Save as Partial Confirmation"),t(),n(167,"span",123),o(168," Check this to save progress and continue confirmation later. The operation will remain in progress. "),t()()()(),m(169,Lt,4,0,"div",124),t(),n(170,"div",125)(171,"button",126),v("click",function(){_(e);let l=p();return x(l.goBack())}),o(172,"Cancel"),t(),n(173,"button",127),m(174,Qt,2,1,"span",9)(175,jt,1,0,"span",128),t()()()()}if(i&2){let e,a,l,s=p();r(5),d("ngClass",s.isCollapsed("operationDetails")?"fa-chevron-down":"fa-chevron-up"),r(),y("collapsed",s.isCollapsed("operationDetails")),r(6),b("",s.operation.operationName," (",s.operation.operationCode,")"),r(5),u(s.operation.operationType),r(4),d("status",s.operation.status),r(5),b("",s.operation.order==null?null:s.operation.order.productName," (",s.operation.order==null?null:s.operation.order.productSku,")"),r(5),u(s.operation.order==null?null:s.operation.order.quantity),r(5),u(s.operation.process==null?null:s.operation.process.processName),r(),d("ngIf",s.previewBatchNumber||s.loadingBatchPreview),r(),d("formGroup",s.confirmForm),r(6),d("ngClass",s.isCollapsed("productionTime")?"fa-chevron-down":"fa-chevron-up"),r(),y("collapsed",s.isCollapsed("productionTime")),r(7),d("ngIf",(e=s.confirmForm.get("startTime"))==null||e.errors==null?null:e.errors.futureStartTime),r(6),d("ngIf",s.confirmForm.errors==null?null:s.confirmForm.errors.invalidTimeRange),r(),d("ngIf",s.durationMinutes!==null&&s.durationMinutes>0),r(5),d("ngClass",s.isCollapsed("productionQuantities")?"fa-chevron-down":"fa-chevron-up"),r(),y("collapsed",s.isCollapsed("productionQuantities")),r(12),d("ngIf",s.batchSizeWarning),r(),d("ngIf",(s.batchSizeConfig==null?null:s.batchSizeConfig.found)&&!s.batchSizeWarning),r(),d("ngIf",s.batchSplitPreview),r(),d("ngIf",s.loadingBatchSplitPreview),r(),d("ngIf",s.totalProduction>0),r(9),d("ngClass",s.isCollapsed("materialConsumption")?"fa-chevron-down":"fa-chevron-up"),r(),y("collapsed",s.isCollapsed("materialConsumption")),r(),d("ngIf",s.showSuggestions&&s.suggestedConsumption),r(),d("ngIf",s.selectedMaterials.length>0),r(4),d("ngIf",s.availableInventory.length>0),r(),d("ngIf",s.availableInventory.length===0),r(),d("ngIf",s.bomRequirements.length>0),r(),d("ngIf",s.bomValidationResult),r(6),d("ngClass",s.isCollapsed("equipmentOperator")?"fa-chevron-down":"fa-chevron-up"),r(),y("collapsed",s.isCollapsed("equipmentOperator")),r(7),g("(",s.getSelectedEquipmentCount()," selected)"),r(2),d("ngForOf",s.availableEquipment),r(),d("ngIf",s.availableEquipment.length===0),r(6),g("(",s.getSelectedOperatorCount()," selected)"),r(2),d("ngForOf",s.activeOperators),r(),d("ngIf",s.activeOperators.length===0),r(5),d("ngClass",s.isCollapsed("delayTracking")?"fa-chevron-down":"fa-chevron-up"),r(),y("collapsed",s.isCollapsed("delayTracking")),r(11),d("ngIf",s.isDelayReasonRequired()),r(4),d("ngForOf",s.delayReasons),r(),d("ngIf",s.isDelayReasonRequired()&&!((a=s.confirmForm.get("delayReason"))!=null&&a.value)),r(2),d("ngIf",s.processParameters.length>0),r(),y("grid-full",s.processParameters.length===0),r(4),d("ngClass",s.isCollapsed("notes")?"fa-chevron-down":"fa-chevron-up"),r(),y("collapsed",s.isCollapsed("notes")),r(3),d("ngIf",s.error),r(10),d("ngIf",(l=s.confirmForm.get("saveAsPartial"))==null?null:l.value),r(4),d("disabled",s.confirmForm.invalid||s.submitting),r(),d("ngIf",!s.submitting),r(),d("ngIf",s.submitting)}}function $t(i,c){if(i&1&&(n(0,"div",62)(1,"p",195),o(2),t()()),i&2){let e=p();r(2),u(e.error||"Operation not found")}}var Ee=(()=>{class i{constructor(e,a,l,s){this.route=e,this.router=a,this.fb=l,this.apiService=s,this.operation=null,this.loading=!0,this.submitting=!1,this.success=!1,this.error="",this.availableInventory=[],this.availableEquipment=[],this.activeOperators=[],this.processParameters=[],this.delayReasons=[],this.selectedMaterials=[],this.confirmationResult=null,this.bomRequirements=[],this.bomValidationResult=null,this.showBomWarning=!1,this.suggestedConsumption=null,this.loadingSuggestions=!1,this.showSuggestions=!1,this.previewBatchNumber="",this.loadingBatchPreview=!1,this.showMaterialModal=!1,this.reservedInventoryIds=[],this.reservationWarnings={},this.reservingInventoryIds=[],this.showHoldModal=!1,this.batchSizeConfig=null,this.batchSizeWarning="",this.batchSplitPreview=null,this.loadingBatchSplitPreview=!1,this.batchSplitPreviewSubject=new J,this.collapsedSections={operationDetails:!1,productionTime:!1,productionQuantities:!1,materialConsumption:!1,equipmentOperator:!1,delayTracking:!1,processParameters:!1,notes:!1}}ngOnInit(){this.operationId=Number(this.route.snapshot.paramMap.get("operationId")),this.initForm(),this.loadData(),this.confirmForm.get("quantityProduced")?.valueChanges.subscribe(e=>{this.checkBatchSizeWarning(),this.batchSplitPreviewSubject.next(e)}),this.batchSplitSubscription=this.batchSplitPreviewSubject.pipe(X(300),K(()=>!!this.batchSizeConfig?.found&&!!this.batchSizeConfig?.maxBatchSize),Z(e=>{if(!e||e<=0||e<=(this.batchSizeConfig?.maxBatchSize||0))return this.batchSplitPreview=null,this.loadingBatchSplitPreview=!1,U;this.loadingBatchSplitPreview=!0;let a=this.operation?.operationType||"",l=this.operation?.order?.productSku||"";return this.apiService.calculateBatchSizes(e,a,void 0,l)})).subscribe({next:e=>{e&&e.batchCount>1?this.batchSplitPreview=e:this.batchSplitPreview=null,this.loadingBatchSplitPreview=!1},error:()=>{this.batchSplitPreview=null,this.loadingBatchSplitPreview=!1}})}ngOnDestroy(){this.batchSplitSubscription?.unsubscribe(),this.releaseAllReservations()}initForm(){let e=new Date,a=this.formatDateTimeLocal(e);this.confirmForm=this.fb.group({operationId:[this.operationId],startTime:[a,[O.required,this.startTimeValidator()]],endTime:[a,[O.required]],quantityProduced:[0,[O.required,O.min(1)]],quantityScrapped:[0,[O.min(0)]],delayMinutes:[0,[O.min(0)]],delayReason:[""],notes:[""],processParameters:this.fb.array([]),saveAsPartial:[!1]},{validators:this.timeRangeValidator()})}startTimeValidator(){return e=>e.value&&new Date(e.value)>new Date?{futureStartTime:!0}:null}timeRangeValidator(){return e=>{let a=e.get("startTime")?.value,l=e.get("endTime")?.value;if(a&&l){let s=new Date(a);if(new Date(l)<=s)return{invalidTimeRange:!0}}return null}}formatDateTimeLocal(e){let a=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),h=String(e.getHours()).padStart(2,"0"),P=String(e.getMinutes()).padStart(2,"0");return`${a}-${l}-${s}T${h}:${P}`}get processParamsFormArray(){return this.confirmForm.get("processParameters")}loadData(){this.loading=!0,this.batchSplitPreview=null,this.apiService.getOperationDetails(this.operationId).subscribe({next:e=>{this.operation=e,this.loadMasterData()},error:e=>{console.error("Error loading operation:",e),this.error="Failed to load operation details",this.loading=!1}})}loadMasterData(){this.apiService.getAvailableEquipment().subscribe({next:e=>{this.availableEquipment=e.map(a=>({equipmentId:a.equipmentId,equipmentCode:a.equipmentCode,equipmentName:a.name||a.equipmentName,selected:!1}))},error:e=>console.error("Error loading equipment:",e)}),this.apiService.getActiveOperators().subscribe({next:e=>{this.activeOperators=e.map(a=>({operatorId:a.operatorId,operatorCode:a.operatorCode,operatorName:a.name||a.operatorName,selected:!1}))},error:e=>console.error("Error loading operators:",e)}),this.apiService.getDelayReasons().subscribe({next:e=>{this.delayReasons=e},error:e=>console.error("Error loading delay reasons:",e)}),this.apiService.getAvailableInventory().subscribe({next:e=>{this.availableInventory=e,this.loading=!1},error:e=>{console.error("Error loading inventory:",e),this.loading=!1}}),this.operation?.operationType&&this.apiService.getProcessParameters(this.operation.operationType,this.operation.order?.productSku).subscribe({next:e=>{this.processParameters=e,this.initProcessParams()},error:e=>console.error("Error loading process parameters:",e)}),this.operation?.order?.productSku&&this.apiService.getBomRequirements(this.operation.order.productSku).subscribe({next:e=>{this.bomRequirements=e.requirements||[]},error:e=>console.error("Error loading BOM requirements:",e)}),this.loadSuggestedConsumption(),this.loadBatchNumberPreview(),this.loadBatchSizeConfig()}loadBatchNumberPreview(){this.loadingBatchPreview=!0;let e=this.operation?.operationType||"",a=this.operation?.order?.productSku||"";this.apiService.previewBatchNumber(e,a).subscribe({next:l=>{this.previewBatchNumber=l.previewBatchNumber,this.loadingBatchPreview=!1},error:l=>{console.error("Error loading batch number preview:",l),this.previewBatchNumber="",this.loadingBatchPreview=!1}})}loadSuggestedConsumption(){this.loadingSuggestions=!0,this.apiService.getSuggestedConsumption(this.operationId).subscribe({next:e=>{this.suggestedConsumption=e,this.loadingSuggestions=!1,this.showSuggestions=e.suggestedMaterials?.length>0,e.targetQuantity&&!this.confirmForm.get("quantityProduced")?.value&&this.confirmForm.patchValue({quantityProduced:e.targetQuantity})},error:e=>{console.error("Error loading suggested consumption:",e),this.loadingSuggestions=!1}})}loadBatchSizeConfig(){let e=this.operation?.operationType||"",a=this.operation?.order?.productSku||"";this.apiService.checkBatchSizeConfig(e,a).subscribe({next:l=>{this.batchSizeConfig=l,this.checkBatchSizeWarning()},error:l=>{console.error("Error loading batch size config:",l),this.batchSizeConfig=null}})}checkBatchSizeWarning(){if(this.batchSizeWarning="",!this.batchSizeConfig||!this.batchSizeConfig.found)return;let e=this.confirmForm.get("quantityProduced")?.value||0;if(e<=0)return;let a=this.batchSizeConfig.minBatchSize||0,l=this.batchSizeConfig.maxBatchSize||0,s=this.batchSizeConfig.unit||"T",h=[];a>0&&e<a&&h.push(`Quantity ${e} is below minimum batch size of ${a} ${s}`),l>0&&e>l&&h.push(`Quantity ${e} exceeds maximum batch size of ${l} ${s}`),this.batchSizeWarning=h.join(". ")}applySuggestedConsumption(){if(this.suggestedConsumption){this.releaseAllReservations(),this.selectedMaterials=[];for(let e of this.suggestedConsumption.suggestedMaterials)for(let a of e.availableBatches)a.suggestedConsumption>0&&(this.selectedMaterials.push({inventoryId:a.inventoryId,batchId:a.batchId||0,batchNumber:a.batchNumber||"",materialId:e.materialId,availableQuantity:a.availableQuantity,quantityToConsume:a.suggestedConsumption}),this.reserveInventoryItem(a.inventoryId,a.availableQuantity));this.validateBom()}}getTotalSuggestedQuantity(){return this.suggestedConsumption?this.suggestedConsumption.suggestedMaterials.reduce((e,a)=>e+a.requiredQuantity,0):0}hasSufficientStock(){return this.suggestedConsumption?this.suggestedConsumption.suggestedMaterials.every(e=>e.sufficientStock):!0}initProcessParams(){this.processParamsFormArray.clear(),this.processParameters.forEach(e=>{let a=[];e.is_required&&a.push(O.required),e.min_value!==null&&e.min_value!==void 0&&a.push(O.min(e.min_value)),e.max_value!==null&&e.max_value!==void 0&&a.push(O.max(e.max_value)),this.processParamsFormArray.push(this.fb.group({parameterName:[e.parameter_name],parameterValue:[e.default_value||"",a]}))})}isMaterialSelected(e){return this.selectedMaterials.some(a=>a.inventoryId===e.inventoryId)}addMaterial(e){this.selectedMaterials.find(l=>l.inventoryId===e.inventoryId)||(this.selectedMaterials.push({inventoryId:e.inventoryId,batchId:e.batchId,batchNumber:e.batchNumber,materialId:e.materialId,availableQuantity:e.quantity,quantityToConsume:0}),this.validateBom(),this.reserveInventoryItem(e.inventoryId,e.quantity))}removeMaterial(e){let a=this.selectedMaterials[e];a&&this.releaseInventoryReservation(a.inventoryId),this.selectedMaterials.splice(e,1)}updateMaterialQuantity(e,a){a>=0&&a<=this.selectedMaterials[e].availableQuantity&&(this.selectedMaterials[e].quantityToConsume=a,this.validateBom())}toggleEquipment(e){this.availableEquipment[e].selected=!this.availableEquipment[e].selected}getSelectedEquipmentIds(){return this.availableEquipment.filter(e=>e.selected).map(e=>e.equipmentId)}getSelectedEquipmentCount(){return this.availableEquipment.filter(e=>e.selected).length}toggleOperator(e){this.activeOperators[e].selected=!this.activeOperators[e].selected}getSelectedOperatorIds(){return this.activeOperators.filter(e=>e.selected).map(e=>e.operatorId)}getSelectedOperatorCount(){return this.activeOperators.filter(e=>e.selected).length}isDelayReasonRequired(){let e=this.confirmForm.get("delayMinutes")?.value;return e&&e>0}validateBom(){if(!this.operation?.order?.productSku||this.selectedMaterials.length===0){this.bomValidationResult=null;return}let e={productSku:this.operation.order.productSku,targetQuantity:this.confirmForm.get("quantityProduced")?.value||0,materialsConsumed:this.selectedMaterials.filter(a=>a.quantityToConsume>0).map(a=>({materialId:a.materialId,quantity:a.quantityToConsume}))};this.apiService.validateBomConsumption(e).subscribe({next:a=>{this.bomValidationResult=a,this.showBomWarning=a.warnings?.length>0||a.errors?.length>0},error:a=>console.error("Error validating BOM:",a)})}getTotalSelectedByMaterial(e){return this.selectedMaterials.filter(a=>a.materialId===e).reduce((a,l)=>a+l.quantityToConsume,0)}getRequirementStatus(e){let a=this.getTotalSelectedByMaterial(e.materialId);return a>=e.quantityRequired?"met":a>0?"partial":"missing"}onSubmit(){if(this.confirmForm.invalid){this.error="Please fill in all required fields correctly.";return}if(this.getSelectedEquipmentCount()===0){this.error="Please select at least one equipment.";return}if(this.getSelectedOperatorCount()===0){this.error="Please select at least one operator.";return}let e=this.confirmForm.value;if(e.delayMinutes>0&&!e.delayReason){this.error="Please select a delay reason when delay duration is greater than 0.";return}this.submitting=!0,this.error="";let a={operationId:this.operationId,producedQty:e.quantityProduced,scrapQty:e.quantityScrapped||0,startTime:new Date(e.startTime).toISOString(),endTime:new Date(e.endTime).toISOString(),equipmentIds:this.getSelectedEquipmentIds(),operatorIds:this.getSelectedOperatorIds(),materialsConsumed:this.selectedMaterials.filter(l=>l.quantityToConsume>0).map(l=>({batchId:l.batchId,inventoryId:l.inventoryId,quantity:l.quantityToConsume})),processParameters:e.processParameters.filter(l=>l.parameterValue).reduce((l,s)=>(l[s.parameterName]=s.parameterValue,l),{}),delayMinutes:e.delayMinutes||0,delayReason:e.delayReason||null,notes:e.notes,saveAsPartial:e.saveAsPartial||!1};this.apiService.confirmProduction(a).subscribe({next:l=>{this.confirmationResult=l,this.success=!0,this.submitting=!1,this.reservedInventoryIds=[],this.reservationWarnings={},this.reservingInventoryIds=[]},error:l=>{console.error("Error confirming production:",l),this.error=l.error?.message||"Failed to confirm production",this.submitting=!1}})}goBack(){this.releaseAllReservations(),this.operation?.order?.orderId?this.router.navigate(["/orders",this.operation.order.orderId]):this.router.navigate(["/orders"])}goToBatch(e){this.router.navigate(["/batches",e])}get yieldPercentage(){let e=this.confirmForm.get("quantityProduced")?.value||0,a=this.confirmForm.get("quantityScrapped")?.value||0,l=e+a;return l===0?null:Math.round(e/l*1e4)/100}get yieldClass(){let e=this.yieldPercentage;return e===null?"":e>=95?"yield-good":e>=80?"yield-warning":"yield-critical"}get durationMinutes(){let e=this.confirmForm.get("startTime")?.value,a=this.confirmForm.get("endTime")?.value;if(!e||!a)return null;let l=new Date(e),h=new Date(a).getTime()-l.getTime();return h<=0?null:Math.round(h/6e4)}get durationFormatted(){let e=this.durationMinutes;if(e===null||e<=0)return"--";let a=Math.floor(e/60),l=e%60;return a>0?`${a}h ${l}m`:`${l}m`}get totalProduction(){let e=this.confirmForm.get("quantityProduced")?.value||0,a=this.confirmForm.get("quantityScrapped")?.value||0;return e+a}openMaterialModal(){this.showMaterialModal=!0}closeMaterialModal(){this.showMaterialModal=!1}onMaterialSelectionChange(e){let a=new Set(this.selectedMaterials.map(s=>s.inventoryId)),l=new Set(e.map(s=>s.inventoryId));for(let s of a)l.has(s)||this.releaseInventoryReservation(s);for(let s of e)a.has(s.inventoryId)||this.reserveInventoryItem(s.inventoryId,s.availableQuantity);this.selectedMaterials=e.map(s=>({inventoryId:s.inventoryId,batchId:s.batchId,batchNumber:s.batchNumber,materialId:s.materialId,availableQuantity:s.availableQuantity,quantityToConsume:s.quantityToConsume})),this.validateBom()}get inventoryForModal(){return this.availableInventory.map(e=>({inventoryId:e.inventoryId,batchId:e.batchId,batchNumber:e.batchNumber,materialId:e.materialId,materialName:e.materialName,quantity:e.quantity,unit:e.unit||"T",state:e.state,location:e.location}))}openHoldModal(){this.showHoldModal=!0}closeHoldModal(){this.showHoldModal=!1}onHoldApplied(e){this.loadData()}get operationName(){return this.operation?`${this.operation.operationName} (${this.operation.operationCode})`:""}toggleSection(e){this.collapsedSections[e]=!this.collapsedSections[e]}isCollapsed(e){return this.collapsedSections[e]||!1}getOutputBatches(){return this.confirmationResult?this.confirmationResult.outputBatches&&this.confirmationResult.outputBatches.length>0?this.confirmationResult.outputBatches:this.confirmationResult.outputBatch?[this.confirmationResult.outputBatch]:[]:[]}hasMultipleBatches(){return this.getOutputBatches().length>1}isPartialConfirmation(){return this.confirmationResult?.isPartial===!0}getRemainingQty(){return this.confirmationResult?.remainingQty||0}continueConfirmation(){this.success=!1,this.confirmationResult=null,this.selectedMaterials=[],this.reservedInventoryIds=[],this.reservationWarnings={},this.reservingInventoryIds=[],this.initForm(),this.loadData()}getTargetQty(){return this.operation?.targetQty||this.operation?.order?.quantity||0}getConfirmationProgress(){let e=this.getTargetQty();if(e<=0)return 0;let a=this.confirmationResult?.producedQty||0;return Math.min(100,Math.round(a/e*100))}isReserved(e){return this.reservedInventoryIds.includes(e)}isReserving(e){return this.reservingInventoryIds.includes(e)}getReservationWarning(e){return this.reservationWarnings[e]||null}hasReservationWarnings(){return Object.keys(this.reservationWarnings).length>0}reserveInventoryItem(e,a){if(this.reservedInventoryIds.includes(e))return;let l=this.operation?.order?.orderId||0;this.reservingInventoryIds.push(e),delete this.reservationWarnings[e],this.apiService.reserveInventory(e,l,this.operationId,a).subscribe({next:()=>{this.reservedInventoryIds.includes(e)||this.reservedInventoryIds.push(e),this.reservingInventoryIds=this.reservingInventoryIds.filter(s=>s!==e)},error:s=>{console.warn("Failed to reserve inventory:",e,s),this.reservationWarnings[e]=s.error?.message||"Could not reserve - may be allocated to another session",this.reservingInventoryIds=this.reservingInventoryIds.filter(h=>h!==e)}})}releaseInventoryReservation(e){if(!this.reservedInventoryIds.includes(e)){delete this.reservationWarnings[e];return}this.apiService.releaseReservation(e).subscribe({next:()=>{this.reservedInventoryIds=this.reservedInventoryIds.filter(a=>a!==e),delete this.reservationWarnings[e]},error:a=>{console.warn("Failed to release reservation:",e,a),this.reservedInventoryIds=this.reservedInventoryIds.filter(l=>l!==e),delete this.reservationWarnings[e]}})}releaseAllReservations(){let e=[...this.reservedInventoryIds];for(let a of e)this.apiService.releaseReservation(a).subscribe({next:()=>{},error:l=>console.warn("Failed to release reservation on cleanup:",a,l)});this.reservedInventoryIds=[],this.reservationWarnings={},this.reservingInventoryIds=[]}static{this.\u0275fac=function(a){return new(a||i)(S(ae),S(A),S(xe),S(N))}}static{this.\u0275cmp=I({type:i,selectors:[["app-production-confirm"]],decls:15,vars:13,consts:[[1,"container"],[1,"page-header"],[1,"btn","btn-secondary",3,"click"],[1,"fas","fa-arrow-left"],[1,"page-title"],["class","btn btn-warning btn-hold","title","Apply hold to this operation",3,"click",4,"ngIf"],["class","hold-badge",4,"ngIf"],["class","text-center",4,"ngIf"],["class","success-container",4,"ngIf"],[4,"ngIf"],["class","card",4,"ngIf"],[3,"close","selectionChange","isOpen","availableInventory","selectedMaterials"],[3,"close","holdApplied","isOpen","entityType","entityId","entityName"],["title","Apply hold to this operation",1,"btn","btn-warning","btn-hold",3,"click"],[1,"fas","fa-pause-circle"],[1,"hold-badge"],[1,"text-center"],["message","Loading operation details..."],[1,"success-container"],[1,"card","success-card"],[1,"success-icon"],[1,"fas",3,"ngClass"],["class","partial-info",4,"ngIf"],[1,"result-summary"],[1,"result-row"],[1,"result-label"],[1,"result-value"],["class","result-row",4,"ngIf"],["class","output-batches-section",4,"ngIf"],[3,"status"],[1,"success-actions"],[1,"btn","btn-primary",3,"click"],["class","btn btn-success",3,"click",4,"ngIf"],["class","btn btn-secondary",3,"click",4,"ngIf"],[1,"partial-info"],[1,"partial-alert"],[1,"fas","fa-info-circle"],[1,"progress-bar-container"],[1,"progress-label"],[1,"progress-percent"],[1,"progress-bar"],[1,"progress-fill"],[1,"remaining-qty"],[1,"output-batches-section"],[1,"batches-header"],[1,"fas","fa-cubes"],[1,"batches-grid"],["class","batch-card",4,"ngFor","ngForOf"],[1,"batch-card"],[1,"batch-header"],[1,"batch-index"],[1,"batch-number"],[1,"batch-details"],[1,"batch-detail"],[1,"detail-label"],[1,"detail-value"],[1,"btn","btn-sm","btn-link","batch-link",3,"click"],[1,"fas","fa-external-link-alt"],["class","split-indicator",4,"ngIf"],[1,"split-indicator"],[1,"btn","btn-success",3,"click"],[1,"fas","fa-play"],[1,"card"],[1,"card-header","collapsible",3,"click"],[1,"card-body"],[1,"operation-info-grid"],[1,"info-item"],[1,"info-label"],[1,"info-value"],["class","batch-preview",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"form-grid"],[1,"card","grid-item"],[1,"row"],[1,"col-6"],[1,"form-group"],["for","startTime"],["type","datetime-local","id","startTime","formControlName","startTime",1,"form-control"],["class","field-error",4,"ngIf"],["for","endTime"],["type","datetime-local","id","endTime","formControlName","endTime",1,"form-control"],["class","duration-display",4,"ngIf"],["for","quantityProduced"],["type","number","id","quantityProduced","formControlName","quantityProduced","min","0",1,"form-control"],["for","quantityScrapped"],["type","number","id","quantityScrapped","formControlName","quantityScrapped","min","0",1,"form-control"],["class","batch-size-warning",4,"ngIf"],["class","batch-size-info",4,"ngIf"],["class","batch-split-preview",4,"ngIf"],["class","batch-split-loading",4,"ngIf"],["class","yield-display",4,"ngIf"],[1,"card-header-with-action","collapsible",3,"click"],[1,"card-header"],[1,"header-actions"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[1,"fas","fa-plus"],[1,"fas","collapse-icon",3,"ngClass"],["class","suggested-consumption",4,"ngIf"],["class","selected-materials",4,"ngIf"],[1,"available-materials"],["class","table",4,"ngIf"],["class","no-data",4,"ngIf"],["class","bom-requirements",4,"ngIf"],["class","bom-validation",4,"ngIf"],[1,"selection-count"],[1,"checkbox-group"],["class","checkbox-item",4,"ngFor","ngForOf"],["class","no-data-small",4,"ngIf"],["for","delayMinutes"],["type","number","id","delayMinutes","formControlName","delayMinutes","min","0","placeholder","0",1,"form-control"],["for","delayReason"],["class","required",4,"ngIf"],["id","delayReason","formControlName","delayReason",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","card grid-item",4,"ngIf"],["id","notes","formControlName","notes","rows","3","placeholder","Add any notes about this production confirmation...",1,"form-control"],["class","alert alert-error",4,"ngIf"],[1,"partial-option-section"],[1,"partial-checkbox"],[1,"checkbox-label"],["type","checkbox","formControlName","saveAsPartial"],[1,"checkbox-text"],[1,"checkbox-hint"],["class","partial-info-box",4,"ngIf"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner",4,"ngIf"],[1,"batch-preview"],["class","info-value batch-number-preview",4,"ngIf"],["class","info-value loading-text",4,"ngIf"],[1,"preview-note"],[1,"info-value","batch-number-preview"],[1,"info-value","loading-text"],[1,"field-error"],[1,"duration-display"],[1,"duration-label"],[1,"duration-value"],[1,"duration-detail"],[1,"batch-size-warning"],[1,"fas","fa-exclamation-triangle"],[1,"batch-size-info"],[1,"batch-split-preview"],[1,"batch-split-header"],[1,"fas","fa-layer-group"],[1,"batch-split-chips"],["class","batch-chip",3,"partial-chip",4,"ngFor","ngForOf"],[1,"batch-split-note"],[1,"batch-chip"],["class","partial-badge",4,"ngIf"],[1,"partial-badge"],[1,"batch-split-loading"],[1,"spinner-sm"],[1,"yield-display"],[1,"yield-stats"],[1,"yield-stat"],[1,"stat-label"],[1,"stat-value"],[1,"yield-percentage",3,"ngClass"],[1,"yield-bar"],[1,"yield-fill",3,"ngClass"],[1,"yield-legend"],[1,"legend-item"],[1,"legend-dot","good"],[1,"legend-dot","warning"],[1,"legend-dot","critical"],[1,"suggested-consumption"],[1,"suggestion-header"],[1,"suggestion-info"],[1,"suggestion-label"],[1,"suggestion-value"],[1,"table","suggestion-table"],[3,"insufficient",4,"ngFor","ngForOf"],["class","alert alert-warning",4,"ngIf"],[1,"stock-status"],[1,"alert","alert-warning"],[1,"selected-materials"],[1,"table"],[3,"reservation-warning-row",4,"ngFor","ngForOf"],["class","alert alert-warning reservation-summary-warning",4,"ngIf"],["class","reserved-badge",4,"ngIf"],["class","reserving-badge",4,"ngIf"],["class","reservation-warning-badge",3,"title",4,"ngIf"],["class","no-reservation-badge",4,"ngIf"],["type","number",1,"form-control","consume-qty",3,"change","value","min","max"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],[1,"reserved-badge"],[1,"fas","fa-lock"],[1,"reserving-badge"],[1,"reservation-warning-badge",3,"title"],[1,"no-reservation-badge"],[1,"alert","alert-warning","reservation-summary-warning"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-sm",3,"click","ngClass","disabled"],[1,"no-data"],[1,"bom-requirements"],[1,"table","bom-table"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"bom-status",3,"ngClass"],[1,"bom-validation"],[1,"alert","alert-error"],[1,"checkbox-item"],["type","checkbox",3,"change","checked"],[1,"no-data-small"],[1,"required"],[3,"value"],["formArrayName","processParameters"],["class","form-group",4,"ngFor","ngForOf"],[3,"formGroupName"],["class","param-hint",4,"ngIf"],["type","number","formControlName","parameterValue","step","any",1,"form-control",3,"placeholder"],[1,"param-hint"],[1,"partial-info-box"],[1,"spinner"]],template:function(a,l){a&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),v("click",function(){return l.goBack()}),f(3,"i",3),o(4," Back to Order"),t(),n(5,"h1",4),o(6,"Production Confirmation"),t(),m(7,Ne,3,0,"button",5)(8,ze,3,0,"span",6),t(),m(9,Ve,2,0,"div",7)(10,$e,37,18,"div",8)(11,Wt,176,62,"div",9)(12,$t,3,1,"div",10),t(),n(13,"app-material-selection-modal",11),v("close",function(){return l.closeMaterialModal()})("selectionChange",function(h){return l.onMaterialSelectionChange(h)}),t(),n(14,"app-apply-hold-modal",12),v("close",function(){return l.closeHoldModal()})("holdApplied",function(h){return l.onHoldApplied(h)}),t()),a&2&&(r(7),d("ngIf",l.operation&&l.operation.status!=="ON_HOLD"),r(),d("ngIf",(l.operation==null?null:l.operation.status)==="ON_HOLD"),r(),d("ngIf",l.loading),r(),d("ngIf",l.success&&l.confirmationResult),r(),d("ngIf",!l.loading&&!l.success&&l.operation),r(),d("ngIf",!l.loading&&!l.operation&&!l.success),r(),d("isOpen",l.showMaterialModal)("availableInventory",l.inventoryForModal)("selectedMaterials",l.selectedMaterials),r(),d("isOpen",l.showHoldModal)("entityType","OPERATION")("entityId",l.operationId)("entityName",l.operationName))},dependencies:[E,w,k,ce,T,R,H,pe,le,Q,L,se,_e,me,fe,ue,ge,Ce,be,ye,Pe,ie],styles:[".form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin-bottom:20px}.grid-item[_ngcontent-%COMP%]{min-width:0}.grid-full[_ngcontent-%COMP%]{grid-column:1 / -1}.card-header.collapsible[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;cursor:pointer;-webkit-user-select:none;user-select:none;transition:background-color .2s}.card-header.collapsible[_ngcontent-%COMP%]:hover{background-color:#e8e8e8}.card-header.collapsible[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px;color:#666;transition:transform .3s ease}.card-header-with-action.collapsible[_ngcontent-%COMP%]{cursor:pointer}.card-header-with-action.collapsible[_ngcontent-%COMP%]:hover{background-color:#e8e8e8}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.collapse-icon[_ngcontent-%COMP%]{font-size:14px;color:#666}.card-body[_ngcontent-%COMP%]{padding:16px;overflow:hidden;transition:max-height .3s ease,padding .3s ease,opacity .3s ease;max-height:2000px;opacity:1}.card-body.collapsed[_ngcontent-%COMP%]{max-height:0;padding-top:0;padding-bottom:0;opacity:0}.page-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:24px;margin-bottom:24px}.operation-info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.info-label[_ngcontent-%COMP%]{font-size:12px;color:#888;text-transform:uppercase}.info-value[_ngcontent-%COMP%]{font-size:14px;font-weight:500}.available-materials[_ngcontent-%COMP%]{margin-bottom:24px}.available-materials[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .selected-materials[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;font-weight:500;margin-bottom:12px;color:#555}.consume-qty[_ngcontent-%COMP%]{width:100px;padding:6px 8px}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:24px;margin-bottom:40px}.no-data[_ngcontent-%COMP%]{color:#888;text-align:center;padding:20px}.required[_ngcontent-%COMP%]{color:#d32f2f}.param-hint[_ngcontent-%COMP%]{font-size:12px;color:#888;font-weight:400}.success-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px 0}.success-card[_ngcontent-%COMP%]{text-align:center;max-width:500px;width:100%}.success-icon[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background:#4caf50;color:#fff;font-size:40px;display:flex;align-items:center;justify-content:center;margin:0 auto 24px}.success-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#2e7d32;margin-bottom:24px}.result-summary[_ngcontent-%COMP%]{background:#f5f5f5;border-radius:8px;padding:20px;margin-bottom:24px}.result-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee}.result-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.result-label[_ngcontent-%COMP%]{color:#666}.result-value[_ngcontent-%COMP%]{font-weight:500}.success-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center}.spinner[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.bom-requirements[_ngcontent-%COMP%]{margin-top:24px;padding-top:24px;border-top:1px solid #e0e0e0}.bom-requirements[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;font-weight:500;margin-bottom:12px;color:#555}.bom-table[_ngcontent-%COMP%]   tr.bom-met[_ngcontent-%COMP%]{background-color:#e8f5e9}.bom-table[_ngcontent-%COMP%]   tr.bom-partial[_ngcontent-%COMP%]{background-color:#fff3e0}.bom-table[_ngcontent-%COMP%]   tr.bom-missing[_ngcontent-%COMP%]{background-color:#ffebee}.bom-status[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500}.bom-status.met[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.bom-status.partial[_ngcontent-%COMP%]{background-color:#ff9800;color:#fff}.bom-status.missing[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.bom-validation[_ngcontent-%COMP%]{margin-top:16px}.bom-validation[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:8px 0 0 20px;padding:0}.alert-warning[_ngcontent-%COMP%]{background-color:#fff3e0;color:#e65100;border:1px solid #ffcc80;padding:12px 16px;border-radius:4px;margin-bottom:12px}.checkbox-group[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto;border:1px solid #e0e0e0;border-radius:4px;padding:12px;background:#fafafa}.checkbox-item[_ngcontent-%COMP%]{margin-bottom:8px}.checkbox-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:6px 8px;border-radius:4px;transition:background-color .2s}.checkbox-label[_ngcontent-%COMP%]:hover{background-color:#e3f2fd}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-right:10px;width:18px;height:18px;cursor:pointer}.checkbox-text[_ngcontent-%COMP%]{font-size:14px;color:#333}.selection-count[_ngcontent-%COMP%]{font-size:12px;color:#666;font-weight:400}.no-data-small[_ngcontent-%COMP%]{color:#888;font-size:13px;margin:0}.field-error[_ngcontent-%COMP%]{color:#d32f2f;font-size:12px;margin-top:4px}input[type=datetime-local][_ngcontent-%COMP%]{padding:8px 12px}.suggested-consumption[_ngcontent-%COMP%]{background:#e3f2fd;border:1px solid #90caf9;border-radius:8px;padding:16px;margin-bottom:24px}.suggestion-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.suggestion-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:#1565c0;font-size:14px}.suggestion-info[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:12px;font-size:14px}.suggestion-label[_ngcontent-%COMP%]{color:#666}.suggestion-value[_ngcontent-%COMP%]{font-weight:600;color:#1565c0}.suggestion-table[_ngcontent-%COMP%]{background:#fff;margin-bottom:12px}.suggestion-table[_ngcontent-%COMP%]   tr.insufficient[_ngcontent-%COMP%]{background-color:#ffebee}.stock-status[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500}.stock-status.ok[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.stock-status.low[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.duration-display[_ngcontent-%COMP%]{margin-top:16px;padding:12px 16px;background:#f5f5f5;border-radius:8px;display:flex;align-items:center;gap:8px}.duration-label[_ngcontent-%COMP%]{color:#666;font-size:14px}.duration-value[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#1976d2}.duration-detail[_ngcontent-%COMP%]{color:#888;font-size:13px}.yield-display[_ngcontent-%COMP%]{margin-top:20px;padding:16px;background:#fafafa;border-radius:8px;border:1px solid #e0e0e0}.yield-stats[_ngcontent-%COMP%]{display:flex;gap:24px;margin-bottom:12px}.yield-stat[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.stat-label[_ngcontent-%COMP%]{color:#666;font-size:14px}.stat-value[_ngcontent-%COMP%]{font-weight:600;font-size:16px;color:#333}.yield-percentage[_ngcontent-%COMP%]{font-size:24px;font-weight:700;padding:4px 12px;border-radius:8px}.yield-percentage.yield-good[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.yield-percentage.yield-warning[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.yield-percentage.yield-critical[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.yield-bar[_ngcontent-%COMP%]{height:8px;background:#e0e0e0;border-radius:4px;overflow:hidden;margin-bottom:12px}.yield-fill[_ngcontent-%COMP%]{height:100%;border-radius:4px;transition:width .3s ease}.yield-fill.yield-good[_ngcontent-%COMP%]{background:linear-gradient(90deg,#4caf50,#66bb6a)}.yield-fill.yield-warning[_ngcontent-%COMP%]{background:linear-gradient(90deg,#ff9800,#ffb74d)}.yield-fill.yield-critical[_ngcontent-%COMP%]{background:linear-gradient(90deg,#f44336,#ef5350)}.yield-legend[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:12px;color:#666}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.legend-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%}.legend-dot.good[_ngcontent-%COMP%]{background:#4caf50}.legend-dot.warning[_ngcontent-%COMP%]{background:#ff9800}.legend-dot.critical[_ngcontent-%COMP%]{background:#f44336}.batch-preview[_ngcontent-%COMP%]{margin-top:20px;padding-top:16px;border-top:1px dashed #e0e0e0}.batch-number-preview[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace;font-size:18px;font-weight:600;color:#1976d2;background:#e3f2fd;padding:4px 12px;border-radius:4px;display:inline-block}.preview-note[_ngcontent-%COMP%]{font-size:12px;color:#888;margin-top:8px;margin-bottom:0;font-style:italic}.loading-text[_ngcontent-%COMP%]{color:#888;font-style:italic}.card-header-with-action[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #e0e0e0;background:#fafafa;margin:-16px -16px 16px;border-radius:8px 8px 0 0}.card-header-with-action[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{background:none;padding:0;margin:0;border:none}.btn-hold[_ngcontent-%COMP%]{margin-left:auto;background:#ff9800;color:#fff}.btn-hold[_ngcontent-%COMP%]:hover{background:#f57c00}.hold-badge[_ngcontent-%COMP%]{margin-left:auto;background:#ffecb3;color:#e65100;padding:8px 16px;border-radius:4px;font-weight:500;display:flex;align-items:center;gap:8px}.btn-warning[_ngcontent-%COMP%]{background:#ff9800;color:#fff}.btn-warning[_ngcontent-%COMP%]:hover{background:#f57c00}@media (max-width: 992px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.success-card.partial-card[_ngcontent-%COMP%]{border:2px solid #ff9800}.success-card.partial-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#e65100}.success-icon.partial-icon[_ngcontent-%COMP%]{background:#ff9800}.partial-info[_ngcontent-%COMP%]{margin-bottom:20px}.partial-alert[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#fff3e0;color:#e65100;padding:12px 16px;border-radius:8px;margin-bottom:16px;text-align:left}.partial-alert[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px}.progress-bar-container[_ngcontent-%COMP%]{background:#f5f5f5;padding:16px;border-radius:8px}.progress-label[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:14px;color:#333}.progress-percent[_ngcontent-%COMP%]{font-weight:600;color:#1976d2}.progress-bar[_ngcontent-%COMP%]{height:12px;background:#e0e0e0;border-radius:6px;overflow:hidden;margin-bottom:8px}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#1976d2,#42a5f5);border-radius:6px;transition:width .5s ease}.remaining-qty[_ngcontent-%COMP%]{font-size:14px;color:#666}.remaining-qty[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#e65100}.output-batches-section[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:1px solid #e0e0e0;text-align:left}.batches-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:12px;font-size:14px;font-weight:600;color:#1976d2}.batches-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}.batches-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}.batch-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:12px;transition:box-shadow .2s}.batch-card[_ngcontent-%COMP%]:hover{box-shadow:0 2px 8px #0000001a}.batch-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px}.batch-index[_ngcontent-%COMP%]{background:#1976d2;color:#fff;padding:2px 6px;border-radius:4px;font-size:11px;font-weight:600}.batch-number[_ngcontent-%COMP%]{font-family:Courier New,Courier,monospace;font-weight:600;color:#333;font-size:13px}.batch-details[_ngcontent-%COMP%]{margin-bottom:8px}.batch-detail[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;padding:2px 0}.detail-label[_ngcontent-%COMP%]{color:#888}.detail-value[_ngcontent-%COMP%]{font-weight:500;color:#333}.batch-link[_ngcontent-%COMP%]{padding:4px 8px;font-size:12px;color:#1976d2}.batch-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.split-indicator[_ngcontent-%COMP%]{font-size:12px;color:#ff9800;font-weight:400}.partial-option-section[_ngcontent-%COMP%]{background:#f5f5f5;border-radius:8px;padding:16px;margin-bottom:20px}.partial-checkbox[_ngcontent-%COMP%]{display:flex;align-items:flex-start}.partial-checkbox[_ngcontent-%COMP%]   .checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px;cursor:pointer;padding:0}.partial-checkbox[_ngcontent-%COMP%]   .checkbox-label[_ngcontent-%COMP%]:hover{background:transparent}.partial-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-top:4px;width:20px;height:20px}.partial-checkbox[_ngcontent-%COMP%]   .checkbox-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.checkbox-hint[_ngcontent-%COMP%]{font-size:13px;color:#666;font-weight:400}.partial-info-box[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;background:#e3f2fd;color:#1565c0;padding:12px 16px;border-radius:8px;margin-top:12px;font-size:13px}.partial-info-box[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px;margin-top:2px}@media (max-width: 768px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:16px}.operation-info-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.row[_ngcontent-%COMP%]{flex-direction:column}.col-6[_ngcontent-%COMP%]{flex:0 0 100%;max-width:100%}.checkbox-group[_ngcontent-%COMP%]{max-height:150px}.yield-stats[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.yield-legend[_ngcontent-%COMP%]{flex-wrap:wrap;gap:8px}.duration-display[_ngcontent-%COMP%], .page-header[_ngcontent-%COMP%]{flex-wrap:wrap}.btn-hold[_ngcontent-%COMP%], .hold-badge[_ngcontent-%COMP%]{margin-left:0;margin-top:8px}.card-header-with-action[_ngcontent-%COMP%]{flex-direction:column;gap:12px;align-items:flex-start}.card-header-with-action.collapsible[_ngcontent-%COMP%]{flex-direction:row;justify-content:space-between}.header-actions[_ngcontent-%COMP%]{flex-wrap:wrap;gap:8px}.card-header.collapsible[_ngcontent-%COMP%]{padding:16px}.card-header.collapsible[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .collapse-icon[_ngcontent-%COMP%]{font-size:16px}.batch-split-chips[_ngcontent-%COMP%]{flex-direction:column}.batches-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.progress-label[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:4px}.success-actions[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.success-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.reserved-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;background:#e8f5e9;color:#2e7d32;padding:3px 8px;border-radius:4px;font-size:12px;font-weight:500;white-space:nowrap}.reserved-badge[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:10px}.reserving-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;color:#1565c0;font-size:12px;font-weight:500;white-space:nowrap}.spinner-sm[_ngcontent-%COMP%]{display:inline-block;width:12px;height:12px;border:2px solid rgba(21,101,192,.3);border-top-color:#1565c0;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.reservation-warning-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;background:#fff3e0;color:#e65100;padding:3px 8px;border-radius:4px;font-size:12px;font-weight:500;cursor:help;white-space:nowrap}.reservation-warning-badge[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:10px}.no-reservation-badge[_ngcontent-%COMP%]{color:#bbb;font-size:12px}.reservation-warning-row[_ngcontent-%COMP%]{background-color:#fffde7}.reservation-summary-warning[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:8px;margin-top:12px}.reservation-summary-warning[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-top:2px;font-size:14px}.batch-size-warning[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#fff3e0;color:#e65100;border:1px solid #ffcc80;padding:10px 14px;border-radius:6px;margin-top:12px;font-size:13px}.batch-size-warning[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px;flex-shrink:0}.batch-size-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#e3f2fd;color:#1565c0;padding:8px 12px;border-radius:6px;margin-top:12px;font-size:12px}.batch-size-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px;flex-shrink:0}.batch-split-preview[_ngcontent-%COMP%]{background:#e8f5e9;border:1px solid #a5d6a7;border-radius:8px;padding:14px 16px;margin-top:12px}.batch-split-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#2e7d32;font-size:14px;margin-bottom:10px}.batch-split-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}.batch-split-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}.batch-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;background:#fff;border:1px solid #c8e6c9;color:#333;padding:4px 10px;border-radius:16px;font-size:13px;font-weight:500;font-family:Courier New,Courier,monospace}.batch-chip.partial-chip[_ngcontent-%COMP%]{border-color:#ffcc80;background:#fff8e1}.partial-badge[_ngcontent-%COMP%]{background:#ff9800;color:#fff;font-size:10px;font-weight:600;padding:1px 6px;border-radius:8px;text-transform:uppercase;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}.batch-split-note[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;color:#666;font-size:12px}.batch-split-note[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px;color:#888}.batch-split-loading[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#1565c0;font-size:13px;margin-top:12px;padding:8px 12px;background:#e3f2fd;border-radius:6px}.btn-added[_ngcontent-%COMP%]{background:#22c55e;color:#fff;cursor:default;opacity:.8}.btn-added[_ngcontent-%COMP%]:disabled{background:#22c55e;color:#fff;opacity:.7}"]})}}return i})();function Gt(i,c){if(i&1&&(n(0,"option",19),o(1),t()),i&2){let e=c.$implicit;d("value",e),r(),u(e)}}function Yt(i,c){if(i&1&&(n(0,"div",20)(1,"div",21)(2,"span",22),o(3),t(),n(4,"span",23),o(5,"Total"),t()(),n(6,"div",24)(7,"span",22),o(8),t(),n(9,"span",23),o(10,"Confirmed"),t()(),n(11,"div",25)(12,"span",22),o(13),t(),n(14,"span",23),o(15,"Pending Review"),t()(),n(16,"div",26)(17,"span",22),o(18),t(),n(19,"span",23),o(20,"Rejected"),t()(),n(21,"div",27)(22,"span",22),o(23),t(),n(24,"span",23),o(25,"Reversed"),t()()()),i&2){let e=p();r(3),u(e.allConfirmations.length),r(5),u(e.countByStatus("CONFIRMED")),r(5),u(e.countByStatus("PENDING_REVIEW")),r(5),u(e.countByStatus("REJECTED")),r(5),u(e.countByStatus("REVERSED"))}}function Jt(i,c){if(i&1){let e=C();n(0,"tr",33),v("click",function(){let l=_(e).$implicit,s=p(3);return x(s.toggleDetail(l))}),n(1,"td"),o(2),t(),n(3,"td"),o(4),t(),n(5,"td"),o(6),t(),n(7,"td"),o(8),t(),n(9,"td"),o(10),t(),n(11,"td"),o(12),t(),n(13,"td")(14,"span",34),o(15),t()(),n(16,"td"),o(17),t()()}if(i&2){let e=c.$implicit,a=p(3);y("selected",a.selectedConfirmation===e)("rejected-row",e.status==="REJECTED")("reversed-row",e.status==="REVERSED"),r(2),u(e.confirmationId),r(2),u(e.operationName||"-"),r(2),u((e.outputBatch==null?null:e.outputBatch.batchNumber)||"-"),r(2),u(e.producedQty),r(2),u(e.scrapQty||0),r(2),u(a.getDuration(e.startTime,e.endTime)),r(2),d("ngClass",a.getStatusClass(e.status)),r(),g(" ",e.status," "),r(2),u(a.formatDateTime(e.createdOn))}}function Ut(i,c){if(i&1&&(n(0,"table",31)(1,"thead")(2,"tr")(3,"th"),o(4,"ID"),t(),n(5,"th"),o(6,"Operation"),t(),n(7,"th"),o(8,"Output Batch"),t(),n(9,"th"),o(10,"Produced Qty"),t(),n(11,"th"),o(12,"Scrap Qty"),t(),n(13,"th"),o(14,"Duration"),t(),n(15,"th"),o(16,"Status"),t(),n(17,"th"),o(18,"Created"),t()()(),n(19,"tbody"),m(20,Jt,18,15,"tr",32),t()()),i&2){let e=p(2);r(20),d("ngForOf",e.confirmations)}}function Kt(i,c){i&1&&(n(0,"div",35)(1,"p"),o(2,"No production confirmations found."),t()())}function Xt(i,c){if(i&1&&(n(0,"div",36),o(1),t()),i&2){let e=p(2);r(),b(" Showing ",e.confirmations.length," of ",e.allConfirmations.length," confirmations ")}}function Zt(i,c){if(i&1&&(n(0,"div",28),m(1,Ut,21,1,"table",29)(2,Kt,3,0,"ng-template",null,1,G)(4,Xt,2,2,"div",30),t()),i&2){let e=$(3),a=p();r(),d("ngIf",a.confirmations.length>0)("ngIfElse",e),r(3),d("ngIf",a.confirmations.length>0)}}function en(i,c){i&1&&(n(0,"div",37),o(1,"Loading production history..."),t())}function tn(i,c){if(i&1){let e=C();n(0,"button",51),v("click",function(){_(e);let l=p(2);return x(l.openReverseDialog(l.selectedConfirmation))}),o(1," Reverse "),t()}}function nn(i,c){if(i&1&&(n(0,"span"),o(1),t()),i&2){let e=p(3);r(),g(" - ",e.selectedConfirmation.delayReason,"")}}function on(i,c){if(i&1&&(n(0,"div",45)(1,"span",46),o(2,"Delay:"),t(),o(3),m(4,nn,2,1,"span",52),t()),i&2){let e=p(2);r(3),g(" ",e.selectedConfirmation.delayMinutes,"min "),r(),d("ngIf",e.selectedConfirmation.delayReason)}}function rn(i,c){if(i&1&&(n(0,"div",45)(1,"span",46),o(2,"Notes:"),t(),o(3),t()),i&2){let e=p(2);r(3),g(" ",e.selectedConfirmation.notes," ")}}function an(i,c){if(i&1&&(n(0,"div",44)(1,"h4"),o(2,"Output Batch"),t(),n(3,"div",45)(4,"span",46),o(5,"Batch:"),t(),o(6),t(),n(7,"div",45)(8,"span",46),o(9,"Material:"),t(),o(10),t(),n(11,"div",45)(12,"span",46),o(13,"Quantity:"),t(),o(14),t()()),i&2){let e=p(2);r(6),g(" ",e.selectedConfirmation.outputBatch.batchNumber,""),r(4),g(" ",e.selectedConfirmation.outputBatch.materialName,""),r(4),b(" ",e.selectedConfirmation.outputBatch.quantity," ",e.selectedConfirmation.outputBatch.unit,"")}}function ln(i,c){if(i&1&&(n(0,"div",45),o(1),t()),i&2){let e=c.$implicit;r(),b(" ",e.name," (",e.equipmentCode,") ")}}function sn(i,c){if(i&1&&(n(0,"div",44)(1,"h4"),o(2,"Equipment"),t(),m(3,ln,2,2,"div",53),t()),i&2){let e=p(2);r(3),d("ngForOf",e.selectedConfirmation.equipment)}}function dn(i,c){if(i&1&&(n(0,"div",45),o(1),t()),i&2){let e=c.$implicit;r(),b(" ",e.name," (",e.operatorCode,") ")}}function cn(i,c){if(i&1&&(n(0,"div",44)(1,"h4"),o(2,"Operators"),t(),m(3,dn,2,2,"div",53),t()),i&2){let e=p(2);r(3),d("ngForOf",e.selectedConfirmation.operators)}}function pn(i,c){if(i&1&&(n(0,"div",45),o(1),t()),i&2){let e=c.$implicit;r(),M(" ",e.materialId," - Batch ",e.batchNumber," (",e.quantityConsumed,") ")}}function mn(i,c){if(i&1&&(n(0,"div",44)(1,"h4"),o(2,"Materials Consumed"),t(),m(3,pn,2,3,"div",53),t()),i&2){let e=p(2);r(3),d("ngForOf",e.selectedConfirmation.materialsConsumed)}}function un(i,c){if(i&1&&(n(0,"div",54)(1,"h4"),o(2,"Rejection"),t(),n(3,"div",45)(4,"span",46),o(5,"Reason:"),t(),o(6),t(),n(7,"div",45)(8,"span",46),o(9,"Rejected By:"),t(),o(10),t(),n(11,"div",45)(12,"span",46),o(13,"Rejected On:"),t(),o(14),t()()),i&2){let e=p(2);r(6),g(" ",e.selectedConfirmation.rejectionReason,""),r(4),g(" ",e.selectedConfirmation.rejectedBy,""),r(4),g(" ",e.formatDateTime(e.selectedConfirmation.rejectedOn),"")}}function gn(i,c){if(i&1&&(n(0,"div",55)(1,"h4"),o(2,"Reversal"),t(),n(3,"div",45)(4,"span",46),o(5,"Reason:"),t(),o(6),t(),n(7,"div",45)(8,"span",46),o(9,"Reversed By:"),t(),o(10),t(),n(11,"div",45)(12,"span",46),o(13,"Reversed On:"),t(),o(14),t()()),i&2){let e=p(2);r(6),g(" ",e.selectedConfirmation.reversalReason,""),r(4),g(" ",e.selectedConfirmation.reversedBy,""),r(4),g(" ",e.formatDateTime(e.selectedConfirmation.reversedOn),"")}}function fn(i,c){if(i&1){let e=C();n(0,"div",38)(1,"div",39)(2,"h3"),o(3),t(),n(4,"div",40),m(5,tn,2,0,"button",41),n(6,"button",42),v("click",function(){_(e);let l=p();return x(l.selectedConfirmation=null)}),o(7,"Close"),t()()(),n(8,"div",43)(9,"div",44)(10,"h4"),o(11,"Production Details"),t(),n(12,"div",45)(13,"span",46),o(14,"Operation:"),t(),o(15),t(),n(16,"div",45)(17,"span",46),o(18,"Produced Qty:"),t(),o(19),t(),n(20,"div",45)(21,"span",46),o(22,"Scrap Qty:"),t(),o(23),t(),n(24,"div",45)(25,"span",46),o(26,"Start:"),t(),o(27),t(),n(28,"div",45)(29,"span",46),o(30,"End:"),t(),o(31),t(),m(32,on,5,2,"div",47)(33,rn,4,1,"div",47),t(),m(34,an,15,4,"div",48)(35,sn,4,1,"div",48)(36,cn,4,1,"div",48)(37,mn,4,1,"div",48)(38,un,15,3,"div",49)(39,gn,15,3,"div",50),t()()}if(i&2){let e=p();r(3),g("Confirmation #",e.selectedConfirmation.confirmationId,""),r(2),d("ngIf",e.canReverse(e.selectedConfirmation)),r(10),g(" ",e.selectedConfirmation.operationName,""),r(4),g(" ",e.selectedConfirmation.producedQty,""),r(4),g(" ",e.selectedConfirmation.scrapQty||0,""),r(4),g(" ",e.formatDateTime(e.selectedConfirmation.startTime),""),r(4),g(" ",e.formatDateTime(e.selectedConfirmation.endTime),""),r(),d("ngIf",e.selectedConfirmation.delayMinutes),r(),d("ngIf",e.selectedConfirmation.notes),r(),d("ngIf",e.selectedConfirmation.outputBatch),r(),d("ngIf",e.selectedConfirmation.equipment==null?null:e.selectedConfirmation.equipment.length),r(),d("ngIf",e.selectedConfirmation.operators==null?null:e.selectedConfirmation.operators.length),r(),d("ngIf",e.selectedConfirmation.materialsConsumed==null?null:e.selectedConfirmation.materialsConsumed.length),r(),d("ngIf",e.selectedConfirmation.rejectionReason),r(),d("ngIf",e.selectedConfirmation.reversalReason)}}function _n(i,c){i&1&&(n(0,"div",68),o(1,"Checking reversal eligibility..."),t())}function xn(i,c){if(i&1&&(n(0,"div"),o(1),t()),i&2){let e=p(3);r(),u(e.canReverseResult.reason)}}function vn(i,c){if(i&1&&(n(0,"li"),o(1),t()),i&2){let e=c.$implicit;r(),u(e)}}function hn(i,c){if(i&1&&(n(0,"ul"),m(1,vn,2,1,"li",70),t()),i&2){let e=p(3);r(),d("ngForOf",e.canReverseResult.blockers)}}function Cn(i,c){if(i&1&&(n(0,"div",69)(1,"strong"),o(2,"Cannot reverse this confirmation."),t(),m(3,xn,2,1,"div",52)(4,hn,2,1,"ul",52),t()),i&2){let e=p(2);r(3),d("ngIf",e.canReverseResult.reason),r(),d("ngIf",e.canReverseResult.blockers==null?null:e.canReverseResult.blockers.length)}}function bn(i,c){if(i&1&&(n(0,"div",69),o(1),t()),i&2){let e=p(2);r(),u(e.reversalError)}}function yn(i,c){if(i&1){let e=C();n(0,"div",71)(1,"label",72),o(2,"Reason "),n(3,"span",73),o(4,"*"),t()(),n(5,"textarea",74),q("ngModelChange",function(l){_(e);let s=p(2);return V(s.reversalReason,l)||(s.reversalReason=l),x(l)}),t()()}if(i&2){let e=p(2);r(5),z("ngModel",e.reversalReason)}}function Pn(i,c){if(i&1){let e=C();n(0,"div",71)(1,"label",75),o(2,"Notes"),t(),n(3,"textarea",76),q("ngModelChange",function(l){_(e);let s=p(2);return V(s.reversalNotes,l)||(s.reversalNotes=l),x(l)}),t()()}if(i&2){let e=p(2);r(3),z("ngModel",e.reversalNotes)}}function Sn(i,c){if(i&1){let e=C();n(0,"div",56),v("click",function(){_(e);let l=p();return x(l.closeReverseDialog())}),n(1,"div",57),v("click",function(l){return _(e),x(l.stopPropagation())}),n(2,"div",58)(3,"h3"),o(4),t(),n(5,"button",59),v("click",function(){_(e);let l=p();return x(l.closeReverseDialog())}),o(6,"\xD7"),t()(),n(7,"div",60)(8,"div",61),o(9," This will restore consumed materials, scrap output batches, and revert operation status. This action cannot be undone. "),t(),m(10,_n,2,0,"div",62)(11,Cn,5,2,"div",63)(12,bn,2,1,"div",63)(13,yn,6,1,"div",64)(14,Pn,4,1,"div",64),t(),n(15,"div",65)(16,"button",66),v("click",function(){_(e);let l=p();return x(l.closeReverseDialog())}),o(17,"Cancel"),t(),n(18,"button",67),v("click",function(){_(e);let l=p();return x(l.confirmReversal())}),o(19),t()()()()}if(i&2){let e=p();r(4),g("Reverse Confirmation #",e.reversalConfirmation==null?null:e.reversalConfirmation.confirmationId,""),r(6),d("ngIf",e.reversalLoading&&!e.canReverseResult),r(),d("ngIf",e.canReverseResult&&!e.canReverseResult.canReverse),r(),d("ngIf",e.reversalError),r(),d("ngIf",e.canReverseResult==null?null:e.canReverseResult.canReverse),r(),d("ngIf",e.canReverseResult==null?null:e.canReverseResult.canReverse),r(4),d("disabled",!(e.canReverseResult!=null&&e.canReverseResult.canReverse)||!e.reversalReason.trim()||e.reversalLoading),r(),g(" ",e.reversalLoading?"Reversing...":"Confirm Reversal"," ")}}var we=(()=>{class i{constructor(e){this.apiService=e,this.allConfirmations=[],this.confirmations=[],this.loading=!0,this.error="",this.filterStatus="all",this.searchTerm="",this.statuses=["CONFIRMED","PENDING_REVIEW","PARTIALLY_CONFIRMED","REJECTED","REVERSED"],this.selectedConfirmation=null,this.showReversalDialog=!1,this.reversalConfirmation=null,this.reversalReason="",this.reversalNotes="",this.reversalLoading=!1,this.reversalError="",this.canReverseResult=null}ngOnInit(){this.loadConfirmations()}loadConfirmations(){this.loading=!0,this.error="",this.allConfirmations=[];let e=0,a=this.statuses.length;this.statuses.forEach(l=>{this.apiService.getConfirmationsByStatus(l).subscribe({next:s=>{this.allConfirmations.push(...s),e++,e===a&&(this.allConfirmations.sort((h,P)=>(P.confirmationId||0)-(h.confirmationId||0)),this.applyFilters(),this.loading=!1)},error:()=>{e++,e===a&&(this.applyFilters(),this.loading=!1)}})})}applyFilters(){let e=[...this.allConfirmations];if(this.filterStatus&&this.filterStatus!=="all"&&(e=e.filter(a=>a.status===this.filterStatus)),this.searchTerm){let a=this.searchTerm.toLowerCase();e=e.filter(l=>l.operationName?.toLowerCase().includes(a)||l.outputBatch?.batchNumber?.toLowerCase().includes(a)||String(l.confirmationId).includes(a)||l.notes?.toLowerCase().includes(a))}this.confirmations=e}onFilterStatusChange(e){this.filterStatus=e,this.applyFilters()}onSearchChange(e){this.searchTerm=e,this.applyFilters()}getStatusClass(e){return e?.toLowerCase().replace(/_/g,"-")||""}countByStatus(e){return this.allConfirmations.filter(a=>a.status===e).length}formatDateTime(e){return e?new Date(e).toLocaleString():"-"}getDuration(e,a){if(!e||!a)return"-";let l=new Date(a).getTime()-new Date(e).getTime(),s=Math.round(l/6e4);return s<60?`${s}m`:`${Math.floor(s/60)}h ${s%60}m`}toggleDetail(e){this.selectedConfirmation=this.selectedConfirmation===e?null:e}canReverse(e){return e.status==="CONFIRMED"||e.status==="PARTIALLY_CONFIRMED"}openReverseDialog(e){this.reversalConfirmation=e,this.reversalReason="",this.reversalNotes="",this.reversalError="",this.reversalLoading=!0,this.canReverseResult=null,this.showReversalDialog=!0,this.apiService.canReverseConfirmation(e.confirmationId).subscribe({next:a=>{this.canReverseResult=a,this.reversalLoading=!1},error:a=>{this.reversalError="Failed to check reversal eligibility.",this.reversalLoading=!1}})}closeReverseDialog(){this.showReversalDialog=!1,this.reversalConfirmation=null,this.canReverseResult=null}confirmReversal(){!this.reversalConfirmation||!this.reversalReason.trim()||(this.reversalLoading=!0,this.reversalError="",this.apiService.reverseConfirmation(this.reversalConfirmation.confirmationId,this.reversalReason.trim(),this.reversalNotes.trim()||void 0).subscribe({next:()=>{this.closeReverseDialog(),this.selectedConfirmation=null,this.loadConfirmations()},error:e=>{this.reversalError=e.error?.message||e.error?.error||"Failed to reverse confirmation.",this.reversalLoading=!1}}))}static{this.\u0275fac=function(a){return new(a||i)(S(N))}}static{this.\u0275cmp=I({type:i,selectors:[["app-production-history"]],decls:23,vars:12,consts:[["loadingTpl",""],["emptyTpl",""],[1,"production-history-page"],[1,"page-header"],[1,"page-title"],[1,"card"],[1,"filters"],[1,"filter-group"],["for","status-filter"],["id","status-filter",3,"ngModelChange","change","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"filter-group","search-group"],["for","search"],["type","text","id","search","placeholder","Search by operation, batch, notes...",3,"ngModelChange","input","ngModel"],["class","summary-cards",4,"ngIf"],["class","table-container",4,"ngIf","ngIfElse"],["class","detail-panel card",4,"ngIf"],["class","modal-backdrop",3,"click",4,"ngIf"],[3,"value"],[1,"summary-cards"],[1,"summary-card"],[1,"count"],[1,"label"],[1,"summary-card","confirmed"],[1,"summary-card","pending"],[1,"summary-card","rejected"],[1,"summary-card","reversed"],[1,"table-container"],["class","data-table",4,"ngIf","ngIfElse"],["class","result-count",4,"ngIf"],[1,"data-table"],["class","clickable-row",3,"selected","rejected-row","reversed-row","click",4,"ngFor","ngForOf"],[1,"clickable-row",3,"click"],[1,"status-badge",3,"ngClass"],[1,"empty-state"],[1,"result-count"],[1,"loading"],[1,"detail-panel","card"],[1,"detail-header"],[1,"detail-actions"],["class","btn btn-sm btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"detail-grid"],[1,"detail-section"],[1,"detail-row"],[1,"detail-label"],["class","detail-row",4,"ngIf"],["class","detail-section",4,"ngIf"],["class","detail-section rejection",4,"ngIf"],["class","detail-section reversal",4,"ngIf"],[1,"btn","btn-sm","btn-warning",3,"click"],[4,"ngIf"],["class","detail-row",4,"ngFor","ngForOf"],[1,"detail-section","rejection"],[1,"detail-section","reversal"],[1,"modal-backdrop",3,"click"],[1,"modal-dialog",3,"click"],[1,"modal-header"],[1,"btn-close",3,"click"],[1,"modal-body"],[1,"warning-banner"],["class","loading-msg",4,"ngIf"],["class","error-banner",4,"ngIf"],["class","form-group",4,"ngIf"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-danger",3,"click","disabled"],[1,"loading-msg"],[1,"error-banner"],[4,"ngFor","ngForOf"],[1,"form-group"],["for","reversal-reason"],[1,"required"],["id","reversal-reason","rows","3","placeholder","Enter reason for reversal...",3,"ngModelChange","ngModel"],["for","reversal-notes"],["id","reversal-notes","rows","2","placeholder","Optional notes...",3,"ngModelChange","ngModel"]],template:function(a,l){if(a&1){let s=C();n(0,"div",2)(1,"div",3)(2,"h1",4),o(3,"Production History"),t()(),n(4,"div",5)(5,"div",6)(6,"div",7)(7,"label",8),o(8,"Status:"),t(),n(9,"select",9),q("ngModelChange",function(P){return _(s),V(l.filterStatus,P)||(l.filterStatus=P),x(P)}),v("change",function(){return _(s),x(l.onFilterStatusChange(l.filterStatus))}),n(10,"option",10),o(11,"All Statuses"),t(),m(12,Gt,2,2,"option",11),t()(),n(13,"div",12)(14,"label",13),o(15,"Search:"),t(),n(16,"input",14),q("ngModelChange",function(P){return _(s),V(l.searchTerm,P)||(l.searchTerm=P),x(P)}),v("input",function(){return _(s),x(l.onSearchChange(l.searchTerm))}),t()()()(),m(17,Yt,26,5,"div",15)(18,Zt,5,3,"div",16)(19,en,2,0,"ng-template",null,0,G)(21,fn,40,15,"div",17)(22,Sn,20,8,"div",18),t()}if(a&2){let s=$(20);r(6),y("filter-active",l.filterStatus&&l.filterStatus!=="all"),r(3),y("filter-active",l.filterStatus&&l.filterStatus!=="all"),z("ngModel",l.filterStatus),r(3),d("ngForOf",l.statuses),r(4),z("ngModel",l.searchTerm),r(),d("ngIf",!l.loading),r(),d("ngIf",!l.loading)("ngIfElse",s),r(3),d("ngIf",l.selectedConfirmation),r(),d("ngIf",l.showReversalDialog)}},dependencies:[E,w,k,T,R,H,Q,L,de],styles:[".production-history-page[_ngcontent-%COMP%]{padding:20px}.summary-cards[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:20px;flex-wrap:wrap}.summary-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:16px 24px;box-shadow:0 1px 3px #0000001a;text-align:center;min-width:120px;border-top:3px solid #dee2e6}.summary-card[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{display:block;font-size:24px;font-weight:700;color:#333}.summary-card[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;color:#666;text-transform:uppercase}.summary-card.confirmed[_ngcontent-%COMP%]{border-top-color:#388e3c}.summary-card.pending[_ngcontent-%COMP%]{border-top-color:#f57c00}.summary-card.rejected[_ngcontent-%COMP%]{border-top-color:#d32f2f}.summary-card.reversed[_ngcontent-%COMP%]{border-top-color:#7b1fa2}.table-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;overflow:hidden}.clickable-row[_ngcontent-%COMP%]{cursor:pointer;transition:background .15s}.clickable-row[_ngcontent-%COMP%]:hover{background:#f8f9fa}.clickable-row.selected[_ngcontent-%COMP%]{background:#e3f2fd}.rejected-row[_ngcontent-%COMP%]{background:#fff5f5}.reversed-row[_ngcontent-%COMP%]{background:#faf5ff}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase}.status-badge.confirmed[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-badge.pending-review[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-badge.partially-confirmed[_ngcontent-%COMP%]{background:#cce5ff;color:#004085}.status-badge.rejected[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.status-badge.reversed[_ngcontent-%COMP%]{background:#f3e5f5;color:#4a148c}.result-count[_ngcontent-%COMP%]{padding:12px 16px;border-top:1px solid #eee;font-size:13px;color:#666}.empty-state[_ngcontent-%COMP%], .loading[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}.detail-panel[_ngcontent-%COMP%]{margin-top:20px}.detail-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.detail-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}.detail-section[_ngcontent-%COMP%]{padding:12px;background:#f8f9fa;border-radius:6px}.detail-section.rejection[_ngcontent-%COMP%]{background:#fff5f5;border:1px solid #f8d7da}.detail-section.reversal[_ngcontent-%COMP%]{background:#faf5ff;border:1px solid #e1bee7}.detail-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;font-size:14px;color:#555;text-transform:uppercase;letter-spacing:.03em}.detail-row[_ngcontent-%COMP%]{padding:4px 0;font-size:14px}.detail-label[_ngcontent-%COMP%]{font-weight:500;color:#555}.detail-actions[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-dialog[_ngcontent-%COMP%]{background:#fff;border-radius:8px;width:500px;max-width:90vw;max-height:90vh;overflow-y:auto;box-shadow:0 4px 20px #0003}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid #eee}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px}.btn-close[_ngcontent-%COMP%]{background:none;border:none;font-size:24px;cursor:pointer;color:#666;padding:0 4px}.modal-body[_ngcontent-%COMP%]{padding:20px}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px;padding:16px 20px;border-top:1px solid #eee}.warning-banner[_ngcontent-%COMP%]{background:#fff3cd;color:#856404;padding:12px 16px;border-radius:4px;margin-bottom:16px;font-size:13px;line-height:1.5}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:12px 16px;border-radius:4px;margin-bottom:16px}.error-banner[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:8px 0 0;padding-left:20px}.loading-msg[_ngcontent-%COMP%]{text-align:center;padding:20px;color:#666}.form-group[_ngcontent-%COMP%]{margin-bottom:16px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:6px;font-weight:500;font-size:14px}.form-group[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:#d32f2f}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ccc;border-radius:4px;font-family:inherit;font-size:14px;resize:vertical}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2;box-shadow:0 0 0 2px #1976d233}.btn-warning[_ngcontent-%COMP%]{background:#f57c00;color:#fff;border:none;padding:6px 16px;border-radius:4px;cursor:pointer;font-size:13px}.btn-warning[_ngcontent-%COMP%]:hover{background:#e65100}.btn-danger[_ngcontent-%COMP%]{background:#d32f2f;color:#fff;border:none;padding:8px 20px;border-radius:4px;cursor:pointer;font-size:14px}.btn-danger[_ngcontent-%COMP%]:hover{background:#b71c1c}.btn-danger[_ngcontent-%COMP%]:disabled{background:#ccc;cursor:not-allowed}"]})}}return i})();function On(i,c){i&1&&(n(0,"div",7),o(1,"Loading available orders..."),t())}function Mn(i,c){if(i&1&&(n(0,"div",8),o(1),t()),i&2){let e=p();r(),u(e.error)}}function In(i,c){if(i&1&&(n(0,"option",22),o(1),t()),i&2){let e=c.$implicit;d("value",e.orderId),r(),b(" ",e.orderNumber," - ",e.customerName||e.customerId," ")}}function En(i,c){i&1&&(n(0,"span",23),o(1," No orders with ready operations available "),t())}function wn(i,c){if(i&1&&(n(0,"option",22),o(1),t()),i&2){let e=c.$implicit;d("value",e.operationId),r(),b(" ",e.operationName," (",e.operationType||"Unknown Type",") ")}}function kn(i,c){i&1&&(n(0,"span",23),o(1," No READY operations found for this order "),t())}function Tn(i,c){if(i&1){let e=C();n(0,"div",11)(1,"label",24),o(2,"Operation"),t(),n(3,"select",25),v("change",function(l){_(e);let s=p(2);return x(s.onOperationSelect(l))}),n(4,"option",14),o(5,"-- Select an Operation --"),t(),m(6,wn,2,3,"option",15),t(),m(7,kn,2,0,"span",16),t()}if(i&2){let e=p(2);r(6),d("ngForOf",e.readyOperations),r(),d("ngIf",e.readyOperations.length===0)}}function Rn(i,c){if(i&1){let e=C();n(0,"div",26)(1,"button",27),v("click",function(){_(e);let l=p(2);return x(l.startConfirmation())}),o(2," Start Production Confirmation "),t()()}}function Nn(i,c){if(i&1&&(n(0,"div",32)(1,"span",33),o(2),t(),n(3,"span",34),o(4),t()()),i&2){let e=c.$implicit;r(2),u(e.label),r(2),u(e.value)}}function zn(i,c){if(i&1&&(n(0,"tr")(1,"td"),o(2),t(),n(3,"td"),o(4),t(),n(5,"td"),o(6),D(7,"date"),t(),n(8,"td")(9,"span",38),o(10),t()()()),i&2){let e=c.$implicit;r(2),u(e.productName||e.productSku),r(2),b("",e.quantity," ",e.unit,""),r(2),u(ne(7,6,e.deliveryDate,"shortDate")),r(3),d("ngClass","status-"+(e.status==null?null:e.status.toLowerCase())),r(),g(" ",e.status," ")}}function Vn(i,c){if(i&1&&(n(0,"div",35)(1,"h4"),o(2,"Line Items"),t(),n(3,"table",36)(4,"thead")(5,"tr")(6,"th"),o(7,"Product"),t(),n(8,"th"),o(9,"Quantity"),t(),n(10,"th"),o(11,"Delivery Date"),t(),n(12,"th"),o(13,"Status"),t()()(),n(14,"tbody"),m(15,zn,11,9,"tr",37),t()()()),i&2){let e=p(3);r(15),d("ngForOf",e.selectedOrder.lineItems)}}function qn(i,c){if(i&1&&(n(0,"div",28)(1,"h3"),o(2,"Order Details"),t(),n(3,"div",29),m(4,Nn,5,2,"div",30),t(),m(5,Vn,16,1,"div",31),t()),i&2){let e=p(2);r(4),d("ngForOf",e.orderContext),r(),d("ngIf",e.selectedOrder==null||e.selectedOrder.lineItems==null?null:e.selectedOrder.lineItems.length)}}function Fn(i,c){if(i&1&&(n(0,"div",41)(1,"span",42),o(2,"Operation Type"),t(),n(3,"span",43),o(4),t()()),i&2){let e=p(3);r(4),u(e.selectedOperationDetails.operationType)}}function Bn(i,c){if(i&1&&(n(0,"div",41)(1,"span",42),o(2,"Operation Code"),t(),n(3,"span",43),o(4),t()()),i&2){let e=p(3);r(4),u(e.selectedOperationDetails.operationCode)}}function Dn(i,c){if(i&1&&(n(0,"div",39)(1,"h3"),o(2,"Selected Operation"),t(),n(3,"div",40)(4,"div",41)(5,"span",42),o(6,"Operation Name"),t(),n(7,"span",43),o(8),t()(),m(9,Fn,5,1,"div",44)(10,Bn,5,1,"div",44),n(11,"div",41)(12,"span",42),o(13,"Sequence"),t(),n(14,"span",43),o(15),t()(),n(16,"div",41)(17,"span",42),o(18,"Status"),t(),n(19,"span",45),o(20,"READY"),t()()()()),i&2){let e=p(2);r(8),u(e.selectedOperationDetails.operationName),r(),d("ngIf",e.selectedOperationDetails.operationType),r(),d("ngIf",e.selectedOperationDetails.operationCode),r(5),g("#",e.selectedOperationDetails.sequenceNumber,"")}}function An(i,c){if(i&1&&(n(0,"div",46)(1,"h3"),o(2,"Available for Production"),t(),n(3,"div",47)(4,"div",48)(5,"span",49),o(6),t(),n(7,"span",50),o(8,"Orders"),t()(),n(9,"div",48)(10,"span",49),o(11),t(),n(12,"span",50),o(13,"Ready Operations"),t()()()()),i&2){let e=p(2);r(6),u(e.availableOrders.length),r(5),u(e.getTotalReadyOperations())}}function Hn(i,c){if(i&1){let e=C();n(0,"div",9)(1,"div",10)(2,"h2"),o(3,"Select Order & Operation"),t(),n(4,"div",11)(5,"label",12),o(6,"Order"),t(),n(7,"select",13),v("change",function(l){_(e);let s=p();return x(s.onOrderSelect(l))}),n(8,"option",14),o(9,"-- Select an Order --"),t(),m(10,In,2,3,"option",15),t(),m(11,En,2,0,"span",16),t(),m(12,Tn,8,2,"div",17)(13,Rn,3,0,"div",18),t(),m(14,qn,6,2,"div",19)(15,Dn,21,4,"div",20)(16,An,14,2,"div",21),t()}if(i&2){let e=p();r(10),d("ngForOf",e.availableOrders),r(),d("ngIf",e.availableOrders.length===0),r(),d("ngIf",e.selectedOrder),r(),d("ngIf",e.selectedOperationId),r(),d("ngIf",e.selectedOrder),r(),d("ngIf",e.selectedOperationDetails),r(),d("ngIf",!e.selectedOrder)}}var ke=(()=>{class i{constructor(e,a){this.apiService=e,this.router=a,this.availableOrders=[],this.selectedOrder=null,this.readyOperations=[],this.selectedOperationId=null,this.loading=!0,this.error=""}ngOnInit(){this.loadAvailableOrders()}loadAvailableOrders(){this.loading=!0,this.apiService.getAvailableOrders().subscribe({next:e=>{this.availableOrders=e,this.loading=!1},error:e=>{this.error="Failed to load available orders",this.loading=!1,console.error("Error loading orders:",e)}})}onOrderSelect(e){let a=e.target.value;if(this.selectedOperationId=null,this.readyOperations=[],!a){this.selectedOrder=null;return}this.selectedOrder=this.availableOrders.find(l=>l.orderId===+a)||null,this.selectedOrder&&(this.readyOperations=this.extractReadyOperations(this.selectedOrder))}extractReadyOperations(e){let a=[];for(let l of e.lineItems||[])for(let s of l.operations||[])s.status==="READY"&&a.push({operationId:s.operationId,operationName:s.processName?`${s.processName} - ${s.operationName}`:s.operationName,operationCode:s.operationCode,operationType:s.operationType,sequenceNumber:s.sequenceNumber,status:s.status});return a}onOperationSelect(e){let a=e.target.value;this.selectedOperationId=a?+a:null}startConfirmation(){this.selectedOperationId&&this.router.navigate(["/production/confirm",this.selectedOperationId])}goToHistory(){this.router.navigate(["/production/history"])}get orderContext(){if(!this.selectedOrder)return[];let e=[{label:"Customer",value:this.selectedOrder.customerName||this.selectedOrder.customerId||"N/A"},{label:"Order Date",value:this.selectedOrder.orderDate?new Date(this.selectedOrder.orderDate).toLocaleDateString():"N/A"},{label:"Status",value:this.selectedOrder.status||"N/A"}],a=this.selectedOrder.lineItems||[];if(a.length>0){let l=a[0];e.push({label:"Product",value:l.productName||l.productSku||"N/A"},{label:"Quantity",value:`${l.quantity||0} ${l.unit||""}`}),l.deliveryDate&&e.push({label:"Due Date",value:new Date(l.deliveryDate).toLocaleDateString()})}return e}get selectedOperationDetails(){return this.selectedOperationId&&this.readyOperations.find(e=>e.operationId===this.selectedOperationId)||null}getTotalReadyOperations(){let e=0;for(let a of this.availableOrders)e+=this.extractReadyOperations(a).length;return e}static{this.\u0275fac=function(a){return new(a||i)(S(N),S(A))}}static{this.\u0275cmp=I({type:i,selectors:[["app-production-landing"]],decls:9,vars:3,consts:[[1,"production-landing-page"],[1,"page-header"],[1,"page-title"],[1,"btn","btn-secondary",3,"click"],["class","loading",4,"ngIf"],["class","error-banner",4,"ngIf"],["class","content",4,"ngIf"],[1,"loading"],[1,"error-banner"],[1,"content"],[1,"selection-section"],[1,"form-group"],["for","orderSelect"],["id","orderSelect",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","help-text",4,"ngIf"],["class","form-group",4,"ngIf"],["class","form-actions",4,"ngIf"],["class","context-panel",4,"ngIf"],["class","operation-panel",4,"ngIf"],["class","stats-panel",4,"ngIf"],[3,"value"],[1,"help-text"],["for","operationSelect"],["id","operationSelect",3,"change"],[1,"form-actions"],[1,"btn","btn-primary",3,"click"],[1,"context-panel"],[1,"context-grid"],["class","context-item",4,"ngFor","ngForOf"],["class","line-items-summary",4,"ngIf"],[1,"context-item"],[1,"context-label"],[1,"context-value"],[1,"line-items-summary"],[1,"summary-table"],[4,"ngFor","ngForOf"],[1,"status-badge",3,"ngClass"],[1,"operation-panel"],[1,"operation-details"],[1,"detail-row"],[1,"detail-label"],[1,"detail-value"],["class","detail-row",4,"ngIf"],[1,"status-badge","status-ready"],[1,"stats-panel"],[1,"stat-cards"],[1,"stat-card"],[1,"stat-value"],[1,"stat-label"]],template:function(a,l){a&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),o(3,"Production Confirmation"),t(),n(4,"button",3),v("click",function(){return l.goToHistory()}),o(5," View History "),t()(),m(6,On,2,0,"div",4)(7,Mn,2,1,"div",5)(8,Hn,17,7,"div",6),t()),a&2&&(r(6),d("ngIf",l.loading),r(),d("ngIf",l.error),r(),d("ngIf",!l.loading&&!l.error))},dependencies:[E,w,k,T,R,oe],styles:[".production-landing-page[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;color:#333}.loading[_ngcontent-%COMP%], .error-banner[_ngcontent-%COMP%]{text-align:center;padding:40px 20px}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;border-radius:8px}.content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px}.selection-section[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;padding:24px}.selection-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 20px;font-size:18px;color:#333;padding-bottom:12px;border-bottom:1px solid #eee}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:500;color:#555}.form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #ddd;border-radius:4px;font-size:14px;background:#fff;cursor:pointer}.form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2}.help-text[_ngcontent-%COMP%]{display:block;margin-top:6px;font-size:12px;color:#666;font-style:italic}.form-actions[_ngcontent-%COMP%]{margin-top:24px;padding-top:16px;border-top:1px solid #eee}.btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:500;transition:background .2s}.btn-primary[_ngcontent-%COMP%]{background:#1976d2;color:#fff;width:100%}.btn-primary[_ngcontent-%COMP%]:hover{background:#1565c0}.btn-secondary[_ngcontent-%COMP%]{background:#757575;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover{background:#616161}.context-panel[_ngcontent-%COMP%], .operation-panel[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;padding:24px}.context-panel[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .operation-panel[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;font-size:16px;color:#333;padding-bottom:12px;border-bottom:1px solid #eee}.context-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}.context-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.context-label[_ngcontent-%COMP%]{font-size:12px;color:#666;text-transform:uppercase;letter-spacing:.5px}.context-value[_ngcontent-%COMP%]{font-size:14px;color:#333;font-weight:500}.line-items-summary[_ngcontent-%COMP%]{margin-top:20px;padding-top:16px;border-top:1px solid #eee}.line-items-summary[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;font-size:14px;color:#555}.summary-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:13px}.summary-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .summary-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 10px;text-align:left;border-bottom:1px solid #eee}.summary-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#fafafa;font-weight:600;color:#555}.operation-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.detail-label[_ngcontent-%COMP%]{font-size:13px;color:#666}.detail-value[_ngcontent-%COMP%]{font-size:14px;color:#333;font-weight:500}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.status-ready[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.status-in_progress[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.status-completed[_ngcontent-%COMP%]{background:#f3e5f5;color:#7b1fa2}.status-created[_ngcontent-%COMP%]{background:#fff3e0;color:#ef6c00}.stats-panel[_ngcontent-%COMP%]{grid-column:2;background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;padding:24px}.stats-panel[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;font-size:16px;color:#333}.stat-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}.stat-card[_ngcontent-%COMP%]{background:#f5f5f5;border-radius:8px;padding:20px;text-align:center}.stat-value[_ngcontent-%COMP%]{display:block;font-size:32px;font-weight:700;color:#1976d2}.stat-label[_ngcontent-%COMP%]{display:block;font-size:13px;color:#666;margin-top:4px}@media (max-width: 768px){.content[_ngcontent-%COMP%], .context-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.stats-panel[_ngcontent-%COMP%]{grid-column:1}}"]})}}return i})();var Ln=[{path:"",component:ke},{path:"confirm/:operationId",component:Ee},{path:"history",component:we}],Te=(()=>{class i{static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275mod=B({type:i})}static{this.\u0275inj=F({imports:[Y.forChild(Ln),Y]})}}return i})();var gi=(()=>{class i{static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275mod=B({type:i})}static{this.\u0275inj=F({imports:[re,ve,he,Te,Se]})}}return i})();export{gi as ProductionModule};
