import{h as q,k as $,n as J}from"./chunk-LMWWBC6Z.js";import{$ as S,B as s,D as I,Da as T,F as n,G as i,H as E,Ha as D,I as L,J as V,Ja as R,L as v,La as W,M as h,N as p,S as A,T as o,Ta as j,U as u,Ua as B,V as k,Va as H,Z as w,_ as P,_a as G,ga as M,ia as F,ja as N,ka as z,m as x,o as b,p as y,qa as U,r as g,s as m,w as a,x as O,z as f}from"./chunk-SXRLIX2W.js";function Y(t,c){if(t&1&&(n(0,"option",23),o(1),i()),t&2){let e=c.$implicit,r=p();s("value",e),a(),u(r.formatEntityType(e))}}function Z(t,c){if(t&1&&(n(0,"option",23),o(1),i()),t&2){let e=c.$implicit;s("value",e),a(),u(e)}}function ee(t,c){if(t&1&&(n(0,"div",24),o(1),i()),t&2){let e=p();a(),u(e.error)}}function te(t,c){if(t&1&&(n(0,"span",47),o(1),i()),t&2){let e=p(2).$implicit;a(),u(e.oldValue)}}function ie(t,c){t&1&&E(0,"i",48)}function ne(t,c){if(t&1&&(n(0,"span",49),o(1),i()),t&2){let e=p(2).$implicit;a(),u(e.newValue)}}function oe(t,c){if(t&1&&(L(0),f(1,te,2,1,"span",44)(2,ie,1,0,"i",45)(3,ne,2,1,"span",46),V()),t&2){let e=p().$implicit;a(),s("ngIf",e.oldValue),a(),s("ngIf",e.oldValue&&e.newValue),a(),s("ngIf",e.newValue)}}function ae(t,c){t&1&&(n(0,"span"),o(1,"-"),i())}function re(t,c){if(t&1){let e=v();n(0,"tr",38),h("click",function(){let l=g(e).$implicit,d=p(3);return m(d.selectEntry(l))}),n(1,"td")(2,"span",39),E(3,"i",40),o(4),i()(),n(5,"td"),o(6),i(),n(7,"td",41),o(8),i(),n(9,"td"),o(10),i(),n(11,"td",42),f(12,oe,4,3,"ng-container",43)(13,ae,2,0,"span",43),i(),n(14,"td"),o(15),i(),n(16,"td",41),o(17),i()()}if(t&2){let e=c.$implicit,r=p(3);I("selected",r.selectedEntry===e),a(2),s("ngClass",r.getActionClass(e.action)),a(),s("ngClass","fa-"+r.getActionIcon(e.action)),a(),k(" ",e.action," "),a(2),u(r.formatEntityType(e.entityType)),a(2),u(e.entityId),a(2),u(e.fieldName||"-"),a(2),s("ngIf",e.oldValue||e.newValue),a(),s("ngIf",!e.oldValue&&!e.newValue),a(2),u(e.changedBy),a(2),u(r.formatTimestamp(e.timestamp))}}function le(t,c){if(t&1){let e=v();n(0,"app-pagination",50),h("pageChange",function(l){g(e);let d=p(3);return m(d.onPageChange(l))})("sizeChange",function(l){g(e);let d=p(3);return m(d.onSizeChange(l))}),i()}if(t&2){let e=p(3);s("page",e.currentPage)("size",e.pageSize)("totalElements",e.totalElements)("totalPages",e.totalPages)("hasNext",e.hasNext)("hasPrevious",e.hasPrevious)}}function se(t,c){if(t&1&&(n(0,"div",27)(1,"table",28)(2,"thead")(3,"tr")(4,"th",29),o(5,"Action"),i(),n(6,"th",30),o(7,"Entity"),i(),n(8,"th",31),o(9,"ID"),i(),n(10,"th",32),o(11,"Field"),i(),n(12,"th",33),o(13,"Change"),i(),n(14,"th",34),o(15,"User"),i(),n(16,"th",35),o(17,"Timestamp"),i()()(),n(18,"tbody"),f(19,re,18,12,"tr",36),i()(),f(20,le,1,6,"app-pagination",37),i()),t&2){let e=p(2);a(19),s("ngForOf",e.entries),a(),s("ngIf",e.entries.length>0)}}function ce(t,c){t&1&&(n(0,"div",51),E(1,"i",52),n(2,"p"),o(3,"No audit entries found."),i()())}function de(t,c){if(t&1&&(n(0,"div",25),f(1,se,21,2,"div",26)(2,ce,4,0,"ng-template",null,1,M),i()),t&2){let e=A(3),r=p();a(),s("ngIf",r.entries.length>0)("ngIfElse",e)}}function pe(t,c){t&1&&(n(0,"div",53),o(1,"Loading audit trail..."),i())}var Q=(()=>{class t{constructor(e){this.apiService=e,this.entries=[],this.loading=!0,this.error="",this.entityTypes=[],this.actionTypes=[],this.filterEntityType="all",this.filterAction="all",this.filterUser="",this.todaysCount=0,this.currentPage=0,this.pageSize=20,this.totalElements=0,this.totalPages=0,this.hasNext=!1,this.hasPrevious=!1,this.selectedEntry=null}ngOnInit(){this.loadFilters(),this.loadPaged(),this.loadSummary()}loadFilters(){this.apiService.getAuditEntityTypes().subscribe({next:e=>this.entityTypes=e,error:()=>{}}),this.apiService.getAuditActionTypes().subscribe({next:e=>this.actionTypes=e,error:()=>{}})}loadSummary(){this.apiService.getAuditSummary().subscribe({next:e=>this.todaysCount=e.todaysActivityCount,error:()=>{}})}loadPaged(){this.loading=!0,this.error="";let e={page:this.currentPage,size:this.pageSize};this.filterEntityType!=="all"&&(e.entityType=this.filterEntityType),this.filterAction!=="all"&&(e.action=this.filterAction),this.filterUser&&(e.search=this.filterUser),this.apiService.getAuditPaged(e).subscribe({next:r=>{this.entries=r.content,this.totalElements=r.totalElements,this.totalPages=r.totalPages,this.hasNext=this.currentPage<this.totalPages-1,this.hasPrevious=this.currentPage>0,this.loading=!1},error:r=>{this.error=r.error?.message||"Failed to load audit trail.",this.loading=!1}})}onFilterChange(){this.currentPage=0,this.loadPaged()}onPageChange(e){this.currentPage=e,this.loadPaged()}onSizeChange(e){this.pageSize=e,this.currentPage=0,this.loadPaged()}getActionClass(e){switch(e){case"CREATE":return"action-create";case"UPDATE":return"action-update";case"DELETE":return"action-delete";case"STATUS_CHANGE":return"action-status";case"HOLD":return"action-hold";case"RELEASE":return"action-release";case"CONSUME":return"action-consume";case"PRODUCE":return"action-produce";default:return""}}getActionIcon(e){switch(e){case"CREATE":return"circle-plus";case"UPDATE":return"pencil";case"DELETE":return"trash";case"STATUS_CHANGE":return"arrows-rotate";case"HOLD":return"circle-pause";case"RELEASE":return"circle-play";case"CONSUME":return"download";case"PRODUCE":return"upload";default:return"clock-rotate-left"}}formatEntityType(e){return e?.replace(/_/g," ")||""}formatTimestamp(e){return e?new Date(e).toLocaleString():"-"}selectEntry(e){this.selectedEntry=this.selectedEntry===e?null:e}clearFilters(){this.filterEntityType="all",this.filterAction="all",this.filterUser="",this.currentPage=0,this.loadPaged()}static{this.\u0275fac=function(r){return new(r||t)(O(q))}}static{this.\u0275cmp=b({type:t,selectors:[["app-audit-list"]],decls:37,vars:9,consts:[["loadingTpl",""],["emptyTpl",""],[1,"audit-list-page"],[1,"page-header"],[1,"page-title"],[1,"header-stats"],[1,"stat-badge"],[1,"card"],[1,"filters"],[1,"filter-group"],["for","entity-filter"],["id","entity-filter",3,"ngModelChange","change","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],["for","action-filter"],["id","action-filter",3,"ngModelChange","change","ngModel"],[1,"filter-group","search-group"],["for","user-filter"],["type","text","id","user-filter","placeholder","Filter by user...",3,"ngModelChange","keyup.enter","ngModel"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"btn","btn-sm","btn-secondary",3,"click"],["class","error-banner",4,"ngIf"],["class","audit-content",4,"ngIf","ngIfElse"],[3,"value"],[1,"error-banner"],[1,"audit-content"],["class","table-container",4,"ngIf","ngIfElse"],[1,"table-container"],[1,"data-table"],[1,"col-action"],[1,"col-entity"],[1,"col-id"],[1,"col-field"],[1,"col-change"],[1,"col-user"],[1,"col-time"],["class","audit-row",3,"selected","click",4,"ngFor","ngForOf"],[3,"page","size","totalElements","totalPages","hasNext","hasPrevious","pageChange","sizeChange",4,"ngIf"],[1,"audit-row",3,"click"],[1,"action-badge",3,"ngClass"],[1,"fas",3,"ngClass"],[1,"mono"],[1,"change-cell"],[4,"ngIf"],["class","old-value",4,"ngIf"],["class","fas fa-arrow-right change-arrow",4,"ngIf"],["class","new-value",4,"ngIf"],[1,"old-value"],[1,"fas","fa-arrow-right","change-arrow"],[1,"new-value"],[3,"pageChange","sizeChange","page","size","totalElements","totalPages","hasNext","hasPrevious"],[1,"empty-state"],[1,"fas","fa-clock-rotate-left"],[1,"loading"]],template:function(r,l){if(r&1){let d=v();n(0,"div",2)(1,"div",3)(2,"h1",4),o(3,"Audit Trail"),i(),n(4,"div",5)(5,"span",6)(6,"strong"),o(7),i(),o(8," changes today"),i()()(),n(9,"div",7)(10,"div",8)(11,"div",9)(12,"label",10),o(13,"Entity:"),i(),n(14,"select",11),S("ngModelChange",function(_){return g(d),P(l.filterEntityType,_)||(l.filterEntityType=_),m(_)}),h("change",function(){return g(d),m(l.onFilterChange())}),n(15,"option",12),o(16,"All Entities"),i(),f(17,Y,2,2,"option",13),i()(),n(18,"div",9)(19,"label",14),o(20,"Action:"),i(),n(21,"select",15),S("ngModelChange",function(_){return g(d),P(l.filterAction,_)||(l.filterAction=_),m(_)}),h("change",function(){return g(d),m(l.onFilterChange())}),n(22,"option",12),o(23,"All Actions"),i(),f(24,Z,2,2,"option",13),i()(),n(25,"div",16)(26,"label",17),o(27,"User:"),i(),n(28,"input",18),S("ngModelChange",function(_){return g(d),P(l.filterUser,_)||(l.filterUser=_),m(_)}),h("keyup.enter",function(){return g(d),m(l.onFilterChange())}),i(),n(29,"button",19),h("click",function(){return g(d),m(l.onFilterChange())}),o(30,"Search"),i()(),n(31,"button",20),h("click",function(){return g(d),m(l.clearFilters())}),o(32,"Clear"),i()()(),f(33,ee,2,1,"div",21)(34,de,4,2,"div",22)(35,pe,2,0,"ng-template",null,0,M),i()}if(r&2){let d=A(36);a(7),u(l.todaysCount),a(7),w("ngModel",l.filterEntityType),a(3),s("ngForOf",l.entityTypes),a(4),w("ngModel",l.filterAction),a(3),s("ngForOf",l.actionTypes),a(4),w("ngModel",l.filterUser),a(5),s("ngIf",l.error),a(),s("ngIf",!l.loading)("ngIfElse",d)}},dependencies:[F,N,z,B,H,D,j,R,W,$],styles:[".audit-list-page[_ngcontent-%COMP%]{padding:20px}.page-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}.stat-badge[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32;padding:6px 14px;border-radius:16px;font-size:13px}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:12px 16px;border-radius:4px;margin-bottom:16px}.table-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;overflow:hidden}.col-action[_ngcontent-%COMP%]{width:140px}.col-entity[_ngcontent-%COMP%]{width:160px}.col-id[_ngcontent-%COMP%]{width:60px}.col-field[_ngcontent-%COMP%]{width:120px}.col-user[_ngcontent-%COMP%]{width:100px}.col-time[_ngcontent-%COMP%]{width:170px}.audit-row[_ngcontent-%COMP%]{cursor:pointer;transition:background .15s}.audit-row[_ngcontent-%COMP%]:hover{background:#f8f9fa}.audit-row.selected[_ngcontent-%COMP%]{background:#e3f2fd}.action-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600;text-transform:uppercase}.action-create[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.action-update[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.action-delete[_ngcontent-%COMP%]{background:#fce4ec;color:#c62828}.action-status[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.action-hold[_ngcontent-%COMP%]{background:#f3e5f5;color:#7b1fa2}.action-release[_ngcontent-%COMP%]{background:#e0f7fa;color:#00695c}.action-consume[_ngcontent-%COMP%]{background:#fafafa;color:#616161}.action-produce[_ngcontent-%COMP%]{background:#f1f8e9;color:#558b2f}.change-cell[_ngcontent-%COMP%]{max-width:250px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.old-value[_ngcontent-%COMP%]{color:#c62828;text-decoration:line-through;font-size:13px}.new-value[_ngcontent-%COMP%]{color:#2e7d32;font-weight:500;font-size:13px}.change-arrow[_ngcontent-%COMP%]{color:#999;margin:0 4px;font-size:11px}.mono[_ngcontent-%COMP%]{font-family:Courier New,monospace;font-size:13px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:48px;color:#ccc;display:block;margin-bottom:12px}.loading[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}"]})}}return t})();var ge=[{path:"",component:Q}],X=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=y({type:t})}static{this.\u0275inj=x({imports:[T.forChild(ge),T]})}}return t})();var Me=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=y({type:t})}static{this.\u0275inj=x({imports:[U,G,X,J]})}}return t})();export{Me as AuditModule};
