import{h as I,i as at,k as lt,n as st}from"./chunk-LMWWBC6Z.js";import{$a as rt,Aa as E,B as s,D as C,Da as H,F as n,G as e,Ga as Y,H as u,Ha as Q,Ia as y,Ja as K,Ka as Z,L as h,M as m,Ma as J,N as c,Na as W,Pa as X,S as N,Sa as tt,T as o,Ta as et,U as g,Ua as L,V as b,Va as z,W as j,Xa as nt,Za as it,_a as ot,a as B,b as $,da as T,fa as R,ga as F,ia as V,ja as M,ka as P,m as w,o as O,oa as D,p as k,qa as G,r as f,s as _,w as l,x as S,ya as A,z as x}from"./chunk-SXRLIX2W.js";function bt(r,p){if(r&1&&(n(0,"option",22),o(1),e()),r&2){let t=p.$implicit;s("value",t),l(),g(t)}}function ht(r,p){if(r&1&&(n(0,"option",22),o(1),e()),r&2){let t=p.$implicit,i=c();s("value",t),l(),g(i.getTypeLabel(t))}}function vt(r,p){r&1&&(n(0,"div",23),o(1,"Loading routings..."),e())}function Ct(r,p){if(r&1&&(n(0,"div",24),o(1),e()),r&2){let t=c();l(),g(t.error)}}function St(r,p){if(r&1){let t=h();n(0,"button",39),m("click",function(){f(t);let a=c().$implicit,d=c(3);return _(d.activateRouting(a))}),u(1,"i",40),e()}}function yt(r,p){if(r&1){let t=h();n(0,"button",41),m("click",function(){f(t);let a=c().$implicit,d=c(3);return _(d.deactivateRouting(a))}),u(1,"i",42),e()}}function Ot(r,p){if(r&1){let t=h();n(0,"button",43),m("click",function(){f(t);let a=c().$implicit,d=c(3);return _(d.putOnHold(a))}),u(1,"i",44),e()}}function Mt(r,p){if(r&1){let t=h();n(0,"button",45),m("click",function(){f(t);let a=c().$implicit,d=c(3);return _(d.releaseFromHold(a))}),u(1,"i",46),e()}}function Pt(r,p){if(r&1){let t=h();n(0,"button",47),m("click",function(){f(t);let a=c().$implicit,d=c(3);return _(d.deleteRouting(a))}),u(1,"i",48),e()}}function Et(r,p){if(r&1){let t=h();n(0,"tr")(1,"td"),o(2),e(),n(3,"td"),o(4),e(),n(5,"td"),o(6),e(),n(7,"td"),o(8),e(),n(9,"td")(10,"span",30),o(11),e()(),n(12,"td"),o(13),e(),n(14,"td"),o(15),T(16,"date"),e(),n(17,"td",31)(18,"button",32),m("click",function(){let a=f(t).$implicit,d=c(3);return _(d.viewRouting(a))}),u(19,"i",33),e(),x(20,St,2,0,"button",34)(21,yt,2,0,"button",35)(22,Ot,2,0,"button",36)(23,Mt,2,0,"button",37)(24,Pt,2,0,"button",38),e()()}if(r&2){let t=p.$implicit,i=c(3);l(2),g(t.routingId),l(2),g(t.routingName),l(2),g(t.processName||"N/A"),l(2),g(i.getTypeLabel(t.routingType)),l(2),s("ngClass",i.getStatusClass(t.status)),l(),b(" ",t.status," "),l(2),g((t.steps==null?null:t.steps.length)||0),l(2),g(R(16,13,t.createdOn,"short")),l(5),s("ngIf",t.status==="DRAFT"||t.status==="INACTIVE"),l(),s("ngIf",t.status==="ACTIVE"),l(),s("ngIf",t.status!=="ON_HOLD"),l(),s("ngIf",t.status==="ON_HOLD"),l(),s("ngIf",t.status==="DRAFT"||t.status==="INACTIVE")}}function It(r,p){if(r&1&&(n(0,"table",28)(1,"thead")(2,"tr")(3,"th"),o(4,"ID"),e(),n(5,"th"),o(6,"Routing Name"),e(),n(7,"th"),o(8,"Process"),e(),n(9,"th"),o(10,"Type"),e(),n(11,"th"),o(12,"Status"),e(),n(13,"th"),o(14,"Steps"),e(),n(15,"th"),o(16,"Created"),e(),n(17,"th"),o(18,"Actions"),e()()(),n(19,"tbody"),x(20,Et,25,16,"tr",29),e()()),r&2){let t=c(2);l(20),s("ngForOf",t.routings)}}function Tt(r,p){r&1&&(n(0,"div",49)(1,"p"),o(2,"No routings found."),e()())}function Rt(r,p){if(r&1){let t=h();n(0,"app-pagination",50),m("pageChange",function(a){f(t);let d=c(2);return _(d.onPageChange(a))})("sizeChange",function(a){f(t);let d=c(2);return _(d.onSizeChange(a))}),e()}if(r&2){let t=c(2);s("page",t.page)("size",t.size)("totalElements",t.totalElements)("totalPages",t.totalPages)("hasNext",t.hasNext)("hasPrevious",t.hasPrevious)}}function wt(r,p){if(r&1&&(n(0,"div",25),x(1,It,21,1,"table",26)(2,Tt,3,0,"ng-template",null,0,F)(4,Rt,1,6,"app-pagination",27),e()),r&2){let t=N(3),i=c();l(),s("ngIf",i.routings.length>0)("ngIfElse",t),l(3),s("ngIf",i.routings.length>0)}}var mt=(()=>{class r{constructor(t,i){this.apiService=t,this.router=i,this.routings=[],this.loading=!0,this.error="",this.page=0,this.size=20,this.totalElements=0,this.totalPages=0,this.hasNext=!1,this.hasPrevious=!1,this.filterStatus="",this.filterType="",this.searchTerm="",this.statuses=["DRAFT","ACTIVE","INACTIVE","ON_HOLD"],this.routingTypes=["SEQUENTIAL","PARALLEL"]}ngOnInit(){this.loadRoutings()}loadRoutings(){this.loading=!0,this.error="";let t={page:this.page,size:this.size,sortBy:"routingName",sortDirection:"ASC",status:this.filterStatus||void 0,type:this.filterType||void 0,search:this.searchTerm||void 0};this.apiService.getRoutingsPaged(t).subscribe({next:i=>{this.routings=i.content,this.page=i.page,this.size=i.size,this.totalElements=i.totalElements,this.totalPages=i.totalPages,this.hasNext=i.hasNext,this.hasPrevious=i.hasPrevious,this.loading=!1},error:i=>{this.error=i.error?.message||"Failed to load routings",this.loading=!1}})}onPageChange(t){this.page=t,this.loadRoutings()}onSizeChange(t){this.size=t,this.page=0,this.loadRoutings()}onFilterStatusChange(t){this.filterStatus=t==="all"?"":t,this.page=0,this.loadRoutings()}onFilterTypeChange(t){this.filterType=t==="all"?"":t,this.page=0,this.loadRoutings()}onSearchChange(t){this.searchTerm=t,this.page=0,this.loadRoutings()}clearFilters(){this.filterStatus="",this.filterType="",this.searchTerm="",this.page=0,this.loadRoutings()}createRouting(){this.router.navigate(["/manage/routing/new"])}editRouting(t){this.router.navigate(["/manage/routing",t.routingId,"edit"])}viewRouting(t){this.router.navigate(["/manage/routing",t.routingId])}activateRouting(t){confirm(`Activate routing "${t.routingName}"? This will deactivate other routings for the same process.`)&&this.apiService.activateRouting(t.routingId,!0).subscribe({next:()=>{this.loadRoutings()},error:i=>{alert(i.error?.message||"Failed to activate routing")}})}deactivateRouting(t){confirm(`Deactivate routing "${t.routingName}"?`)&&this.apiService.deactivateRouting(t.routingId).subscribe({next:()=>{this.loadRoutings()},error:i=>{alert(i.error?.message||"Failed to deactivate routing")}})}putOnHold(t){let i=prompt("Enter hold reason:");i!==null&&this.apiService.putRoutingOnHold(t.routingId,i).subscribe({next:()=>{this.loadRoutings()},error:a=>{alert(a.error?.message||"Failed to put routing on hold")}})}releaseFromHold(t){confirm(`Release routing "${t.routingName}" from hold?`)&&this.apiService.releaseRoutingFromHold(t.routingId).subscribe({next:()=>{this.loadRoutings()},error:i=>{alert(i.error?.message||"Failed to release routing")}})}deleteRouting(t){confirm(`Delete routing "${t.routingName}"? This cannot be undone.`)&&this.apiService.deleteRouting(t.routingId).subscribe({next:()=>{this.loadRoutings()},error:i=>{alert(i.error?.message||"Failed to delete routing. Only DRAFT/INACTIVE routings without execution can be deleted.")}})}getStatusClass(t){switch(t){case"DRAFT":return"status-draft";case"ACTIVE":return"status-active";case"INACTIVE":return"status-inactive";case"ON_HOLD":return"status-on-hold";default:return""}}getTypeLabel(t){return t==="SEQUENTIAL"?"Sequential":"Parallel"}static{this.\u0275fac=function(i){return new(i||r)(S(I),S(E))}}static{this.\u0275cmp=O({type:r,selectors:[["app-routing-list"]],decls:32,vars:16,consts:[["emptyTpl",""],[1,"routing-list-page"],[1,"page-header"],[1,"page-title"],[1,"btn","btn-primary",3,"click"],[1,"fa","fa-plus"],[1,"card"],[1,"filters"],[1,"filter-group"],["for","status"],["id","status",3,"change","value"],["value","all"],[3,"value",4,"ngFor","ngForOf"],["for","type"],["id","type",3,"change","value"],[1,"filter-group","search-group"],["for","search"],["type","text","id","search","placeholder","Search by name or process...",3,"input","value"],[1,"btn","btn-secondary",3,"click"],["class","loading",4,"ngIf"],["class","error-message",4,"ngIf"],["class","table-container",4,"ngIf"],[3,"value"],[1,"loading"],[1,"error-message"],[1,"table-container"],["class","data-table",4,"ngIf","ngIfElse"],[3,"page","size","totalElements","totalPages","hasNext","hasPrevious","pageChange","sizeChange",4,"ngIf"],[1,"data-table"],[4,"ngFor","ngForOf"],[1,"status-badge",3,"ngClass"],[1,"actions"],["title","View/Edit",1,"btn","btn-sm","btn-secondary",3,"click"],[1,"fa","fa-edit"],["class","btn btn-sm btn-success","title","Activate",3,"click",4,"ngIf"],["class","btn btn-sm btn-warning","title","Deactivate",3,"click",4,"ngIf"],["class","btn btn-sm btn-warning","title","Put On Hold",3,"click",4,"ngIf"],["class","btn btn-sm btn-info","title","Release",3,"click",4,"ngIf"],["class","btn btn-sm btn-danger","title","Delete",3,"click",4,"ngIf"],["title","Activate",1,"btn","btn-sm","btn-success",3,"click"],[1,"fa","fa-check"],["title","Deactivate",1,"btn","btn-sm","btn-warning",3,"click"],[1,"fa","fa-pause"],["title","Put On Hold",1,"btn","btn-sm","btn-warning",3,"click"],[1,"fa","fa-hand"],["title","Release",1,"btn","btn-sm","btn-info",3,"click"],[1,"fa","fa-play"],["title","Delete",1,"btn","btn-sm","btn-danger",3,"click"],[1,"fa","fa-trash"],[1,"empty-state"],[3,"pageChange","sizeChange","page","size","totalElements","totalPages","hasNext","hasPrevious"]],template:function(i,a){i&1&&(n(0,"div",1)(1,"div",2)(2,"h1",3),o(3,"Routing Management"),e(),n(4,"button",4),m("click",function(){return a.createRouting()}),u(5,"i",5),o(6," New Routing "),e()(),n(7,"div",6)(8,"div",7)(9,"div",8)(10,"label",9),o(11,"Status:"),e(),n(12,"select",10),m("change",function(v){return a.onFilterStatusChange(v.target.value)}),n(13,"option",11),o(14,"All Statuses"),e(),x(15,bt,2,2,"option",12),e()(),n(16,"div",8)(17,"label",13),o(18,"Type:"),e(),n(19,"select",14),m("change",function(v){return a.onFilterTypeChange(v.target.value)}),n(20,"option",11),o(21,"All Types"),e(),x(22,ht,2,2,"option",12),e()(),n(23,"div",15)(24,"label",16),o(25,"Search:"),e(),n(26,"input",17),m("input",function(v){return a.onSearchChange(v.target.value)}),e()(),n(27,"button",18),m("click",function(){return a.clearFilters()}),o(28,"Clear"),e()()(),x(29,vt,2,0,"div",19)(30,Ct,2,1,"div",20)(31,wt,5,3,"div",21),e()),i&2&&(l(9),C("filter-active",a.filterStatus),l(3),C("filter-active",a.filterStatus),s("value",a.filterStatus||"all"),l(3),s("ngForOf",a.statuses),l(),C("filter-active",a.filterType),l(3),C("filter-active",a.filterType),s("value",a.filterType||"all"),l(3),s("ngForOf",a.routingTypes),l(4),s("value",a.searchTerm),l(3),s("ngIf",a.loading),l(),s("ngIf",a.error),l(),s("ngIf",!a.loading&&!a.error))},dependencies:[V,M,P,L,z,lt,D],styles:[".routing-list-page[_ngcontent-%COMP%]{padding:24px}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:#1e293b}.summary-cards[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:24px;flex-wrap:wrap}.summary-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:16px 24px;min-width:120px;text-align:center}.summary-card[_ngcontent-%COMP%]   .card-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;color:#1e293b}.summary-card[_ngcontent-%COMP%]   .card-label[_ngcontent-%COMP%]{font-size:.875rem;color:#64748b}.summary-card.draft[_ngcontent-%COMP%]{border-left:4px solid #94a3b8}.summary-card.active[_ngcontent-%COMP%]{border-left:4px solid #22c55e}.summary-card.inactive[_ngcontent-%COMP%]{border-left:4px solid #ef4444}.summary-card.on-hold[_ngcontent-%COMP%]{border-left:4px solid #f59e0b}.filters[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:24px;align-items:center;flex-wrap:wrap}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:#64748b}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .filter-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e2e8f0;border-radius:4px;font-size:.875rem}.filter-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{min-width:200px}.table-container[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:8px;overflow:hidden}.data-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.data-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 16px;text-align:left;border-bottom:1px solid #e2e8f0}.data-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8fafc;font-weight:600;color:#64748b;font-size:.75rem;text-transform:uppercase}.data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:.875rem;color:#1e293b}.data-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8fafc}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:4px;font-size:.75rem;font-weight:500}.status-draft[_ngcontent-%COMP%]{background:#f1f5f9;color:#64748b}.status-active[_ngcontent-%COMP%]{background:#dcfce7;color:#16a34a}.status-inactive[_ngcontent-%COMP%]{background:#fee2e2;color:#dc2626}.status-on-hold[_ngcontent-%COMP%]{background:#fef3c7;color:#d97706}.actions[_ngcontent-%COMP%]{display:flex;gap:8px}.btn[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:4px;cursor:pointer;font-size:.875rem;display:inline-flex;align-items:center;gap:4px}.btn-primary[_ngcontent-%COMP%]{background:#1976d2;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background:#1565c0}.btn-secondary[_ngcontent-%COMP%]{background:#e2e8f0;color:#64748b}.btn-secondary[_ngcontent-%COMP%]:hover{background:#cbd5e1}.btn-success[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.btn-success[_ngcontent-%COMP%]:hover{background:#16a34a}.btn-warning[_ngcontent-%COMP%]{background:#f59e0b;color:#fff}.btn-warning[_ngcontent-%COMP%]:hover{background:#d97706}.btn-danger[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover{background:#dc2626}.btn-info[_ngcontent-%COMP%]{background:#0ea5e9;color:#fff}.btn-info[_ngcontent-%COMP%]:hover{background:#0284c7}.btn-sm[_ngcontent-%COMP%]{padding:4px 8px;font-size:.75rem}.loading[_ngcontent-%COMP%]{text-align:center;padding:48px;color:#64748b}.error-message[_ngcontent-%COMP%]{background:#fee2e2;color:#dc2626;padding:12px 16px;border-radius:4px;margin-bottom:16px}.no-data[_ngcontent-%COMP%]{text-align:center;color:#64748b;padding:24px}"]})}}return r})();function kt(r,p){if(r&1){let t=h();n(0,"button",17),m("click",function(){f(t);let a=c(2);return _(a.activateRouting())}),u(1,"i",18),o(2," Activate "),e()}}function Nt(r,p){if(r&1){let t=h();n(0,"button",19),m("click",function(){f(t);let a=c(2);return _(a.deactivateRouting())}),u(1,"i",20),o(2," Deactivate "),e()}}function Ft(r,p){if(r&1){let t=h();n(0,"button",21),m("click",function(){f(t);let a=c(2);return _(a.putOnHold())}),u(1,"i",22),o(2," Put on Hold "),e()}}function Vt(r,p){if(r&1){let t=h();n(0,"button",17),m("click",function(){f(t);let a=c(2);return _(a.releaseFromHold())}),u(1,"i",23),o(2," Release Hold "),e()}}function Dt(r,p){if(r&1){let t=h();n(0,"div",11)(1,"button",12),m("click",function(){f(t);let a=c();return _(a.editRouting())}),u(2,"i",13),o(3," Edit "),e(),x(4,kt,3,0,"button",14)(5,Nt,3,0,"button",15)(6,Ft,3,0,"button",16)(7,Vt,3,0,"button",14),e()}if(r&2){let t=c();l(4),s("ngIf",t.routing.status==="DRAFT"||t.routing.status==="INACTIVE"),l(),s("ngIf",t.routing.status==="ACTIVE"),l(),s("ngIf",t.routing.status!=="ON_HOLD"),l(),s("ngIf",t.routing.status==="ON_HOLD")}}function At(r,p){r&1&&(n(0,"div",24),u(1,"app-loading-spinner",25),e())}function Lt(r,p){if(r&1&&(n(0,"div",26),o(1),e()),r&2){let t=c();l(),b(" ",t.error," ")}}function zt(r,p){if(r&1&&(n(0,"span",32),o(1),e()),r&2){let t=c().$implicit,i=c(3);s("ngClass",i.getStepStatusClass(t.status)),l(),b(" ",t.status," ")}}function qt(r,p){r&1&&(n(0,"span"),o(1,"-"),e())}function Bt(r,p){if(r&1&&(n(0,"tr")(1,"td"),o(2),e(),n(3,"td"),o(4),e(),n(5,"td"),o(6),e(),n(7,"td")(8,"span",42),o(9),e()(),n(10,"td")(11,"span",43),o(12),e()(),n(13,"td")(14,"span",43),o(15),e()(),n(16,"td")(17,"span",43),o(18),e()(),n(19,"td")(20,"span",43),o(21),e()(),n(22,"td")(23,"span",43),o(24),e()(),n(25,"td"),o(26),e(),n(27,"td"),x(28,zt,2,2,"span",44)(29,qt,2,0,"span",45),e()()),r&2){let t=p.$implicit;l(2),g(t.sequenceNumber),l(2),g(t.operationName),l(2),g(t.operationType),l(3),g(t.operationCode||"-"),l(2),C("flag-yes",t.isParallel)("flag-no",!t.isParallel),l(),b(" ",t.isParallel?"Yes":"No"," "),l(2),C("flag-yes",t.mandatoryFlag)("flag-no",!t.mandatoryFlag),l(),b(" ",t.mandatoryFlag?"Yes":"No"," "),l(2),C("flag-yes",t.producesOutputBatch)("flag-no",!t.producesOutputBatch),l(),b(" ",t.producesOutputBatch?"Yes":"No"," "),l(2),C("flag-yes",t.allowsSplit)("flag-no",!t.allowsSplit),l(),b(" ",t.allowsSplit?"Yes":"No"," "),l(2),C("flag-yes",t.allowsMerge)("flag-no",!t.allowsMerge),l(),b(" ",t.allowsMerge?"Yes":"No"," "),l(2),g(t.estimatedDurationMinutes?t.estimatedDurationMinutes+" min":"-"),l(2),s("ngIf",t.status),l(),s("ngIf",!t.status)}}function $t(r,p){if(r&1&&(n(0,"div",39)(1,"table",40)(2,"thead")(3,"tr")(4,"th"),o(5,"#"),e(),n(6,"th"),o(7,"Operation Name"),e(),n(8,"th"),o(9,"Type"),e(),n(10,"th"),o(11,"Code"),e(),n(12,"th"),o(13,"Parallel"),e(),n(14,"th"),o(15,"Mandatory"),e(),n(16,"th"),o(17,"Output Batch"),e(),n(18,"th"),o(19,"Split"),e(),n(20,"th"),o(21,"Merge"),e(),n(22,"th"),o(23,"Duration"),e(),n(24,"th"),o(25,"Status"),e()()(),n(26,"tbody"),x(27,Bt,30,32,"tr",41),e()()()),r&2){let t=c(2);l(27),s("ngForOf",t.routing.steps)}}function jt(r,p){if(r&1){let t=h();n(0,"div",46)(1,"p"),o(2,"No steps defined for this routing."),e(),n(3,"button",12),m("click",function(){f(t);let a=c(2);return _(a.editRouting())}),u(4,"i",47),o(5," Add Steps "),e()()}}function Ht(r,p){if(r&1&&(n(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30)(4,"h2"),o(5),e(),n(6,"span",31),o(7),e()(),n(8,"span",32),o(9),e()(),n(10,"div",33)(11,"div",34)(12,"h3"),o(13,"Basic Information"),e(),n(14,"div",35)(15,"span",36),o(16,"Routing ID"),e(),n(17,"span",37),o(18),e()(),n(19,"div",35)(20,"span",36),o(21,"Routing Name"),e(),n(22,"span",37),o(23),e()(),n(24,"div",35)(25,"span",36),o(26,"Type"),e(),n(27,"span",37),o(28),e()(),n(29,"div",35)(30,"span",36),o(31,"Process"),e(),n(32,"span",37),o(33),e()()(),n(34,"div",34)(35,"h3"),o(36,"Audit Information"),e(),n(37,"div",35)(38,"span",36),o(39,"Created By"),e(),n(40,"span",37),o(41),e()(),n(42,"div",35)(43,"span",36),o(44,"Created On"),e(),n(45,"span",37),o(46),T(47,"date"),e()(),n(48,"div",35)(49,"span",36),o(50,"Updated By"),e(),n(51,"span",37),o(52),e()(),n(53,"div",35)(54,"span",36),o(55,"Updated On"),e(),n(56,"span",37),o(57),T(58,"date"),e()()()()(),n(59,"div",28)(60,"div",29)(61,"h2"),o(62),e()(),x(63,$t,28,1,"div",38)(64,jt,6,0,"ng-template",null,0,F),e()()),r&2){let t=N(65),i=c();l(5),g(i.routing.routingName),l(2),g(i.getTypeLabel(i.routing.routingType)),l(),s("ngClass",i.getStatusClass(i.routing.status)),l(),b(" ",i.routing.status," "),l(9),g(i.routing.routingId),l(5),g(i.routing.routingName),l(5),g(i.getTypeLabel(i.routing.routingType)),l(5),g(i.routing.processName||"N/A"),l(8),g(i.routing.createdBy||"-"),l(5),g(i.routing.createdOn?R(47,15,i.routing.createdOn,"medium"):"-"),l(6),g(i.routing.updatedBy||"-"),l(5),g(i.routing.updatedOn?R(58,18,i.routing.updatedOn,"medium"):"-"),l(5),b("Routing Steps (",(i.routing.steps==null?null:i.routing.steps.length)||0,")"),l(),s("ngIf",i.routing.steps&&i.routing.steps.length>0)("ngIfElse",t)}}var gt=(()=>{class r{constructor(t,i,a){this.route=t,this.router=i,this.apiService=a,this.routing=null,this.loading=!0,this.error=null}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t?this.loadRouting(+t):(this.error="No routing ID provided",this.loading=!1)}loadRouting(t){this.loading=!0,this.error=null,this.apiService.getRoutingById(t).subscribe({next:i=>{this.routing=i,this.routing?.steps&&this.routing.steps.sort((a,d)=>a.sequenceNumber-d.sequenceNumber),this.loading=!1},error:i=>{console.error("Error loading routing:",i),this.error="Failed to load routing",this.loading=!1}})}editRouting(){this.routing&&this.router.navigate(["/manage/routing",this.routing.routingId,"edit"])}goBack(){this.router.navigate(["/manage/routing"])}activateRouting(){this.routing&&confirm(`Activate routing "${this.routing.routingName}"? This will deactivate other routings for the same process.`)&&this.apiService.activateRouting(this.routing.routingId,!0).subscribe({next:()=>{this.loadRouting(this.routing.routingId)},error:t=>{console.error("Error activating routing:",t),this.error=t.error?.message||"Failed to activate routing"}})}deactivateRouting(){this.routing&&confirm(`Deactivate routing "${this.routing.routingName}"?`)&&this.apiService.deactivateRouting(this.routing.routingId).subscribe({next:()=>{this.loadRouting(this.routing.routingId)},error:t=>{console.error("Error deactivating routing:",t),this.error=t.error?.message||"Failed to deactivate routing"}})}putOnHold(){if(!this.routing)return;let t=prompt("Enter hold reason:");t!==null&&this.apiService.putRoutingOnHold(this.routing.routingId,t).subscribe({next:()=>{this.loadRouting(this.routing.routingId)},error:i=>{console.error("Error putting on hold:",i),this.error=i.error?.message||"Failed to put routing on hold"}})}releaseFromHold(){this.routing&&confirm(`Release routing "${this.routing.routingName}" from hold?`)&&this.apiService.releaseRoutingFromHold(this.routing.routingId).subscribe({next:()=>{this.loadRouting(this.routing.routingId)},error:t=>{console.error("Error releasing from hold:",t),this.error=t.error?.message||"Failed to release routing from hold"}})}getStatusClass(t){switch(t?.toUpperCase()){case"DRAFT":return"status-draft";case"ACTIVE":return"status-active";case"INACTIVE":return"status-inactive";case"ON_HOLD":return"status-on-hold";default:return""}}getTypeLabel(t){return t==="SEQUENTIAL"?"Sequential":"Parallel"}getStepStatusClass(t){switch(t?.toUpperCase()){case"ACTIVE":return"status-active";case"INACTIVE":return"status-inactive";case"NOT_STARTED":return"status-draft";case"READY":return"status-active";case"IN_PROGRESS":return"status-in-progress";case"CONFIRMED":return"status-confirmed";default:return""}}static{this.\u0275fac=function(i){return new(i||r)(S(A),S(E),S(I))}}static{this.\u0275cmp=O({type:r,selectors:[["app-routing-detail"]],decls:12,vars:4,consts:[["noSteps",""],[1,"detail-container"],[1,"page-header"],[1,"header-left"],[1,"btn","btn-back",3,"click"],[1,"fas","fa-arrow-left"],[1,"page-title"],["class","header-actions",4,"ngIf"],["class","loading",4,"ngIf"],["class","error-message",4,"ngIf"],["class","detail-content",4,"ngIf"],[1,"header-actions"],[1,"btn","btn-secondary",3,"click"],[1,"fas","fa-edit"],["class","btn btn-success",3,"click",4,"ngIf"],["class","btn btn-warning",3,"click",4,"ngIf"],["class","btn btn-danger",3,"click",4,"ngIf"],[1,"btn","btn-success",3,"click"],[1,"fas","fa-check"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-pause"],[1,"btn","btn-danger",3,"click"],[1,"fas","fa-ban"],[1,"fas","fa-play"],[1,"loading"],["message","Loading routing..."],[1,"error-message"],[1,"detail-content"],[1,"detail-card"],[1,"card-header"],[1,"header-title"],[1,"type-badge"],[1,"status-badge",3,"ngClass"],[1,"detail-grid"],[1,"detail-section"],[1,"detail-row"],[1,"label"],[1,"value"],["class","steps-content",4,"ngIf","ngIfElse"],[1,"steps-content"],[1,"steps-table"],[4,"ngFor","ngForOf"],[1,"code-value"],[1,"flag-badge"],["class","status-badge",3,"ngClass",4,"ngIf"],[4,"ngIf"],[1,"empty-state"],[1,"fas","fa-plus"]],template:function(i,a){i&1&&(n(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),m("click",function(){return a.goBack()}),u(4,"i",5),o(5," Back "),e(),n(6,"h1",6),o(7,"Routing Details"),e()(),x(8,Dt,8,4,"div",7),e(),x(9,At,2,0,"div",8)(10,Lt,2,1,"div",9)(11,Ht,66,21,"div",10),e()),i&2&&(l(8),s("ngIf",a.routing),l(),s("ngIf",a.loading),l(),s("ngIf",a.error),l(),s("ngIf",!a.loading&&a.routing))},dependencies:[V,M,P,at,D],styles:[".detail-container[_ngcontent-%COMP%]{padding:24px}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:600;color:#1e293b}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:48px}.error-message[_ngcontent-%COMP%]{background:#fef2f2;border:1px solid #fecaca;color:#dc2626;padding:12px 16px;border-radius:8px;margin-bottom:16px}.detail-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.detail-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:8px;overflow:hidden}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;background:#f8fafc;border-bottom:1px solid #e2e8f0}.header-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600;color:#1e293b}.detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px;padding:24px}.detail-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.detail-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;font-size:14px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:.05em}.detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f1f5f9}.detail-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.label[_ngcontent-%COMP%]{color:#64748b;font-size:14px}.value[_ngcontent-%COMP%]{color:#1e293b;font-weight:500;font-size:14px}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase}.status-draft[_ngcontent-%COMP%]{background:#f1f5f9;color:#64748b}.status-active[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.status-inactive[_ngcontent-%COMP%]{background:#fee2e2;color:#dc2626}.status-on-hold[_ngcontent-%COMP%]{background:#fef3c7;color:#b45309}.status-in-progress[_ngcontent-%COMP%]{background:#dbeafe;color:#1d4ed8}.status-confirmed[_ngcontent-%COMP%]{background:#e0e7ff;color:#4338ca}.type-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 10px;border-radius:6px;font-size:12px;font-weight:500;background:#f1f5f9;color:#475569}.steps-content[_ngcontent-%COMP%]{overflow-x:auto}.steps-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.steps-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .steps-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 16px;text-align:left;border-bottom:1px solid #e2e8f0}.steps-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8fafc;font-weight:600;color:#64748b;font-size:12px;text-transform:uppercase;letter-spacing:.05em}.steps-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:14px;color:#1e293b}.steps-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8fafc}.steps-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.code-value[_ngcontent-%COMP%]{font-family:monospace;background:#f1f5f9;padding:2px 8px;border-radius:4px;font-size:13px}.flag-badge[_ngcontent-%COMP%]{display:inline-block;padding:2px 8px;border-radius:4px;font-size:12px;font-weight:500}.flag-yes[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.flag-no[_ngcontent-%COMP%]{background:#f1f5f9;color:#94a3b8}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px 24px;color:#64748b}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 16px;font-size:14px}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color .2s}.btn-back[_ngcontent-%COMP%]{background:transparent;color:#64748b;padding:8px 12px}.btn-back[_ngcontent-%COMP%]:hover{background:#f1f5f9;color:#1e293b}.btn-secondary[_ngcontent-%COMP%]{background:#f1f5f9;color:#475569}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e2e8f0}.btn-success[_ngcontent-%COMP%]{background:#dcfce7;color:#166534;border:1px solid #bbf7d0}.btn-success[_ngcontent-%COMP%]:hover{background:#bbf7d0}.btn-warning[_ngcontent-%COMP%]{background:#fef3c7;color:#b45309;border:1px solid #fcd34d}.btn-warning[_ngcontent-%COMP%]:hover{background:#fde68a}.btn-danger[_ngcontent-%COMP%]{background:#fef2f2;color:#dc2626;border:1px solid #fecaca}.btn-danger[_ngcontent-%COMP%]:hover{background:#fee2e2}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}.header-actions[_ngcontent-%COMP%]{flex-wrap:wrap}.detail-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.steps-content[_ngcontent-%COMP%]{overflow-x:auto}}"]})}}return r})();function Ut(r,p){r&1&&(n(0,"div",7),o(1,"Loading..."),e())}function Gt(r,p){if(r&1&&(n(0,"div",8),o(1),e()),r&2){let t=c();l(),g(t.error)}}function Yt(r,p){r&1&&(n(0,"div",29),o(1,"Routing name is required"),e())}function Qt(r,p){if(r&1&&(n(0,"option",30),o(1),e()),r&2){let t=p.$implicit;s("value",t.processId),l(),j(" ",t.processName," (",t.status,") ")}}function Kt(r,p){r&1&&(n(0,"div",29),o(1,"Process is required"),e())}function Zt(r,p){if(r&1&&(n(0,"option",30),o(1),e()),r&2){let t=p.$implicit;s("value",t.value),l(),g(t.label)}}function Jt(r,p){if(r&1&&(n(0,"span",49),o(1),e()),r&2){let t=c().$implicit,i=c(3);l(),b(" ",i.getTemplateName(t.operationTemplateId)," ")}}function Wt(r,p){r&1&&(n(0,"span",50),o(1,"Manual"),e())}function Xt(r,p){r&1&&(n(0,"span",51),o(1,"OUT"),e())}function te(r,p){r&1&&(n(0,"span",52),o(1,"SPLIT"),e())}function ee(r,p){r&1&&(n(0,"span",53),o(1,"MERGE"),e())}function ne(r,p){r&1&&(n(0,"span"),o(1,"-"),e())}function ie(r,p){if(r&1){let t=h();n(0,"tr")(1,"td"),o(2),e(),n(3,"td"),x(4,Jt,2,1,"span",33)(5,Wt,2,0,"span",34),e(),n(6,"td"),o(7),e(),n(8,"td"),o(9),e(),n(10,"td")(11,"span"),o(12),e()(),n(13,"td")(14,"span"),o(15),e()(),n(16,"td",35),x(17,Xt,2,0,"span",36)(18,te,2,0,"span",37)(19,ee,2,0,"span",38)(20,ne,2,0,"span",39),e(),n(21,"td",40)(22,"button",41),m("click",function(){let a=f(t).index,d=c(3);return _(d.moveStepUp(a))}),u(23,"i",42),e(),n(24,"button",43),m("click",function(){let a=f(t).index,d=c(3);return _(d.moveStepDown(a))}),u(25,"i",44),e(),n(26,"button",45),m("click",function(){let a=f(t),d=a.$implicit,v=a.index,ft=c(3);return _(ft.openEditStep(d,v))}),u(27,"i",46),e(),n(28,"button",47),m("click",function(){let a=f(t).index,d=c(3);return _(d.deleteStep(a))}),u(29,"i",48),e()()()}if(r&2){let t=p.$implicit,i=p.index,a=c(3);l(2),g(t.sequenceNumber),l(2),s("ngIf",t.operationTemplateId),l(),s("ngIf",!t.operationTemplateId),l(2),g(t.operationName),l(2),g(t.operationType),l(2),C("yes",t.isParallel)("no",!t.isParallel),l(),b(" ",t.isParallel?"Yes":"No"," "),l(2),C("yes",t.mandatoryFlag)("no",!t.mandatoryFlag),l(),b(" ",t.mandatoryFlag?"Yes":"No"," "),l(2),s("ngIf",t.producesOutputBatch),l(),s("ngIf",t.allowsSplit),l(),s("ngIf",t.allowsMerge),l(),s("ngIf",!t.producesOutputBatch&&!t.allowsSplit&&!t.allowsMerge),l(2),s("disabled",i===0),l(2),s("disabled",i===a.steps.length-1),l(4),s("disabled",t.mandatoryFlag)}}function oe(r,p){if(r&1&&(n(0,"table",31)(1,"thead")(2,"tr")(3,"th"),o(4,"Seq"),e(),n(5,"th"),o(6,"Template"),e(),n(7,"th"),o(8,"Operation Name"),e(),n(9,"th"),o(10,"Type"),e(),n(11,"th"),o(12,"Parallel"),e(),n(13,"th"),o(14,"Mandatory"),e(),n(15,"th"),o(16,"Batch Flags"),e(),n(17,"th"),o(18,"Actions"),e()()(),n(19,"tbody"),x(20,ie,30,22,"tr",32),e()()),r&2){let t=c(2);l(20),s("ngForOf",t.steps)}}function re(r,p){r&1&&(n(0,"div",54),o(1," No steps defined. Add steps to define the operation sequence. "),e())}function ae(r,p){if(r&1){let t=h();n(0,"form",9),m("ngSubmit",function(){f(t);let a=c();return _(a.onSubmit())}),n(1,"div",10)(2,"h2"),o(3,"Routing Details"),e(),n(4,"div",11)(5,"label",12),o(6,"Routing Name *"),e(),u(7,"input",13),x(8,Yt,2,0,"div",14),e(),n(9,"div",11)(10,"label",15),o(11,"Process *"),e(),n(12,"select",16)(13,"option",17),o(14,"Select a process"),e(),x(15,Qt,2,3,"option",18),e(),x(16,Kt,2,0,"div",14),e(),n(17,"div",11)(18,"label",19),o(19,"Routing Type *"),e(),n(20,"select",20),x(21,Zt,2,2,"option",18),e()()(),n(22,"div",10)(23,"div",21)(24,"h2"),o(25,"Routing Steps"),e(),n(26,"button",22),m("click",function(){f(t);let a=c();return _(a.openAddStep())}),u(27,"i",23),o(28," Add Step "),e()(),x(29,oe,21,1,"table",24)(30,re,2,0,"div",25),e(),n(31,"div",26)(32,"button",27),m("click",function(){f(t);let a=c();return _(a.cancel())}),o(33,"Cancel"),e(),n(34,"button",28),o(35),e()()()}if(r&2){let t=c();s("formGroup",t.form),l(8),s("ngIf",t.hasError("routingName")),l(7),s("ngForOf",t.processes),l(),s("ngIf",t.hasError("processId")),l(5),s("ngForOf",t.routingTypes),l(8),s("ngIf",t.steps.length>0),l(),s("ngIf",t.steps.length===0),l(4),s("disabled",t.saving),l(),b(" ",t.saving?"Saving...":t.isEditMode?"Update Routing":"Create Routing"," ")}}function le(r,p){if(r&1&&(n(0,"option",64),o(1),e()),r&2){let t=p.$implicit;s("ngValue",t.operationTemplateId),l(),j(" ",t.operationName," (",t.operationType,") ")}}function se(r,p){r&1&&(n(0,"div",29),o(1,"Required when no template selected"),e())}function pe(r,p){if(r&1&&(n(0,"option",30),o(1),e()),r&2){let t=p.$implicit;s("value",t),l(),g(t)}}function ce(r,p){r&1&&(n(0,"div",29),o(1,"Required when no template selected"),e())}function de(r,p){r&1&&(n(0,"div",29),o(1,"Must be positive"),e())}function me(r,p){if(r&1){let t=h();n(0,"div",55),m("click",function(){f(t);let a=c();return _(a.closeStepModal())}),n(1,"div",56),m("click",function(a){return f(t),_(a.stopPropagation())}),n(2,"div",57)(3,"h3"),o(4),e(),n(5,"button",58),m("click",function(){f(t);let a=c();return _(a.closeStepModal())}),o(6,"\xD7"),e()(),n(7,"div",59)(8,"form",60)(9,"div",61)(10,"label",62),o(11,"Operation Template"),e(),n(12,"select",63),m("change",function(a){f(t);let d=c();return _(d.onTemplateChange(a))}),n(13,"option",64),o(14,"-- No Template (Manual Entry) --"),e(),x(15,le,2,3,"option",65),e(),n(16,"div",66),o(17,"Select a template to auto-populate operation details, or enter manually below."),e()(),n(18,"div",67)(19,"div",11)(20,"label",68),o(21),e(),u(22,"input",69),x(23,se,2,0,"div",14),e(),n(24,"div",11)(25,"label",70),o(26),e(),n(27,"select",71)(28,"option",17),o(29,"Select type"),e(),x(30,pe,2,2,"option",18),e(),x(31,ce,2,0,"div",14),e()(),n(32,"div",67)(33,"div",11)(34,"label",72),o(35,"Operation Code"),e(),u(36,"input",73),e(),n(37,"div",11)(38,"label",74),o(39,"Sequence Number *"),e(),u(40,"input",75),x(41,de,2,0,"div",14),e()(),n(42,"div",67)(43,"div",11)(44,"label",76),o(45,"Estimated Duration (min)"),e(),u(46,"input",77),e()(),n(47,"div",11)(48,"label",78),o(49,"Description"),e(),u(50,"textarea",79),e(),n(51,"div",80)(52,"label",81),u(53,"input",82),n(54,"span"),o(55,"Can run in parallel with other steps at same sequence"),e()(),n(56,"label",81),u(57,"input",83),n(58,"span"),o(59,"Mandatory step (cannot be skipped)"),e()()(),n(60,"div",80)(61,"h4"),o(62,"Batch Behavior"),e(),n(63,"label",81),u(64,"input",84),n(65,"span"),o(66,"Produces output batch"),e()(),n(67,"label",81),u(68,"input",85),n(69,"span"),o(70,"Allows batch split"),e()(),n(71,"label",81),u(72,"input",86),n(73,"span"),o(74,"Allows batch merge"),e()()()()(),n(75,"div",87)(76,"button",27),m("click",function(){f(t);let a=c();return _(a.closeStepModal())}),o(77,"Cancel"),e(),n(78,"button",22),m("click",function(){f(t);let a=c();return _(a.saveStep())}),o(79),e()()()()}if(r&2){let t,i,a=c();l(4),g(a.editingStep?"Edit Step":"Add Step"),l(4),s("formGroup",a.stepForm),l(5),s("ngValue",null),l(2),s("ngForOf",a.operationTemplates),l(6),b("Operation Name ",(t=a.stepForm.get("operationTemplateId"))!=null&&t.value?"":"*",""),l(2),s("ngIf",a.hasStepError("operationName")),l(3),b("Operation Type ",(i=a.stepForm.get("operationTemplateId"))!=null&&i.value?"":"*",""),l(4),s("ngForOf",a.operationTypes),l(),s("ngIf",a.hasStepError("operationType")),l(10),s("ngIf",a.hasStepError("sequenceNumber")),l(38),b(" ",a.editingStep?"Update Step":"Add Step"," ")}}var U=(()=>{class r{constructor(t,i,a,d){this.fb=t,this.apiService=i,this.router=a,this.route=d,this.isEditMode=!1,this.routingId=null,this.loading=!1,this.saving=!1,this.error="",this.processes=[],this.steps=[],this.operationTemplates=[],this.showStepModal=!1,this.editingStep=null,this.editingStepIndex=null,this.routingTypes=[{value:"SEQUENTIAL",label:"Sequential"},{value:"PARALLEL",label:"Parallel"}],this.operationTypes=["MELTING","CASTING","ROLLING","CUTTING","INSPECTION","PACKAGING","OTHER"]}ngOnInit(){this.initForms(),this.loadProcesses(),this.loadOperationTemplates();let t=this.route.snapshot.paramMap.get("id");t&&(this.isEditMode=!0,this.routingId=+t,this.loadRouting(this.routingId))}initForms(){this.form=this.fb.group({routingName:["",[y.required,y.maxLength(100)]],processId:["",y.required],routingType:["SEQUENTIAL",y.required]}),this.stepForm=this.fb.group({operationTemplateId:[null],operationName:["",[y.maxLength(100)]],operationType:[""],operationCode:["",y.maxLength(50)],sequenceNumber:[1,[y.required,y.min(1)]],isParallel:[!1],mandatoryFlag:[!0],producesOutputBatch:[!1],allowsSplit:[!1],allowsMerge:[!1],estimatedDurationMinutes:[null,y.min(1)],description:["",y.maxLength(500)]})}loadProcesses(){this.apiService.getAllProcesses().subscribe({next:t=>{this.processes=t},error:t=>{console.error("Failed to load processes",t)}})}loadOperationTemplates(){this.apiService.getActiveOperationTemplates().subscribe({next:t=>{this.operationTemplates=t},error:t=>{console.error("Failed to load operation templates",t)}})}onTemplateChange(t){let i=t.target,a=i.value?+i.value:null;if(a){let d=this.operationTemplates.find(v=>v.operationTemplateId===a);d&&(this.stepForm.patchValue({operationName:d.operationName,operationType:d.operationType,operationCode:d.operationCode||""}),this.apiService.getOperationTemplateById(a).subscribe({next:v=>{v.estimatedDurationMinutes&&this.stepForm.patchValue({estimatedDurationMinutes:v.estimatedDurationMinutes})}}))}else this.stepForm.patchValue({operationName:"",operationType:"",operationCode:"",estimatedDurationMinutes:null})}loadRouting(t){this.loading=!0,this.apiService.getRoutingById(t).subscribe({next:i=>{this.form.patchValue({routingName:i.routingName,processId:i.processId,routingType:i.routingType}),this.steps=(i.steps||[]).map(a=>({routingStepId:a.routingStepId,operationTemplateId:a.operationTemplateId||null,operationName:a.operationName||"",operationType:a.operationType||"",operationCode:a.operationCode||"",sequenceNumber:a.sequenceNumber,isParallel:a.isParallel||!1,mandatoryFlag:a.mandatoryFlag!==!1,producesOutputBatch:a.producesOutputBatch||!1,allowsSplit:a.allowsSplit||!1,allowsMerge:a.allowsMerge||!1,status:a.status,estimatedDurationMinutes:a.estimatedDurationMinutes,description:a.description})),this.loading=!1},error:i=>{this.error=i.error?.message||"Failed to load routing",this.loading=!1}})}onSubmit(){if(this.form.invalid){Object.keys(this.form.controls).forEach(i=>{this.form.get(i)?.markAsTouched()});return}this.saving=!0,this.error="";let t=$(B({},this.form.value),{processId:+this.form.value.processId});this.isEditMode&&this.routingId?this.apiService.updateRouting(this.routingId,t).subscribe({next:()=>{this.saving=!1,this.router.navigate(["/manage/routing"])},error:i=>{this.error=i.error?.message||"Failed to update routing",this.saving=!1}}):this.apiService.createRouting(t).subscribe({next:i=>{this.steps.length>0?this.saveSteps(i.routingId):(this.saving=!1,this.router.navigate(["/manage/routing"]))},error:i=>{this.error=i.error?.message||"Failed to create routing",this.saving=!1}})}saveSteps(t){let i=0;for(let a of this.steps)a.routingStepId?i++:this.apiService.createRoutingStep(t,a).subscribe({next:()=>{i++,i===this.steps.filter(d=>!d.routingStepId).length&&(this.saving=!1,this.router.navigate(["/manage/routing"]))},error:d=>{console.error("Failed to save step",d)}});i===this.steps.length&&(this.saving=!1,this.router.navigate(["/manage/routing"]))}cancel(){this.router.navigate(["/manage/routing"])}openAddStep(){this.editingStep=null,this.editingStepIndex=null,this.stepForm.reset({operationTemplateId:null,operationName:"",operationType:"",operationCode:"",sequenceNumber:this.steps.length+1,isParallel:!1,mandatoryFlag:!0,producesOutputBatch:!1,allowsSplit:!1,allowsMerge:!1,estimatedDurationMinutes:null,description:""}),this.showStepModal=!0}openEditStep(t,i){this.editingStep=t,this.editingStepIndex=i,this.stepForm.patchValue({operationTemplateId:t.operationTemplateId||null,operationName:t.operationName,operationType:t.operationType,operationCode:t.operationCode||"",sequenceNumber:t.sequenceNumber,isParallel:t.isParallel,mandatoryFlag:t.mandatoryFlag,producesOutputBatch:t.producesOutputBatch||!1,allowsSplit:t.allowsSplit||!1,allowsMerge:t.allowsMerge||!1,estimatedDurationMinutes:t.estimatedDurationMinutes||null,description:t.description||""}),this.showStepModal=!0}closeStepModal(){this.showStepModal=!1,this.editingStep=null,this.editingStepIndex=null}saveStep(){let t=this.stepForm.value;if(!t.operationTemplateId&&!t.operationName){this.stepForm.get("operationName")?.setErrors({required:!0}),this.stepForm.get("operationName")?.markAsTouched();return}if(!t.operationTemplateId&&!t.operationType){this.stepForm.get("operationType")?.setErrors({required:!0}),this.stepForm.get("operationType")?.markAsTouched();return}if(this.stepForm.invalid){Object.keys(this.stepForm.controls).forEach(a=>{this.stepForm.get(a)?.markAsTouched()});return}let i=$(B({},t),{operationTemplateId:t.operationTemplateId?+t.operationTemplateId:void 0,routingStepId:this.editingStep?.routingStepId});this.editingStepIndex!==null?(this.steps[this.editingStepIndex]=i,i.routingStepId&&this.routingId&&this.apiService.updateRoutingStep(i.routingStepId,i).subscribe({error:a=>console.error("Failed to update step",a)})):(this.steps.push(i),this.routingId&&this.apiService.createRoutingStep(this.routingId,i).subscribe({next:a=>{let d=this.steps.findIndex(v=>v===i);d>=0&&(this.steps[d].routingStepId=a.routingStepId)},error:a=>console.error("Failed to create step",a)})),this.closeStepModal()}deleteStep(t){let i=this.steps[t];if(i.mandatoryFlag){alert("Cannot delete mandatory step");return}confirm("Delete this step?")&&(i.routingStepId?this.apiService.deleteRoutingStep(i.routingStepId).subscribe({next:()=>{this.steps.splice(t,1)},error:a=>{alert(a.error?.message||"Failed to delete step")}}):this.steps.splice(t,1))}moveStepUp(t){if(t>0){let i=this.steps[t];this.steps[t]=this.steps[t-1],this.steps[t-1]=i,this.updateSequenceNumbers()}}moveStepDown(t){if(t<this.steps.length-1){let i=this.steps[t];this.steps[t]=this.steps[t+1],this.steps[t+1]=i,this.updateSequenceNumbers()}}updateSequenceNumbers(){if(this.steps.forEach((t,i)=>{t.sequenceNumber=i+1}),this.routingId&&this.steps.every(t=>t.routingStepId)){let t=this.steps.map(i=>i.routingStepId);this.apiService.reorderRoutingSteps(this.routingId,t).subscribe({error:i=>console.error("Failed to reorder steps",i)})}}hasError(t){let i=this.form.get(t);return!!i&&i.invalid&&i.touched}hasStepError(t){let i=this.stepForm.get(t);return!!i&&i.invalid&&i.touched}get title(){return this.isEditMode?"Edit Routing":"Create Routing"}getTemplateName(t){if(!t)return"-";let i=this.operationTemplates.find(a=>a.operationTemplateId===t);return i?i.operationName:`Template #${t}`}static{this.\u0275fac=function(i){return new(i||r)(S(it),S(I),S(E),S(A))}}static{this.\u0275cmp=O({type:r,selectors:[["app-routing-form"]],decls:8,vars:5,consts:[[1,"routing-form-page"],[1,"page-header"],[1,"page-title"],["class","loading",4,"ngIf"],["class","error-message",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"loading"],[1,"error-message"],[3,"ngSubmit","formGroup"],[1,"form-section"],[1,"form-group"],["for","routingName"],["type","text","id","routingName","formControlName","routingName","placeholder","Enter routing name"],["class","field-error",4,"ngIf"],["for","processId"],["id","processId","formControlName","processId"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","routingType"],["id","routingType","formControlName","routingType"],[1,"section-header"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-plus"],["class","steps-table",4,"ngIf"],["class","no-steps",4,"ngIf"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"field-error"],[3,"value"],[1,"steps-table"],[4,"ngFor","ngForOf"],["class","template-ref","title","Uses template",4,"ngIf"],["class","manual-entry",4,"ngIf"],[1,"batch-flags"],["class","flag","title","Produces Output Batch",4,"ngIf"],["class","flag","title","Allows Split",4,"ngIf"],["class","flag","title","Allows Merge",4,"ngIf"],[4,"ngIf"],[1,"actions"],["type","button","title","Move Up",1,"btn","btn-sm",3,"click","disabled"],[1,"fa","fa-arrow-up"],["type","button","title","Move Down",1,"btn","btn-sm",3,"click","disabled"],[1,"fa","fa-arrow-down"],["type","button","title","Edit",1,"btn","btn-sm","btn-secondary",3,"click"],[1,"fa","fa-edit"],["type","button","title","Delete",1,"btn","btn-sm","btn-danger",3,"click","disabled"],[1,"fa","fa-trash"],["title","Uses template",1,"template-ref"],[1,"manual-entry"],["title","Produces Output Batch",1,"flag"],["title","Allows Split",1,"flag"],["title","Allows Merge",1,"flag"],[1,"no-steps"],[1,"modal-overlay",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],["type","button",1,"close-btn",3,"click"],[1,"modal-body"],[3,"formGroup"],[1,"form-group","template-select"],["for","operationTemplateId"],["id","operationTemplateId","formControlName","operationTemplateId",3,"change"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"hint"],[1,"form-row"],["for","operationName"],["type","text","id","operationName","formControlName","operationName","placeholder","e.g., Melting"],["for","operationType"],["id","operationType","formControlName","operationType"],["for","operationCode"],["type","text","id","operationCode","formControlName","operationCode","placeholder","e.g., OP-001"],["for","sequenceNumber"],["type","number","id","sequenceNumber","formControlName","sequenceNumber","min","1"],["for","estimatedDurationMinutes"],["type","number","id","estimatedDurationMinutes","formControlName","estimatedDurationMinutes","min","1"],["for","description"],["id","description","formControlName","description","rows","2"],[1,"checkbox-group"],[1,"checkbox-label"],["type","checkbox","formControlName","isParallel"],["type","checkbox","formControlName","mandatoryFlag"],["type","checkbox","formControlName","producesOutputBatch"],["type","checkbox","formControlName","allowsSplit"],["type","checkbox","formControlName","allowsMerge"],[1,"modal-footer"]],template:function(i,a){i&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),o(3),e()(),x(4,Ut,2,0,"div",3)(5,Gt,2,1,"div",4)(6,ae,36,9,"form",5),e(),x(7,me,80,11,"div",6)),i&2&&(l(3),g(a.title),l(),s("ngIf",a.loading),l(),s("ngIf",a.error),l(),s("ngIf",!a.loading),l(),s("ngIf",a.showStepModal))},dependencies:[M,P,J,L,z,Q,W,Y,et,K,Z,nt,X,tt],styles:[".routing-form-page[_ngcontent-%COMP%]{padding:24px;max-width:1000px;margin:0 auto}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 24px;font-size:1.5rem;color:#1e293b}.form-section[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:24px;margin-bottom:24px}.form-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 16px;font-size:1.125rem;color:#1e293b}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.form-group[_ngcontent-%COMP%]{margin-bottom:16px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:4px;font-size:.875rem;font-weight:500;color:#64748b}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #e2e8f0;border-radius:4px;font-size:.875rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}.field-error[_ngcontent-%COMP%]{color:#dc2626;font-size:.75rem;margin-top:4px}.steps-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.steps-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .steps-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid #e2e8f0}.steps-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8fafc;font-weight:600;font-size:.75rem;text-transform:uppercase;color:#64748b}.steps-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:.875rem}.steps-table[_ngcontent-%COMP%]   .yes[_ngcontent-%COMP%]{color:#16a34a}.steps-table[_ngcontent-%COMP%]   .no[_ngcontent-%COMP%]{color:#64748b}.batch-flags[_ngcontent-%COMP%]{display:flex;gap:4px}.batch-flags[_ngcontent-%COMP%]   .flag[_ngcontent-%COMP%]{display:inline-block;padding:2px 6px;border-radius:4px;font-size:.625rem;font-weight:600;background:#e0f2fe;color:#0284c7}.actions[_ngcontent-%COMP%]{display:flex;gap:4px}.no-steps[_ngcontent-%COMP%]{text-align:center;padding:32px;color:#64748b;background:#f8fafc;border-radius:4px}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;padding-top:16px}.btn[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:4px;cursor:pointer;font-size:.875rem;display:inline-flex;align-items:center;gap:6px}.btn-primary[_ngcontent-%COMP%]{background:#1976d2;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#1565c0}.btn-secondary[_ngcontent-%COMP%]{background:#e2e8f0;color:#64748b}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#cbd5e1}.btn-danger[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#dc2626}.btn-sm[_ngcontent-%COMP%]{padding:4px 8px;font-size:.75rem}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal[_ngcontent-%COMP%]{background:#fff;border-radius:8px;width:90%;max-width:600px;max-height:90vh;overflow-y:auto}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #e2e8f0}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.125rem}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;cursor:pointer;color:#64748b}.modal-body[_ngcontent-%COMP%]{padding:24px}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;padding:16px 24px;border-top:1px solid #e2e8f0}.checkbox-group[_ngcontent-%COMP%]{margin-top:16px}.checkbox-group[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;font-size:.875rem;color:#64748b}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px;cursor:pointer}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:auto}.checkbox-label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.875rem;color:#1e293b}.loading[_ngcontent-%COMP%]{text-align:center;padding:48px;color:#64748b}.error-message[_ngcontent-%COMP%]{background:#fee2e2;color:#dc2626;padding:12px 16px;border-radius:4px;margin-bottom:16px}.template-select[_ngcontent-%COMP%]{margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid #e2e8f0}.template-select[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{background:#f0f9ff;border-color:#0ea5e9}.hint[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b;margin-top:4px}.template-ref[_ngcontent-%COMP%]{display:inline-block;padding:2px 8px;background:#e0f2fe;color:#0369a1;border-radius:4px;font-size:.75rem;font-weight:500}.manual-entry[_ngcontent-%COMP%]{display:inline-block;padding:2px 8px;background:#f1f5f9;color:#64748b;border-radius:4px;font-size:.75rem;font-style:italic}"]})}}return r})();var ge=[{path:"",component:mt},{path:"new",component:U},{path:":id",component:gt},{path:":id/edit",component:U}],ut=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=k({type:r})}static{this.\u0275inj=w({imports:[H.forChild(ge),H]})}}return r})();var Ae=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=k({type:r})}static{this.\u0275inj=w({imports:[G,ot,rt,ut,st]})}}return r})();export{Ae as RoutingModule};
