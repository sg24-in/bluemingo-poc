import{c as q}from"./chunk-GOYRN6BK.js";import{g as J}from"./chunk-ADU7FNXD.js";import"./chunk-ZJBKTRW2.js";import"./chunk-FP6K47HW.js";import{A as i,Aa as W,B as n,C as h,Ca as z,D as L,E as k,Ea as j,G as S,H as M,I as m,M as A,Ma as B,N as o,Na as H,O as d,Oa as G,P as V,Q as F,T as C,Ta as $,U as E,V as v,aa as b,ca as N,da as U,ea as R,h as x,j as O,k as y,ka as D,m as g,n as _,r,s as I,u as f,w as c,xa as T,y as P}from"./chunk-EZLQYSV5.js";function Y(e,s){if(e&1&&(i(0,"option",21),o(1),n()),e&2){let t=s.$implicit,a=m();c("value",t),r(),d(a.formatEntityType(t))}}function Z(e,s){if(e&1&&(i(0,"option",21),o(1),n()),e&2){let t=s.$implicit;c("value",t),r(),d(t)}}function tt(e,s){if(e&1&&(i(0,"div",22),o(1),n()),e&2){let t=m();r(),d(t.error)}}function et(e,s){if(e&1&&(i(0,"span",45),o(1),n()),e&2){let t=m(2).$implicit;r(),d(t.oldValue)}}function it(e,s){e&1&&h(0,"i",46)}function nt(e,s){if(e&1&&(i(0,"span",47),o(1),n()),e&2){let t=m(2).$implicit;r(),d(t.newValue)}}function ot(e,s){if(e&1&&(L(0),f(1,et,2,1,"span",42)(2,it,1,0,"i",43)(3,nt,2,1,"span",44),k()),e&2){let t=m().$implicit;r(),c("ngIf",t.oldValue),r(),c("ngIf",t.oldValue&&t.newValue),r(),c("ngIf",t.newValue)}}function rt(e,s){e&1&&(i(0,"span"),o(1,"-"),n())}function at(e,s){if(e&1){let t=S();i(0,"tr",36),M("click",function(){let l=g(t).$implicit,u=m(3);return _(u.selectEntry(l))}),i(1,"td")(2,"span",37),h(3,"i",38),o(4),n()(),i(5,"td"),o(6),n(),i(7,"td",39),o(8),n(),i(9,"td"),o(10),n(),i(11,"td",40),f(12,ot,4,3,"ng-container",41)(13,rt,2,0,"span",41),n(),i(14,"td"),o(15),n(),i(16,"td",39),o(17),n()()}if(e&2){let t=s.$implicit,a=m(3);P("selected",a.selectedEntry===t),r(2),c("ngClass",a.getActionClass(t.action)),r(),c("ngClass","fa-"+a.getActionIcon(t.action)),r(),V(" ",t.action," "),r(2),d(a.formatEntityType(t.entityType)),r(2),d(t.entityId),r(2),d(t.fieldName||"-"),r(2),c("ngIf",t.oldValue||t.newValue),r(),c("ngIf",!t.oldValue&&!t.newValue),r(2),d(t.changedBy),r(2),d(a.formatTimestamp(t.timestamp))}}function lt(e,s){if(e&1&&(i(0,"div",25)(1,"table",26)(2,"thead")(3,"tr")(4,"th",27),o(5,"Action"),n(),i(6,"th",28),o(7,"Entity"),n(),i(8,"th",29),o(9,"ID"),n(),i(10,"th",30),o(11,"Field"),n(),i(12,"th",31),o(13,"Change"),n(),i(14,"th",32),o(15,"User"),n(),i(16,"th",33),o(17,"Timestamp"),n()()(),i(18,"tbody"),f(19,at,18,12,"tr",34),n()(),i(20,"div",35),o(21),n()()),e&2){let t=m(2);r(19),c("ngForOf",t.filteredEntries),r(2),F(" Showing ",t.filteredEntries.length," of ",t.entries.length," entries ")}}function ct(e,s){e&1&&(i(0,"div",48),h(1,"i",49),i(2,"p"),o(3,"No audit entries found."),n()())}function st(e,s){if(e&1&&(i(0,"div",23),f(1,lt,22,3,"div",24)(2,ct,4,0,"ng-template",null,1,b),n()),e&2){let t=A(3),a=m();r(),c("ngIf",a.filteredEntries.length>0)("ngIfElse",t)}}function dt(e,s){e&1&&(i(0,"div",50),o(1,"Loading audit trail..."),n())}var Q=(()=>{class e{constructor(t){this.apiService=t,this.entries=[],this.loading=!0,this.error="",this.entityTypes=[],this.actionTypes=[],this.filterEntityType="all",this.filterAction="all",this.filterUser="",this.todaysCount=0,this.selectedEntry=null}ngOnInit(){this.loadFilters(),this.loadRecent(),this.loadSummary()}loadFilters(){this.apiService.getAuditEntityTypes().subscribe({next:t=>this.entityTypes=t,error:()=>{}}),this.apiService.getAuditActionTypes().subscribe({next:t=>this.actionTypes=t,error:()=>{}})}loadSummary(){this.apiService.getAuditSummary().subscribe({next:t=>this.todaysCount=t.todaysActivityCount,error:()=>{}})}loadRecent(){this.loading=!0,this.error="",this.apiService.getRecentAuditActivity(200).subscribe({next:t=>{this.entries=t,this.loading=!1},error:t=>{this.error=t.error?.message||"Failed to load audit trail.",this.loading=!1}})}get filteredEntries(){let t=this.entries;if(this.filterEntityType!=="all"&&(t=t.filter(a=>a.entityType===this.filterEntityType)),this.filterAction!=="all"&&(t=t.filter(a=>a.action===this.filterAction)),this.filterUser){let a=this.filterUser.toLowerCase();t=t.filter(l=>l.changedBy?.toLowerCase().includes(a))}return t}getActionClass(t){switch(t){case"CREATE":return"action-create";case"UPDATE":return"action-update";case"DELETE":return"action-delete";case"STATUS_CHANGE":return"action-status";case"HOLD":return"action-hold";case"RELEASE":return"action-release";case"CONSUME":return"action-consume";case"PRODUCE":return"action-produce";default:return""}}getActionIcon(t){switch(t){case"CREATE":return"circle-plus";case"UPDATE":return"pencil";case"DELETE":return"trash";case"STATUS_CHANGE":return"arrows-rotate";case"HOLD":return"circle-pause";case"RELEASE":return"circle-play";case"CONSUME":return"download";case"PRODUCE":return"upload";default:return"clock-rotate-left"}}formatEntityType(t){return t?.replace(/_/g," ")||""}formatTimestamp(t){return t?new Date(t).toLocaleString():"-"}selectEntry(t){this.selectedEntry=this.selectedEntry===t?null:t}clearFilters(){this.filterEntityType="all",this.filterAction="all",this.filterUser=""}static{this.\u0275fac=function(a){return new(a||e)(I(q))}}static{this.\u0275cmp=O({type:e,selectors:[["app-audit-list"]],decls:35,vars:9,consts:[["loadingTpl",""],["emptyTpl",""],[1,"audit-list-page"],[1,"page-header"],[1,"header-stats"],[1,"stat-badge"],[1,"card"],[1,"filters"],[1,"filter-group"],["for","entity-filter"],["id","entity-filter",3,"ngModelChange","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],["for","action-filter"],["id","action-filter",3,"ngModelChange","ngModel"],[1,"filter-group","search-group"],["for","user-filter"],["type","text","id","user-filter","placeholder","Filter by user...",3,"ngModelChange","ngModel"],[1,"btn","btn-sm","btn-secondary",3,"click"],["class","error-banner",4,"ngIf"],["class","audit-content",4,"ngIf","ngIfElse"],[3,"value"],[1,"error-banner"],[1,"audit-content"],["class","table-container",4,"ngIf","ngIfElse"],[1,"table-container"],[1,"data-table"],[1,"col-action"],[1,"col-entity"],[1,"col-id"],[1,"col-field"],[1,"col-change"],[1,"col-user"],[1,"col-time"],["class","audit-row",3,"selected","click",4,"ngFor","ngForOf"],[1,"result-count"],[1,"audit-row",3,"click"],[1,"action-badge",3,"ngClass"],[1,"fas",3,"ngClass"],[1,"mono"],[1,"change-cell"],[4,"ngIf"],["class","old-value",4,"ngIf"],["class","fas fa-arrow-right change-arrow",4,"ngIf"],["class","new-value",4,"ngIf"],[1,"old-value"],[1,"fas","fa-arrow-right","change-arrow"],[1,"new-value"],[1,"empty-state"],[1,"fas","fa-clock-rotate-left"],[1,"loading"]],template:function(a,l){if(a&1){let u=S();i(0,"div",2)(1,"div",3)(2,"h1"),o(3,"Audit Trail"),n(),i(4,"div",4)(5,"span",5)(6,"strong"),o(7),n(),o(8," changes today"),n()()(),i(9,"div",6)(10,"div",7)(11,"div",8)(12,"label",9),o(13,"Entity:"),n(),i(14,"select",10),v("ngModelChange",function(p){return g(u),E(l.filterEntityType,p)||(l.filterEntityType=p),_(p)}),i(15,"option",11),o(16,"All Entities"),n(),f(17,Y,2,2,"option",12),n()(),i(18,"div",8)(19,"label",13),o(20,"Action:"),n(),i(21,"select",14),v("ngModelChange",function(p){return g(u),E(l.filterAction,p)||(l.filterAction=p),_(p)}),i(22,"option",11),o(23,"All Actions"),n(),f(24,Z,2,2,"option",12),n()(),i(25,"div",15)(26,"label",16),o(27,"User:"),n(),i(28,"input",17),v("ngModelChange",function(p){return g(u),E(l.filterUser,p)||(l.filterUser=p),_(p)}),n()(),i(29,"button",18),M("click",function(){return g(u),_(l.clearFilters())}),o(30,"Clear"),n()()(),f(31,tt,2,1,"div",19)(32,st,4,2,"div",20)(33,dt,2,0,"ng-template",null,0,b),n()}if(a&2){let u=A(34);r(7),d(l.todaysCount),r(7),C("ngModel",l.filterEntityType),r(3),c("ngForOf",l.entityTypes),r(4),C("ngModel",l.filterAction),r(3),c("ngForOf",l.actionTypes),r(4),C("ngModel",l.filterUser),r(3),c("ngIf",l.error),r(),c("ngIf",!l.loading)("ngIfElse",u)}},dependencies:[N,U,R,H,G,W,B,z,j],styles:[".audit-list-page[_ngcontent-%COMP%]{padding:20px}.page-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}.stat-badge[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32;padding:6px 14px;border-radius:16px;font-size:13px}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:12px 16px;border-radius:4px;margin-bottom:16px}.table-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;overflow:hidden}.col-action[_ngcontent-%COMP%]{width:140px}.col-entity[_ngcontent-%COMP%]{width:160px}.col-id[_ngcontent-%COMP%]{width:60px}.col-field[_ngcontent-%COMP%]{width:120px}.col-user[_ngcontent-%COMP%]{width:100px}.col-time[_ngcontent-%COMP%]{width:170px}.audit-row[_ngcontent-%COMP%]{cursor:pointer;transition:background .15s}.audit-row[_ngcontent-%COMP%]:hover{background:#f8f9fa}.audit-row.selected[_ngcontent-%COMP%]{background:#e3f2fd}.action-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600;text-transform:uppercase}.action-create[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.action-update[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.action-delete[_ngcontent-%COMP%]{background:#fce4ec;color:#c62828}.action-status[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.action-hold[_ngcontent-%COMP%]{background:#f3e5f5;color:#7b1fa2}.action-release[_ngcontent-%COMP%]{background:#e0f7fa;color:#00695c}.action-consume[_ngcontent-%COMP%]{background:#fafafa;color:#616161}.action-produce[_ngcontent-%COMP%]{background:#f1f8e9;color:#558b2f}.change-cell[_ngcontent-%COMP%]{max-width:250px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.old-value[_ngcontent-%COMP%]{color:#c62828;text-decoration:line-through;font-size:13px}.new-value[_ngcontent-%COMP%]{color:#2e7d32;font-weight:500;font-size:13px}.change-arrow[_ngcontent-%COMP%]{color:#999;margin:0 4px;font-size:11px}.mono[_ngcontent-%COMP%]{font-family:Courier New,monospace;font-size:13px}.result-count[_ngcontent-%COMP%]{padding:12px 16px;border-top:1px solid #eee;font-size:13px;color:#666}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:48px;color:#ccc;display:block;margin-bottom:12px}.loading[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}"]})}}return e})();var pt=[{path:"",component:Q}],X=(()=>{class e{static{this.\u0275fac=function(a){return new(a||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=x({imports:[T.forChild(pt),T]})}}return e})();var Mt=(()=>{class e{static{this.\u0275fac=function(a){return new(a||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=x({imports:[D,$,X,J]})}}return e})();export{Mt as AuditModule};
