import{a as M,b as A,c as R,d as q,e as oe,f as ae}from"./chunk-PSDCBCWL.js";import{A as C,B as N,I as T,K as k,N as E,O as y,Q as F,R as Q,Y as L,_ as S,ba as G,d as w,ea as U,f as P,fa as v,g as D,ga as H,h as _,ha as K,i as x,ja as Z,k as a,ka as J,l as h,la as W,m,ma as X,o as s,oa as Y,p as I,pa as ee,q as B,qa as V,r as i,ra as z,s as t,t as u,ta as te,u as O,v as g,va as ne,w as c,wa as ie,xa as re,y as o,z as f}from"./chunk-SDYT7PYO.js";function ve(n,l){n&1&&(i(0,"div",17),u(1,"app-loading-spinner",18),t())}function he(n,l){if(n&1){let e=O();i(0,"tr")(1,"td"),o(2),t(),i(3,"td"),o(4),t(),i(5,"td"),o(6),t(),i(7,"td"),o(8),t(),i(9,"td"),u(10,"app-status-badge",25),t(),i(11,"td"),o(12),T(13,"date"),t(),i(14,"td",26)(15,"button",27),g("click",function(){let d=_(e).$implicit,p=c(3);return x(p.viewOrder(d.orderId))}),o(16," View "),t(),i(17,"button",28),g("click",function(){let d=_(e).$implicit,p=c(3);return x(p.editOrder(d.orderId))}),o(18," Edit "),t()()()}if(n&2){let e=l.$implicit,r=c(3);a(2),f(e.orderNumber),a(2),f(e.customerName||"N/A"),a(2),f(r.getProductInfo(e)),a(2),f(r.getTotalQuantity(e)),a(2),s("status",e.status),a(2),f(k(13,6,e.orderDate,"mediumDate"))}}function Ce(n,l){if(n&1&&(i(0,"table",23)(1,"thead")(2,"tr")(3,"th"),o(4,"Order Number"),t(),i(5,"th"),o(6,"Customer"),t(),i(7,"th"),o(8,"Product"),t(),i(9,"th"),o(10,"Quantity"),t(),i(11,"th"),o(12,"Status"),t(),i(13,"th"),o(14,"Order Date"),t(),i(15,"th"),o(16,"Actions"),t()()(),i(17,"tbody"),m(18,he,19,9,"tr",24),t()()),n&2){let e=c(2);a(18),s("ngForOf",e.orders)}}function Oe(n,l){n&1&&(i(0,"p",29),o(1," No orders found matching the selected filter. "),t())}function be(n,l){if(n&1){let e=O();i(0,"app-pagination",30),g("pageChange",function(d){_(e);let p=c(2);return x(p.onPageChange(d))})("sizeChange",function(d){_(e);let p=c(2);return x(p.onSizeChange(d))}),t()}if(n&2){let e=c(2);s("page",e.page)("size",e.size)("totalElements",e.totalElements)("totalPages",e.totalPages)("hasNext",e.hasNext)("hasPrevious",e.hasPrevious)}}function Ie(n,l){if(n&1&&(i(0,"div",19),m(1,Ce,19,1,"table",20)(2,Oe,2,0,"p",21)(3,be,1,6,"app-pagination",22),t()),n&2){let e=c();a(),s("ngIf",e.orders.length>0),a(),s("ngIf",e.orders.length===0),a(),s("ngIf",e.orders.length>0)}}var pe=(()=>{class n{constructor(e,r){this.apiService=e,this.router=r,this.orders=[],this.loading=!0,this.page=0,this.size=20,this.totalElements=0,this.totalPages=0,this.hasNext=!1,this.hasPrevious=!1,this.filterStatus="",this.searchTerm=""}ngOnInit(){this.loadOrders()}loadOrders(){this.loading=!0;let e={page:this.page,size:this.size,sortBy:"orderDate",sortDirection:"DESC",status:this.filterStatus||void 0,search:this.searchTerm||void 0};this.apiService.getOrdersPaged(e).subscribe({next:r=>{this.orders=r.content,this.page=r.page,this.size=r.size,this.totalElements=r.totalElements,this.totalPages=r.totalPages,this.hasNext=r.hasNext,this.hasPrevious=r.hasPrevious,this.loading=!1},error:r=>{console.error("Error loading orders:",r),this.loading=!1}})}onPageChange(e){this.page=e,this.loadOrders()}onSizeChange(e){this.size=e,this.page=0,this.loadOrders()}onFilterChange(e){this.filterStatus=e==="all"?"":e,this.page=0,this.loadOrders()}onSearch(e){this.searchTerm=e,this.page=0,this.loadOrders()}viewOrder(e){this.router.navigate(["/orders",e])}createOrder(){this.router.navigate(["/orders/new"])}editOrder(e){this.router.navigate(["/orders",e,"edit"])}getProductInfo(e){return e.lineItems&&e.lineItems.length>0?e.lineItems[0].productName:"N/A"}getTotalQuantity(e){return e.lineItems&&e.lineItems.length>0?e.lineItems.reduce((r,d)=>r+(d.quantity||0),0):0}static{this.\u0275fac=function(r){return new(r||n)(h(M),h(S))}}static{this.\u0275cmp=P({type:n,selectors:[["app-order-list"]],decls:27,vars:4,consts:[[1,"container"],[1,"page-header"],[1,"page-title-section"],[1,"page-title"],[1,"btn","btn-primary",3,"click"],[1,"header-controls"],[1,"search-group"],["type","text","placeholder","Search orders...",1,"search-input",3,"input","value"],[1,"filter-group"],[3,"change","value"],["value","all"],["value","CREATED"],["value","IN_PROGRESS"],["value","COMPLETED"],["value","CANCELLED"],["class","text-center",4,"ngIf"],["class","card",4,"ngIf"],[1,"text-center"],["message","Loading orders..."],[1,"card"],["class","table",4,"ngIf"],["class","no-data",4,"ngIf"],[3,"page","size","totalElements","totalPages","hasNext","hasPrevious","pageChange","sizeChange",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],[3,"status"],[1,"actions"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"btn","btn-secondary","btn-sm",3,"click"],[1,"no-data"],[3,"pageChange","sizeChange","page","size","totalElements","totalPages","hasNext","hasPrevious"]],template:function(r,d){r&1&&(u(0,"app-header"),i(1,"div",0)(2,"div",1)(3,"div",2)(4,"h1",3),o(5,"Production Orders"),t(),i(6,"button",4),g("click",function(){return d.createOrder()}),o(7,"+ New Order"),t()(),i(8,"div",5)(9,"div",6)(10,"input",7),g("input",function(b){return d.onSearch(b.target.value)}),t()(),i(11,"div",8)(12,"label"),o(13,"Filter by status:"),t(),i(14,"select",9),g("change",function(b){return d.onFilterChange(b.target.value)}),i(15,"option",10),o(16,"All"),t(),i(17,"option",11),o(18,"Created"),t(),i(19,"option",12),o(20,"In Progress"),t(),i(21,"option",13),o(22,"Completed"),t(),i(23,"option",14),o(24,"Cancelled"),t()()()()(),m(25,ve,2,0,"div",15)(26,Ie,4,3,"div",16),t()),r&2&&(a(10),s("value",d.searchTerm),a(4),s("value",d.filterStatus||"all"),a(11),s("ngIf",d.loading),a(),s("ngIf",!d.loading))},dependencies:[E,y,V,z,A,R,q,oe,F],styles:[".page-title-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:16px}.page-title-section[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{white-space:nowrap}.header-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.search-group[_ngcontent-%COMP%]{display:flex;align-items:center}.search-input[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;width:250px}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2}.filter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;color:#666}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;background:#fff;cursor:pointer}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}.no-data[_ngcontent-%COMP%]{text-align:center;color:#888;padding:40px}.actions[_ngcontent-%COMP%]{display:flex;gap:8px}.btn-secondary[_ngcontent-%COMP%]{background:#6c757d;color:#fff;border:none;border-radius:4px;cursor:pointer}.btn-secondary[_ngcontent-%COMP%]:hover{background:#5a6268}"]})}}return n})();function Pe(n,l){n&1&&(i(0,"div",6),u(1,"app-loading-spinner",7),t())}function Ee(n,l){n&1&&u(0,"div",33)}function ye(n,l){if(n&1&&(i(0,"span"),o(1),t()),n&2){let e=c().$implicit;a(),C("Planned: ",e.plannedQuantity,"")}}function Se(n,l){if(n&1&&(i(0,"span"),o(1),t()),n&2){let e=c().$implicit;a(),C("Completed: ",e.completedQuantity,"")}}function Me(n,l){if(n&1){let e=O();i(0,"div",34)(1,"button",35),g("click",function(){_(e);let d=c().$implicit,p=c(4);return x(p.startProduction(d.operationId))}),o(2),t()()}if(n&2){let e=c().$implicit;a(2),C(" ",e.status==="IN_PROGRESS"?"Continue Production":"Start Production"," ")}}function Ne(n,l){if(n&1&&(i(0,"div",23)(1,"div",24)(2,"div",25),o(3),t(),m(4,Ee,1,0,"div",26),t(),i(5,"div",27)(6,"div",28)(7,"span",29),o(8),t(),i(9,"span",30),o(10),t(),u(11,"app-status-badge",11),t(),i(12,"div",31)(13,"span"),o(14),t(),m(15,ye,2,1,"span",4)(16,Se,2,1,"span",4),t(),m(17,Me,3,1,"div",32),t()()),n&2){let e=l.$implicit,r=l.index,d=c().$implicit,p=c(3);B(p.getOperationStatusClass(e.status)),a(3),f(r+1),a(),s("ngIf",r<d.operations.length-1),a(4),f(e.operationName),a(2),C("(",e.operationCode,")"),a(),s("status",e.status),a(3),C("Type: ",e.operationType,""),a(),s("ngIf",e.plannedQuantity),a(),s("ngIf",e.completedQuantity),a(),s("ngIf",p.canStartOperation(e))}}function we(n,l){if(n&1&&(i(0,"div",19)(1,"div",20)(2,"h4"),o(3),t(),u(4,"app-status-badge",11),t(),i(5,"div",21),m(6,Ne,18,11,"div",22),t()()),n&2){let e=l.$implicit;a(3),f(e.stageName),a(),s("status",e.status),a(2),s("ngForOf",e.operations)}}function De(n,l){if(n&1&&(i(0,"div",8)(1,"div",14)(2,"div")(3,"h3"),o(4),t(),i(5,"p",15),o(6),t()(),i(7,"div",16)(8,"span",17),o(9),t()()(),m(10,we,7,3,"div",18),t()),n&2){let e=l.$implicit;a(4),f(e.productName),a(2),C("SKU: ",e.productSku,""),a(3),N("",e.quantity," ",e.unitOfMeasure,""),a(),s("ngForOf",e.processes)}}function Te(n,l){if(n&1&&(i(0,"div")(1,"div",8)(2,"div",9)(3,"div",10)(4,"h2"),o(5),t(),u(6,"app-status-badge",11),t(),i(7,"div",12)(8,"span"),o(9,"Priority: "),i(10,"strong"),o(11),t()(),i(12,"span"),o(13,"Due: "),i(14,"strong"),o(15),T(16,"date"),t()()()()(),m(17,De,11,5,"div",13),t()),n&2){let e=c();a(5),C("Order: ",e.order.orderNumber,""),a(),s("status",e.order.status),a(5),f(e.order.priority),a(4),f(k(16,5,e.order.dueDate,"mediumDate")),a(2),s("ngForOf",e.order.lineItems)}}function ke(n,l){n&1&&(i(0,"div",8)(1,"p",36),o(2,"Order not found"),t()())}var ce=(()=>{class n{constructor(e,r,d){this.route=e,this.router=r,this.apiService=d,this.order=null,this.loading=!0}ngOnInit(){this.orderId=Number(this.route.snapshot.paramMap.get("orderId")),this.loadOrder()}loadOrder(){this.loading=!0,this.apiService.getOrderById(this.orderId).subscribe({next:e=>{this.order=e,this.loading=!1},error:e=>{console.error("Error loading order:",e),this.loading=!1}})}goBack(){this.router.navigate(["/orders"])}startProduction(e){this.router.navigate(["/production/confirm",e])}canStartOperation(e){return e.status==="PENDING"||e.status==="IN_PROGRESS"}getOperationStatusClass(e){switch(e){case"COMPLETED":return"step-completed";case"IN_PROGRESS":return"step-active";default:return"step-pending"}}static{this.\u0275fac=function(r){return new(r||n)(h(L),h(S),h(M))}}static{this.\u0275cmp=P({type:n,selectors:[["app-order-detail"]],decls:8,vars:3,consts:[[1,"container"],[1,"page-header"],[1,"btn","btn-secondary",3,"click"],["class","text-center",4,"ngIf"],[4,"ngIf"],["class","card",4,"ngIf"],[1,"text-center"],["message","Loading order details..."],[1,"card"],[1,"order-header"],[1,"order-info"],[3,"status"],[1,"order-meta"],["class","card",4,"ngFor","ngForOf"],[1,"line-item-header"],[1,"product-sku"],[1,"quantity-info"],[1,"quantity"],["class","process-section",4,"ngFor","ngForOf"],[1,"process-section"],[1,"process-header"],[1,"operations-list"],["class","operation-item",3,"class",4,"ngFor","ngForOf"],[1,"operation-item"],[1,"operation-step"],[1,"step-number"],["class","step-line",4,"ngIf"],[1,"operation-content"],[1,"operation-info"],[1,"operation-name"],[1,"operation-code"],[1,"operation-details"],["class","operation-actions",4,"ngIf"],[1,"step-line"],[1,"operation-actions"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"no-data"]],template:function(r,d){r&1&&(u(0,"app-header"),i(1,"div",0)(2,"div",1)(3,"button",2),g("click",function(){return d.goBack()}),o(4,"\u2190 Back to Orders"),t()(),m(5,Pe,2,0,"div",3)(6,Te,18,8,"div",4)(7,ke,3,0,"div",5),t()),r&2&&(a(5),s("ngIf",d.loading),a(),s("ngIf",!d.loading&&d.order),a(),s("ngIf",!d.loading&&!d.order))},dependencies:[E,y,A,R,q,F],styles:[".order-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.order-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.order-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;font-weight:500;margin:0}.order-meta[_ngcontent-%COMP%]{display:flex;gap:24px;color:#666;font-size:14px}.line-item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;padding-bottom:16px;border-bottom:1px solid #eee;margin-bottom:16px}.line-item-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:500;margin:0 0 4px}.product-sku[_ngcontent-%COMP%]{color:#888;font-size:13px;margin:0}.quantity-info[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{font-size:20px;font-weight:500;color:#1976d2}.process-section[_ngcontent-%COMP%]{margin-top:20px}.process-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:16px}.process-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin:0}.operations-list[_ngcontent-%COMP%]{margin-left:12px}.operation-item[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:8px}.operation-step[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.step-number[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:500;background:#e0e0e0;color:#666}.step-line[_ngcontent-%COMP%]{width:2px;flex:1;min-height:40px;background:#e0e0e0}.step-completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#4caf50;color:#fff}.step-completed[_ngcontent-%COMP%]   .step-line[_ngcontent-%COMP%]{background:#4caf50}.step-active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#1976d2;color:#fff}.operation-content[_ngcontent-%COMP%]{flex:1;padding:8px 16px;background:#fafafa;border-radius:8px;margin-bottom:8px}.step-active[_ngcontent-%COMP%]   .operation-content[_ngcontent-%COMP%]{background:#e3f2fd;border:1px solid #90caf9}.step-completed[_ngcontent-%COMP%]   .operation-content[_ngcontent-%COMP%]{background:#e8f5e9;border:1px solid #a5d6a7}.operation-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px}.operation-name[_ngcontent-%COMP%]{font-weight:500}.operation-code[_ngcontent-%COMP%]{color:#888;font-size:13px}.operation-details[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:13px;color:#666;margin-bottom:8px}.operation-actions[_ngcontent-%COMP%]{margin-top:12px}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}.no-data[_ngcontent-%COMP%]{text-align:center;color:#888;padding:40px}"]})}}return n})();function Fe(n,l){n&1&&(i(0,"div",4),o(1,"Loading order..."),t())}function Le(n,l){if(n&1&&(i(0,"div",33),o(1),t()),n&2){let e=c(2);a(),f(e.error)}}function Ve(n,l){if(n&1&&(i(0,"option",34),o(1),t()),n&2){let e=l.$implicit;s("value",e.customerId),a(),N(" ",e.customerCode," - ",e.customerName," ")}}function ze(n,l){n&1&&(i(0,"span",23),o(1,"Loading customers..."),t())}function Ae(n,l){n&1&&(i(0,"span",35),o(1,"Customer is required"),t())}function Re(n,l){if(n&1&&(i(0,"span",35),o(1),t()),n&2){let e=c(2);a(),C(" ",e.getError("customerName")," ")}}function qe(n,l){n&1&&(i(0,"span",35),o(1,"Order date is required"),t())}function je(n,l){n&1&&(i(0,"div",9)(1,"div",10)(2,"label",36),o(3,"Status"),t(),i(4,"select",37)(5,"option",38),o(6,"Created"),t(),i(7,"option",39),o(8,"In Progress"),t(),i(9,"option",40),o(10,"Completed"),t(),i(11,"option",41),o(12,"Cancelled"),t()()()())}function Ge(n,l){if(n&1){let e=O();i(0,"button",42),g("click",function(){_(e);let d=c(2);return x(d.addLineItem())}),o(1," + Add Line Item "),t()}}function $e(n,l){n&1&&(i(0,"div",43),o(1," Line items can only be modified for orders with CREATED status. "),t())}function Be(n,l){if(n&1){let e=O();i(0,"button",56),g("click",function(){_(e);let d=c().index,p=c(2);return x(p.removeLineItem(d))}),o(1," \xD7 "),t()}}function Qe(n,l){if(n&1&&(i(0,"option",34),o(1),t()),n&2){let e=l.$implicit;s("value",e.productSku),a(),N(" ",e.productSku," - ",e.productName," ")}}function Ue(n,l){if(n&1){let e=O();i(0,"div",44)(1,"div",45)(2,"span",46),o(3),t(),m(4,Be,2,0,"button",47),t(),i(5,"div",48)(6,"div",10)(7,"label"),o(8,"Product *"),t(),i(9,"select",49),g("change",function(d){let p=_(e).index,b=c(2);return x(b.onProductChange(p,d))}),i(10,"option",13),o(11,"Select a product..."),t(),m(12,Qe,2,3,"option",14),t()(),i(13,"div",10)(14,"label"),o(15,"Product Name *"),t(),u(16,"input",50),t(),i(17,"div",51)(18,"label"),o(19,"Quantity *"),t(),u(20,"input",52),t(),i(21,"div",53)(22,"label"),o(23,"Unit *"),t(),u(24,"input",54),t(),i(25,"div",10)(26,"label"),o(27,"Delivery Date"),t(),u(28,"input",55),t()()()}if(n&2){let e=l.index,r=c(2);s("formGroupName",e),a(3),C("Line ",e+1,""),a(),s("ngIf",r.lineItems.length>1&&r.canEditLineItems()),a(5),I("error",r.hasLineItemError(e,"productSku")),s("disabled",!r.canEditLineItems()),a(3),s("ngForOf",r.products),a(4),I("error",r.hasLineItemError(e,"productName")),s("readonly",!r.canEditLineItems()),a(4),I("error",r.hasLineItemError(e,"quantity")),s("readonly",!r.canEditLineItems()),a(4),I("error",r.hasLineItemError(e,"unit")),s("readonly",!r.canEditLineItems()),a(4),s("readonly",!r.canEditLineItems())}}function He(n,l){n&1&&(i(0,"div",57),o(1,' No line items. Click "Add Line Item" to add products to this order. '),t())}function Ke(n,l){if(n&1){let e=O();i(0,"div",5)(1,"form",6),g("ngSubmit",function(){_(e);let d=c();return x(d.onSubmit())}),m(2,Le,2,1,"div",7),i(3,"div",8)(4,"h2"),o(5,"Order Information"),t(),i(6,"div",9)(7,"div",10)(8,"label",11),o(9,"Customer *"),t(),i(10,"select",12),g("change",function(d){_(e);let p=c();return x(p.onCustomerChange(d))}),i(11,"option",13),o(12,"Select a customer..."),t(),m(13,Ve,2,3,"option",14),t(),m(14,ze,2,0,"span",15)(15,Ae,2,0,"span",16),t(),i(16,"div",10)(17,"label",17),o(18,"Customer Name *"),t(),u(19,"input",18),m(20,Re,2,1,"span",16),t()(),i(21,"div",9)(22,"div",10)(23,"label",19),o(24,"Order Date *"),t(),u(25,"input",20),m(26,qe,2,0,"span",16),t(),i(27,"div",10)(28,"label",21),o(29,"Order Number"),t(),u(30,"input",22),i(31,"span",23),o(32,"Leave empty to auto-generate"),t()()(),m(33,je,13,0,"div",24),t(),i(34,"div",8)(35,"div",25)(36,"h2"),o(37,"Line Items"),t(),m(38,Ge,2,0,"button",26),t(),m(39,$e,2,0,"div",27)(40,Ue,29,17,"div",28)(41,He,2,0,"div",29),t(),i(42,"div",30)(43,"button",31),g("click",function(){_(e);let d=c();return x(d.cancel())}),o(44," Cancel "),t(),i(45,"button",32),o(46),t()()()()}if(n&2){let e=c();a(),s("formGroup",e.form),a(),s("ngIf",e.error),a(8),I("error",e.hasError("customerId")),a(3),s("ngForOf",e.customers),a(),s("ngIf",e.loadingCustomers),a(),s("ngIf",e.hasError("customerId")),a(4),I("error",e.hasError("customerName")),a(),s("ngIf",e.hasError("customerName")),a(5),I("error",e.hasError("orderDate")),a(),s("ngIf",e.hasError("orderDate")),a(4),s("readonly",e.isEditMode),a(3),s("ngIf",e.isEditMode),a(5),s("ngIf",e.canEditLineItems()),a(),s("ngIf",e.isEditMode&&!e.canEditLineItems()),a(),s("ngForOf",e.lineItems.controls),a(),s("ngIf",e.lineItems.length===0),a(2),s("disabled",e.saving),a(2),s("disabled",e.saving||e.form.invalid),a(),C(" ",e.saving?"Saving...":e.isEditMode?"Update Order":"Create Order"," ")}}var $=(()=>{class n{constructor(e,r,d,p){this.fb=e,this.apiService=r,this.route=d,this.router=p,this.isEditMode=!1,this.orderId=null,this.loading=!1,this.saving=!1,this.error="",this.customers=[],this.products=[],this.loadingCustomers=!0,this.loadingProducts=!0}ngOnInit(){this.initForm(),this.loadCustomers(),this.loadProducts();let e=this.route.snapshot.paramMap.get("id");e?(this.isEditMode=!0,this.orderId=+e,this.loadOrder()):this.addLineItem()}initForm(){this.form=this.fb.group({customerId:["",v.required],customerName:["",[v.required,v.maxLength(200)]],orderDate:[this.getTodayDate(),v.required],orderNumber:[""],status:["CREATED"],lineItems:this.fb.array([])})}get lineItems(){return this.form.get("lineItems")}createLineItemGroup(e){return this.fb.group({orderLineId:[e?.orderLineId||null],productSku:[e?.productSku||"",[v.required,v.maxLength(50)]],productName:[e?.productName||"",[v.required,v.maxLength(200)]],quantity:[e?.quantity||1,[v.required,v.min(.01)]],unit:[e?.unit||"",[v.required,v.maxLength(20)]],deliveryDate:[e?.deliveryDate||""]})}addLineItem(){this.lineItems.push(this.createLineItemGroup())}removeLineItem(e){this.lineItems.length>1&&this.lineItems.removeAt(e)}loadCustomers(){this.apiService.getActiveCustomers().subscribe({next:e=>{this.customers=e,this.loadingCustomers=!1},error:e=>{console.error("Error loading customers:",e),this.loadingCustomers=!1}})}loadProducts(){this.apiService.getActiveProducts().subscribe({next:e=>{this.products=e,this.loadingProducts=!1},error:e=>{console.error("Error loading products:",e),this.loadingProducts=!1}})}onCustomerChange(e){let r=e.target.value,d=this.customers.find(p=>p.customerId.toString()===r);d&&this.form.patchValue({customerName:d.customerName})}onProductChange(e,r){let d=r.target.value,p=this.products.find(b=>b.productSku===d);p&&this.lineItems.at(e).patchValue({productName:p.productName,unit:p.unit})}loadOrder(){this.orderId&&(this.loading=!0,this.apiService.getOrderById(this.orderId).subscribe({next:e=>{this.form.patchValue({customerId:e.customerId||"",customerName:e.customerName||"",orderDate:e.orderDate||"",orderNumber:e.orderNumber||"",status:e.status}),this.lineItems.clear(),e.lineItems&&e.lineItems.length>0?e.lineItems.forEach(r=>{this.lineItems.push(this.createLineItemGroup(r))}):this.addLineItem(),this.loading=!1},error:e=>{this.error=e.error?.message||"Failed to load order.",this.loading=!1}}))}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.saving=!0,this.error="";let e=this.form.getRawValue();if(this.isEditMode&&this.orderId){let r={customerId:e.customerId,customerName:e.customerName,orderDate:e.orderDate||void 0,status:e.status};this.apiService.updateOrder(this.orderId,r).subscribe({next:()=>{this.saving=!1,this.router.navigate(["/orders"])},error:d=>{this.saving=!1,this.error=d.error?.message||"Failed to update order."}})}else{let r={customerId:e.customerId,customerName:e.customerName,orderDate:e.orderDate,orderNumber:e.orderNumber||void 0,lineItems:e.lineItems.map(d=>({productSku:d.productSku,productName:d.productName,quantity:d.quantity,unit:d.unit,deliveryDate:d.deliveryDate||void 0}))};this.apiService.createOrder(r).subscribe({next:()=>{this.saving=!1,this.router.navigate(["/orders"])},error:d=>{this.saving=!1,this.error=d.error?.message||"Failed to create order."}})}}cancel(){this.router.navigate(["/orders"])}getTodayDate(){return new Date().toISOString().split("T")[0]}hasError(e){let r=this.form.get(e);return!!(r&&r.invalid&&r.touched)}hasLineItemError(e,r){let d=this.lineItems.at(e)?.get(r);return!!(d&&d.invalid&&d.touched)}getError(e){let r=this.form.get(e);return!r||!r.errors?"":r.errors.required?`${e} is required`:r.errors.maxlength?`${e} is too long`:"Invalid value"}canEditLineItems(){return!this.isEditMode||this.form.get("status")?.value==="CREATED"}static{this.\u0275fac=function(r){return new(r||n)(h(ne),h(M),h(L),h(S))}}static{this.\u0275cmp=P({type:n,selectors:[["app-order-form"]],decls:6,vars:3,consts:[[1,"order-form-page"],[1,"page-header"],["class","loading",4,"ngIf"],["class","form-container",4,"ngIf"],[1,"loading"],[1,"form-container"],[3,"ngSubmit","formGroup"],["class","error-banner",4,"ngIf"],[1,"form-section"],[1,"form-row"],[1,"form-group"],["for","customerId"],["id","customerId","formControlName","customerId",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","hint",4,"ngIf"],["class","error-text",4,"ngIf"],["for","customerName"],["type","text","id","customerName","formControlName","customerName","placeholder","Customer name"],["for","orderDate"],["type","date","id","orderDate","formControlName","orderDate"],["for","orderNumber"],["type","text","id","orderNumber","formControlName","orderNumber","placeholder","Auto-generated if empty",3,"readonly"],[1,"hint"],["class","form-row",4,"ngIf"],[1,"section-header"],["type","button","class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["class","line-items-warning",4,"ngIf"],["class","line-item",3,"formGroupName",4,"ngFor","ngForOf"],["class","empty-line-items",4,"ngIf"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"error-banner"],[3,"value"],[1,"error-text"],["for","status"],["id","status","formControlName","status"],["value","CREATED"],["value","IN_PROGRESS"],["value","COMPLETED"],["value","CANCELLED"],["type","button",1,"btn","btn-sm","btn-primary",3,"click"],[1,"line-items-warning"],[1,"line-item",3,"formGroupName"],[1,"line-item-header"],[1,"line-number"],["type","button","class","btn-icon btn-danger","title","Remove line item",3,"click",4,"ngIf"],[1,"line-item-fields"],["formControlName","productSku",3,"change","disabled"],["type","text","formControlName","productName","placeholder","Product name",3,"readonly"],[1,"form-group","quantity-group"],["type","number","formControlName","quantity","min","0.01","step","0.01",3,"readonly"],[1,"form-group","unit-group"],["type","text","formControlName","unit","placeholder","e.g., KG",3,"readonly"],["type","date","formControlName","deliveryDate",3,"readonly"],["type","button","title","Remove line item",1,"btn-icon","btn-danger",3,"click"],[1,"empty-line-items"]],template:function(r,d){r&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),o(3),t()(),m(4,Fe,2,0,"div",2)(5,Ke,47,22,"div",3),t()),r&2&&(a(3),f(d.isEditMode?"Edit Order":"New Order"),a(),s("ngIf",d.loading),a(),s("ngIf",!d.loading))},dependencies:[E,y,Z,V,z,U,J,ee,H,K,te,W,Y,X],styles:[".order-form-page[_ngcontent-%COMP%]{padding:20px;max-width:1000px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;color:#333}.loading[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}.form-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;padding:24px}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:12px 16px;border-radius:4px;margin-bottom:20px}.form-section[_ngcontent-%COMP%]{margin-bottom:32px}.form-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#333;margin:0 0 16px;padding-bottom:8px;border-bottom:1px solid #eee}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid #eee}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;padding:0;border:none}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:16px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.form-group.full-width[_ngcontent-%COMP%]{grid-column:1 / -1}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:#555;font-size:14px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{padding:10px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;transition:border-color .2s}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea.error[_ngcontent-%COMP%]{border-color:#dc3545}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:disabled, .form-group[_ngcontent-%COMP%]   input[readonly][_ngcontent-%COMP%]{background:#f5f5f5;cursor:not-allowed}.hint[_ngcontent-%COMP%]{font-size:12px;color:#666}.error-text[_ngcontent-%COMP%]{font-size:12px;color:#dc3545}.line-item[_ngcontent-%COMP%]{background:#f8f9fa;border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid #e9ecef}.line-item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.line-number[_ngcontent-%COMP%]{font-weight:600;color:#333}.line-item-fields[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 100px 80px 140px;gap:12px;align-items:end}.quantity-group[_ngcontent-%COMP%]{min-width:100px}.unit-group[_ngcontent-%COMP%]{min-width:80px}.line-items-warning[_ngcontent-%COMP%]{background:#fff3cd;color:#856404;padding:12px 16px;border-radius:4px;margin-bottom:16px;font-size:14px}.empty-line-items[_ngcontent-%COMP%]{text-align:center;padding:32px;color:#666;background:#f8f9fa;border-radius:8px;border:2px dashed #dee2e6}.btn-icon[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:background .2s}.btn-icon.btn-danger[_ngcontent-%COMP%]{color:#dc3545}.btn-icon.btn-danger[_ngcontent-%COMP%]:hover{background:#f8d7da}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;padding-top:20px;border-top:1px solid #eee}.btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:500;transition:background .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#0056b3}.btn-secondary[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#545b62}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}@media (max-width: 900px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.line-item-fields[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}@media (max-width: 600px){.line-item-fields[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return n})();var Ze=[{path:"",component:pe},{path:"new",component:$},{path:":orderId",component:ce},{path:":orderId/edit",component:$}],me=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=D({type:n})}static{this.\u0275inj=w({imports:[G.forChild(Ze),G]})}}return n})();var xt=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=D({type:n})}static{this.\u0275inj=w({imports:[Q,ie,re,me,ae]})}}return n})();export{xt as OrdersModule};
