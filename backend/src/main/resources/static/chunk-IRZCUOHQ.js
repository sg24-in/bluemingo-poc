import{g as q}from"./chunk-IX5OVKKX.js";import{d as Y}from"./chunk-ARXHOQX7.js";import"./chunk-6JOZGQIR.js";import{$ as V,D as b,E as _,Ea as z,F as s,Fa as j,Ga as K,J as y,K as o,L as c,La as Q,M as O,N as B,Q as v,R as k,S,Y as M,_ as R,aa as N,ea as F,g as h,i as I,j as C,l as u,m as g,o as r,p as T,qa as w,r as x,t as d,ta as D,v as L,va as A,x as e,xa as W,y as n,z as P}from"./chunk-ADVEXGTJ.js";function J(i,p){if(i&1&&(e(0,"option",18),o(1),n()),i&2){let t=p.$implicit;d("value",t),r(),c(t)}}function X(i,p){if(i&1&&(e(0,"div",19),o(1),n()),i&2){let t=s();r(),c(t.actionError)}}function Z(i,p){if(i&1&&(e(0,"div",20)(1,"div",21)(2,"span",22),o(3),n(),e(4,"span",23),o(5,"Total"),n()(),e(6,"div",24)(7,"span",22),o(8),n(),e(9,"span",23),o(10,"Ready"),n()(),e(11,"div",25)(12,"span",22),o(13),n(),e(14,"span",23),o(15,"In Progress"),n()(),e(16,"div",26)(17,"span",22),o(18),n(),e(19,"span",23),o(20,"Confirmed"),n()(),e(21,"div",27)(22,"span",22),o(23),n(),e(24,"span",23),o(25,"Blocked"),n()()()),i&2){let t=s();r(3),c(t.allOperations.length),r(5),c(t.countByStatus("READY")),r(5),c(t.countByStatus("IN_PROGRESS")),r(5),c(t.countByStatus("CONFIRMED")),r(5),c(t.countByStatus("BLOCKED"))}}function $(i,p){if(i&1){let t=b();e(0,"button",37),_("click",function(){u(t);let a=s().$implicit,m=s(3);return g(m.openBlockModal(a))}),o(1," Block "),n()}}function tt(i,p){if(i&1){let t=b();e(0,"button",38),_("click",function(){u(t);let a=s().$implicit,m=s(3);return g(m.unblockOperation(a))}),o(1," Unblock "),n()}}function et(i,p){if(i&1&&(e(0,"tr")(1,"td"),o(2),n(),e(3,"td"),o(4),n(),e(5,"td"),o(6),n(),e(7,"td"),o(8),n(),e(9,"td"),o(10),n(),e(11,"td"),o(12),n(),e(13,"td"),o(14),n(),e(15,"td"),o(16),n(),e(17,"td")(18,"span",33),o(19),n()(),e(20,"td",34),x(21,$,2,0,"button",35)(22,tt,2,0,"button",36),n()()),i&2){let t=p.$implicit,l=s(3);L("blocked-row",t.status==="BLOCKED"),r(2),c(t.operationCode||"-"),r(2),c(t.operationName),r(2),c(t.operationType||"-"),r(2),c(t.orderNumber||"-"),r(2),c(t.processName||"-"),r(2),c(t.sequenceNumber),r(2),c(t.targetQty||"-"),r(2),c(t.confirmedQty||"-"),r(2),d("ngClass",l.getStatusClass(t.status)),r(),O(" ",t.status," "),r(2),d("ngIf",t.status!=="BLOCKED"&&t.status!=="CONFIRMED"),r(),d("ngIf",t.status==="BLOCKED")}}function nt(i,p){if(i&1&&(e(0,"table",31)(1,"thead")(2,"tr")(3,"th"),o(4,"Code"),n(),e(5,"th"),o(6,"Name"),n(),e(7,"th"),o(8,"Type"),n(),e(9,"th"),o(10,"Order"),n(),e(11,"th"),o(12,"Process"),n(),e(13,"th"),o(14,"Seq"),n(),e(15,"th"),o(16,"Target Qty"),n(),e(17,"th"),o(18,"Confirmed Qty"),n(),e(19,"th"),o(20,"Status"),n(),e(21,"th"),o(22,"Actions"),n()()(),e(23,"tbody"),x(24,et,23,14,"tr",32),n()()),i&2){let t=s(2);r(24),d("ngForOf",t.operations)}}function it(i,p){i&1&&(e(0,"div",39)(1,"p"),o(2,"No operations found."),n()())}function ot(i,p){if(i&1&&(e(0,"div",40),o(1),n()),i&2){let t=s(2);r(),B(" Showing ",t.operations.length," of ",t.allOperations.length," operations ")}}function rt(i,p){if(i&1&&(e(0,"div",28),x(1,nt,25,1,"table",29)(2,it,3,0,"ng-template",null,1,M)(4,ot,2,2,"div",30),n()),i&2){let t=y(3),l=s();r(),d("ngIf",l.operations.length>0)("ngIfElse",t),r(3),d("ngIf",l.operations.length>0)}}function at(i,p){i&1&&(e(0,"div",41),o(1,"Loading operations..."),n())}function lt(i,p){if(i&1&&(e(0,"div",55),o(1),n()),i&2){let t=s(2);r(),c(t.actionError)}}function st(i,p){if(i&1){let t=b();e(0,"div",42),_("click",function(){u(t);let a=s();return g(a.closeBlockModal())}),e(1,"div",43),_("click",function(a){return u(t),g(a.stopPropagation())}),e(2,"div",44)(3,"h2"),o(4,"Block Operation"),n(),e(5,"button",45),_("click",function(){u(t);let a=s();return g(a.closeBlockModal())}),P(6,"i",46),n()(),e(7,"div",47)(8,"p"),o(9,"Block operation "),e(10,"strong"),o(11),n(),o(12),n(),e(13,"div",48)(14,"label",49),o(15,"Reason *"),n(),e(16,"textarea",50),S("ngModelChange",function(a){u(t);let m=s();return k(m.blockReason,a)||(m.blockReason=a),g(a)}),n()(),x(17,lt,2,1,"div",51),n(),e(18,"div",52)(19,"button",53),_("click",function(){u(t);let a=s();return g(a.closeBlockModal())}),o(20,"Cancel"),n(),e(21,"button",54),_("click",function(){u(t);let a=s();return g(a.confirmBlock())}),o(22),n()()()()}if(i&2){let t=s();r(11),c(t.operationToBlock==null?null:t.operationToBlock.operationName),r(),O(" (",t.operationToBlock==null?null:t.operationToBlock.operationCode,")?"),r(4),v("ngModel",t.blockReason),r(),d("ngIf",t.actionError),r(2),d("disabled",t.blockLoading),r(2),d("disabled",t.blockLoading||!t.blockReason.trim()),r(),O(" ",t.blockLoading?"Blocking...":"Block"," ")}}var H=(()=>{class i{constructor(t){this.apiService=t,this.allOperations=[],this.operations=[],this.loading=!0,this.error="",this.actionError="",this.filterStatus="all",this.searchTerm="",this.statuses=["NOT_STARTED","READY","IN_PROGRESS","CONFIRMED","PARTIALLY_CONFIRMED","ON_HOLD","BLOCKED"],this.showBlockModal=!1,this.operationToBlock=null,this.blockReason="",this.blockLoading=!1}ngOnInit(){this.loadOperations()}loadOperations(){this.loading=!0,this.error="",this.apiService.getAllOperations().subscribe({next:t=>{this.allOperations=t,this.applyFilters(),this.loading=!1},error:t=>{this.error=t.error?.message||"Failed to load operations.",this.loading=!1}})}applyFilters(){let t=[...this.allOperations];if(this.filterStatus&&this.filterStatus!=="all"&&(t=t.filter(l=>l.status===this.filterStatus)),this.searchTerm){let l=this.searchTerm.toLowerCase();t=t.filter(a=>a.operationName?.toLowerCase().includes(l)||a.operationCode?.toLowerCase().includes(l)||a.orderNumber?.toLowerCase().includes(l)||a.processName?.toLowerCase().includes(l))}this.operations=t}onFilterStatusChange(t){this.filterStatus=t,this.applyFilters()}onSearchChange(t){this.searchTerm=t,this.applyFilters()}getStatusClass(t){return t?.toLowerCase().replace(/_/g,"-")||""}countByStatus(t){return this.allOperations.filter(l=>l.status===t).length}openBlockModal(t){this.operationToBlock=t,this.blockReason="",this.actionError="",this.showBlockModal=!0}closeBlockModal(){this.showBlockModal=!1,this.operationToBlock=null,this.blockReason=""}confirmBlock(){!this.operationToBlock||!this.blockReason.trim()||(this.blockLoading=!0,this.actionError="",this.apiService.blockOperation(this.operationToBlock.operationId,this.blockReason).subscribe({next:()=>{this.blockLoading=!1,this.closeBlockModal(),this.loadOperations()},error:t=>{this.blockLoading=!1,this.actionError=t.error?.message||"Failed to block operation."}}))}unblockOperation(t){this.actionError="",this.apiService.unblockOperation(t.operationId).subscribe({next:()=>{this.loadOperations()},error:l=>{this.actionError=l.error?.message||"Failed to unblock operation."}})}static{this.\u0275fac=function(l){return new(l||i)(T(Y))}}static{this.\u0275cmp=I({type:i,selectors:[["app-operation-list"]],decls:23,vars:8,consts:[["loadingTpl",""],["emptyTpl",""],[1,"operation-list-page"],[1,"page-header"],[1,"card"],[1,"filters"],[1,"filter-group"],["for","status-filter"],["id","status-filter",3,"ngModelChange","change","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"filter-group","search-group"],["for","search"],["type","text","id","search","placeholder","Search by name, code, order...",3,"ngModelChange","input","ngModel"],["class","error-banner",4,"ngIf"],["class","summary-cards",4,"ngIf"],["class","table-container",4,"ngIf","ngIfElse"],["class","modal-overlay",3,"click",4,"ngIf"],[3,"value"],[1,"error-banner"],[1,"summary-cards"],[1,"summary-card"],[1,"count"],[1,"label"],[1,"summary-card","ready"],[1,"summary-card","in-progress"],[1,"summary-card","confirmed"],[1,"summary-card","blocked"],[1,"table-container"],["class","data-table",4,"ngIf","ngIfElse"],["class","result-count",4,"ngIf"],[1,"data-table"],[3,"blocked-row",4,"ngFor","ngForOf"],[1,"status-badge",3,"ngClass"],[1,"actions"],["class","btn btn-sm btn-warning",3,"click",4,"ngIf"],["class","btn btn-sm btn-success",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-warning",3,"click"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"empty-state"],[1,"result-count"],[1,"loading"],[1,"modal-overlay",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"fas","fa-xmark"],[1,"modal-body"],[1,"form-group"],["for","blockReason"],["id","blockReason","rows","3","placeholder","Enter reason for blocking...",3,"ngModelChange","ngModel"],["class","error",4,"ngIf"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"btn","btn-warning",3,"click","disabled"],[1,"error"]],template:function(l,a){if(l&1){let m=b();e(0,"div",2)(1,"div",3)(2,"h1"),o(3,"Operations"),n()(),e(4,"div",4)(5,"div",5)(6,"div",6)(7,"label",7),o(8,"Status:"),n(),e(9,"select",8),S("ngModelChange",function(f){return u(m),k(a.filterStatus,f)||(a.filterStatus=f),g(f)}),_("change",function(){return u(m),g(a.onFilterStatusChange(a.filterStatus))}),e(10,"option",9),o(11,"All Statuses"),n(),x(12,J,2,2,"option",10),n()(),e(13,"div",11)(14,"label",12),o(15,"Search:"),n(),e(16,"input",13),S("ngModelChange",function(f){return u(m),k(a.searchTerm,f)||(a.searchTerm=f),g(f)}),_("input",function(){return u(m),g(a.onSearchChange(a.searchTerm))}),n()()()(),x(17,X,2,1,"div",14)(18,Z,26,5,"div",15)(19,rt,5,3,"div",16)(20,at,2,0,"ng-template",null,0,M)(22,st,23,7,"div",17),n()}if(l&2){let m=y(21);r(9),v("ngModel",a.filterStatus),r(3),d("ngForOf",a.statuses),r(4),v("ngModel",a.searchTerm),r(),d("ngIf",a.actionError),r(),d("ngIf",!a.loading),r(),d("ngIf",!a.loading)("ngIfElse",m),r(3),d("ngIf",a.showBlockModal)}},dependencies:[R,V,N,j,K,D,z,A,W],styles:[".operation-list-page[_ngcontent-%COMP%]{padding:20px}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:12px 16px;border-radius:4px;margin-bottom:16px}.summary-cards[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:20px;flex-wrap:wrap}.summary-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:16px 24px;box-shadow:0 1px 3px #0000001a;text-align:center;min-width:120px;border-top:3px solid #dee2e6}.summary-card[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{display:block;font-size:24px;font-weight:700;color:#333}.summary-card[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;color:#666;text-transform:uppercase}.summary-card.ready[_ngcontent-%COMP%]{border-top-color:#4caf50}.summary-card.in-progress[_ngcontent-%COMP%]{border-top-color:#1976d2}.summary-card.confirmed[_ngcontent-%COMP%]{border-top-color:#388e3c}.summary-card.blocked[_ngcontent-%COMP%]{border-top-color:#d32f2f}.table-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;overflow:hidden}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase}.status-badge.not-started[_ngcontent-%COMP%]{background:#e9ecef;color:#757575}.status-badge.ready[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-badge.in-progress[_ngcontent-%COMP%]{background:#cce5ff;color:#004085}.status-badge.confirmed[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-badge.partially-confirmed[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-badge.on-hold[_ngcontent-%COMP%], .status-badge.blocked[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.blocked-row[_ngcontent-%COMP%]{background:#fff5f5}.actions[_ngcontent-%COMP%]{display:flex;gap:8px}.btn-warning[_ngcontent-%COMP%]{background:#ffc107;color:#212529}.btn-warning[_ngcontent-%COMP%]:hover:not(:disabled){background:#e0a800}.btn-success[_ngcontent-%COMP%]{background:#28a745;color:#fff}.btn-success[_ngcontent-%COMP%]:hover:not(:disabled){background:#218838}.form-group[_ngcontent-%COMP%]{margin-top:16px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;margin-bottom:6px;color:#555}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;resize:vertical}.result-count[_ngcontent-%COMP%]{padding:12px 16px;border-top:1px solid #eee;font-size:13px;color:#666}.empty-state[_ngcontent-%COMP%], .loading[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}"]})}}return i})();var ct=[{path:"",component:H}],U=(()=>{class i{static{this.\u0275fac=function(l){return new(l||i)}}static{this.\u0275mod=C({type:i})}static{this.\u0275inj=h({imports:[w.forChild(ct),w]})}}return i})();var kt=(()=>{class i{static{this.\u0275fac=function(l){return new(l||i)}}static{this.\u0275mod=C({type:i})}static{this.\u0275inj=h({imports:[F,Q,U,q]})}}return i})();export{kt as OperationsModule};
