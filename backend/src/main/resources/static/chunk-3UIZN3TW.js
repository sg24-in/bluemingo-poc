import{a as z,b as L,c as B,d as W,f as $}from"./chunk-PSDCBCWL.js";import{A as f,E as S,F as M,G as E,I,K as T,N as O,O as k,Q,R as V,_ as R,ba as w,d as P,ea as D,f as j,g as y,ga as N,h as p,i as m,ia as q,k as r,l as C,m as _,o as d,p as b,r as i,s as n,t as h,u as v,v as g,w as c,wa as F,xa as A,y as o,z as x}from"./chunk-SDYT7PYO.js";function G(t,l){if(t&1){let e=v();i(0,"div",9),g("click",function(){p(e);let s=c();return m(s.clearMessages())}),o(1),i(2,"button",10),o(3,"\xD7"),n()()}if(t&2){let e=c();r(),f(" ",e.error," ")}}function H(t,l){if(t&1){let e=v();i(0,"div",11),g("click",function(){p(e);let s=c();return m(s.clearMessages())}),o(1),i(2,"button",10),o(3,"\xD7"),n()()}if(t&2){let e=c();r(),f(" ",e.success," ")}}function K(t,l){t&1&&(i(0,"div",12),h(1,"app-loading-spinner",13),n())}function X(t,l){if(t&1&&(i(0,"span",19),o(1),n()),t&2){let e=c(2);r(),f(" ",e.qualityPendingProcesses.length," ")}}function Z(t,l){if(t&1&&(i(0,"span",20),o(1),n()),t&2){let e=c(2);r(),f(" ",e.rejectedProcesses.length," ")}}function ee(t,l){if(t&1){let e=v();i(0,"tr")(1,"td"),o(2),n(),i(3,"td"),o(4),n(),i(5,"td"),o(6),n(),i(7,"td"),h(8,"app-status-badge",29),n(),i(9,"td"),o(10),I(11,"date"),n(),i(12,"td",30)(13,"button",31),g("click",function(){let s=p(e).$implicit,u=c(4);return m(u.openDecisionModal(s,"accept"))}),o(14," Accept "),n(),i(15,"button",32),g("click",function(){let s=p(e).$implicit,u=c(4);return m(u.openDecisionModal(s,"reject"))}),o(16," Reject "),n()()()}if(t&2){let e=l.$implicit,a=c(4);r(2),x(e.processId),r(2),x(e.stageName),r(2),x(a.getOperationsSummary(e)),r(2),d("status",e.status),r(2),x(T(11,7,e.updatedOn,"short")),r(3),d("disabled",a.processing),r(2),d("disabled",a.processing)}}function te(t,l){if(t&1&&(i(0,"table",27)(1,"thead")(2,"tr")(3,"th"),o(4,"Process ID"),n(),i(5,"th"),o(6,"Stage Name"),n(),i(7,"th"),o(8,"Operations"),n(),i(9,"th"),o(10,"Status"),n(),i(11,"th"),o(12,"Updated"),n(),i(13,"th"),o(14,"Actions"),n()()(),i(15,"tbody"),_(16,ee,17,10,"tr",28),n()()),t&2){let e=c(3);r(16),d("ngForOf",e.qualityPendingProcesses)}}function ne(t,l){t&1&&(i(0,"p",33),o(1," No processes awaiting quality inspection "),n())}function ie(t,l){if(t&1&&(i(0,"div",21)(1,"div",22)(2,"div",23)(3,"span"),o(4,"Processes Awaiting Quality Inspection"),n()(),i(5,"div",24),_(6,te,17,1,"table",25)(7,ne,2,0,"p",26),n()()()),t&2){let e=c(2);r(6),d("ngIf",e.qualityPendingProcesses.length>0),r(),d("ngIf",e.qualityPendingProcesses.length===0)}}function oe(t,l){if(t&1){let e=v();i(0,"tr")(1,"td"),o(2),n(),i(3,"td"),o(4),n(),i(5,"td"),o(6),n(),i(7,"td"),h(8,"app-status-badge",29),n(),i(9,"td"),o(10),I(11,"date"),n(),i(12,"td",30)(13,"button",34),g("click",function(){let s=p(e).$implicit,u=c(4);return m(u.retryProcess(s))}),o(14," Retry Inspection "),n()()()}if(t&2){let e=l.$implicit,a=c(4);r(2),x(e.processId),r(2),x(e.stageName),r(2),x(a.getOperationsSummary(e)),r(2),d("status",e.status),r(2),x(T(11,6,e.updatedOn,"short")),r(3),d("disabled",a.processing)}}function re(t,l){if(t&1&&(i(0,"table",27)(1,"thead")(2,"tr")(3,"th"),o(4,"Process ID"),n(),i(5,"th"),o(6,"Stage Name"),n(),i(7,"th"),o(8,"Operations"),n(),i(9,"th"),o(10,"Status"),n(),i(11,"th"),o(12,"Updated"),n(),i(13,"th"),o(14,"Actions"),n()()(),i(15,"tbody"),_(16,oe,15,9,"tr",28),n()()),t&2){let e=c(3);r(16),d("ngForOf",e.rejectedProcesses)}}function se(t,l){t&1&&(i(0,"p",33),o(1," No rejected processes "),n())}function ae(t,l){if(t&1&&(i(0,"div",21)(1,"div",22)(2,"div",23)(3,"span"),o(4,"Rejected Processes"),n()(),i(5,"div",24),_(6,re,17,1,"table",25)(7,se,2,0,"p",26),n()()()),t&2){let e=c(2);r(6),d("ngIf",e.rejectedProcesses.length>0),r(),d("ngIf",e.rejectedProcesses.length===0)}}function ce(t,l){if(t&1){let e=v();i(0,"div")(1,"div",14)(2,"button",15),g("click",function(){p(e);let s=c();return m(s.setActiveTab("pending"))}),o(3," Quality Pending "),_(4,X,2,1,"span",16),n(),i(5,"button",15),g("click",function(){p(e);let s=c();return m(s.setActiveTab("rejected"))}),o(6," Rejected "),_(7,Z,2,1,"span",17),n()(),_(8,ie,8,2,"div",18)(9,ae,8,2,"div",18),n()}if(t&2){let e=c();r(2),b("active",e.activeTab==="pending"),r(2),d("ngIf",e.qualityPendingProcesses.length>0),r(),b("active",e.activeTab==="rejected"),r(2),d("ngIf",e.rejectedProcesses.length>0),r(),d("ngIf",e.activeTab==="pending"),r(),d("ngIf",e.activeTab==="rejected")}}function de(t,l){if(t&1&&(i(0,"div",51)(1,"p")(2,"strong"),o(3,"Process ID:"),n(),o(4),n(),i(5,"p")(6,"strong"),o(7,"Stage Name:"),n(),o(8),n(),i(9,"p")(10,"strong"),o(11,"Operations:"),n(),o(12),n()()),t&2){let e=c(2);r(4),f(" ",e.selectedProcess.processId,""),r(4),f(" ",e.selectedProcess.stageName,""),r(4),f(" ",e.getOperationsSummary(e.selectedProcess),"")}}function le(t,l){t&1&&(i(0,"div",52)(1,"p"),o(2,"Are you sure you want to accept this process?"),n(),i(3,"p"),o(4,"The process will be marked as "),i(5,"strong"),o(6,"COMPLETED"),n(),o(7,"."),n()())}function pe(t,l){t&1&&(i(0,"div",53)(1,"p"),o(2,"Please provide a reason for rejecting this process."),n(),i(3,"p"),o(4,"The process will be marked as "),i(5,"strong"),o(6,"REJECTED"),n(),o(7,"."),n()())}function me(t,l){if(t&1){let e=v();i(0,"div",44)(1,"label",54),o(2,"Rejection Reason *"),n(),i(3,"textarea",55),E("ngModelChange",function(s){p(e);let u=c(2);return M(u.rejectReason,s)||(u.rejectReason=s),m(s)}),n()()}if(t&2){let e=c(2);r(3),S("ngModel",e.rejectReason)}}function ge(t,l){if(t&1&&(i(0,"div",56),o(1),n()),t&2){let e=c(2);r(),x(e.error)}}function _e(t,l){if(t&1){let e=v();i(0,"div",35),g("click",function(){p(e);let s=c();return m(s.closeDecisionModal())}),i(1,"div",36),g("click",function(s){return p(e),m(s.stopPropagation())}),i(2,"div",37)(3,"h3"),o(4),n(),i(5,"button",38),g("click",function(){p(e);let s=c();return m(s.closeDecisionModal())}),o(6,"\xD7"),n()(),i(7,"div",39),_(8,de,13,3,"div",40)(9,le,8,0,"div",41)(10,pe,8,0,"div",42)(11,me,4,1,"div",43),i(12,"div",44)(13,"label",45),o(14,"Notes (Optional)"),n(),i(15,"textarea",46),E("ngModelChange",function(s){p(e);let u=c();return M(u.notes,s)||(u.notes=s),m(s)}),n()(),_(16,ge,2,1,"div",47),n(),i(17,"div",48)(18,"button",49),g("click",function(){p(e);let s=c();return m(s.closeDecisionModal())}),o(19,"Cancel"),n(),i(20,"button",50),g("click",function(){p(e);let s=c();return m(s.submitDecision())}),o(21),n()()()()}if(t&2){let e=c();r(2),b("accept-header",e.decisionType==="accept")("reject-header",e.decisionType==="reject"),r(2),x(e.decisionType==="accept"?"Accept Process":"Reject Process"),r(4),d("ngIf",e.selectedProcess),r(),d("ngIf",e.decisionType==="accept"),r(),d("ngIf",e.decisionType==="reject"),r(),d("ngIf",e.decisionType==="reject"),r(4),S("ngModel",e.notes),r(),d("ngIf",e.error),r(4),b("btn-success",e.decisionType==="accept")("btn-danger",e.decisionType==="reject"),d("disabled",e.processing||e.decisionType==="reject"&&!e.rejectReason.trim()),r(),f(" ",e.processing?"Processing...":e.decisionType==="accept"?"Accept":"Reject"," ")}}var J=(()=>{class t{constructor(e,a){this.apiService=e,this.router=a,this.qualityPendingProcesses=[],this.rejectedProcesses=[],this.loading=!0,this.error="",this.success="",this.selectedProcess=null,this.showDecisionModal=!1,this.decisionType=null,this.rejectReason="",this.notes="",this.processing=!1,this.activeTab="pending"}ngOnInit(){this.loadProcesses()}loadProcesses(){this.loading=!0,this.error="",this.apiService.getQualityPendingProcesses().subscribe({next:e=>{this.qualityPendingProcesses=e,this.loadRejectedProcesses()},error:e=>{console.error("Error loading quality pending processes:",e),this.error="Failed to load quality pending processes",this.loading=!1}})}loadRejectedProcesses(){this.apiService.getProcessesByStatus("REJECTED").subscribe({next:e=>{this.rejectedProcesses=e,this.loading=!1},error:e=>{console.error("Error loading rejected processes:",e),this.loading=!1}})}setActiveTab(e){this.activeTab=e}openDecisionModal(e,a){this.selectedProcess=e,this.decisionType=a,this.rejectReason="",this.notes="",this.showDecisionModal=!0,this.error=""}closeDecisionModal(){this.showDecisionModal=!1,this.selectedProcess=null,this.decisionType=null,this.rejectReason="",this.notes=""}submitDecision(){if(!(!this.selectedProcess||!this.decisionType)){if(this.decisionType==="reject"&&!this.rejectReason.trim()){this.error="Rejection reason is required";return}this.processing=!0,this.error="",this.decisionType==="accept"?this.apiService.acceptProcess(this.selectedProcess.processId,this.notes).subscribe({next:e=>{this.success=`Process ${this.selectedProcess?.stageName} accepted and marked as completed`,this.closeDecisionModal(),this.loadProcesses(),this.processing=!1},error:e=>{console.error("Error accepting process:",e),this.error=e.error?.message||"Failed to accept process",this.processing=!1}}):this.apiService.rejectProcess(this.selectedProcess.processId,this.rejectReason,this.notes).subscribe({next:e=>{this.success=`Process ${this.selectedProcess?.stageName} rejected`,this.closeDecisionModal(),this.loadProcesses(),this.processing=!1},error:e=>{console.error("Error rejecting process:",e),this.error=e.error?.message||"Failed to reject process",this.processing=!1}})}}retryProcess(e){this.processing=!0,this.error="",this.apiService.updateProcessStatus({processId:e.processId,newStatus:"QUALITY_PENDING"}).subscribe({next:a=>{this.success=`Process ${e.stageName} moved back to quality pending for re-inspection`,this.loadProcesses(),this.processing=!1},error:a=>{console.error("Error retrying process:",a),this.error=a.error?.message||"Failed to retry process",this.processing=!1}})}getOperationsSummary(e){return!e.operations||e.operations.length===0?"No operations":`${e.operations.filter(s=>s.status==="CONFIRMED").length}/${e.operations.length} confirmed`}navigateToOrder(e){this.router.navigate(["/orders"])}clearMessages(){this.error="",this.success=""}static{this.\u0275fac=function(a){return new(a||t)(C(z),C(R))}}static{this.\u0275cmp=j({type:t,selectors:[["app-quality-pending"]],decls:12,vars:5,consts:[[1,"container"],[1,"page-header"],[1,"page-title"],[1,"page-subtitle"],["class","alert alert-error",3,"click",4,"ngIf"],["class","alert alert-success",3,"click",4,"ngIf"],["class","text-center",4,"ngIf"],[4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-error",3,"click"],[1,"alert-close"],[1,"alert","alert-success",3,"click"],[1,"text-center"],["message","Loading processes..."],[1,"tab-nav"],[1,"tab-btn",3,"click"],["class","badge",4,"ngIf"],["class","badge rejected",4,"ngIf"],["class","tab-content",4,"ngIf"],[1,"badge"],[1,"badge","rejected"],[1,"tab-content"],[1,"card"],[1,"card-header"],[1,"card-body"],["class","table",4,"ngIf"],["class","no-data",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],[3,"status"],[1,"actions-cell"],[1,"btn","btn-sm","btn-success",3,"click","disabled"],[1,"btn","btn-sm","btn-danger",3,"click","disabled"],[1,"no-data"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"modal-body"],["class","process-details",4,"ngIf"],["class","decision-info accept-info",4,"ngIf"],["class","decision-info reject-info",4,"ngIf"],["class","form-group",4,"ngIf"],[1,"form-group"],["for","notes"],["id","notes","rows","2","placeholder","Additional notes...",3,"ngModelChange","ngModel"],["class","alert alert-error modal-error",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn",3,"click","disabled"],[1,"process-details"],[1,"decision-info","accept-info"],[1,"decision-info","reject-info"],["for","rejectReason"],["id","rejectReason","rows","3","placeholder","Enter the reason for rejection...",3,"ngModelChange","ngModel"],[1,"alert","alert-error","modal-error"]],template:function(a,s){a&1&&(h(0,"app-header"),i(1,"div",0)(2,"div",1)(3,"h1",2),o(4,"Quality Inspection"),n(),i(5,"p",3),o(6,"Review and approve or reject processes awaiting quality inspection"),n()(),_(7,G,4,1,"div",4)(8,H,4,1,"div",5)(9,K,2,0,"div",6)(10,ce,10,8,"div",7),n(),_(11,_e,22,17,"div",8)),a&2&&(r(7),d("ngIf",s.error),r(),d("ngIf",s.success),r(),d("ngIf",s.loading),r(),d("ngIf",!s.loading),r(),d("ngIf",s.showDecisionModal))},dependencies:[O,k,D,N,q,L,B,W,Q],styles:['.page-subtitle[_ngcontent-%COMP%]{color:#666;font-size:14px;margin-top:4px}.tab-nav[_ngcontent-%COMP%]{display:flex;gap:4px;margin-bottom:20px;border-bottom:2px solid #e0e0e0;padding-bottom:0}.tab-btn[_ngcontent-%COMP%]{padding:12px 24px;border:none;background:transparent;cursor:pointer;font-size:14px;font-weight:500;color:#666;position:relative;display:flex;align-items:center;gap:8px}.tab-btn[_ngcontent-%COMP%]:hover, .tab-btn.active[_ngcontent-%COMP%]{color:#1976d2}.tab-btn.active[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-2px;left:0;right:0;height:2px;background:#1976d2}.tab-btn[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#1976d2;color:#fff;padding:2px 8px;border-radius:12px;font-size:12px}.tab-btn[_ngcontent-%COMP%]   .badge.rejected[_ngcontent-%COMP%]{background:#c62828}.actions-cell[_ngcontent-%COMP%]{display:flex;gap:8px}.btn-danger[_ngcontent-%COMP%]{background-color:#c62828;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#b71c1c}.alert[_ngcontent-%COMP%]{padding:12px 16px;border-radius:4px;margin-bottom:16px;position:relative;cursor:pointer}.alert-success[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32;border:1px solid #a5d6a7}.alert-error[_ngcontent-%COMP%]{background:#ffebee;color:#c62828;border:1px solid #ef9a9a}.alert-close[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;font-size:18px;cursor:pointer;color:inherit}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:8px;width:90%;max-width:500px;max-height:90vh;overflow-y:auto;box-shadow:0 4px 20px #00000026}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid #eee}.modal-header.accept-header[_ngcontent-%COMP%]{background:#e8f5e9;border-bottom-color:#a5d6a7}.modal-header.reject-header[_ngcontent-%COMP%]{background:#ffebee;border-bottom-color:#ef9a9a}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:24px;cursor:pointer;color:#666}.close-btn[_ngcontent-%COMP%]:hover{color:#333}.modal-body[_ngcontent-%COMP%]{padding:20px}.modal-footer[_ngcontent-%COMP%]{padding:16px 20px;border-top:1px solid #eee;display:flex;justify-content:flex-end;gap:12px}.process-details[_ngcontent-%COMP%]{background:#f5f5f5;padding:12px;border-radius:4px;margin-bottom:16px}.process-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0}.decision-info[_ngcontent-%COMP%]{padding:12px;border-radius:4px;margin-bottom:16px}.decision-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0}.accept-info[_ngcontent-%COMP%]{background:#e8f5e9;border-left:4px solid #4caf50}.reject-info[_ngcontent-%COMP%]{background:#ffebee;border-left:4px solid #c62828}.form-group[_ngcontent-%COMP%]{margin-bottom:16px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:13px;font-weight:500;margin-bottom:4px;color:#333}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;resize:vertical}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2}.modal-error[_ngcontent-%COMP%]{margin-bottom:0}.no-data[_ngcontent-%COMP%]{text-align:center;color:#888;padding:40px}']})}}return t})();var ue=[{path:"quality-pending",component:J},{path:"",redirectTo:"quality-pending",pathMatch:"full"}],Y=(()=>{class t{static{this.\u0275fac=function(a){return new(a||t)}}static{this.\u0275mod=y({type:t})}static{this.\u0275inj=P({imports:[w.forChild(ue),w]})}}return t})();var Qe=(()=>{class t{static{this.\u0275fac=function(a){return new(a||t)}}static{this.\u0275mod=y({type:t})}static{this.\u0275inj=P({imports:[V,F,A,Y,$]})}}return t})();export{Qe as ProcessesModule};
