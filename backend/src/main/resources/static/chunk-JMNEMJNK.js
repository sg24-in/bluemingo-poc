import{a as G,b as Ce}from"./chunk-YSMJKQKZ.js";import{d as $,e as B,f as Oe,g as be}from"./chunk-DC6H7RTP.js";import{d as M}from"./chunk-CX5NRPTH.js";import"./chunk-Q66F4YPD.js";import{$ as E,Aa as ce,Ba as pe,Ca as me,D as b,Da as ue,E as g,Ea as ge,F as p,Fa as fe,G as te,Ga as q,H as ne,Ha as j,I as ie,Ja as _e,K as d,L as f,La as xe,M as O,Ma as he,N,Na as ve,V as w,X as D,Z as re,aa as S,da as R,fa as oe,g as z,i as I,j as V,l as _,m as x,ma as A,o,oa as P,p as h,r as m,ra as Y,t as s,ua as ae,v as y,va as v,w as ee,wa as de,x as i,xa as se,y as n,z as u,za as le}from"./chunk-KBMCX72K.js";function ke(t,l){t&1&&(i(0,"div",17),u(1,"app-loading-spinner",18),n())}function Le(t,l){if(t&1){let e=b();i(0,"tr")(1,"td"),d(2),n(),i(3,"td"),d(4),n(),i(5,"td"),d(6),n(),i(7,"td"),d(8),n(),i(9,"td"),u(10,"app-status-badge",24),n(),i(11,"td"),d(12),w(13,"date"),n(),i(14,"td",25)(15,"button",26),g("click",function(){let a=_(e).$implicit,c=p(3);return x(c.viewOrder(a.orderId))}),d(16," View "),n(),i(17,"button",27),g("click",function(){let a=_(e).$implicit,c=p(3);return x(c.editOrder(a.orderId))}),d(18," Edit "),n()()()}if(t&2){let e=l.$implicit,r=p(3);o(2),f(e.orderNumber||"ORD-"+e.orderId),o(2),f(e.customerName||"N/A"),o(2),f(r.getProductInfo(e)),o(2),f(r.getTotalQuantity(e)),o(2),s("status",e.status),o(2),f(D(13,6,e.orderDate,"mediumDate"))}}function ze(t,l){if(t&1&&(i(0,"table",22)(1,"thead")(2,"tr")(3,"th"),d(4,"Order Number"),n(),i(5,"th"),d(6,"Customer"),n(),i(7,"th"),d(8,"Product"),n(),i(9,"th"),d(10,"Quantity"),n(),i(11,"th"),d(12,"Status"),n(),i(13,"th"),d(14,"Order Date"),n(),i(15,"th"),d(16,"Actions"),n()()(),i(17,"tbody"),m(18,Le,19,9,"tr",23),n()()),t&2){let e=p(2);o(18),s("ngForOf",e.orders)}}function Ve(t,l){t&1&&(i(0,"p",28),d(1," No orders found matching the selected filter. "),n())}function Re(t,l){if(t&1){let e=b();i(0,"app-pagination",29),g("pageChange",function(a){_(e);let c=p(2);return x(c.onPageChange(a))})("sizeChange",function(a){_(e);let c=p(2);return x(c.onSizeChange(a))}),n()}if(t&2){let e=p(2);s("page",e.page)("size",e.size)("totalElements",e.totalElements)("totalPages",e.totalPages)("hasNext",e.hasNext)("hasPrevious",e.hasPrevious)}}function Ae(t,l){if(t&1&&(i(0,"div",4),m(1,ze,19,1,"table",19)(2,Ve,2,0,"p",20)(3,Re,1,6,"app-pagination",21),n()),t&2){let e=p();o(),s("ngIf",e.orders.length>0),o(),s("ngIf",e.orders.length===0),o(),s("ngIf",e.orders.length>0)}}var Se=(()=>{class t{constructor(e,r){this.apiService=e,this.router=r,this.orders=[],this.loading=!0,this.page=0,this.size=20,this.totalElements=0,this.totalPages=0,this.hasNext=!1,this.hasPrevious=!1,this.filterStatus="",this.searchTerm=""}ngOnInit(){this.loadOrders()}loadOrders(){this.loading=!0;let e={page:this.page,size:this.size,sortBy:"orderDate",sortDirection:"DESC",status:this.filterStatus||void 0,search:this.searchTerm||void 0};this.apiService.getOrdersPaged(e).subscribe({next:r=>{this.orders=r.content,this.page=r.page,this.size=r.size,this.totalElements=r.totalElements,this.totalPages=r.totalPages,this.hasNext=r.hasNext,this.hasPrevious=r.hasPrevious,this.loading=!1},error:r=>{console.error("Error loading orders:",r),this.loading=!1}})}onPageChange(e){this.page=e,this.loadOrders()}onSizeChange(e){this.size=e,this.page=0,this.loadOrders()}onFilterChange(e){this.filterStatus=e==="all"?"":e,this.page=0,this.loadOrders()}onSearch(e){this.searchTerm=e,this.page=0,this.loadOrders()}viewOrder(e){this.router.navigate(["/orders",e])}createOrder(){this.router.navigate(["/orders/new"])}editOrder(e){this.router.navigate(["/orders",e,"edit"])}getProductInfo(e){return e.lineItems&&e.lineItems.length>0?e.lineItems[0].productName:"N/A"}getTotalQuantity(e){return e.lineItems&&e.lineItems.length>0?e.lineItems.reduce((r,a)=>r+(a.quantity||0),0):0}static{this.\u0275fac=function(r){return new(r||t)(h(M),h(P))}}static{this.\u0275cmp=I({type:t,selectors:[["app-order-list"]],decls:26,vars:4,consts:[[1,"container"],[1,"page-header"],[1,"page-title"],[1,"btn","btn-primary",3,"click"],[1,"card"],[1,"filters"],[1,"search-group"],["type","text","placeholder","Search orders...",1,"search-input",3,"input","value"],[1,"filter-group"],[3,"change","value"],["value","all"],["value","CREATED"],["value","IN_PROGRESS"],["value","COMPLETED"],["value","CANCELLED"],["class","text-center",4,"ngIf"],["class","card",4,"ngIf"],[1,"text-center"],["message","Loading orders..."],["class","table",4,"ngIf"],["class","no-data",4,"ngIf"],[3,"page","size","totalElements","totalPages","hasNext","hasPrevious","pageChange","sizeChange",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],[3,"status"],[1,"actions"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"btn","btn-secondary","btn-sm",3,"click"],[1,"no-data"],[3,"pageChange","sizeChange","page","size","totalElements","totalPages","hasNext","hasPrevious"]],template:function(r,a){r&1&&(i(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"Production Orders"),n(),i(4,"button",3),g("click",function(){return a.createOrder()}),d(5,"+ New Order"),n()(),i(6,"div",4)(7,"div",5)(8,"div",6)(9,"input",7),g("input",function(C){return a.onSearch(C.target.value)}),n()(),i(10,"div",8)(11,"label"),d(12,"Status:"),n(),i(13,"select",9),g("change",function(C){return a.onFilterChange(C.target.value)}),i(14,"option",10),d(15,"All"),n(),i(16,"option",11),d(17,"Created"),n(),i(18,"option",12),d(19,"In Progress"),n(),i(20,"option",13),d(21,"Completed"),n(),i(22,"option",14),d(23,"Cancelled"),n()()()()(),m(24,ke,2,0,"div",15)(25,Ae,4,3,"div",16),n()),r&2&&(o(9),s("value",a.searchTerm),o(4),s("value",a.filterStatus||"all"),o(11),s("ngIf",a.loading),o(),s("ngIf",!a.loading))},dependencies:[E,S,q,j,$,B,Oe,R],styles:[".page-title-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:16px}.page-title-section[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{white-space:nowrap}.header-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.search-input[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;width:250px}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2}.actions[_ngcontent-%COMP%]{display:flex;gap:8px}"]})}}return t})();var qe=["processFlowChart"];function je(t,l){if(t&1){let e=b();i(0,"button",9),g("click",function(){_(e);let a=p();return x(a.editOrder())}),d(1,"Edit Order"),n()}}function Ge(t,l){t&1&&(i(0,"div",10),u(1,"app-loading-spinner",11),n())}function $e(t,l){if(t&1&&(i(0,"span"),d(1,"Customer: "),i(2,"strong"),d(3),n()()),t&2){let e=p(2);o(3),f(e.order.customerName)}}function Be(t,l){if(t&1&&(i(0,"span"),d(1,"Order Date: "),i(2,"strong"),d(3),w(4,"date"),n()()),t&2){let e=p(2);o(3),f(D(4,1,e.order.orderDate,"mediumDate"))}}function Qe(t,l){t&1&&(i(0,"div",12)(1,"div",18),d(2,"Process Flow"),n(),u(3,"div",19,0),n())}function Ue(t,l){if(t&1&&(i(0,"span",26),d(1),w(2,"date"),n()),t&2){let e=p().$implicit;o(),O("Delivery: ",D(2,1,e.deliveryDate,"mediumDate"),"")}}function We(t,l){t&1&&u(0,"div",41)}function Ye(t,l){if(t&1&&(i(0,"span"),d(1),n()),t&2){let e=p().$implicit;o(),O("Planned: ",e.plannedQuantity,"")}}function He(t,l){if(t&1&&(i(0,"span"),d(1),n()),t&2){let e=p().$implicit;o(),O("Completed: ",e.completedQuantity,"")}}function Ke(t,l){if(t&1){let e=b();i(0,"div",42)(1,"button",43),g("click",function(){_(e);let a=p().$implicit,c=p(4);return x(c.startProduction(a.operationId))}),d(2),n()()}if(t&2){let e=p().$implicit;o(2),O(" ",e.status==="IN_PROGRESS"?"Continue Production":"Start Production"," ")}}function Xe(t,l){if(t&1&&(i(0,"div",31)(1,"div",32)(2,"div",33),d(3),n(),m(4,We,1,0,"div",34),n(),i(5,"div",35)(6,"div",36)(7,"span",37),d(8),n(),i(9,"span",38),d(10),n(),u(11,"app-status-badge",15),n(),i(12,"div",39)(13,"span"),d(14),n(),m(15,Ye,2,1,"span",7)(16,He,2,1,"span",7),n(),m(17,Ke,3,1,"div",40),n()()),t&2){let e=l.$implicit,r=l.index,a=p().$implicit,c=p(3);ee(c.getOperationStatusClass(e.status)),o(3),f(r+1),o(),s("ngIf",r<a.operations.length-1),o(4),f(e.operationName),o(2),O("(",e.operationCode,")"),o(),s("status",e.status),o(3),O("Type: ",e.operationType,""),o(),s("ngIf",e.plannedQuantity),o(),s("ngIf",e.completedQuantity),o(),s("ngIf",c.canStartOperation(e))}}function Ze(t,l){if(t&1&&(i(0,"div",27)(1,"div",28)(2,"h4"),d(3),n(),u(4,"app-status-badge",15),n(),i(5,"div",29),m(6,Xe,18,11,"div",30),n()()),t&2){let e=l.$implicit;o(3),f(e.stageName),o(),s("status",e.status),o(2),s("ngForOf",e.operations)}}function Je(t,l){if(t&1&&(i(0,"div",12)(1,"div",20)(2,"div")(3,"h3"),d(4),n(),i(5,"p",21),d(6),n()(),i(7,"div",22)(8,"span",23),d(9),n(),m(10,Ue,3,4,"span",24),n()(),m(11,Ze,7,3,"div",25),n()),t&2){let e=l.$implicit;o(4),f(e.productName),o(2),O("SKU: ",e.productSku,""),o(3),N("",e.quantity," ",e.unit,""),o(),s("ngIf",e.deliveryDate),o(),s("ngForOf",e.processes)}}function et(t,l){if(t&1&&(i(0,"div")(1,"div",12)(2,"div",13)(3,"div",14)(4,"h2"),d(5),n(),u(6,"app-status-badge",15),n(),i(7,"div",16),m(8,$e,4,1,"span",7)(9,Be,5,4,"span",7),n()()(),m(10,Qe,5,0,"div",8)(11,Je,12,6,"div",17),n()),t&2){let e=p();o(5),O("Order: ",e.order.orderNumber||"ORD-"+e.order.orderId,""),o(),s("status",e.order.status),o(2),s("ngIf",e.order.customerName),o(),s("ngIf",e.order.orderDate),o(),s("ngIf",(e.order.lineItems==null?null:e.order.lineItems.length)>0),o(),s("ngForOf",e.order.lineItems)}}function tt(t,l){t&1&&(i(0,"div",12)(1,"p",44),d(2,"Order not found"),n()())}var Pe=(()=>{class t{constructor(e,r,a,c){this.route=e,this.router=r,this.apiService=a,this.chartService=c,this.order=null,this.loading=!0}ngOnInit(){this.orderId=Number(this.route.snapshot.paramMap.get("orderId")),this.loadOrder()}loadOrder(){this.loading=!0,this.apiService.getOrderById(this.orderId).subscribe({next:e=>{this.order=e,this.loading=!1,setTimeout(()=>this.buildProcessFlowChart(),0)},error:e=>{console.error("Error loading order:",e),this.loading=!1}})}goBack(){this.router.navigate(["/orders"])}editOrder(){this.router.navigate(["/orders",this.orderId,"edit"])}startProduction(e){this.router.navigate(["/production/confirm",e])}canStartOperation(e){return e.status==="PENDING"||e.status==="IN_PROGRESS"}getOperationStatusClass(e){switch(e){case"COMPLETED":return"step-completed";case"IN_PROGRESS":return"step-active";default:return"step-pending"}}ngOnDestroy(){this.chartService.disposeAll()}getStatusColor(e){return{NOT_STARTED:"#9e9e9e",PENDING:"#9e9e9e",READY:"#4caf50",IN_PROGRESS:"#1976d2",COMPLETED:"#388e3c",CONFIRMED:"#388e3c",ON_HOLD:"#f44336",BLOCKED:"#d32f2f"}[e]||"#9e9e9e"}buildProcessFlowChart(){if(!this.processFlowChartRef||!this.order?.lineItems?.length)return;let e=[],r=[],a=0,c=30,C=130,U=160;this.order.lineItems.forEach(T=>{(T.processes||[]).forEach(F=>{let K=`process-${F.processId}`,X=F.operations?.length||1,Ne=a+(X-1)*U/2;e.push({id:K,name:F.stageName,x:Ne,y:c,symbolSize:[120,36],symbol:"roundRect",itemStyle:{color:"#f5f5f5",borderColor:"#1976d2",borderWidth:2},label:{show:!0,fontSize:G.labelBold,fontWeight:"bold",color:"#1976d2"}});let W=null;(F.operations||[]).forEach((k,Z)=>{let L=`op-${k.operationId}`,J=this.getStatusColor(k.status);e.push({id:L,name:`${k.operationName}
[${k.status}]`,x:a+Z*U,y:C,symbolSize:50,itemStyle:{color:J,borderColor:J,borderWidth:2},label:{show:!0,fontSize:G.label,color:"#333",position:"bottom",distance:8}}),Z===0&&r.push({source:K,target:L,lineStyle:{color:"#bbb",width:1.5,type:"dashed"}}),W&&r.push({source:W,target:L,lineStyle:{color:"#666",width:2},symbol:["none","arrow"],symbolSize:8}),W=L}),a+=X*U+80})});let xt=this.chartService.initChart(this.processFlowChartRef.nativeElement,"process-flow");this.chartService.setOption("process-flow",{tooltip:{trigger:"item",textStyle:{fontSize:G.tooltip},formatter:T=>T.dataType==="node"?T.name.replace(`
`,"<br/>"):""},series:[{type:"graph",layout:"none",roam:!0,data:e,links:r,lineStyle:{curveness:0},emphasis:{focus:"adjacency",lineStyle:{width:3}}}]})}static{this.\u0275fac=function(r){return new(r||t)(h(A),h(P),h(M),h(Ce))}}static{this.\u0275cmp=I({type:t,selectors:[["app-order-detail"]],viewQuery:function(r,a){if(r&1&&te(qe,5),r&2){let c;ne(c=ie())&&(a.processFlowChartRef=c.first)}},decls:9,vars:4,consts:[["processFlowChart",""],[1,"container"],[1,"page-header"],[1,"btn","btn-secondary",3,"click"],[1,"fas","fa-arrow-left"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","text-center",4,"ngIf"],[4,"ngIf"],["class","card",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"text-center"],["message","Loading order details..."],[1,"card"],[1,"order-header"],[1,"order-info"],[3,"status"],[1,"order-meta"],["class","card",4,"ngFor","ngForOf"],[1,"card-header"],[1,"process-flow-container"],[1,"line-item-header"],[1,"product-sku"],[1,"quantity-info"],[1,"quantity"],["class","delivery-date",4,"ngIf"],["class","process-section",4,"ngFor","ngForOf"],[1,"delivery-date"],[1,"process-section"],[1,"process-header"],[1,"operations-list"],["class","operation-item",3,"class",4,"ngFor","ngForOf"],[1,"operation-item"],[1,"operation-step"],[1,"step-number"],["class","step-line",4,"ngIf"],[1,"operation-content"],[1,"operation-info"],[1,"operation-name"],[1,"operation-code"],[1,"operation-details"],["class","operation-actions",4,"ngIf"],[1,"step-line"],[1,"operation-actions"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"no-data"]],template:function(r,a){r&1&&(i(0,"div",1)(1,"div",2)(2,"button",3),g("click",function(){return a.goBack()}),u(3,"i",4),d(4," Back to Orders"),n(),m(5,je,2,0,"button",5),n(),m(6,Ge,2,0,"div",6)(7,et,12,6,"div",7)(8,tt,3,0,"div",8),n()),r&2&&(o(5),s("ngIf",a.order),o(),s("ngIf",a.loading),o(),s("ngIf",!a.loading&&a.order),o(),s("ngIf",!a.loading&&!a.order))},dependencies:[E,S,$,B,R],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.order-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.order-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.order-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;font-weight:500;margin:0}.order-meta[_ngcontent-%COMP%]{display:flex;gap:24px;color:#666;font-size:14px}.line-item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;padding-bottom:16px;border-bottom:1px solid #eee;margin-bottom:16px}.line-item-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:500;margin:0 0 4px}.product-sku[_ngcontent-%COMP%]{color:#888;font-size:13px;margin:0}.quantity-info[_ngcontent-%COMP%]{text-align:right}.quantity-info[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{display:block;font-size:20px;font-weight:500;color:#1976d2}.quantity-info[_ngcontent-%COMP%]   .delivery-date[_ngcontent-%COMP%]{display:block;font-size:13px;color:#666;margin-top:4px}.process-section[_ngcontent-%COMP%]{margin-top:20px}.process-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:16px}.process-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin:0}.operations-list[_ngcontent-%COMP%]{margin-left:12px}.operation-item[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:8px}.operation-step[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.step-number[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:500;background:#e0e0e0;color:#666}.step-line[_ngcontent-%COMP%]{width:2px;flex:1;min-height:40px;background:#e0e0e0}.step-completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#4caf50;color:#fff}.step-completed[_ngcontent-%COMP%]   .step-line[_ngcontent-%COMP%]{background:#4caf50}.step-active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:#1976d2;color:#fff}.operation-content[_ngcontent-%COMP%]{flex:1;padding:8px 16px;background:#fafafa;border-radius:8px;margin-bottom:8px}.step-active[_ngcontent-%COMP%]   .operation-content[_ngcontent-%COMP%]{background:#e3f2fd;border:1px solid #90caf9}.step-completed[_ngcontent-%COMP%]   .operation-content[_ngcontent-%COMP%]{background:#e8f5e9;border:1px solid #a5d6a7}.operation-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px}.operation-name[_ngcontent-%COMP%]{font-weight:500}.operation-code[_ngcontent-%COMP%]{color:#888;font-size:13px}.operation-details[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:13px;color:#666;margin-bottom:8px}.operation-actions[_ngcontent-%COMP%]{margin-top:12px}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}.card-header[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin-bottom:8px}.process-flow-container[_ngcontent-%COMP%]{width:100%;height:400px}.no-data[_ngcontent-%COMP%]{text-align:center;color:#888;padding:40px}"]})}}return t})();function nt(t,l){t&1&&(i(0,"div",4),d(1,"Loading order..."),n())}function it(t,l){if(t&1&&(i(0,"div",33),d(1),n()),t&2){let e=p(2);o(),f(e.error)}}function rt(t,l){if(t&1&&(i(0,"option",34),d(1),n()),t&2){let e=l.$implicit;s("value",e.customerId),o(),N(" ",e.customerCode," - ",e.customerName," ")}}function ot(t,l){t&1&&(i(0,"span",22),d(1,"Loading customers..."),n())}function at(t,l){t&1&&(i(0,"span",35),d(1,"Customer is required"),n())}function dt(t,l){t&1&&(i(0,"span",35),d(1,"Order date is required"),n())}function st(t,l){t&1&&(i(0,"div",9)(1,"div",10)(2,"label",36),d(3,"Status"),n(),i(4,"select",37)(5,"option",38),d(6,"Created"),n(),i(7,"option",39),d(8,"In Progress"),n(),i(9,"option",40),d(10,"Completed"),n(),i(11,"option",41),d(12,"Cancelled"),n()()()())}function lt(t,l){if(t&1){let e=b();i(0,"button",42),g("click",function(){_(e);let a=p(2);return x(a.addLineItem())}),d(1," + Add Line Item "),n()}}function ct(t,l){t&1&&(i(0,"div",43),d(1," Line items can only be modified for orders with CREATED status. "),n())}function pt(t,l){if(t&1){let e=b();i(0,"button",57),g("click",function(){_(e);let a=p().index,c=p(2);return x(c.removeLineItem(a))}),u(1,"i",58),n()}}function mt(t,l){if(t&1&&(i(0,"option",34),d(1),n()),t&2){let e=l.$implicit;s("value",e.sku),o(),N(" ",e.sku," - ",e.productName," ")}}function ut(t,l){if(t&1){let e=b();i(0,"div",44)(1,"div",45)(2,"span",46),d(3),n(),m(4,pt,2,0,"button",47),n(),i(5,"div",48)(6,"div",49)(7,"label"),d(8,"Product *"),n(),i(9,"select",50),g("change",function(a){let c=_(e).index,C=p(2);return x(C.onProductChange(c,a))}),i(10,"option",13),d(11,"Select a product..."),n(),m(12,mt,2,3,"option",14),n(),u(13,"input",51),n(),i(14,"div",52)(15,"label"),d(16,"Quantity *"),n(),u(17,"input",53),n(),i(18,"div",54)(19,"label"),d(20,"Unit"),n(),u(21,"input",55),n(),i(22,"div",10)(23,"label"),d(24,"Delivery Date"),n(),u(25,"input",56),n()()()}if(t&2){let e=l.index,r=p(2);s("formGroupName",e),o(3),O("Line ",e+1,""),o(),s("ngIf",r.lineItems.length>1&&r.canEditLineItems()),o(5),y("error",r.hasLineItemError(e,"productSku")),o(3),s("ngForOf",r.products),o(5),y("error",r.hasLineItemError(e,"quantity")),o(4),y("error",r.hasLineItemError(e,"unit"))}}function gt(t,l){t&1&&(i(0,"div",59),d(1,' No line items. Click "Add Line Item" to add products to this order. '),n())}function ft(t,l){if(t&1){let e=b();i(0,"div",5)(1,"form",6),g("ngSubmit",function(){_(e);let a=p();return x(a.onSubmit())}),m(2,it,2,1,"div",7),i(3,"div",8)(4,"h2"),d(5,"Order Information"),n(),i(6,"div",9)(7,"div",10)(8,"label",11),d(9,"Customer *"),n(),i(10,"select",12),g("change",function(a){_(e);let c=p();return x(c.onCustomerChange(a))}),i(11,"option",13),d(12,"Select a customer..."),n(),m(13,rt,2,3,"option",14),n(),u(14,"input",15),m(15,ot,2,0,"span",16)(16,at,2,0,"span",17),n()(),i(17,"div",9)(18,"div",10)(19,"label",18),d(20,"Order Date *"),n(),u(21,"input",19),m(22,dt,2,0,"span",17),n(),i(23,"div",10)(24,"label",20),d(25,"Order Number"),n(),u(26,"input",21),i(27,"span",22),d(28,"Leave empty to auto-generate"),n()()(),m(29,st,13,0,"div",23),n(),i(30,"div",8)(31,"div",24)(32,"h2"),d(33,"Line Items"),n(),m(34,lt,2,0,"button",25),n(),m(35,ct,2,0,"div",26),i(36,"div",27),m(37,ut,26,10,"div",28),n(),m(38,gt,2,0,"div",29),n(),i(39,"div",30)(40,"button",31),g("click",function(){_(e);let a=p();return x(a.cancel())}),d(41," Cancel "),n(),i(42,"button",32),d(43),n()()()()}if(t&2){let e=p();o(),s("formGroup",e.form),o(),s("ngIf",e.error),o(8),y("error",e.hasError("customerId")),o(3),s("ngForOf",e.customers),o(2),s("ngIf",e.loadingCustomers),o(),s("ngIf",e.hasError("customerId")),o(5),y("error",e.hasError("orderDate")),o(),s("ngIf",e.hasError("orderDate")),o(4),s("readonly",e.isEditMode),o(3),s("ngIf",e.isEditMode),o(5),s("ngIf",e.canEditLineItems()),o(),s("ngIf",e.isEditMode&&!e.canEditLineItems()),o(2),s("ngForOf",e.lineItems.controls),o(),s("ngIf",e.lineItems.length===0),o(2),s("disabled",e.saving),o(2),s("disabled",e.saving||e.form.invalid),o(),O(" ",e.saving?"Saving...":e.isEditMode?"Update Order":"Create Order"," ")}}var H=(()=>{class t{constructor(e,r,a,c,C){this.fb=e,this.apiService=r,this.route=a,this.router=c,this.cdr=C,this.isEditMode=!1,this.orderId=null,this.loading=!1,this.saving=!1,this.error="",this.customers=[],this.products=[],this.loadingCustomers=!0,this.loadingProducts=!0}ngOnInit(){let e=this.route.snapshot.paramMap.get("orderId");e&&(this.isEditMode=!0,this.orderId=+e),this.initForm(),this.loadCustomers(),this.loadProducts(),this.isEditMode&&this.orderId?this.loadOrder():this.addLineItem()}initForm(){this.form=this.fb.group({customerId:["",v.required],customerName:["",[v.required,v.maxLength(200)]],orderDate:[this.getTodayDate(),v.required],orderNumber:[""],status:["CREATED"],lineItems:this.fb.array([])})}get lineItems(){return this.form.get("lineItems")}createLineItemGroup(e){return this.fb.group({orderLineId:[e?.orderLineId||null],productSku:[e?.productSku||"",[v.required,v.maxLength(50)]],productName:[e?.productName||"",[v.required,v.maxLength(200)]],quantity:[e?.quantity||1,[v.required,v.min(.01)]],unit:[e?.unit||"",[v.required,v.maxLength(20)]],deliveryDate:[e?.deliveryDate||""]})}addLineItem(){this.lineItems.push(this.createLineItemGroup())}removeLineItem(e){this.lineItems.length>1&&this.lineItems.removeAt(e)}loadCustomers(){this.apiService.getActiveCustomers().subscribe({next:e=>{this.customers=e,this.loadingCustomers=!1,this.cdr.detectChanges()},error:e=>{console.error("Error loading customers:",e),this.loadingCustomers=!1,this.cdr.detectChanges()}})}loadProducts(){this.apiService.getActiveProducts().subscribe({next:e=>{this.products=e,this.loadingProducts=!1,this.cdr.detectChanges()},error:e=>{console.error("Error loading products:",e),this.loadingProducts=!1,this.cdr.detectChanges()}})}onCustomerChange(e){let r=e.target.value,a=this.customers.find(c=>c.customerId.toString()===r);a&&this.form.patchValue({customerName:a.customerName})}onProductChange(e,r){let a=r.target.value,c=this.products.find(C=>C.sku===a);c&&this.lineItems.at(e).patchValue({productName:c.productName,unit:c.baseUnit})}loadOrder(){this.orderId&&(this.loading=!0,this.apiService.getOrderById(this.orderId).subscribe({next:e=>{this.form.patchValue({customerId:e.customerId||"",customerName:e.customerName||"",orderDate:e.orderDate||"",orderNumber:e.orderNumber||"",status:e.status}),this.lineItems.clear(),e.lineItems&&e.lineItems.length>0?e.lineItems.forEach(r=>{this.lineItems.push(this.createLineItemGroup(r))}):this.addLineItem(),this.loading=!1},error:e=>{this.error=e.error?.message||"Failed to load order.",this.loading=!1}}))}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.saving=!0,this.error="";let e=this.form.getRawValue();if(this.isEditMode&&this.orderId){let r={customerId:e.customerId,customerName:e.customerName,orderDate:e.orderDate||void 0,status:e.status};this.apiService.updateOrder(this.orderId,r).subscribe({next:()=>{this.saving=!1,this.router.navigate(["/orders"])},error:a=>{this.saving=!1,this.error=a.error?.message||"Failed to update order."}})}else{let r={customerId:e.customerId,customerName:e.customerName,orderDate:e.orderDate,orderNumber:e.orderNumber||void 0,lineItems:e.lineItems.map(a=>({productSku:a.productSku,productName:a.productName,quantity:a.quantity,unit:a.unit,deliveryDate:a.deliveryDate||void 0}))};this.apiService.createOrder(r).subscribe({next:()=>{this.saving=!1,this.router.navigate(["/orders"])},error:a=>{this.saving=!1,this.error=a.error?.message||"Failed to create order."}})}}cancel(){this.router.navigate(["/orders"])}getTodayDate(){return new Date().toISOString().split("T")[0]}hasError(e){let r=this.form.get(e);return!!(r&&r.invalid&&r.touched)}hasLineItemError(e,r){let a=this.lineItems.at(e)?.get(r);return!!(a&&a.invalid&&a.touched)}getError(e){let r=this.form.get(e);return!r||!r.errors?"":r.errors.required?`${e} is required`:r.errors.maxlength?`${e} is too long`:"Invalid value"}canEditLineItems(){return!this.isEditMode||this.form.get("status")?.value==="CREATED"}trackByIndex(e){return e}static{this.\u0275fac=function(r){return new(r||t)(h(xe),h(M),h(A),h(P),h(re))}}static{this.\u0275cmp=I({type:t,selectors:[["app-order-form"]],decls:6,vars:3,consts:[[1,"order-form-page"],[1,"page-header"],["class","loading",4,"ngIf"],["class","form-container",4,"ngIf"],[1,"loading"],[1,"form-container"],[3,"ngSubmit","formGroup"],["class","error-banner",4,"ngIf"],[1,"form-section"],[1,"form-row"],[1,"form-group"],["for","customerId"],["id","customerId","formControlName","customerId",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","hidden","formControlName","customerName"],["class","hint",4,"ngIf"],["class","error-text",4,"ngIf"],["for","orderDate"],["type","date","id","orderDate","formControlName","orderDate"],["for","orderNumber"],["type","text","id","orderNumber","formControlName","orderNumber","placeholder","Auto-generated if empty",3,"readonly"],[1,"hint"],["class","form-row",4,"ngIf"],[1,"section-header"],["type","button","class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["class","line-items-warning",4,"ngIf"],["formArrayName","lineItems"],["class","line-item",3,"formGroupName",4,"ngFor","ngForOf"],["class","empty-line-items",4,"ngIf"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"error-banner"],[3,"value"],[1,"error-text"],["for","status"],["id","status","formControlName","status"],["value","CREATED"],["value","IN_PROGRESS"],["value","COMPLETED"],["value","CANCELLED"],["type","button",1,"btn","btn-sm","btn-primary",3,"click"],[1,"line-items-warning"],[1,"line-item",3,"formGroupName"],[1,"line-item-header"],[1,"line-number"],["type","button","class","btn-icon btn-danger","title","Remove line item",3,"click",4,"ngIf"],[1,"line-item-fields"],[1,"form-group","product-group"],["formControlName","productSku",3,"change"],["type","hidden","formControlName","productName"],[1,"form-group","quantity-group"],["type","number","formControlName","quantity","min","0.01","step","0.01"],[1,"form-group","unit-group"],["type","text","formControlName","unit","readonly",""],["type","date","formControlName","deliveryDate"],["type","button","title","Remove line item",1,"btn-icon","btn-danger",3,"click"],[1,"fas","fa-xmark"],[1,"empty-line-items"]],template:function(r,a){if(r&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),d(3),n()(),m(4,nt,2,0,"div",2)(5,ft,44,19,"div",3),n()),r&2){let c;o(3),f(a.isEditMode?"Edit Order: "+(((c=a.form.get("orderNumber"))==null?null:c.value)||"ORD-"+a.orderId):"New Order"),o(),s("ngIf",a.loading),o(),s("ngIf",!a.loading)}},dependencies:[E,S,le,q,j,ae,ce,fe,de,se,_e,pe,ge,me,ue],styles:[".order-form-page[_ngcontent-%COMP%]{padding:20px;max-width:1000px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;color:#333}.loading[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}.form-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;padding:24px}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:12px 16px;border-radius:4px;margin-bottom:20px}.form-section[_ngcontent-%COMP%]{margin-bottom:32px}.form-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#333;margin:0 0 16px;padding-bottom:8px;border-bottom:1px solid #eee}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid #eee}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;padding:0;border:none}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:16px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.form-group.full-width[_ngcontent-%COMP%]{grid-column:1 / -1}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:#555;font-size:14px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{padding:10px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;transition:border-color .2s}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select.error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea.error[_ngcontent-%COMP%]{border-color:#d32f2f}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:disabled, .form-group[_ngcontent-%COMP%]   input[readonly][_ngcontent-%COMP%]{background:#f5f5f5;cursor:not-allowed}.hint[_ngcontent-%COMP%]{font-size:12px;color:#666}.error-text[_ngcontent-%COMP%]{font-size:12px;color:#d32f2f}.line-item[_ngcontent-%COMP%]{background:#f8f9fa;border-radius:8px;padding:16px;margin-bottom:16px;border:1px solid #e9ecef}.line-item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.line-number[_ngcontent-%COMP%]{font-weight:600;color:#333}.line-item-fields[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 120px 100px 150px;gap:12px;align-items:end}.quantity-group[_ngcontent-%COMP%]{min-width:100px}.unit-group[_ngcontent-%COMP%]{min-width:80px}.line-items-warning[_ngcontent-%COMP%]{background:#fff3cd;color:#856404;padding:12px 16px;border-radius:4px;margin-bottom:16px;font-size:14px}.empty-line-items[_ngcontent-%COMP%]{text-align:center;padding:32px;color:#666;background:#f8f9fa;border-radius:8px;border:2px dashed #dee2e6}.btn-icon[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:background .2s}.btn-icon.btn-danger[_ngcontent-%COMP%]{color:#d32f2f}.btn-icon.btn-danger[_ngcontent-%COMP%]:hover{background:#f8d7da}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;padding-top:20px;border-top:1px solid #eee}.btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:500;transition:background .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#1976d2;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#1565c0}.btn-secondary[_ngcontent-%COMP%]{background:#757575;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#616161}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}@media (max-width: 900px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.line-item-fields[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}@media (max-width: 600px){.line-item-fields[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return t})();var _t=[{path:"",component:Se},{path:"new",component:H},{path:":orderId",component:Pe},{path:":orderId/edit",component:H}],Me=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=V({type:t})}static{this.\u0275inj=z({imports:[Y.forChild(_t),Y]})}}return t})();var jt=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=V({type:t})}static{this.\u0275inj=z({imports:[oe,he,ve,Me,be]})}}return t})();export{jt as OrdersModule};
