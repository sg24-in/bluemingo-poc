import{d as ce,e as me,g as pe}from"./chunk-DC6H7RTP.js";import{d as B}from"./chunk-CX5NRPTH.js";import"./chunk-Q66F4YPD.js";import{$ as k,Aa as ne,Ba as ie,Ca as oe,D as y,Da as re,E as C,Ea as ae,F as c,Fa as N,Ga as V,Ha as D,J as Q,Ja as le,K as i,L as u,La as de,M as f,Ma as se,N as x,O as I,Q as j,R as A,S as H,V as G,W as J,Y as $,_ as w,aa as q,ca as Y,fa as U,g as M,i as O,j as T,l as g,m as _,ma as K,o as r,oa as X,p as E,r as p,ra as z,s as W,t as d,ua as R,v as P,va as S,wa as F,x as n,xa as Z,y as t,ya as ee,z as b,za as te}from"./chunk-KBMCX72K.js";function Ce(o,s){o&1&&(n(0,"div",9),b(1,"app-loading-spinner",10),t())}function he(o,s){if(o&1&&(n(0,"div",16)(1,"span",17),i(2,"New Batch Created:"),t(),n(3,"span",18),i(4),t()()),o&2){let e=c(2);r(4),u(e.confirmationResult.newBatchNumber)}}function be(o,s){if(o&1){let e=y();n(0,"button",2),C("click",function(){g(e);let a=c(2);return _(a.goToBatch(a.confirmationResult.newBatchId))}),i(1," View New Batch "),t()}}function ye(o,s){if(o&1){let e=y();n(0,"div",11)(1,"div",12)(2,"div",13),b(3,"i",14),t(),n(4,"h2"),i(5,"Production Confirmed Successfully!"),t(),n(6,"div",15)(7,"div",16)(8,"span",17),i(9,"Confirmation ID:"),t(),n(10,"span",18),i(11),t()(),n(12,"div",16)(13,"span",17),i(14,"Quantity Produced:"),t(),n(15,"span",18),i(16),t()(),p(17,he,5,1,"div",19),n(18,"div",16)(19,"span",17),i(20,"Materials Consumed:"),t(),n(21,"span",18),i(22),t()(),n(23,"div",16)(24,"span",17),i(25,"Operation Status:"),t(),b(26,"app-status-badge",20),t()(),n(27,"div",21)(28,"button",22),C("click",function(){g(e);let a=c();return _(a.goBack())}),i(29,"Back to Order"),t(),p(30,be,2,0,"button",23),t()()()}if(o&2){let e=c();r(11),u(e.confirmationResult.confirmationId),r(5),u(e.confirmationResult.quantityProduced),r(),d("ngIf",e.confirmationResult.newBatchNumber),r(5),f("",(e.confirmationResult.materialsConsumed==null?null:e.confirmationResult.materialsConsumed.length)||0," item(s)"),r(4),d("status",e.confirmationResult.operationStatus),r(4),d("ngIf",e.confirmationResult.newBatchId)}}function Se(o,s){o&1&&(n(0,"div",67),i(1," Start time cannot be in the future "),t())}function Ee(o,s){o&1&&(n(0,"div",67),i(1," End time must be after start time "),t())}function Pe(o,s){if(o&1&&(n(0,"tr")(1,"td"),i(2),t(),n(3,"td"),i(4),t(),n(5,"td"),i(6),t(),n(7,"td"),i(8),t(),n(9,"td")(10,"span",77),i(11),t()()()),o&2){let e=s.$implicit;P("insufficient",!e.sufficientStock),r(2),x("",e.materialName," (",e.materialId,")"),r(2),x("",e.requiredQuantity," ",e.unit,""),r(2),x("",e.availableQuantity," ",e.unit,""),r(2),u(e.yieldLossRatio),r(2),P("ok",e.sufficientStock)("low",!e.sufficientStock),r(),f(" ",e.sufficientStock?"Sufficient":"Insufficient"," ")}}function Ie(o,s){o&1&&(n(0,"div",78)(1,"strong"),i(2,"Warning:"),t(),i(3," Insufficient stock for some materials. Please review before proceeding. "),t())}function Me(o,s){if(o&1){let e=y();n(0,"div",68)(1,"div",69)(2,"h4"),i(3,"BOM Suggested Consumption"),t(),n(4,"button",70),C("click",function(){g(e);let a=c(2);return _(a.applySuggestedConsumption())}),i(5," Apply Suggestions "),t()(),n(6,"div",71)(7,"span",72),i(8,"Target Quantity:"),t(),n(9,"span",73),i(10),t(),n(11,"span",72),i(12,"Total Required:"),t(),n(13,"span",73),i(14),t()(),n(15,"table",74)(16,"thead")(17,"tr")(18,"th"),i(19,"Material"),t(),n(20,"th"),i(21,"Required Qty"),t(),n(22,"th"),i(23,"Available"),t(),n(24,"th"),i(25,"Yield Ratio"),t(),n(26,"th"),i(27,"Stock Status"),t()()(),n(28,"tbody"),p(29,Pe,12,14,"tr",75),t()(),p(30,Ie,4,0,"div",76),t()}if(o&2){let e=c(2);r(4),d("disabled",!e.hasSufficientStock()),r(6),f("",e.suggestedConsumption.targetQuantity," T"),r(4),f("",e.suggestedConsumption.totalRequiredQuantity," T"),r(15),d("ngForOf",e.suggestedConsumption.suggestedMaterials),r(),d("ngIf",!e.hasSufficientStock())}}function Oe(o,s){if(o&1){let e=y();n(0,"tr")(1,"td"),i(2),t(),n(3,"td"),i(4),t(),n(5,"td"),i(6),t(),n(7,"td"),b(8,"app-status-badge",20),t(),n(9,"td")(10,"button",81),C("click",function(){let a=g(e).$implicit,m=c(3);return _(m.addMaterial(a))}),i(11," Add "),t()()()}if(o&2){let e=s.$implicit;r(2),u(e.batchNumber),r(2),u(e.materialId),r(2),x("",e.quantity," ",e.unit,""),r(2),d("status",e.state)}}function Te(o,s){if(o&1&&(n(0,"table",79)(1,"thead")(2,"tr")(3,"th"),i(4,"Batch #"),t(),n(5,"th"),i(6,"Material ID"),t(),n(7,"th"),i(8,"Available Qty"),t(),n(9,"th"),i(10,"State"),t(),n(11,"th"),i(12,"Action"),t()()(),n(13,"tbody"),p(14,Oe,12,5,"tr",80),t()()),o&2){let e=c(2);r(14),d("ngForOf",e.availableInventory)}}function we(o,s){o&1&&(n(0,"p",82),i(1,"No available inventory"),t())}function ke(o,s){if(o&1){let e=y();n(0,"tr")(1,"td"),i(2),t(),n(3,"td"),i(4),t(),n(5,"td"),i(6),t(),n(7,"td")(8,"input",84),C("change",function(a){let m=g(e).index,v=c(3);return _(v.updateMaterialQuantity(m,a.target.valueAsNumber))}),t()(),n(9,"td")(10,"button",85),C("click",function(){let a=g(e).index,m=c(3);return _(m.removeMaterial(a))}),i(11," Remove "),t()()()}if(o&2){let e=s.$implicit;r(2),u(e.batchNumber),r(2),u(e.materialId),r(2),u(e.availableQuantity),r(2),d("value",e.quantityToConsume)("min",0)("max",e.availableQuantity)}}function qe(o,s){if(o&1&&(n(0,"div",83)(1,"h4"),i(2,"Selected Materials"),t(),n(3,"table",79)(4,"thead")(5,"tr")(6,"th"),i(7,"Batch #"),t(),n(8,"th"),i(9,"Material ID"),t(),n(10,"th"),i(11,"Available"),t(),n(12,"th"),i(13,"Qty to Consume"),t(),n(14,"th"),i(15,"Action"),t()()(),n(16,"tbody"),p(17,ke,12,6,"tr",80),t()()()),o&2){let e=c(2);r(17),d("ngForOf",e.selectedMaterials)}}function Re(o,s){if(o&1&&(n(0,"tr",89)(1,"td"),i(2),t(),n(3,"td"),i(4),t(),n(5,"td"),i(6),t(),n(7,"td")(8,"span",90),i(9),G(10,"uppercase"),t()()()),o&2){let e=s.$implicit,l=c(3);d("ngClass","bom-"+l.getRequirementStatus(e)),r(2),x("",e.materialName," (",e.materialId,")"),r(2),x("",e.quantityRequired," ",e.unit,""),r(2),x("",l.getTotalSelectedByMaterial(e.materialId)," ",e.unit,""),r(2),d("ngClass",l.getRequirementStatus(e)),r(),f(" ",J(10,9,l.getRequirementStatus(e))," ")}}function Fe(o,s){if(o&1&&(n(0,"div",86)(1,"h4"),i(2,"BOM Requirements"),t(),n(3,"table",87)(4,"thead")(5,"tr")(6,"th"),i(7,"Material"),t(),n(8,"th"),i(9,"Required Qty"),t(),n(10,"th"),i(11,"Selected Qty"),t(),n(12,"th"),i(13,"Status"),t()()(),n(14,"tbody"),p(15,Re,11,11,"tr",88),t()()()),o&2){let e=c(2);r(15),d("ngForOf",e.bomRequirements)}}function Ne(o,s){if(o&1&&(n(0,"li"),i(1),t()),o&2){let e=s.$implicit;r(),u(e)}}function Ve(o,s){if(o&1&&(n(0,"div",78)(1,"strong"),i(2,"Warnings:"),t(),n(3,"ul"),p(4,Ne,2,1,"li",80),t()()),o&2){let e=c(3);r(4),d("ngForOf",e.bomValidationResult.warnings)}}function De(o,s){if(o&1&&(n(0,"li"),i(1),t()),o&2){let e=s.$implicit;r(),u(e)}}function Be(o,s){if(o&1&&(n(0,"div",92)(1,"strong"),i(2,"Errors:"),t(),n(3,"ul"),p(4,De,2,1,"li",80),t()()),o&2){let e=c(3);r(4),d("ngForOf",e.bomValidationResult.errors)}}function Qe(o,s){if(o&1&&(n(0,"div",91),p(1,Ve,5,1,"div",76)(2,Be,5,1,"div",62),t()),o&2){let e=c(2);r(),d("ngIf",(e.bomValidationResult.warnings==null?null:e.bomValidationResult.warnings.length)>0),r(),d("ngIf",(e.bomValidationResult.errors==null?null:e.bomValidationResult.errors.length)>0)}}function je(o,s){if(o&1){let e=y();n(0,"div",93)(1,"label",94)(2,"input",95),C("change",function(){let a=g(e).index,m=c(2);return _(m.toggleEquipment(a))}),t(),n(3,"span",96),i(4),t()()()}if(o&2){let e=s.$implicit;r(2),d("checked",e.selected),r(2),x("",e.equipmentName," (",e.equipmentCode,")")}}function Ae(o,s){o&1&&(n(0,"p",97),i(1,"No equipment available"),t())}function He(o,s){if(o&1){let e=y();n(0,"div",93)(1,"label",94)(2,"input",95),C("change",function(){let a=g(e).index,m=c(2);return _(m.toggleOperator(a))}),t(),n(3,"span",96),i(4),t()()()}if(o&2){let e=s.$implicit;r(2),d("checked",e.selected),r(2),x("",e.operatorName," (",e.operatorCode,")")}}function $e(o,s){o&1&&(n(0,"p",97),i(1,"No operators available"),t())}function ze(o,s){o&1&&(n(0,"span",98),i(1,"*"),t())}function Le(o,s){if(o&1&&(n(0,"option",99),i(1),t()),o&2){let e=s.$implicit;d("value",e.reason_code),r(),f(" ",e.reason_description," ")}}function We(o,s){o&1&&(n(0,"div",67),i(1," Delay reason is required when delay duration is entered "),t())}function Ge(o,s){o&1&&(n(0,"span",98),i(1,"*"),t())}function Je(o,s){if(o&1&&(n(0,"span",105),i(1),t()),o&2){let e=c().$implicit;r(),f("(",e.unit,")")}}function Ye(o,s){if(o&1&&(n(0,"span",105),i(1),t()),o&2){let e=c().$implicit;r(),x(" [",e.min_value||"..."," - ",e.max_value||"...","] ")}}function Ue(o,s){if(o&1&&(n(0,"div",67),i(1),t()),o&2){let e=c().$implicit;r(),f(" ",e.parameter_name," is required ")}}function Ke(o,s){if(o&1&&(n(0,"div",67),i(1),t()),o&2){let e=c().$implicit;r(),I(" ",e.parameter_name," must be at least ",e.min_value," ",e.unit||""," ")}}function Xe(o,s){if(o&1&&(n(0,"div",67),i(1),t()),o&2){let e=c().$implicit;r(),I(" ",e.parameter_name," must not exceed ",e.max_value," ",e.unit||""," ")}}function Ze(o,s){if(o&1&&(n(0,"div",33)(1,"div",102)(2,"label"),i(3),p(4,Ge,2,0,"span",57)(5,Je,2,1,"span",103)(6,Ye,2,2,"span",103),t(),b(7,"input",104),p(8,Ue,2,1,"div",36)(9,Ke,2,3,"div",36)(10,Xe,2,3,"div",36),t()()),o&2){let e,l,a,m=s.$implicit,v=s.index,h=c(3);r(),d("formGroupName",v),r(2),f("",m.parameter_name," "),r(),d("ngIf",m.is_required),r(),d("ngIf",m.unit),r(),d("ngIf",m.min_value!==null||m.max_value!==null),r(),d("placeholder",m.default_value||""),W("min",m.min_value)("max",m.max_value),r(),d("ngIf",((e=h.processParamsFormArray.at(v).get("parameterValue"))==null||e.errors==null?null:e.errors.required)&&((e=h.processParamsFormArray.at(v).get("parameterValue"))==null?null:e.touched)),r(),d("ngIf",(l=h.processParamsFormArray.at(v).get("parameterValue"))==null||l.errors==null?null:l.errors.min),r(),d("ngIf",(a=h.processParamsFormArray.at(v).get("parameterValue"))==null||a.errors==null?null:a.errors.max)}}function et(o,s){if(o&1&&(n(0,"div",24)(1,"div",25),i(2,"Process Parameters"),t(),n(3,"div",100),p(4,Ze,11,11,"div",101),t()()),o&2){let e=c(2);r(4),d("ngForOf",e.processParameters)}}function tt(o,s){if(o&1&&(n(0,"div",92),i(1),t()),o&2){let e=c(2);r(),f(" ",e.error," ")}}function nt(o,s){o&1&&(n(0,"span"),i(1,"Confirm Production"),t())}function it(o,s){o&1&&b(0,"span",106)}function ot(o,s){if(o&1){let e=y();n(0,"div")(1,"div",24)(2,"div",25),i(3,"Operation Details"),t(),n(4,"div",26)(5,"div",27)(6,"span",28),i(7,"Operation"),t(),n(8,"span",29),i(9),t()(),n(10,"div",27)(11,"span",28),i(12,"Type"),t(),n(13,"span",29),i(14),t()(),n(15,"div",27)(16,"span",28),i(17,"Status"),t(),b(18,"app-status-badge",20),t(),n(19,"div",27)(20,"span",28),i(21,"Product"),t(),n(22,"span",29),i(23),t()(),n(24,"div",27)(25,"span",28),i(26,"Order Quantity"),t(),n(27,"span",29),i(28),t()(),n(29,"div",27)(30,"span",28),i(31,"Stage"),t(),n(32,"span",29),i(33),t()()()(),n(34,"form",30),C("ngSubmit",function(){g(e);let a=c();return _(a.onSubmit())}),n(35,"div",24)(36,"div",25),i(37,"Production Time"),t(),n(38,"div",31)(39,"div",32)(40,"div",33)(41,"label",34),i(42,"Start Time *"),t(),b(43,"input",35),p(44,Se,2,0,"div",36),t()(),n(45,"div",32)(46,"div",33)(47,"label",37),i(48,"End Time *"),t(),b(49,"input",38),t()()(),p(50,Ee,2,0,"div",36),t(),n(51,"div",24)(52,"div",25),i(53,"Production Quantities"),t(),n(54,"div",31)(55,"div",32)(56,"div",33)(57,"label",39),i(58,"Quantity Produced *"),t(),b(59,"input",40),t()(),n(60,"div",32)(61,"div",33)(62,"label",41),i(63,"Quantity Scrapped"),t(),b(64,"input",42),t()()()(),n(65,"div",24)(66,"div",25),i(67,"Material Consumption"),t(),p(68,Me,31,5,"div",43),n(69,"div",44)(70,"h4"),i(71,"Available Inventory"),t(),p(72,Te,15,1,"table",45)(73,we,2,0,"p",46),t(),p(74,qe,18,1,"div",47)(75,Fe,16,1,"div",48)(76,Qe,3,2,"div",49),t(),n(77,"div",24)(78,"div",25),i(79,"Equipment & Operator"),t(),n(80,"div",31)(81,"div",32)(82,"div",33)(83,"label"),i(84,"Equipment * "),n(85,"span",50),i(86),t()(),n(87,"div",51),p(88,je,5,3,"div",52)(89,Ae,2,0,"p",53),t()()(),n(90,"div",32)(91,"div",33)(92,"label"),i(93,"Operator * "),n(94,"span",50),i(95),t()(),n(96,"div",51),p(97,He,5,3,"div",52)(98,$e,2,0,"p",53),t()()()()(),n(99,"div",24)(100,"div",25),i(101,"Delay Tracking"),t(),n(102,"div",31)(103,"div",32)(104,"div",33)(105,"label",54),i(106,"Delay Duration (minutes)"),t(),b(107,"input",55),t()(),n(108,"div",32)(109,"div",33)(110,"label",56),i(111," Delay Reason "),p(112,ze,2,0,"span",57),t(),n(113,"select",58)(114,"option",59),i(115,"-- Select Reason --"),t(),p(116,Le,2,2,"option",60),t(),p(117,We,2,0,"div",36),t()()()(),p(118,et,5,1,"div",8),n(119,"div",24)(120,"div",25),i(121,"Notes"),t(),n(122,"div",33),b(123,"textarea",61),t()(),p(124,tt,2,1,"div",62),n(125,"div",63)(126,"button",64),C("click",function(){g(e);let a=c();return _(a.goBack())}),i(127,"Cancel"),t(),n(128,"button",65),p(129,nt,2,0,"span",7)(130,it,1,0,"span",66),t()()()()}if(o&2){let e,l,a=c();r(9),x("",a.operation.operationName," (",a.operation.operationCode,")"),r(5),u(a.operation.operationType),r(4),d("status",a.operation.status),r(5),x("",a.operation.order==null?null:a.operation.order.productName," (",a.operation.order==null?null:a.operation.order.productSku,")"),r(5),u(a.operation.order==null?null:a.operation.order.quantity),r(5),u(a.operation.process==null?null:a.operation.process.stageName),r(),d("formGroup",a.confirmForm),r(10),d("ngIf",(e=a.confirmForm.get("startTime"))==null||e.errors==null?null:e.errors.futureStartTime),r(6),d("ngIf",a.confirmForm.errors==null?null:a.confirmForm.errors.invalidTimeRange),r(18),d("ngIf",a.showSuggestions&&a.suggestedConsumption),r(4),d("ngIf",a.availableInventory.length>0),r(),d("ngIf",a.availableInventory.length===0),r(),d("ngIf",a.selectedMaterials.length>0),r(),d("ngIf",a.bomRequirements.length>0),r(),d("ngIf",a.bomValidationResult),r(10),f("(",a.getSelectedEquipmentCount()," selected)"),r(2),d("ngForOf",a.availableEquipment),r(),d("ngIf",a.availableEquipment.length===0),r(6),f("(",a.getSelectedOperatorCount()," selected)"),r(2),d("ngForOf",a.activeOperators),r(),d("ngIf",a.activeOperators.length===0),r(14),d("ngIf",a.isDelayReasonRequired()),r(4),d("ngForOf",a.delayReasons),r(),d("ngIf",a.isDelayReasonRequired()&&!((l=a.confirmForm.get("delayReason"))!=null&&l.value)),r(),d("ngIf",a.processParameters.length>0),r(6),d("ngIf",a.error),r(4),d("disabled",a.confirmForm.invalid||a.submitting),r(),d("ngIf",!a.submitting),r(),d("ngIf",a.submitting)}}function rt(o,s){if(o&1&&(n(0,"div",24)(1,"p",82),i(2),t()()),o&2){let e=c();r(2),u(e.error||"Operation not found")}}var ue=(()=>{class o{constructor(e,l,a,m){this.route=e,this.router=l,this.fb=a,this.apiService=m,this.operation=null,this.loading=!0,this.submitting=!1,this.success=!1,this.error="",this.availableInventory=[],this.availableEquipment=[],this.activeOperators=[],this.processParameters=[],this.delayReasons=[],this.selectedMaterials=[],this.confirmationResult=null,this.bomRequirements=[],this.bomValidationResult=null,this.showBomWarning=!1,this.suggestedConsumption=null,this.loadingSuggestions=!1,this.showSuggestions=!1}ngOnInit(){this.operationId=Number(this.route.snapshot.paramMap.get("operationId")),this.initForm(),this.loadData()}initForm(){let e=new Date,l=this.formatDateTimeLocal(e);this.confirmForm=this.fb.group({operationId:[this.operationId],startTime:[l,[S.required,this.startTimeValidator()]],endTime:[l,[S.required]],quantityProduced:[0,[S.required,S.min(1)]],quantityScrapped:[0,[S.min(0)]],delayMinutes:[0,[S.min(0)]],delayReason:[""],notes:[""],processParameters:this.fb.array([])},{validators:this.timeRangeValidator()})}startTimeValidator(){return e=>e.value&&new Date(e.value)>new Date?{futureStartTime:!0}:null}timeRangeValidator(){return e=>{let l=e.get("startTime")?.value,a=e.get("endTime")?.value;if(l&&a){let m=new Date(l);if(new Date(a)<=m)return{invalidTimeRange:!0}}return null}}formatDateTimeLocal(e){let l=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0"),v=String(e.getHours()).padStart(2,"0"),h=String(e.getMinutes()).padStart(2,"0");return`${l}-${a}-${m}T${v}:${h}`}get processParamsFormArray(){return this.confirmForm.get("processParameters")}loadData(){this.loading=!0,this.apiService.getOperationDetails(this.operationId).subscribe({next:e=>{this.operation=e,this.loadMasterData()},error:e=>{console.error("Error loading operation:",e),this.error="Failed to load operation details",this.loading=!1}})}loadMasterData(){this.apiService.getAvailableEquipment().subscribe({next:e=>{this.availableEquipment=e.map(l=>({equipmentId:l.equipmentId,equipmentCode:l.equipmentCode,equipmentName:l.equipmentName,selected:!1}))},error:e=>console.error("Error loading equipment:",e)}),this.apiService.getActiveOperators().subscribe({next:e=>{this.activeOperators=e.map(l=>({operatorId:l.operatorId,operatorCode:l.operatorCode,operatorName:l.operatorName,selected:!1}))},error:e=>console.error("Error loading operators:",e)}),this.apiService.getDelayReasons().subscribe({next:e=>{this.delayReasons=e},error:e=>console.error("Error loading delay reasons:",e)}),this.apiService.getAvailableInventory().subscribe({next:e=>{this.availableInventory=e,this.loading=!1},error:e=>{console.error("Error loading inventory:",e),this.loading=!1}}),this.operation?.operationType&&this.apiService.getProcessParameters(this.operation.operationType,this.operation.order?.productSku).subscribe({next:e=>{this.processParameters=e,this.initProcessParams()},error:e=>console.error("Error loading process parameters:",e)}),this.operation?.order?.productSku&&this.apiService.getBomRequirements(this.operation.order.productSku).subscribe({next:e=>{this.bomRequirements=e.requirements||[]},error:e=>console.error("Error loading BOM requirements:",e)}),this.loadSuggestedConsumption()}loadSuggestedConsumption(){this.loadingSuggestions=!0,this.apiService.getSuggestedConsumption(this.operationId).subscribe({next:e=>{this.suggestedConsumption=e,this.loadingSuggestions=!1,this.showSuggestions=e.suggestedMaterials?.length>0,e.targetQuantity&&!this.confirmForm.get("quantityProduced")?.value&&this.confirmForm.patchValue({quantityProduced:e.targetQuantity})},error:e=>{console.error("Error loading suggested consumption:",e),this.loadingSuggestions=!1}})}applySuggestedConsumption(){if(this.suggestedConsumption){this.selectedMaterials=[];for(let e of this.suggestedConsumption.suggestedMaterials)for(let l of e.availableBatches)l.suggestedConsumption>0&&this.selectedMaterials.push({inventoryId:l.inventoryId,batchId:l.batchId||0,batchNumber:l.batchNumber||"",materialId:e.materialId,availableQuantity:l.availableQuantity,quantityToConsume:l.suggestedConsumption});this.validateBom()}}getTotalSuggestedQuantity(){return this.suggestedConsumption?this.suggestedConsumption.suggestedMaterials.reduce((e,l)=>e+l.requiredQuantity,0):0}hasSufficientStock(){return this.suggestedConsumption?this.suggestedConsumption.suggestedMaterials.every(e=>e.sufficientStock):!0}initProcessParams(){this.processParamsFormArray.clear(),this.processParameters.forEach(e=>{let l=[];e.is_required&&l.push(S.required),e.min_value!==null&&e.min_value!==void 0&&l.push(S.min(e.min_value)),e.max_value!==null&&e.max_value!==void 0&&l.push(S.max(e.max_value)),this.processParamsFormArray.push(this.fb.group({parameterName:[e.parameter_name],parameterValue:[e.default_value||"",l]}))})}addMaterial(e){this.selectedMaterials.find(a=>a.inventoryId===e.inventoryId)||(this.selectedMaterials.push({inventoryId:e.inventoryId,batchId:e.batchId,batchNumber:e.batchNumber,materialId:e.materialId,availableQuantity:e.quantity,quantityToConsume:0}),this.validateBom())}removeMaterial(e){this.selectedMaterials.splice(e,1)}updateMaterialQuantity(e,l){l>=0&&l<=this.selectedMaterials[e].availableQuantity&&(this.selectedMaterials[e].quantityToConsume=l,this.validateBom())}toggleEquipment(e){this.availableEquipment[e].selected=!this.availableEquipment[e].selected}getSelectedEquipmentIds(){return this.availableEquipment.filter(e=>e.selected).map(e=>e.equipmentId)}getSelectedEquipmentCount(){return this.availableEquipment.filter(e=>e.selected).length}toggleOperator(e){this.activeOperators[e].selected=!this.activeOperators[e].selected}getSelectedOperatorIds(){return this.activeOperators.filter(e=>e.selected).map(e=>e.operatorId)}getSelectedOperatorCount(){return this.activeOperators.filter(e=>e.selected).length}isDelayReasonRequired(){let e=this.confirmForm.get("delayMinutes")?.value;return e&&e>0}validateBom(){if(!this.operation?.order?.productSku||this.selectedMaterials.length===0){this.bomValidationResult=null;return}let e={productSku:this.operation.order.productSku,targetQuantity:this.confirmForm.get("quantityProduced")?.value||0,materialsConsumed:this.selectedMaterials.filter(l=>l.quantityToConsume>0).map(l=>({materialId:l.materialId,quantity:l.quantityToConsume}))};this.apiService.validateBomConsumption(e).subscribe({next:l=>{this.bomValidationResult=l,this.showBomWarning=l.warnings?.length>0||l.errors?.length>0},error:l=>console.error("Error validating BOM:",l)})}getTotalSelectedByMaterial(e){return this.selectedMaterials.filter(l=>l.materialId===e).reduce((l,a)=>l+a.quantityToConsume,0)}getRequirementStatus(e){let l=this.getTotalSelectedByMaterial(e.materialId);return l>=e.quantityRequired?"met":l>0?"partial":"missing"}onSubmit(){if(this.confirmForm.invalid){this.error="Please fill in all required fields correctly.";return}if(this.getSelectedEquipmentCount()===0){this.error="Please select at least one equipment.";return}if(this.getSelectedOperatorCount()===0){this.error="Please select at least one operator.";return}let e=this.confirmForm.value;if(e.delayMinutes>0&&!e.delayReason){this.error="Please select a delay reason when delay duration is greater than 0.";return}this.submitting=!0,this.error="";let l={operationId:this.operationId,producedQty:e.quantityProduced,scrapQty:e.quantityScrapped||0,startTime:new Date(e.startTime).toISOString(),endTime:new Date(e.endTime).toISOString(),equipmentIds:this.getSelectedEquipmentIds(),operatorIds:this.getSelectedOperatorIds(),materialsConsumed:this.selectedMaterials.filter(a=>a.quantityToConsume>0).map(a=>({batchId:a.batchId,inventoryId:a.inventoryId,quantity:a.quantityToConsume})),processParameters:e.processParameters.filter(a=>a.parameterValue).reduce((a,m)=>(a[m.parameterName]=m.parameterValue,a),{}),delayMinutes:e.delayMinutes||0,delayReason:e.delayReason||null,notes:e.notes};this.apiService.confirmProduction(l).subscribe({next:a=>{this.confirmationResult=a,this.success=!0,this.submitting=!1},error:a=>{console.error("Error confirming production:",a),this.error=a.error?.message||"Failed to confirm production",this.submitting=!1}})}goBack(){this.operation?.order?.orderId?this.router.navigate(["/orders",this.operation.order.orderId]):this.router.navigate(["/orders"])}goToBatch(e){this.router.navigate(["/batches",e])}static{this.\u0275fac=function(l){return new(l||o)(E(K),E(X),E(de),E(B))}}static{this.\u0275cmp=O({type:o,selectors:[["app-production-confirm"]],decls:11,vars:4,consts:[[1,"container"],[1,"page-header"],[1,"btn","btn-secondary",3,"click"],[1,"fas","fa-arrow-left"],[1,"page-title"],["class","text-center",4,"ngIf"],["class","success-container",4,"ngIf"],[4,"ngIf"],["class","card",4,"ngIf"],[1,"text-center"],["message","Loading operation details..."],[1,"success-container"],[1,"card","success-card"],[1,"success-icon"],[1,"fas","fa-circle-check"],[1,"result-summary"],[1,"result-row"],[1,"result-label"],[1,"result-value"],["class","result-row",4,"ngIf"],[3,"status"],[1,"success-actions"],[1,"btn","btn-primary",3,"click"],["class","btn btn-secondary",3,"click",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"operation-info-grid"],[1,"info-item"],[1,"info-label"],[1,"info-value"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-6"],[1,"form-group"],["for","startTime"],["type","datetime-local","id","startTime","formControlName","startTime",1,"form-control"],["class","field-error",4,"ngIf"],["for","endTime"],["type","datetime-local","id","endTime","formControlName","endTime",1,"form-control"],["for","quantityProduced"],["type","number","id","quantityProduced","formControlName","quantityProduced","min","0",1,"form-control"],["for","quantityScrapped"],["type","number","id","quantityScrapped","formControlName","quantityScrapped","min","0",1,"form-control"],["class","suggested-consumption",4,"ngIf"],[1,"available-materials"],["class","table",4,"ngIf"],["class","no-data",4,"ngIf"],["class","selected-materials",4,"ngIf"],["class","bom-requirements",4,"ngIf"],["class","bom-validation",4,"ngIf"],[1,"selection-count"],[1,"checkbox-group"],["class","checkbox-item",4,"ngFor","ngForOf"],["class","no-data-small",4,"ngIf"],["for","delayMinutes"],["type","number","id","delayMinutes","formControlName","delayMinutes","min","0","placeholder","0",1,"form-control"],["for","delayReason"],["class","required",4,"ngIf"],["id","delayReason","formControlName","delayReason",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],["id","notes","formControlName","notes","rows","3","placeholder","Add any notes about this production confirmation...",1,"form-control"],["class","alert alert-error",4,"ngIf"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-success",3,"disabled"],["class","spinner",4,"ngIf"],[1,"field-error"],[1,"suggested-consumption"],[1,"suggestion-header"],["type","button",1,"btn","btn-primary","btn-sm",3,"click","disabled"],[1,"suggestion-info"],[1,"suggestion-label"],[1,"suggestion-value"],[1,"table","suggestion-table"],[3,"insufficient",4,"ngFor","ngForOf"],["class","alert alert-warning",4,"ngIf"],[1,"stock-status"],[1,"alert","alert-warning"],[1,"table"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[1,"no-data"],[1,"selected-materials"],["type","number",1,"form-control","consume-qty",3,"change","value","min","max"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],[1,"bom-requirements"],[1,"table","bom-table"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"bom-status",3,"ngClass"],[1,"bom-validation"],[1,"alert","alert-error"],[1,"checkbox-item"],[1,"checkbox-label"],["type","checkbox",3,"change","checked"],[1,"checkbox-text"],[1,"no-data-small"],[1,"required"],[3,"value"],["formArrayName","processParameters"],["class","form-group",4,"ngFor","ngForOf"],[3,"formGroupName"],["class","param-hint",4,"ngIf"],["type","number","formControlName","parameterValue","step","any",1,"form-control",3,"placeholder"],[1,"param-hint"],[1,"spinner"]],template:function(l,a){l&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),C("click",function(){return a.goBack()}),b(3,"i",3),i(4," Back to Order"),t(),n(5,"h1",4),i(6,"Production Confirmation"),t()(),p(7,Ce,2,0,"div",5)(8,ye,31,6,"div",6)(9,ot,131,31,"div",7)(10,rt,3,1,"div",8),t()),l&2&&(r(7),d("ngIf",a.loading),r(),d("ngIf",a.success&&a.confirmationResult),r(),d("ngIf",!a.loading&&!a.success&&a.operation),r(),d("ngIf",!a.loading&&!a.operation&&!a.success))},dependencies:[w,k,q,te,V,D,R,ne,N,F,Z,le,ie,ae,oe,re,ce,me,Y],styles:[".page-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:24px;margin-bottom:24px}.operation-info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.info-label[_ngcontent-%COMP%]{font-size:12px;color:#888;text-transform:uppercase}.info-value[_ngcontent-%COMP%]{font-size:14px;font-weight:500}.available-materials[_ngcontent-%COMP%]{margin-bottom:24px}.available-materials[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .selected-materials[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;font-weight:500;margin-bottom:12px;color:#555}.consume-qty[_ngcontent-%COMP%]{width:100px;padding:6px 8px}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:24px;margin-bottom:40px}.no-data[_ngcontent-%COMP%]{color:#888;text-align:center;padding:20px}.required[_ngcontent-%COMP%]{color:#d32f2f}.param-hint[_ngcontent-%COMP%]{font-size:12px;color:#888;font-weight:400}.success-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px 0}.success-card[_ngcontent-%COMP%]{text-align:center;max-width:500px;width:100%}.success-icon[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background:#4caf50;color:#fff;font-size:40px;display:flex;align-items:center;justify-content:center;margin:0 auto 24px}.success-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#2e7d32;margin-bottom:24px}.result-summary[_ngcontent-%COMP%]{background:#f5f5f5;border-radius:8px;padding:20px;margin-bottom:24px}.result-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee}.result-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.result-label[_ngcontent-%COMP%]{color:#666}.result-value[_ngcontent-%COMP%]{font-weight:500}.success-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center}.spinner[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.bom-requirements[_ngcontent-%COMP%]{margin-top:24px;padding-top:24px;border-top:1px solid #e0e0e0}.bom-requirements[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;font-weight:500;margin-bottom:12px;color:#555}.bom-table[_ngcontent-%COMP%]   tr.bom-met[_ngcontent-%COMP%]{background-color:#e8f5e9}.bom-table[_ngcontent-%COMP%]   tr.bom-partial[_ngcontent-%COMP%]{background-color:#fff3e0}.bom-table[_ngcontent-%COMP%]   tr.bom-missing[_ngcontent-%COMP%]{background-color:#ffebee}.bom-status[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500}.bom-status.met[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.bom-status.partial[_ngcontent-%COMP%]{background-color:#ff9800;color:#fff}.bom-status.missing[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.bom-validation[_ngcontent-%COMP%]{margin-top:16px}.bom-validation[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:8px 0 0 20px;padding:0}.alert-warning[_ngcontent-%COMP%]{background-color:#fff3e0;color:#e65100;border:1px solid #ffcc80;padding:12px 16px;border-radius:4px;margin-bottom:12px}.checkbox-group[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto;border:1px solid #e0e0e0;border-radius:4px;padding:12px;background:#fafafa}.checkbox-item[_ngcontent-%COMP%]{margin-bottom:8px}.checkbox-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;padding:6px 8px;border-radius:4px;transition:background-color .2s}.checkbox-label[_ngcontent-%COMP%]:hover{background-color:#e3f2fd}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-right:10px;width:18px;height:18px;cursor:pointer}.checkbox-text[_ngcontent-%COMP%]{font-size:14px;color:#333}.selection-count[_ngcontent-%COMP%]{font-size:12px;color:#666;font-weight:400}.no-data-small[_ngcontent-%COMP%]{color:#888;font-size:13px;margin:0}.field-error[_ngcontent-%COMP%]{color:#d32f2f;font-size:12px;margin-top:4px}input[type=datetime-local][_ngcontent-%COMP%]{padding:8px 12px}.suggested-consumption[_ngcontent-%COMP%]{background:#e3f2fd;border:1px solid #90caf9;border-radius:8px;padding:16px;margin-bottom:24px}.suggestion-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.suggestion-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:#1565c0;font-size:14px}.suggestion-info[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:12px;font-size:14px}.suggestion-label[_ngcontent-%COMP%]{color:#666}.suggestion-value[_ngcontent-%COMP%]{font-weight:600;color:#1565c0}.suggestion-table[_ngcontent-%COMP%]{background:#fff;margin-bottom:12px}.suggestion-table[_ngcontent-%COMP%]   tr.insufficient[_ngcontent-%COMP%]{background-color:#ffebee}.stock-status[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500}.stock-status.ok[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.stock-status.low[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}@media (max-width: 768px){.operation-info-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.row[_ngcontent-%COMP%]{flex-direction:column}.col-6[_ngcontent-%COMP%]{flex:0 0 100%;max-width:100%}.checkbox-group[_ngcontent-%COMP%]{max-height:150px}}"]})}}return o})();function at(o,s){if(o&1&&(n(0,"option",17),i(1),t()),o&2){let e=s.$implicit;d("value",e),r(),u(e)}}function lt(o,s){if(o&1&&(n(0,"div",18)(1,"div",19)(2,"span",20),i(3),t(),n(4,"span",21),i(5,"Total"),t()(),n(6,"div",22)(7,"span",20),i(8),t(),n(9,"span",21),i(10,"Confirmed"),t()(),n(11,"div",23)(12,"span",20),i(13),t(),n(14,"span",21),i(15,"Pending Review"),t()(),n(16,"div",24)(17,"span",20),i(18),t(),n(19,"span",21),i(20,"Rejected"),t()()()),o&2){let e=c();r(3),u(e.allConfirmations.length),r(5),u(e.countByStatus("CONFIRMED")),r(5),u(e.countByStatus("PENDING_REVIEW")),r(5),u(e.countByStatus("REJECTED"))}}function dt(o,s){if(o&1){let e=y();n(0,"tr",30),C("click",function(){let a=g(e).$implicit,m=c(3);return _(m.toggleDetail(a))}),n(1,"td"),i(2),t(),n(3,"td"),i(4),t(),n(5,"td"),i(6),t(),n(7,"td"),i(8),t(),n(9,"td"),i(10),t(),n(11,"td"),i(12),t(),n(13,"td")(14,"span",31),i(15),t()(),n(16,"td"),i(17),t()()}if(o&2){let e=s.$implicit,l=c(3);P("selected",l.selectedConfirmation===e)("rejected-row",e.status==="REJECTED"),r(2),u(e.confirmationId),r(2),u(e.operationName||"-"),r(2),u((e.outputBatch==null?null:e.outputBatch.batchNumber)||"-"),r(2),u(e.producedQty),r(2),u(e.scrapQty||0),r(2),u(l.getDuration(e.startTime,e.endTime)),r(2),d("ngClass",l.getStatusClass(e.status)),r(),f(" ",e.status," "),r(2),u(l.formatDateTime(e.createdOn))}}function st(o,s){if(o&1&&(n(0,"table",28)(1,"thead")(2,"tr")(3,"th"),i(4,"ID"),t(),n(5,"th"),i(6,"Operation"),t(),n(7,"th"),i(8,"Output Batch"),t(),n(9,"th"),i(10,"Produced Qty"),t(),n(11,"th"),i(12,"Scrap Qty"),t(),n(13,"th"),i(14,"Duration"),t(),n(15,"th"),i(16,"Status"),t(),n(17,"th"),i(18,"Created"),t()()(),n(19,"tbody"),p(20,dt,18,13,"tr",29),t()()),o&2){let e=c(2);r(20),d("ngForOf",e.confirmations)}}function ct(o,s){o&1&&(n(0,"div",32)(1,"p"),i(2,"No production confirmations found."),t()())}function mt(o,s){if(o&1&&(n(0,"div",33),i(1),t()),o&2){let e=c(2);r(),x(" Showing ",e.confirmations.length," of ",e.allConfirmations.length," confirmations ")}}function pt(o,s){if(o&1&&(n(0,"div",25),p(1,st,21,1,"table",26)(2,ct,3,0,"ng-template",null,1,$)(4,mt,2,2,"div",27),t()),o&2){let e=Q(3),l=c();r(),d("ngIf",l.confirmations.length>0)("ngIfElse",e),r(3),d("ngIf",l.confirmations.length>0)}}function ut(o,s){o&1&&(n(0,"div",34),i(1,"Loading production history..."),t())}function ft(o,s){if(o&1&&(n(0,"span"),i(1),t()),o&2){let e=c(3);r(),f(" - ",e.selectedConfirmation.delayReason,"")}}function gt(o,s){if(o&1&&(n(0,"div",40)(1,"span",41),i(2,"Delay:"),t(),i(3),p(4,ft,2,1,"span",45),t()),o&2){let e=c(2);r(3),f(" ",e.selectedConfirmation.delayMinutes,"min "),r(),d("ngIf",e.selectedConfirmation.delayReason)}}function _t(o,s){if(o&1&&(n(0,"div",40)(1,"span",41),i(2,"Notes:"),t(),i(3),t()),o&2){let e=c(2);r(3),f(" ",e.selectedConfirmation.notes," ")}}function xt(o,s){if(o&1&&(n(0,"div",39)(1,"h4"),i(2,"Output Batch"),t(),n(3,"div",40)(4,"span",41),i(5,"Batch:"),t(),i(6),t(),n(7,"div",40)(8,"span",41),i(9,"Material:"),t(),i(10),t(),n(11,"div",40)(12,"span",41),i(13,"Quantity:"),t(),i(14),t()()),o&2){let e=c(2);r(6),f(" ",e.selectedConfirmation.outputBatch.batchNumber,""),r(4),f(" ",e.selectedConfirmation.outputBatch.materialName,""),r(4),x(" ",e.selectedConfirmation.outputBatch.quantity," ",e.selectedConfirmation.outputBatch.unit,"")}}function vt(o,s){if(o&1&&(n(0,"div",40),i(1),t()),o&2){let e=s.$implicit;r(),x(" ",e.name," (",e.equipmentCode,") ")}}function Ct(o,s){if(o&1&&(n(0,"div",39)(1,"h4"),i(2,"Equipment"),t(),p(3,vt,2,2,"div",46),t()),o&2){let e=c(2);r(3),d("ngForOf",e.selectedConfirmation.equipment)}}function ht(o,s){if(o&1&&(n(0,"div",40),i(1),t()),o&2){let e=s.$implicit;r(),x(" ",e.name," (",e.operatorCode,") ")}}function bt(o,s){if(o&1&&(n(0,"div",39)(1,"h4"),i(2,"Operators"),t(),p(3,ht,2,2,"div",46),t()),o&2){let e=c(2);r(3),d("ngForOf",e.selectedConfirmation.operators)}}function yt(o,s){if(o&1&&(n(0,"div",40),i(1),t()),o&2){let e=s.$implicit;r(),I(" ",e.materialId," - Batch ",e.batchNumber," (",e.quantityConsumed,") ")}}function St(o,s){if(o&1&&(n(0,"div",39)(1,"h4"),i(2,"Materials Consumed"),t(),p(3,yt,2,3,"div",46),t()),o&2){let e=c(2);r(3),d("ngForOf",e.selectedConfirmation.materialsConsumed)}}function Et(o,s){if(o&1&&(n(0,"div",47)(1,"h4"),i(2,"Rejection"),t(),n(3,"div",40)(4,"span",41),i(5,"Reason:"),t(),i(6),t(),n(7,"div",40)(8,"span",41),i(9,"Rejected By:"),t(),i(10),t(),n(11,"div",40)(12,"span",41),i(13,"Rejected On:"),t(),i(14),t()()),o&2){let e=c(2);r(6),f(" ",e.selectedConfirmation.rejectionReason,""),r(4),f(" ",e.selectedConfirmation.rejectedBy,""),r(4),f(" ",e.formatDateTime(e.selectedConfirmation.rejectedOn),"")}}function Pt(o,s){if(o&1){let e=y();n(0,"div",35)(1,"div",36)(2,"h3"),i(3),t(),n(4,"button",37),C("click",function(){g(e);let a=c();return _(a.selectedConfirmation=null)}),i(5,"Close"),t()(),n(6,"div",38)(7,"div",39)(8,"h4"),i(9,"Production Details"),t(),n(10,"div",40)(11,"span",41),i(12,"Operation:"),t(),i(13),t(),n(14,"div",40)(15,"span",41),i(16,"Produced Qty:"),t(),i(17),t(),n(18,"div",40)(19,"span",41),i(20,"Scrap Qty:"),t(),i(21),t(),n(22,"div",40)(23,"span",41),i(24,"Start:"),t(),i(25),t(),n(26,"div",40)(27,"span",41),i(28,"End:"),t(),i(29),t(),p(30,gt,5,2,"div",42)(31,_t,4,1,"div",42),t(),p(32,xt,15,4,"div",43)(33,Ct,4,1,"div",43)(34,bt,4,1,"div",43)(35,St,4,1,"div",43)(36,Et,15,3,"div",44),t()()}if(o&2){let e=c();r(3),f("Confirmation #",e.selectedConfirmation.confirmationId,""),r(10),f(" ",e.selectedConfirmation.operationName,""),r(4),f(" ",e.selectedConfirmation.producedQty,""),r(4),f(" ",e.selectedConfirmation.scrapQty||0,""),r(4),f(" ",e.formatDateTime(e.selectedConfirmation.startTime),""),r(4),f(" ",e.formatDateTime(e.selectedConfirmation.endTime),""),r(),d("ngIf",e.selectedConfirmation.delayMinutes),r(),d("ngIf",e.selectedConfirmation.notes),r(),d("ngIf",e.selectedConfirmation.outputBatch),r(),d("ngIf",e.selectedConfirmation.equipment==null?null:e.selectedConfirmation.equipment.length),r(),d("ngIf",e.selectedConfirmation.operators==null?null:e.selectedConfirmation.operators.length),r(),d("ngIf",e.selectedConfirmation.materialsConsumed==null?null:e.selectedConfirmation.materialsConsumed.length),r(),d("ngIf",e.selectedConfirmation.rejectionReason)}}var fe=(()=>{class o{constructor(e){this.apiService=e,this.allConfirmations=[],this.confirmations=[],this.loading=!0,this.error="",this.filterStatus="all",this.searchTerm="",this.statuses=["CONFIRMED","PENDING_REVIEW","PARTIALLY_CONFIRMED","REJECTED"],this.selectedConfirmation=null}ngOnInit(){this.loadConfirmations()}loadConfirmations(){this.loading=!0,this.error="",this.allConfirmations=[];let e=0,l=this.statuses.length;this.statuses.forEach(a=>{this.apiService.getConfirmationsByStatus(a).subscribe({next:m=>{this.allConfirmations.push(...m),e++,e===l&&(this.allConfirmations.sort((v,h)=>(h.confirmationId||0)-(v.confirmationId||0)),this.applyFilters(),this.loading=!1)},error:()=>{e++,e===l&&(this.applyFilters(),this.loading=!1)}})})}applyFilters(){let e=[...this.allConfirmations];if(this.filterStatus&&this.filterStatus!=="all"&&(e=e.filter(l=>l.status===this.filterStatus)),this.searchTerm){let l=this.searchTerm.toLowerCase();e=e.filter(a=>a.operationName?.toLowerCase().includes(l)||a.outputBatch?.batchNumber?.toLowerCase().includes(l)||String(a.confirmationId).includes(l)||a.notes?.toLowerCase().includes(l))}this.confirmations=e}onFilterStatusChange(e){this.filterStatus=e,this.applyFilters()}onSearchChange(e){this.searchTerm=e,this.applyFilters()}getStatusClass(e){return e?.toLowerCase().replace(/_/g,"-")||""}countByStatus(e){return this.allConfirmations.filter(l=>l.status===e).length}formatDateTime(e){return e?new Date(e).toLocaleString():"-"}getDuration(e,l){if(!e||!l)return"-";let a=new Date(l).getTime()-new Date(e).getTime(),m=Math.round(a/6e4);return m<60?`${m}m`:`${Math.floor(m/60)}h ${m%60}m`}toggleDetail(e){this.selectedConfirmation=this.selectedConfirmation===e?null:e}static{this.\u0275fac=function(l){return new(l||o)(E(B))}}static{this.\u0275cmp=O({type:o,selectors:[["app-production-history"]],decls:22,vars:7,consts:[["loadingTpl",""],["emptyTpl",""],[1,"production-history-page"],[1,"page-header"],[1,"card"],[1,"filters"],[1,"filter-group"],["for","status-filter"],["id","status-filter",3,"ngModelChange","change","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"filter-group","search-group"],["for","search"],["type","text","id","search","placeholder","Search by operation, batch, notes...",3,"ngModelChange","input","ngModel"],["class","summary-cards",4,"ngIf"],["class","table-container",4,"ngIf","ngIfElse"],["class","detail-panel card",4,"ngIf"],[3,"value"],[1,"summary-cards"],[1,"summary-card"],[1,"count"],[1,"label"],[1,"summary-card","confirmed"],[1,"summary-card","pending"],[1,"summary-card","rejected"],[1,"table-container"],["class","data-table",4,"ngIf","ngIfElse"],["class","result-count",4,"ngIf"],[1,"data-table"],["class","clickable-row",3,"selected","rejected-row","click",4,"ngFor","ngForOf"],[1,"clickable-row",3,"click"],[1,"status-badge",3,"ngClass"],[1,"empty-state"],[1,"result-count"],[1,"loading"],[1,"detail-panel","card"],[1,"detail-header"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"detail-grid"],[1,"detail-section"],[1,"detail-row"],[1,"detail-label"],["class","detail-row",4,"ngIf"],["class","detail-section",4,"ngIf"],["class","detail-section rejection",4,"ngIf"],[4,"ngIf"],["class","detail-row",4,"ngFor","ngForOf"],[1,"detail-section","rejection"]],template:function(l,a){if(l&1){let m=y();n(0,"div",2)(1,"div",3)(2,"h1"),i(3,"Production History"),t()(),n(4,"div",4)(5,"div",5)(6,"div",6)(7,"label",7),i(8,"Status:"),t(),n(9,"select",8),H("ngModelChange",function(h){return g(m),A(a.filterStatus,h)||(a.filterStatus=h),_(h)}),C("change",function(){return g(m),_(a.onFilterStatusChange(a.filterStatus))}),n(10,"option",9),i(11,"All Statuses"),t(),p(12,at,2,2,"option",10),t()(),n(13,"div",11)(14,"label",12),i(15,"Search:"),t(),n(16,"input",13),H("ngModelChange",function(h){return g(m),A(a.searchTerm,h)||(a.searchTerm=h),_(h)}),C("input",function(){return g(m),_(a.onSearchChange(a.searchTerm))}),t()()()(),p(17,lt,21,4,"div",14)(18,pt,5,3,"div",15)(19,ut,2,0,"ng-template",null,0,$)(21,Pt,37,13,"div",16),t()}if(l&2){let m=Q(20);r(9),j("ngModel",a.filterStatus),r(3),d("ngForOf",a.statuses),r(4),j("ngModel",a.searchTerm),r(),d("ngIf",!a.loading),r(),d("ngIf",!a.loading)("ngIfElse",m),r(3),d("ngIf",a.selectedConfirmation)}},dependencies:[w,k,q,V,D,R,N,F,ee],styles:[".production-history-page[_ngcontent-%COMP%]{padding:20px}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:12px 16px;border-radius:4px;margin-bottom:16px}.summary-cards[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:20px;flex-wrap:wrap}.summary-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:16px 24px;box-shadow:0 1px 3px #0000001a;text-align:center;min-width:120px;border-top:3px solid #dee2e6}.summary-card[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{display:block;font-size:24px;font-weight:700;color:#333}.summary-card[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;color:#666;text-transform:uppercase}.summary-card.confirmed[_ngcontent-%COMP%]{border-top-color:#388e3c}.summary-card.pending[_ngcontent-%COMP%]{border-top-color:#f57c00}.summary-card.rejected[_ngcontent-%COMP%]{border-top-color:#d32f2f}.table-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;overflow:hidden}.clickable-row[_ngcontent-%COMP%]{cursor:pointer;transition:background .15s}.clickable-row[_ngcontent-%COMP%]:hover{background:#f8f9fa}.clickable-row.selected[_ngcontent-%COMP%]{background:#e3f2fd}.rejected-row[_ngcontent-%COMP%]{background:#fff5f5}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:12px;font-size:12px;font-weight:500;text-transform:uppercase}.status-badge.confirmed[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-badge.pending-review[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-badge.partially-confirmed[_ngcontent-%COMP%]{background:#cce5ff;color:#004085}.status-badge.rejected[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.result-count[_ngcontent-%COMP%]{padding:12px 16px;border-top:1px solid #eee;font-size:13px;color:#666}.empty-state[_ngcontent-%COMP%], .loading[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#666}.detail-panel[_ngcontent-%COMP%]{margin-top:20px}.detail-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.detail-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.detail-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}.detail-section[_ngcontent-%COMP%]{padding:12px;background:#f8f9fa;border-radius:6px}.detail-section.rejection[_ngcontent-%COMP%]{background:#fff5f5;border:1px solid #f8d7da}.detail-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;font-size:14px;color:#555;text-transform:uppercase;letter-spacing:.03em}.detail-row[_ngcontent-%COMP%]{padding:4px 0;font-size:14px}.detail-label[_ngcontent-%COMP%]{font-weight:500;color:#555}"]})}}return o})();var It=[{path:"confirm/:operationId",component:ue},{path:"history",component:fe},{path:"",redirectTo:"history",pathMatch:"full"}],ge=(()=>{class o{static{this.\u0275fac=function(l){return new(l||o)}}static{this.\u0275mod=T({type:o})}static{this.\u0275inj=M({imports:[z.forChild(It),z]})}}return o})();var Lt=(()=>{class o{static{this.\u0275fac=function(l){return new(l||o)}}static{this.\u0275mod=T({type:o})}static{this.\u0275inj=M({imports:[U,se,ge,pe]})}}return o})();export{Lt as ProductionModule};
